<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d9/d7f/tripal_8entities_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal.entities.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga46df8084aa82f744920d66ac59ae9a38" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>_tripal_get_bundle_field_element_details</definition>
        <argsstring>($elements, &amp;$field_details)</argsstring>
        <name>_tripal_get_bundle_field_element_details</name>
        <param>
          <declname>$elements</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$field_details</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A recursive helper function for the tripal_get_bundle_details.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$elementInfo</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1533" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1533" bodyend="1562"/>
      </memberdef>
      <memberdef kind="function" id="d9/d7f/tripal_8entities_8api_8inc_1a95c7d0cd51877955bfd3477bf37c5808" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>_tripal_get_entity_tokens_for_elements</definition>
        <argsstring>($instance, $parent, $elements, &amp;$tokens, $options)</argsstring>
        <name>_tripal_get_entity_tokens_for_elements</name>
        <param>
          <declname>$instance</declname>
        </param>
        <param>
          <declname>$parent</declname>
        </param>
        <param>
          <declname>$elements</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$tokens</declname>
        </param>
        <param>
          <declname>$options</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A recursive helper function to get tokens for element sub fields.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$instance</parametername>
</parameternamelist>
<parameterdescription>
<para>A original field instance object. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$parent</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the parent. The first time this is called outside of recursion this should be the field name. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$elements</parametername>
</parameternamelist>
<parameterdescription>
<para>The array of elements to process. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>The array of tokens to be added to. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1217" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1217" bodyend="1258"/>
      </memberdef>
      <memberdef kind="function" id="d9/d7f/tripal_8entities_8api_8inc_1a0d5955f1c1d9c7c60821f943d2f3e7a3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>_tripal_replace_entity_tokens_for_elements</definition>
        <argsstring>($elements, $values)</argsstring>
        <name>_tripal_replace_entity_tokens_for_elements</name>
        <param>
          <declname>$elements</declname>
        </param>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A helper function for tripal_replace_entity_tokens to get token values.</para><para>This helper function is used when the tokens are from subelements. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$entity</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1381" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1381" bodyend="1390"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gaf9f571c2cb42fe6578e4b2a85432d792" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_bundle_create</definition>
        <argsstring>(&amp;$bundle, $storage_args)</argsstring>
        <name>hook_bundle_create</name>
        <param>
          <type>&amp;</type>
          <declname>$bundle</declname>
        </param>
        <param>
          <declname>$storage_args</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Allows a module to perform tasks after a <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> object is created.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle</parametername>
</parameternamelist>
<parameterdescription>
<para>The newly created <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> object. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$storage_args</parametername>
</parameternamelist>
<parameterdescription>
<para>Arguments passed to the storage backend for this bundle. These arguments typically provide details for how to associate this bundle with records in the storage system. Each storage system will have its own set of arguments that it will expect. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="80" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="80" bodyend="82"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga8f8e40c7836f31085b3ba5b151a01304" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_bundle_delete</definition>
        <argsstring>($bundle)</argsstring>
        <name>hook_bundle_delete</name>
        <param>
          <declname>$bundle</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Allows a module to perform tasks before a <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> object is deleted.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle</parametername>
</parameternamelist>
<parameterdescription>
<para>The newly created <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> object. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="112" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="112" bodyend="114"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gaf8be8ab20c6d9e3ec5a5073508c337a4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_bundle_postcreate</definition>
        <argsstring>(&amp;$bundle)</argsstring>
        <name>hook_bundle_postcreate</name>
        <param>
          <type>&amp;</type>
          <declname>$bundle</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Allows a module to perform tasks after fields are added to a <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref>.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle</parametername>
</parameternamelist>
<parameterdescription>
<para>The newly created <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> object. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="91" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="91" bodyend="93"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gac67a33dfa03f9f2981873a6d94a890c8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_entity_create</definition>
        <argsstring>(&amp;$entity, $entity_type)</argsstring>
        <name>hook_entity_create</name>
        <param>
          <type>&amp;</type>
          <declname>$entity</declname>
        </param>
        <param>
          <declname>$entity_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="63" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="63" bodyend="65"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga87e87c32adeeefff7ac905b884b06fde" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_tripal_cron_notification</definition>
        <argsstring>()</argsstring>
        <name>hook_tripal_cron_notification</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Allows a module to add admin notifications to the associated tripal table during the cron run. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="100" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="100" bodyend="102"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga7b7a007b158eaa50f4f5fa2e97320003" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_tripal_default_title_format</definition>
        <argsstring>($bundle, $available_tokens)</argsstring>
        <name>hook_tripal_default_title_format</name>
        <param>
          <declname>$bundle</declname>
        </param>
        <param>
          <declname>$available_tokens</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implement this hook to define default formats for Tripal Content Types.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype><ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref></parametertype>
<parametername>$bundle</parametername>
</parameternamelist>
<parameterdescription>
<para>A tripal content type entity with information to be used for determining the default title format. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$available_tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of available tokens for this particular tripal content type.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>array An array of potential formats. The lightest weighted format suggested by all modules will be chosen. Each array item should consist of a &apos;weight&apos; and &apos;format&apos;. See the hook implementation below for examples.<itemizedlist>
<listitem><para>weight: an integer used to determine priority of suggestions. The smaller/lighter the number the higher the priority. Best practice is to use a weight less than 0 for extension modules. specifically, -2 is a good weight for calculated formats and -5 is a good weight for hard-coded formats specific to a given type.</para></listitem><listitem><para>format: a string including approved tokens used to determine the title on Tripal content pages. </para></listitem></itemizedlist>
</para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="140" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="140" bodyend="175"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga2c17dc368ac82e83398f642885bfd9fb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>theme_token_list</definition>
        <argsstring>($tokens)</argsstring>
        <name>theme_token_list</name>
        <param>
          <declname>$tokens</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Formats the tokens for display.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>A list of tokens generated via <ref refid="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" kindref="member">tripal_get_entity_tokens()</ref>. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Rendered output describing the available tokens. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1402" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1402" bodyend="1415"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gab6848d2947f13ae562d8fe604de26142" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_add_notification</definition>
        <argsstring>($title, $details, $type, $actions, $submitter_id)</argsstring>
        <name>tripal_add_notification</name>
        <param>
          <declname>$title</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <param>
          <declname>$type</declname>
        </param>
        <param>
          <declname>$actions</declname>
        </param>
        <param>
          <declname>$submitter_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Allows a module to write to the admin notification table.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$title</parametername>
</parameternamelist>
<parameterdescription>
<para>A generic phrase indicating what the notification is for. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para>A human-readable sentence or two describing the issue. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$type</parametername>
</parameternamelist>
<parameterdescription>
<para>A one word type indicating the type of notification. Tripal types include: Jobs, Fields. If no type is required please pass NULL. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$actions</parametername>
</parameternamelist>
<parameterdescription>
<para>A serialized PHP associative array containing the link and URL for each action. If not type is required please pass NULL. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$submitter_id</parametername>
</parameternamelist>
<parameterdescription>
<para>A unique ID provided by the submitter for checking to make sure that the notification is not added more than once. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="381" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="381" bodyend="406"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gae741bc8f60274eee9fbe4e2ca062fe83" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_create_bundle</definition>
        <argsstring>($args, &amp;$error=&apos;&apos;)</argsstring>
        <name>tripal_create_bundle</name>
        <param>
          <declname>$args</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$error</declname>
          <defval>&apos;&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Creates a new Tripal Entity type (i.e. bundle).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$args</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of arguments that must include the following keys:<itemizedlist>
<listitem><para>vocabulary: The abbreviated vocabulary for the vocabulary (e.g. RO, SO, PATO).</para></listitem><listitem><para>accession: The unique term ID in the vocabulary $vocabulary (i.e. an accession).</para></listitem><listitem><para>term_name: A human-readable name for this term. This will became the name that appears for the content type. In practice, this should be the name of the term. (E.g. the name for SO:0000704 is gene). </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$error</parametername>
</parameternamelist>
<parameterdescription>
<para>A string, passed by reference, that is filled with the error message if the function fails.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The bundle object or FALSE if failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="429" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="429" bodyend="553"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gaece8addc446db986888dea9c9a339955" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_create_bundle_fields</definition>
        <argsstring>($bundle, $term)</argsstring>
        <name>tripal_create_bundle_fields</name>
        <param>
          <declname>$bundle</declname>
        </param>
        <param>
          <declname>$term</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Refreshes the bundle such that new fields added by modules will be found.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the bundle to refresh (e.g. bio_data_4). </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$term</parametername>
</parameternamelist>
<parameterdescription>
<para>The term object for the bundle.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The array of field instance names that were added. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="682" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="682" bodyend="818"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga5a80b6313c62a09790cdfdb15ac3a122" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_entity_label</definition>
        <argsstring>($entity)</argsstring>
        <name>tripal_entity_label</name>
        <param>
          <declname>$entity</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Define the entity label callback. This will return the title.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$entity</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>mixed </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1426" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1426" bodyend="1431"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga7bad5fec2219d0f880f65290e71ec0d4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_bundle_details</definition>
        <argsstring>($bundle_name)</argsstring>
        <name>tripal_get_bundle_details</name>
        <param>
          <declname>$bundle_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves details, including attached fields, for a given bundle.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the bundle (e.g. bio_data_xx)</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An array containing the name, label, controlled vocabulary details and a list of fields attached to the bundle. Returns FALSE if the bundle does not exist. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1446" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1446" bodyend="1525"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_bundle_variable</definition>
        <argsstring>($variable_name, $bundle_id, $default=FALSE)</argsstring>
        <name>tripal_get_bundle_variable</name>
        <param>
          <declname>$variable_name</declname>
        </param>
        <param>
          <declname>$bundle_id</declname>
        </param>
        <param>
          <declname>$default</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="937" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="937" bodyend="960"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga52a167fdb04c89c9ce53db5f803cab63" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_content_type</definition>
        <argsstring>($bundle_name)</argsstring>
        <name>tripal_get_content_type</name>
        <param>
          <declname>$bundle_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves information about a given content type.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of a bundle.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An object containing information about the bundle. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="661" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="661" bodyend="667"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga193227c1fd8a379805e054ab4dd2b4cf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_content_types</definition>
        <argsstring>()</argsstring>
        <name>tripal_get_content_types</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a list of the content types.</para><para><simplesect kind="return"><para>An array of bundles. Each bundle is an object containing information about that bundle. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="564" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="564" bodyend="569"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gadda52167dced1ec99f937d18da58eda7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_default_title_format</definition>
        <argsstring>($bundle)</argsstring>
        <name>tripal_get_default_title_format</name>
        <param>
          <declname>$bundle</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Determine the default title format to use for an entity.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype><ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref></parametertype>
<parametername>$bundle</parametername>
</parameternamelist>
<parameterdescription>
<para>The Entity object for the Tripal Bundle that the title format is for.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>string A default title format. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1073" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1073" bodyend="1111"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_entity_tokens</definition>
        <argsstring>($bundle, $options=array())</argsstring>
        <name>tripal_get_entity_tokens</name>
        <param>
          <declname>$bundle</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns an array of tokens based on Tripal Entity Fields.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype><ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref></parametertype>
<parametername>$bundle</parametername>
</parameternamelist>
<parameterdescription>
<para>The bundle entity for which you want tokens. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An array of tokens where the key is the machine_name of the token. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1124" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1124" bodyend="1202"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gaed3e1bc34351087f058114cec1c33081" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_title_format</definition>
        <argsstring>($bundle)</argsstring>
        <name>tripal_get_title_format</name>
        <param>
          <declname>$bundle</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1032" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1032" bodyend="1045"/>
      </memberdef>
      <memberdef kind="function" id="d9/d7f/tripal_8entities_8api_8inc_1a870d12f8becbd6cd6cff132253738d5c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_insert_entity</definition>
        <argsstring>($bundle_name, $values)</argsstring>
        <name>tripal_insert_entity</name>
        <param>
          <declname>$bundle_name</declname>
        </param>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Is this completed? It doesn&apos;t look right and I can&apos;t find it used anywhere in the existing code.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the bundle (e.g. bio_data_xx) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>unknown</parametertype>
<parametername>$values</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1576" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1576" bodyend="1622"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_load_bundle_entity</definition>
        <argsstring>($values)</argsstring>
        <name>tripal_load_bundle_entity</name>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> entity that matches the given arguments.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$values</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array used to match a bundle. Valid keys may:<itemizedlist>
<listitem><para>id: the numeric id of the bundle.</para></listitem><listitem><para>name: the bundle name (e.g. &apos;bio_data_234&apos;)</para></listitem><listitem><para>label: the bundle label (e.g. &apos;Organism&apos;)</para></listitem><listitem><para>term_id: the term ID to which the bundle belongs</para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref> entity object or NULL if not found. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="335" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="335" bodyend="358"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga9a3271fd80709ab2bac87f2033a67d59" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_load_entity</definition>
        <argsstring>($entity_type, $ids=FALSE, $reset=FALSE, $field_ids=array(), $cache=TRUE)</argsstring>
        <name>tripal_load_entity</name>
        <param>
          <declname>$entity_type</declname>
        </param>
        <param>
          <declname>$ids</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$reset</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$field_ids</declname>
          <defval>array()</defval>
        </param>
        <param>
          <declname>$cache</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="212" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="212" bodyend="234"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga8d7df332ef5e92725a5044692e85ead2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_load_term_entity</definition>
        <argsstring>($values)</argsstring>
        <name>tripal_load_term_entity</name>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a <ref refid="d9/d5a/classTripalTerm" kindref="compound">TripalTerm</ref> entity that matches the given arguments.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$values</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array used to match a term. <linebreak/>
 Valid keys may be:<itemizedlist>
<listitem><para>vocabulary: Must always be used with accession to uniquely identify a term. <linebreak/>
 - accession: Must always be used with vocabulary to uniquely identify a term.</para></listitem><listitem><para>term_id: Can be used alone to uniquely identify a term.</para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A <ref refid="d9/d5a/classTripalTerm" kindref="compound">TripalTerm</ref> entity object or NULL if not found. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="253" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="253" bodyend="281"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga1aaa769cc643f35d50f261f8e1b5d540" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_load_vocab_entity</definition>
        <argsstring>($values)</argsstring>
        <name>tripal_load_vocab_entity</name>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a <ref refid="d6/d79/classTripalVocab" kindref="compound">TripalVocab</ref> entity that maches the given arguments.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$values</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array used to match a vocabulary. <linebreak/>
 The valid keys are:<itemizedlist>
<listitem><para>vocab_id: integer id of the vocabulary.</para></listitem><listitem><para>vocabulary: string name of vocabulary.</para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A <ref refid="d6/d79/classTripalVocab" kindref="compound">TripalVocab</ref> entity object or NULL if not found. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="297" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="297" bodyend="318"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga050b81319c70291ff5e66b0df460b81a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_replace_entity_tokens</definition>
        <argsstring>($string, &amp;$entity, $bundle_entity=NULL)</argsstring>
        <name>tripal_replace_entity_tokens</name>
        <param>
          <declname>$string</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$entity</declname>
        </param>
        <param>
          <declname>$bundle_entity</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Replace all Tripal Tokens in a given string.</para><para>NOTE: If there is no value for a token then the token is removed.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>string</parametertype>
<parametername>$string</parametername>
</parameternamelist>
<parameterdescription>
<para>The string containing tokens. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype><ref refid="db/d44/classTripalEntity" kindref="compound">TripalEntity</ref></parametertype>
<parametername>$entity</parametername>
</parameternamelist>
<parameterdescription>
<para>The entity with field values used to find values of tokens. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype><ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref></parametertype>
<parametername>$bundle_entity</parametername>
</parameternamelist>
<parameterdescription>
<para>The bundle enitity containing special values sometimes needed for token replacement.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The string will all tokens replaced with values. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1277" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1277" bodyend="1373"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga64ba0896880df6f55c775573634db3ad" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_save_title_format</definition>
        <argsstring>($entity, $format)</argsstring>
        <name>tripal_save_title_format</name>
        <param>
          <declname>$entity</declname>
        </param>
        <param>
          <declname>$format</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Save Page Title Format for a given Tripal Entity Type.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype><ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref></parametertype>
<parametername>$entity</parametername>
</parameternamelist>
<parameterdescription>
<para>The Entity object for the Tripal Bundle the title format is for. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>string</parametertype>
<parametername>$format</parametername>
</parameternamelist>
<parameterdescription>
<para>The pattern to be used when generating entity titles for the above type. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1057" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1057" bodyend="1060"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_set_bundle_variable</definition>
        <argsstring>($variable_name, $bundle_id, $value)</argsstring>
        <name>tripal_set_bundle_variable</name>
        <param>
          <declname>$variable_name</declname>
        </param>
        <param>
          <declname>$bundle_id</declname>
        </param>
        <param>
          <declname>$value</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Save the value of a tripal variable for a given bundle.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>string</parametertype>
<parametername>$variable_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the variable as in tripal_variables.name. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>int</parametertype>
<parametername>$bundle_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The unique identfier for the bundle you want the value for. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$text</parametername>
</parameternamelist>
<parameterdescription>
<para>$value The value of the variable for the given bundle. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="974" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="974" bodyend="1016"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga118e7306cc739fe083689877cd863984" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_tripal_cron_notification</definition>
        <argsstring>()</argsstring>
        <name>tripal_tripal_cron_notification</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Refreshes the bundle such that new fields added by modules will be found during cron.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the bundle to refresh (e.g. bio_data_4). </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="580" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="580" bodyend="648"/>
      </memberdef>
      <memberdef kind="function" id="d5/dce/group__tripal__entities__api_1ga14dfedcffbaa4b759a05052dc2a7ccde" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_update_bundle_field</definition>
        <argsstring>($field_name, $field_info, $entity_type_name, $bundle_name)</argsstring>
        <name>tripal_update_bundle_field</name>
        <param>
          <declname>$field_name</declname>
        </param>
        <param>
          <declname>$field_info</declname>
        </param>
        <param>
          <declname>$entity_type_name</declname>
        </param>
        <param>
          <declname>$bundle_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Updates an existing field and its attached instance to a bundle.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$field_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the field. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$field_info</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array containing the field information. The following key/value pairs are supported:<itemizedlist>
<listitem><para>field_type: a valid field type. May be any of the Drupal default fields, one created by the tripal_chado module or another custom module.</para></listitem><listitem><para>widget_type: a valid widget type. May be any of the Drupal default fields, one created by the tripal_chado module or another custom module.</para></listitem><listitem><para>field_settings: an array of settings that are appropriate for the selected field type.</para></listitem><listitem><para>widget_settings: an array of settings that are appropriate for the selected widget type.</para></listitem><listitem><para>description: a default description for this field.</para></listitem><listitem><para>label: a label used as a header for this field.</para></listitem><listitem><para>is_required: indicates if the field is required in the edit form.</para></listitem><listitem><para>cardinality: indicates the number of values this field can support. the default is 1 (meaning only one value). Use a value of FIELD_CARDINALITY_UNLIMITED for unlimited number of values.</para></listitem><listitem><para>default_value: A default value for the field.</para></listitem><listitem><para>format: A string indicating the format for the field. Must be specific to the field. </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$entity_type_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The entity type name. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The bundle name.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>FALSE if the field could not be updated</para></simplesect>
TODO: this function really shouldn&apos;t try to create an instance and attach to a bundle at the same time. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="859" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="859" bodyend="917"/>
      </memberdef>
      <memberdef kind="function" id="d9/d7f/tripal_8entities_8api_8inc_1a3dbb32095411987c0cffc4314082fc21" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_update_entity</definition>
        <argsstring>($bundle_name, $values)</argsstring>
        <name>tripal_update_entity</name>
        <param>
          <declname>$bundle_name</declname>
        </param>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Are we keeping this?</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bundle_name</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$values</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.entities.api.inc" line="1632" column="1" bodyfile="tripal/api/tripal.entities.api.inc" bodystart="1632" bodyend="1635"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides an application programming interface (API) for working with <ref refid="db/d44/classTripalEntity" kindref="compound">TripalEntity</ref> content types (bundles) and their entities. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="63" refid="d5/dce/group__tripal__entities__api_1gac67a33dfa03f9f2981873a6d94a890c8" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gac67a33dfa03f9f2981873a6d94a890c8" kindref="member">hook_entity_create</ref>(&amp;$entity,<sp/>$entity_type)<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal">}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="80" refid="d5/dce/group__tripal__entities__api_1gaf9f571c2cb42fe6578e4b2a85432d792" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf9f571c2cb42fe6578e4b2a85432d792" kindref="member">hook_bundle_create</ref>(&amp;$bundle,<sp/>$storage_args)<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal">}</highlight></codeline>
<codeline lineno="91" refid="d5/dce/group__tripal__entities__api_1gaf8be8ab20c6d9e3ec5a5073508c337a4" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf8be8ab20c6d9e3ec5a5073508c337a4" kindref="member">hook_bundle_postcreate</ref>(&amp;$bundle)<sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal">}</highlight></codeline>
<codeline lineno="100" refid="d5/dce/group__tripal__entities__api_1ga87e87c32adeeefff7ac905b884b06fde" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga87e87c32adeeefff7ac905b884b06fde" kindref="member">hook_tripal_cron_notification</ref>()<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal">}</highlight></codeline>
<codeline lineno="103"><highlight class="normal"></highlight></codeline>
<codeline lineno="112" refid="d5/dce/group__tripal__entities__api_1ga8f8e40c7836f31085b3ba5b151a01304" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga8f8e40c7836f31085b3ba5b151a01304" kindref="member">hook_bundle_delete</ref>($bundle)<sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal">}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="d5/dce/group__tripal__entities__api_1ga7b7a007b158eaa50f4f5fa2e97320003" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga7b7a007b158eaa50f4f5fa2e97320003" kindref="member">hook_tripal_default_title_format</ref>($bundle,<sp/>$available_tokens)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/>$format<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>you<sp/>want<sp/>to<sp/>suggest<sp/>a<sp/>default<sp/>format<sp/>for<sp/>a<sp/>particular<sp/>vocabulary<sp/>term:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//---------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>the<sp/>term<sp/>associated<sp/>with<sp/>this<sp/>Tripal<sp/>Content<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/>entity_load(</highlight><highlight class="stringliteral">&apos;TripalTerm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;term_id));</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/>reset($term);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it&apos;s<sp/>the<sp/>term<sp/>you<sp/>are<sp/>interested<sp/>in<sp/>then<sp/>suggest<sp/>a<sp/>format.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term-&gt;name<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;organism&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>suggest<sp/>a<sp/>format,<sp/>add<sp/>an<sp/>element<sp/>to<sp/>the<sp/>array<sp/>with<sp/>a<sp/>format<sp/>&amp;<sp/>weight<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>key.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>the<sp/>format/pattern<sp/>you<sp/>suggest<sp/>be<sp/>used<sp/>to<sp/>determine<sp/>the<sp/>title<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>organism<sp/>pages.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[organism__genus]<sp/>[organism__species]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>weight/priority<sp/>of<sp/>your<sp/>suggestion.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>-5</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Say<sp/>you<sp/>know<sp/>that<sp/>in<sp/>your<sp/>particular<sp/>site,<sp/>all<sp/>&apos;names&apos;<sp/>are<sp/>required</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>you<sp/>want<sp/>to<sp/>only<sp/>use<sp/>the<sp/>human-readable<sp/>name:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//---------------------------------------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/>$name_field<sp/>=<sp/>preg_grep(</highlight><highlight class="stringliteral">&apos;/__name]$/&apos;</highlight><highlight class="normal">,<sp/>array_keys($available_tokens));</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/>$name_field<sp/>=<sp/>reset($name_field);</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_string($name_field))<sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name_field,</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>-2,</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="175"><highlight class="normal">}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="212" refid="d5/dce/group__tripal__entities__api_1ga9a3271fd80709ab2bac87f2033a67d59" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga9a3271fd80709ab2bac87f2033a67d59" kindref="member">tripal_load_entity</ref>($entity_type,<sp/>$ids<sp/>=<sp/>FALSE,<sp/>$reset<sp/>=<sp/>FALSE,</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_ids<sp/>=<sp/>array(),<sp/>$cache<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>$conditions<sp/>is<sp/>deprecated<sp/>in<sp/>the<sp/>funtion<sp/>arguments<sp/>of<sp/>entity_load</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>it<sp/>was<sp/>removed<sp/>from<sp/>the<sp/>parameters<sp/>of<sp/>this<sp/>function<sp/>as<sp/>well.<sp/>But</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>load()<sp/>function<sp/>of<sp/>the<sp/>entity<sp/>controller<sp/>still<sp/>expects<sp/>it<sp/>so<sp/>set<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>an<sp/>empty<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/>$conditions<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>isn&apos;t<sp/>a<sp/>TripalEntity<sp/>then<sp/>just<sp/>load<sp/>it<sp/>the<sp/>old<sp/>fashioned<sp/>way</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>although<sp/>caching<sp/>will<sp/>not<sp/>be<sp/>used<sp/>if<sp/>it<sp/>not<sp/>specifically<sp/>set<sp/>to<sp/>FALSE.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($entity_type<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>entity_load($entity_type,<sp/>$ids,<sp/>$conditions,<sp/>$reset);</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>entity<sp/>controller<sp/>and<sp/>clear<sp/>the<sp/>cache<sp/>if<sp/>requested<sp/>(default).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/>$ec<sp/>=<sp/>entity_get_controller($entity_type);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($reset)<sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/>$ec-&gt;resetCache();</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$ec-&gt;load($ids,<sp/>$conditions,<sp/>$field_ids,<sp/>$cache);</highlight></codeline>
<codeline lineno="234"><highlight class="normal">}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="253" refid="d5/dce/group__tripal__entities__api_1ga8d7df332ef5e92725a5044692e85ead2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga8d7df332ef5e92725a5044692e85ead2" kindref="member">tripal_load_term_entity</ref>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/>$vocabulary<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>?<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>?<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/>$term_id<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>?<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocabulary<sp/>and<sp/>$accession)<sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_term&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tt&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;join(</highlight><highlight class="stringliteral">&apos;tripal_vocab&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tv&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tv.id<sp/>=<sp/>tt.vocab_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;fields(</highlight><highlight class="stringliteral">&apos;tt&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;tv.vocabulary&apos;</highlight><highlight class="normal">,<sp/>$vocabulary)</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;tt.accession&apos;</highlight><highlight class="normal">,<sp/>$accession);</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>$query-&gt;execute()-&gt;fetchObject();</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term_id)<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_term&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tt&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;fields(</highlight><highlight class="stringliteral">&apos;tt&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;tt.id&apos;</highlight><highlight class="normal">,<sp/>$term_id);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>$query-&gt;execute()-&gt;fetchObject();</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term)<sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>$entity<sp/>=<sp/>entity_load(</highlight><highlight class="stringliteral">&apos;TripalTerm&apos;</highlight><highlight class="normal">,<sp/>array($term-&gt;id));</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>reset($entity);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="281"><highlight class="normal">}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight></codeline>
<codeline lineno="297" refid="d5/dce/group__tripal__entities__api_1ga1aaa769cc643f35d50f261f8e1b5d540" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga1aaa769cc643f35d50f261f8e1b5d540" kindref="member">tripal_load_vocab_entity</ref>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/>$vocabulary<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>?<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/>$vocab_id<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;vocab_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>?<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;vocab_id&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/>$vocab<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/>$query=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_vocab&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tv&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tv&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocabulary)<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tv.vocabulary&apos;</highlight><highlight class="normal">,<sp/>$vocabulary);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocab_id)<sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tv.id&apos;</highlight><highlight class="normal">,<sp/>$vocab_id);</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/>$vocab<sp/>=<sp/>$query-&gt;execute()-&gt;fetchObject();</highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocab)<sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>$entity<sp/>=<sp/>entity_load(</highlight><highlight class="stringliteral">&apos;TripalVocab&apos;</highlight><highlight class="normal">,<sp/>array($vocab-&gt;id));</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>reset($entity);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="318"><highlight class="normal">}</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="335" refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bundle&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>$query-&gt;fields(</highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tb.id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tb.name&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tb.label&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tb.term_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/>$query-&gt;execute()-&gt;fetchObject();</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($bundle)<sp/>{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/>$entity<sp/>=<sp/>entity_load_unchanged(</highlight><highlight class="stringliteral">&apos;TripalBundle&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$entity;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="381" refid="d5/dce/group__tripal__entities__api_1gab6848d2947f13ae562d8fe604de26142" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gab6848d2947f13ae562d8fe604de26142" kindref="member">tripal_add_notification</ref>($title,<sp/>$details,<sp/>$type,<sp/>$actions,<sp/>$submitter_id)<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>the<sp/>notification<sp/>isn&apos;t<sp/>already<sp/>in<sp/>the<sp/>admin<sp/>notification<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/>$dedup<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_admin_notfications&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tan&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tan&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;submitter_id&apos;</highlight><highlight class="normal">,<sp/>$submitter_id,<sp/></highlight><highlight class="charliteral">&apos;=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()-&gt;fetchAll();</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($dedup))<sp/>{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;details<sp/>=<sp/>$details;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;title<sp/>=<sp/>$title;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;submitter_id<sp/>=<sp/>$submitter_id;</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;actions<sp/>=<sp/>serialize($actions);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;enabled<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;type<sp/>=<sp/>$type;</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_admin_notfications&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>watchdog(</highlight><highlight class="stringliteral">&apos;tripal_cron&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>write<sp/>notification<sp/>to<sp/>database.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="406"><highlight class="normal">}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="429" refid="d5/dce/group__tripal__entities__api_1gae741bc8f60274eee9fbe4e2ca062fe83" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gae741bc8f60274eee9fbe4e2ca062fe83" kindref="member">tripal_create_bundle</ref>($args,<sp/>&amp;$error<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/>$vocabulary<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/>$term_name<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/>$storage_args<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;storage_args&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>create<sp/>the<sp/>TripalVocab<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>already<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>$vocab<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga1aaa769cc643f35d50f261f8e1b5d540" kindref="member">tripal_load_vocab_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary));</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$vocab)<sp/>{</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$vocab<sp/>=<sp/>entity_get_controller(</highlight><highlight class="stringliteral">&apos;TripalVocab&apos;</highlight><highlight class="normal">)-&gt;create(array(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary));</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocab)<sp/>{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$vocab-&gt;save();</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_entities&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>create<sp/>TripalVocab<sp/>:vocab&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:vocab&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary));</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Next<sp/>create<sp/>the<sp/>TripalTerm<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>already<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>$term<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga8d7df332ef5e92725a5044692e85ead2" kindref="member">tripal_load_term_entity</ref>(array(</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary,</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$term)<sp/>{</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$targs<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;vocab_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocab-&gt;id,<sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,<sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_name);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>entity_get_controller(</highlight><highlight class="stringliteral">&apos;TripalTerm&apos;</highlight><highlight class="normal">)-&gt;create($targs);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term)<sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>$term-&gt;save();</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_entities&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>create<sp/>TripalTerm<sp/>:term&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_name));</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>bundle<sp/>doesn&apos;t<sp/>already<sp/>exist,<sp/>then<sp/>add<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;bio_data_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;id;</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/>$einfo<sp/>=<sp/>entity_get_info(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!in_array($bundle_name,<sp/>array_keys($einfo[</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">])))<sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>the<sp/>label<sp/>for<sp/>the<sp/>content<sp/>type<sp/>have<sp/>capitalized<sp/>words.<sp/><sp/>The</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>exception<sp/>is<sp/>&apos;mRNA&apos;<sp/>which<sp/>we<sp/>know<sp/>should<sp/>not<sp/>be<sp/>uppercased.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$label<sp/>=<sp/>ucwords(preg_replace(</highlight><highlight class="stringliteral">&apos;/_/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<sp/>$term_name));</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term_name<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;mRNA&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$label<sp/>=<sp/>$term_name;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>db_insert(</highlight><highlight class="stringliteral">&apos;tripal_bundle&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(array(</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$label,</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name,</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term-&gt;id,</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>))</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_entities&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>create<sp/>Tripal<sp/>Bundle<sp/>:name.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>$modules<sp/>=<sp/>module_implements(</highlight><highlight class="stringliteral">&apos;bundle_create&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_bundle_create&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($function))<sp/>{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$function($bundle,<sp/>$storage_args);</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Clear<sp/>the<sp/>entity<sp/>cache<sp/>so<sp/>that<sp/>Drupal<sp/>will<sp/>read<sp/>our</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>hook_entity_info()<sp/>implementation.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>global<sp/>$language;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>$langcode<sp/>=<sp/>$language-&gt;language;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>cache_clear_all(</highlight><highlight class="stringliteral">&quot;entity_info:$langcode&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/>variable_set(</highlight><highlight class="stringliteral">&apos;menu_rebuild_needed&apos;</highlight><highlight class="normal">,<sp/>TRUE);</highlight></codeline>
<codeline lineno="514"><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>bundle<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle)<sp/>{</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_entities&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>load<sp/>Tripal<sp/>Bundle<sp/>:name<sp/>after<sp/>cache<sp/>clear.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaece8addc446db986888dea9c9a339955" kindref="member">tripal_create_bundle_fields</ref>($bundle,<sp/>$term);</highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Specifically<sp/>commiting<sp/>here<sp/>since<sp/>we<sp/>have<sp/>a<sp/>fully<sp/>featured<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Post-create<sp/>hook<sp/>implementations<sp/>assume<sp/>we<sp/>have<sp/>a<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>created<sp/>bundle<sp/>so<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>rollback<sp/>if<sp/>a<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>custom<sp/>implementation<sp/>causes<sp/>an<sp/>exception.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($transaction);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>create<sp/>content<sp/>type:<sp/>%message.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$e-&gt;getMessage())),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>any<sp/>custom<sp/>hook_bundle_postcreate()<sp/>implementations.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>done<sp/>outside<sp/>of<sp/>the<sp/>try/catch<sp/>&amp;<sp/>transaction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>since<sp/>it<sp/>occurs<sp/>after<sp/>creation<sp/>and<sp/>thus<sp/>should<sp/>not<sp/>cause</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>rollback<sp/>of<sp/>the<sp/>creation<sp/>on<sp/>error.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/>$modules<sp/>=<sp/>module_implements(</highlight><highlight class="stringliteral">&apos;bundle_postcreate&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_bundle_postcreate&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($function))<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function($bundle);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$bundle;</highlight></codeline>
<codeline lineno="553"><highlight class="normal">}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="564" refid="d5/dce/group__tripal__entities__api_1ga193227c1fd8a379805e054ab4dd2b4cf" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga193227c1fd8a379805e054ab4dd2b4cf" kindref="member">tripal_get_content_types</ref>()<sp/>{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bundle&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchAll();</highlight></codeline>
<codeline lineno="569"><highlight class="normal">}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="580" refid="d5/dce/group__tripal__entities__api_1ga118e7306cc739fe083689877cd863984" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga118e7306cc739fe083689877cd863984" kindref="member">tripal_tripal_cron_notification</ref>()<sp/>{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/>$num_created<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>all<sp/>bundle<sp/>names<sp/>to<sp/>cycle<sp/>through.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/>$all_bundles<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bundle&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()-&gt;fetchAll();</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($all_bundles<sp/>as<sp/>$bundle_name){</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>bundle<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name-&gt;name));</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle)<sp/>{</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Unrecognized<sp/>bundle<sp/>name<sp/>&apos;%bundle&apos;.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%bundle&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>modules<sp/>to<sp/>add<sp/>fields<sp/>to<sp/>the<sp/>new<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>$modules<sp/>=<sp/>module_implements(</highlight><highlight class="stringliteral">&apos;bundle_fields_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_bundle_fields_info&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$info<sp/>=<sp/>$function(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle);</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($info<sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>field<sp/>already<sp/>exists<sp/>then<sp/>skip<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($field)<sp/>{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>notification<sp/>that<sp/>new<sp/>fields<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$detail_info<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;<sp/>Tripal<sp/>has<sp/>detected<sp/>a<sp/>new<sp/>field<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.</highlight><highlight class="stringliteral">&apos;<sp/>for<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;label.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>content<sp/>type<sp/>is<sp/>available<sp/>for<sp/>import.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$title<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;New<sp/>field<sp/>available<sp/>for<sp/>import&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$actions[</highlight><highlight class="stringliteral">&apos;Import&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;admin/import/field/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle_name-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/field&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Field&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$submitter_id<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle_name-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$module;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1gab6848d2947f13ae562d8fe604de26142" kindref="member">tripal_add_notification</ref>($title,<sp/>$detail_info,<sp/>$type,<sp/>$actions,<sp/>$submitter_id);</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$num_created++;</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>modules<sp/>to<sp/>add<sp/>instances<sp/>to<sp/>the<sp/>new<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/>$modules<sp/>=<sp/>module_implements(</highlight><highlight class="stringliteral">&apos;bundle_instances_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_bundle_instances_info&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$info<sp/>=<sp/>$function(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($info<sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="627"><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>field<sp/>is<sp/>already<sp/>attached<sp/>to<sp/>this<sp/>bundle<sp/>then<sp/>skip<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($field<sp/>and<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">,<sp/>$field)<sp/>and</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$field[</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">])<sp/>and</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>in_array($bundle-&gt;name,<sp/>$field[</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>notification<sp/>that<sp/>new<sp/>fields<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$detail_info<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;<sp/>Tripal<sp/>has<sp/>detected<sp/>a<sp/>new<sp/>field<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.</highlight><highlight class="stringliteral">&apos;<sp/>for<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;label.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>content<sp/>type<sp/>is<sp/>available<sp/>for<sp/>import.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$title<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;New<sp/>field<sp/>available<sp/>for<sp/>import&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$actions[</highlight><highlight class="stringliteral">&apos;Import&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;admin/import/field/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/instance&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Field&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$submitter_id<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle_name-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$module;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1gab6848d2947f13ae562d8fe604de26142" kindref="member">tripal_add_notification</ref>($title,<sp/>$detail_info,<sp/>$type,<sp/>$actions,<sp/>$submitter_id);</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$num_created++;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="648"><highlight class="normal">}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="661" refid="d5/dce/group__tripal__entities__api_1ga52a167fdb04c89c9ce53db5f803cab63" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga52a167fdb04c89c9ce53db5f803cab63" kindref="member">tripal_get_content_type</ref>($bundle_name)<sp/>{</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bundle&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tb&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;tb.name&apos;</highlight><highlight class="normal">,<sp/>$bundle_name)</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchAll();</highlight></codeline>
<codeline lineno="667"><highlight class="normal">}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="682" refid="d5/dce/group__tripal__entities__api_1gaece8addc446db986888dea9c9a339955" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaece8addc446db986888dea9c9a339955" kindref="member">tripal_create_bundle_fields</ref>($bundle,<sp/>$term)<sp/>{</highlight></codeline>
<codeline lineno="683"><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/>$added<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="685"><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>modules<sp/>to<sp/>add<sp/>fields<sp/>to<sp/>the<sp/>new<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/>$modules<sp/>=<sp/>module_implements(</highlight><highlight class="stringliteral">&apos;bundle_fields_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/>$field_info<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_bundle_fields_info&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/>$temp<sp/>=<sp/>$function(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle);</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($temp))<sp/>{</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>it<sp/>would<sp/>be<sp/>good<sp/>to<sp/>check<sp/>this<sp/>array<sp/>to<sp/>make<sp/>sure<sp/>it<sp/>follows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>protocol.<sp/><sp/>It<sp/>would<sp/>help<sp/>identify<sp/>potential<sp/>errors.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_info<sp/>=<sp/>array_merge($field_info,<sp/>$temp);</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>modules<sp/>to<sp/>alter<sp/>which<sp/>fields<sp/>should<sp/>be<sp/>attached<sp/>to<sp/>content</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>types<sp/>they<sp/>create.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/>drupal_alter(</highlight><highlight class="stringliteral">&apos;bundle_fields_info&apos;</highlight><highlight class="normal">,<sp/>$field_info,<sp/>$bundle,<sp/>$term);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>all<sp/>of<sp/>the<sp/>fields<sp/>and<sp/>create<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($field_info<sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_type<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="706"><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>field<sp/>already<sp/>exists<sp/>then<sp/>skip<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($field)<sp/>{</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="712"><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>the<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_create_field($details);</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$field)<sp/>{</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>(t(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>create<sp/>new<sp/>field:<sp/>%field.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">])),<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="720"><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>modules<sp/>to<sp/>add<sp/>instances<sp/>to<sp/>the<sp/>new<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/>$modules<sp/>=<sp/>module_implements(</highlight><highlight class="stringliteral">&apos;bundle_instances_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/>$instance_info<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_bundle_instances_info&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/>$temp<sp/>=<sp/>$function(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle);</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($temp))<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>it<sp/>would<sp/>be<sp/>good<sp/>to<sp/>check<sp/>this<sp/>array<sp/>to<sp/>make<sp/>sure<sp/>it<sp/>follows</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>protocol.<sp/><sp/>It<sp/>would<sp/>help<sp/>identify<sp/>potential<sp/>errors.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$instance_info<sp/>=<sp/>array_merge($instance_info,<sp/>$temp);</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="733"><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>modules<sp/>to<sp/>alter<sp/>which<sp/>fields<sp/>should<sp/>be<sp/>attached<sp/>to<sp/>content</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>types<sp/>they<sp/>create.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/>drupal_alter(</highlight><highlight class="stringliteral">&apos;bundle_instances_info&apos;</highlight><highlight class="normal">,<sp/>$instance_info,<sp/>$bundle,<sp/>$term);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>list<sp/>of<sp/>existing<sp/>instances</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/>$existing_instances<sp/>=<sp/>field_info_instances(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;name);</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>all<sp/>of<sp/>the<sp/>field<sp/>instances<sp/>and<sp/>create<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($instance_info<sp/>as<sp/>$instance_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>instance<sp/>has<sp/>a<sp/>term.<sp/>If<sp/>not,<sp/>report<sp/>it<sp/>and<sp/>skip<sp/>the<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">,<sp/>$details[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_fields&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>field<sp/>instance,<sp/>!field,<sp/>is<sp/>missing<sp/>the<sp/>&quot;term_vocabulary&quot;<sp/>setting.<sp/>The<sp/>field<sp/>instance<sp/>cannot<sp/>be<sp/>added.<sp/>Please<sp/>check<sp/>the<sp/>field<sp/>settings.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;!field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance_name],<sp/>[</highlight><highlight class="stringliteral">&apos;drupal_set_message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE]);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">,<sp/>$details[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_fields&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>field<sp/>instance,<sp/>!field,<sp/>is<sp/>missing<sp/>the<sp/>&quot;term_accession&quot;<sp/>setting.<sp/>The<sp/>field<sp/>instance<sp/>cannot<sp/>be<sp/>added.<sp/>Please<sp/>check<sp/>the<sp/>field<sp/>settings.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;!field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance_name],<sp/>[</highlight><highlight class="stringliteral">&apos;drupal_set_message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE]);</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;}</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>term<sp/>exists.<sp/>If<sp/>not,<sp/>skip<sp/>the<sp/>field<sp/>instance<sp/>and<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>report<sp/>an<sp/>error.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_term_id<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">];<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_term<sp/>=<sp/><ref refid="de/d00/group__tripal__terms__api_1gaf99a705ba9ec49d8d1e46aa0300505c0" kindref="member">tripal_get_term_details</ref>($details[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">],<sp/>$details[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$field_term)<sp/>{</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_fields&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>term,<sp/>!term,<sp/>for<sp/>the<sp/>field,<sp/>!field,<sp/>does<sp/>not<sp/>exist<sp/>in<sp/>the<sp/>database.<sp/>The<sp/><sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field<sp/>instance<sp/>cannot<sp/>be<sp/>added.<sp/>Please<sp/>make<sp/>sure<sp/>the<sp/>term<sp/>is<sp/>correct<sp/>and<sp/>add<sp/>it<sp/>if<sp/>necessary.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;!term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_term_id,</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;!field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance_name],</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;drupal_set_message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE]);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>term<sp/>is<sp/>not<sp/>used<sp/>for<sp/>any<sp/>other<sp/>existing<sp/>field<sp/>instance.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/>$skip<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($existing_instances<sp/>as<sp/>$existing_name<sp/>=&gt;<sp/>$existing_instance)<sp/>{</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>instance<sp/>term<sp/>is<sp/>the<sp/>same<sp/>as<sp/>this<sp/>exsiting<sp/>term<sp/>and<sp/>the<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>instance<sp/>name<sp/>is<sp/>not<sp/>the<sp/>same<sp/>then<sp/>we<sp/>have<sp/>a<sp/>problem.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$existing_term_id<sp/>=<sp/>$existing_instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$existing_instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$existing_field<sp/>=<sp/>field_info_field($existing_name);</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($existing_term_id<sp/>==<sp/>$field_term_id<sp/>and<sp/>$instance_name<sp/>!=<sp/>$existing_name)<sp/>{</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_fields&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>field,<sp/>!field,<sp/>uses<sp/>a<sp/>term,<sp/>!term,<sp/>that<sp/>is<sp/>already<sp/>in<sp/>use<sp/>on<sp/>this<sp/>content<sp/>type.<sp/>The<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field<sp/>instance<sp/>cannot<sp/>be<sp/>added.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;!term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$existing_term_id,</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;!field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance_name],</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;drupal_set_message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE]);</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$skip<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>instance<sp/>term<sp/>is<sp/>the<sp/>same<sp/>as<sp/>this<sp/>exsting<sp/>term<sp/>but<sp/>the<sp/>storage</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>types<sp/>are<sp/>different<sp/>then<sp/>we<sp/>have<sp/>a<sp/>problem.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$existing_storage<sp/>=<sp/>$existing_field[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$this_field_storage<sp/>=<sp/>$field_info[$details[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]][</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($existing_term_id<sp/>==<sp/>$field_term_id<sp/>and<sp/>$existing_storage<sp/>!=<sp/>$this_field_storage)<sp/>{</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_fields&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>field,<sp/>!field,<sp/>provided<sp/>by<sp/>the<sp/>storage<sp/>type,<sp/>!type,<sp/>uses<sp/>a<sp/>term,<sp/>!term,<sp/>that<sp/>is<sp/>already<sp/>in<sp/>use<sp/>on<sp/>this<sp/>content<sp/>type<sp/>and<sp/>provided<sp/>by<sp/>another<sp/>storage<sp/>backend.<sp/>The<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field<sp/>instance<sp/>cannot<sp/>be<sp/>added.<sp/><sp/>Perhaps,<sp/>consider<sp/>a<sp/>different<sp/>term<sp/>and<sp/>adjust<sp/>the<sp/>data<sp/>in<sp/>the<sp/>database.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;!term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$existing_term_id,</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;!type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$this_field_storage,</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;!field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance_name],</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;drupal_set_message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE]);</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$skip<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($skip)<sp/>{</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="806"><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>field<sp/>is<sp/>already<sp/>attached<sp/>to<sp/>this<sp/>bundle<sp/>then<sp/>skip<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($instance_name,<sp/>$existing_instances))<sp/>{</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="811"><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>the<sp/>field<sp/>instance.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>$instance<sp/>=<sp/>field_create_instance($details);</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/>$existing_instances[$instance_name]<sp/>=<sp/>$instance;</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/>$added[]<sp/>=<sp/>$instance_name;</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$added;</highlight></codeline>
<codeline lineno="818"><highlight class="normal">}</highlight></codeline>
<codeline lineno="819"><highlight class="normal"></highlight></codeline>
<codeline lineno="859" refid="d5/dce/group__tripal__entities__api_1ga14dfedcffbaa4b759a05052dc2a7ccde" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga14dfedcffbaa4b759a05052dc2a7ccde" kindref="member">tripal_update_bundle_field</ref>($field_name,<sp/>$field_info,<sp/>$entity_type_name,<sp/>$bundle_name)<sp/>{</highlight></codeline>
<codeline lineno="860"><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/>$field<sp/>=<sp/>field_info_field($field_name);</highlight></codeline>
<codeline lineno="862"><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>field<sp/>doesn&apos;t<sp/>exists<sp/>or<sp/>is<sp/>not<sp/>attached<sp/>to<sp/>this<sp/>bundle<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>just<sp/>return,<sp/>there<sp/>is<sp/>nothing<sp/>left<sp/>to<sp/>do.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$field<sp/>or<sp/>!array_key_exists(</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">,<sp/>$field)<sp/>or</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>!array_key_exists($entity_type_name,<sp/>$field[</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">])<sp/>or</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>!in_array($bundle_name,<sp/>$field[</highlight><highlight class="stringliteral">&apos;bundles&apos;</highlight><highlight class="normal">][$entity_type_name]))<sp/>{</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="870"><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_name;</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;field_type&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;cardinality&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;cardinality&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;locked&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;locked&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;locked&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;field_settings&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;field_settings&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="884"><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/>field_update_field($field);</highlight></codeline>
<codeline lineno="886"><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/>$field_instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_name;</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/>$field_instance[</highlight><highlight class="stringliteral">&apos;entity_type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$entity_type_name;</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/>$field_instance[</highlight><highlight class="stringliteral">&apos;bundle&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$bundle_name;</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;widget&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;widget_type&apos;</highlight><highlight class="normal">,<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;widget&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;widget&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;widget_type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;widget_settings&apos;</highlight><highlight class="normal">,<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;widget&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;widget&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;widget_settings&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;is_required&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;field_settings&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;default_value&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;default_value&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;default_value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal">,<sp/>$field_info))<sp/>{</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$field_info[</highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/>field_update_instance($field_instance);</highlight></codeline>
<codeline lineno="917"><highlight class="normal">}</highlight></codeline>
<codeline lineno="918"><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"></highlight></codeline>
<codeline lineno="937" refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" kindref="member">tripal_get_bundle_variable</ref>($variable_name,<sp/>$bundle_id,<sp/>$default<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="938"><highlight class="normal"></highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/>$variable<sp/>=<sp/><ref refid="d9/da9/group__tripal__variables__api_1ga377e23d9ee9f48da4394389fa3d6404b" kindref="member">tripal_get_variable</ref>($variable_name);</highlight></codeline>
<codeline lineno="940"><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Warn<sp/>if<sp/>we<sp/>can&apos;t<sp/>find<sp/>the<sp/>tripal_variable.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$variable)<sp/>{</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$default;</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="945"><highlight class="normal"></highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Select<sp/>the<sp/>value<sp/>for<sp/>this<sp/>variable.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/>$value<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bundle_variables&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;var&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;var&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;var.bundle_id&apos;</highlight><highlight class="normal">,<sp/>$bundle_id)</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;var.variable_id&apos;</highlight><highlight class="normal">,<sp/>$variable-&gt;variable_id)</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchField();</highlight></codeline>
<codeline lineno="953"><highlight class="normal"></highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Warn<sp/>if<sp/>the<sp/>value<sp/>appears<sp/>to<sp/>be<sp/>empty.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$value)<sp/>{</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$default;</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="958"><highlight class="normal"></highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$value;</highlight></codeline>
<codeline lineno="960"><highlight class="normal">}</highlight></codeline>
<codeline lineno="961"><highlight class="normal"></highlight></codeline>
<codeline lineno="974" refid="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" kindref="member">tripal_set_bundle_variable</ref>($variable_name,<sp/>$bundle_id,<sp/>$value)<sp/>{</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/>$variable<sp/>=<sp/><ref refid="d9/da9/group__tripal__variables__api_1ga377e23d9ee9f48da4394389fa3d6404b" kindref="member">tripal_get_variable</ref>($variable_name);</highlight></codeline>
<codeline lineno="976"><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$variable)<sp/>{</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($variable_name<sp/>===<sp/></highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">){</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/da9/group__tripal__variables__api_1ga5e75a5502190885c06fa72cc55545383" kindref="member">tripal_insert_variable</ref>(</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Structure-&gt;Tripal<sp/>Content<sp/>Type-&gt;edit<sp/>checkbox<sp/>to<sp/>hide<sp/>empty<sp/>fields<sp/>for<sp/>that<sp/>bundle.&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$variable<sp/>=<sp/><ref refid="d9/da9/group__tripal__variables__api_1ga377e23d9ee9f48da4394389fa3d6404b" kindref="member">tripal_get_variable</ref>($variable_name);</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$variable)<sp/>{</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="992"><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>And<sp/>then<sp/>we<sp/>need<sp/>to<sp/>write<sp/>the<sp/>new<sp/>format<sp/>to<sp/>the<sp/>tripal_bundle_variables<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;bundle_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_id,</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;variable_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$variable-&gt;variable_id,</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$value,</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>whether<sp/>there<sp/>is<sp/>already<sp/>a<sp/>format<sp/>saved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/>$bundle_variable_id<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bundle_variables&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;var&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;var&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;bundle_variable_id&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;var.bundle_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;bundle_id&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;var.variable_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;variable_id&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchField();</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($bundle_variable_id)<sp/>{</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;bundle_variable_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$bundle_variable_id;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_bundle_variables&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>,<sp/></highlight><highlight class="stringliteral">&apos;bundle_variable_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_bundle_variables&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>);</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"></highlight></codeline>
<codeline lineno="1018"><highlight class="normal"></highlight></codeline>
<codeline lineno="1032" refid="d5/dce/group__tripal__entities__api_1gaed3e1bc34351087f058114cec1c33081" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaed3e1bc34351087f058114cec1c33081" kindref="member">tripal_get_title_format</ref>($bundle)<sp/>{</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>existing<sp/>title<sp/>format<sp/>if<sp/>it<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/>$title_format<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" kindref="member">tripal_get_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;title_format&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id);</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"></highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>isn&apos;t<sp/>yet<sp/>a<sp/>title<sp/>format<sp/>for<sp/>this<sp/>bundle/type<sp/>then<sp/>we<sp/>should</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>the<sp/>default.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$title_format)<sp/>{</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/>$title_format<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gadda52167dced1ec99f937d18da58eda7" kindref="member">tripal_get_default_title_format</ref>($bundle);</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga64ba0896880df6f55c775573634db3ad" kindref="member">tripal_save_title_format</ref>($bundle,<sp/>$title_format);</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"></highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$title_format;</highlight></codeline>
<codeline lineno="1045"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"></highlight></codeline>
<codeline lineno="1057" refid="d5/dce/group__tripal__entities__api_1ga64ba0896880df6f55c775573634db3ad" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga64ba0896880df6f55c775573634db3ad" kindref="member">tripal_save_title_format</ref>($entity,<sp/>$format)<sp/>{</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"></highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" kindref="member">tripal_set_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;title_format&apos;</highlight><highlight class="normal">,<sp/>$entity-&gt;id,<sp/>$format);</highlight></codeline>
<codeline lineno="1060"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"></highlight></codeline>
<codeline lineno="1073" refid="d5/dce/group__tripal__entities__api_1gadda52167dced1ec99f937d18da58eda7" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1gadda52167dced1ec99f937d18da58eda7" kindref="member">tripal_get_default_title_format</ref>($bundle)<sp/>{</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/>$format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"></highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Retrieve<sp/>all<sp/>available<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" kindref="member">tripal_get_entity_tokens</ref>($bundle);</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"></highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>A)<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>more<sp/>informed<sp/>modules<sp/>have<sp/>suggested<sp/>a<sp/>title<sp/>for<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>type.<sp/>Invoke<sp/>hook_tripal_default_title_format()<sp/>to<sp/>get<sp/>all<sp/>suggestions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>from<sp/>other<sp/>modules.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/>$suggestions<sp/>=<sp/>module_invoke_all(</highlight><highlight class="stringliteral">&apos;tripal_default_title_format&apos;</highlight><highlight class="normal">,<sp/>$bundle,<sp/>$tokens);</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($suggestions)<sp/>{</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>suggestion<sp/>with<sp/>the<sp/>lightest<sp/>weight.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>$lightest_key<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($suggestions<sp/>as<sp/>$k<sp/>=&gt;<sp/>$s)<sp/>{</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($lightest_key<sp/>===<sp/>NULL)<sp/>$lightest_key<sp/>=<sp/>$k;</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($s[</highlight><highlight class="stringliteral">&apos;weight&apos;</highlight><highlight class="normal">]<sp/>&lt;<sp/>$lightest_key)<sp/>$lightest_key<sp/>=<sp/>$k;</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>$suggestions[$lightest_key][</highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"></highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>B)<sp/>Generate<sp/>our<sp/>own<sp/>ugly<sp/>title<sp/>by<sp/>simply<sp/>comma-separating<sp/>all<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>required<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$format)<sp/>{</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/>$tmp<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>which<sp/>tokens<sp/>are<sp/>required<sp/>fields<sp/>and<sp/>join<sp/>them<sp/>into<sp/>a<sp/>default<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>format.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($tokens<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($token[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tmp[]<sp/>=<sp/>$token[</highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>$tmp);</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"></highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="1111"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"></highlight></codeline>
<codeline lineno="1113"><highlight class="normal"></highlight></codeline>
<codeline lineno="1124" refid="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" kindref="member">tripal_get_entity_tokens</ref>($bundle,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"></highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>default<sp/>options.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;required<sp/>only&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;required<sp/>only&apos;</highlight><highlight class="normal">]))<sp/>?<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;required<sp/>only&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include<sp/>id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include<sp/>id&apos;</highlight><highlight class="normal">]))<sp/>?<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include<sp/>id&apos;</highlight><highlight class="normal">]<sp/>:<sp/>TRUE;</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"></highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include<sp/>id&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/>$token<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[TripalBundle__bundle_id]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens[$token]<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Bundle<sp/>ID&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>unique<sp/>identifier<sp/>for<sp/>this<sp/>Tripal<sp/>Content<sp/>Type.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>NULL,</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/>];</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"></highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/>$token<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[TripalEntity__entity_id]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens[$token]<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Content/Entity<sp/>ID&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>unique<sp/>identifier<sp/>for<sp/>an<sp/>individual<sp/>piece<sp/>of<sp/>Tripal<sp/>Content.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>NULL,</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/>];</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"></highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/>$instances<sp/>=<sp/>field_info_instances(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;name);</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($instances<sp/>as<sp/>$instance_name<sp/>=&gt;<sp/>$instance)<sp/>{</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$instance[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>and<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;required<sp/>only&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/>$use_field<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>the<sp/>TripalEntity<sp/>fields<sp/>and<sp/>see<sp/>if<sp/>they<sp/>have</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sub-elements,<sp/>if<sp/>so,<sp/>add<sp/>those<sp/>as<sp/>tokens<sp/>too.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_name<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($instance[</highlight><highlight class="stringliteral">&apos;entity_type&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="df/d0f/group__tripal__fields__api_1gabb7ea3717ca825f758cfa9eb5c259ac0" kindref="member">tripal_load_include_field_class</ref>($field_name))<sp/>{</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($field_name);</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$field_obj<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>$field_name($field,<sp/>$instance);</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$element_info<sp/>=<sp/>$field_obj-&gt;elementInfo();</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$term_id<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($element_info<sp/>and<sp/></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists($term_id,<sp/>$element_info)<sp/>and<sp/></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">,<sp/>$element_info[$term_id])<sp/>and<sp/>count($element_info[$term_id][</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">])<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$elements<sp/>=<sp/>$element_info[$term_id][</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a95c7d0cd51877955bfd3477bf37c5808" kindref="member">_tripal_get_entity_tokens_for_elements</ref>($instance,<sp/>$field_name,<sp/>$elements,<sp/>$tokens,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$use_field<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$use_field<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$use_field<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>have<sp/>no<sp/>elements<sp/>to<sp/>add<sp/>then<sp/>just<sp/>add<sp/>the<sp/>field<sp/>as<sp/>is.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($use_field)<sp/>{</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>the<sp/>token<sp/>from<sp/>the<sp/>field<sp/>information.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$token<sp/>=<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal"><sp/>.<sp/>$instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tokens[$token]<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>];</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"></highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$tokens;</highlight></codeline>
<codeline lineno="1202"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"></highlight></codeline>
<codeline lineno="1217" refid="d9/d7f/tripal_8entities_8api_8inc_1a95c7d0cd51877955bfd3477bf37c5808" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a95c7d0cd51877955bfd3477bf37c5808" kindref="member">_tripal_get_entity_tokens_for_elements</ref>($instance,<sp/>$parent,<sp/>$elements,<sp/>&amp;$tokens,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>all<sp/>of<sp/>the<sp/>elements<sp/>and<sp/>add<sp/>tokens<sp/>for<sp/>each<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($elements<sp/>as<sp/>$child_term_id<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>don&apos;t<sp/>need<sp/>to<sp/>add<sp/>the<sp/>entity<sp/>element.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($child_term_id<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;entity&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Skip<sp/>elements<sp/>that<sp/>aren&apos;t<sp/>required.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/>$required<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">,<sp/>$details)<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$required<sp/>and<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;required<sp/>only&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/>$token<sp/>=<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal"><sp/>.<sp/>$parent<sp/>.<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal"><sp/>.<sp/>$child_term_id<sp/>.<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">;<sp/></highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/>$label<sp/>=<sp/>$child_term_id;</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/>$details))<sp/>{</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$label<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/:/&apos;</highlight><highlight class="normal">,<sp/>$child_term_id))<sp/>{</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>list($vocabulary,<sp/>$accession)<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/>$child_term_id);</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$term<sp/>=<sp/><ref refid="de/d00/group__tripal__terms__api_1gaf99a705ba9ec49d8d1e46aa0300505c0" kindref="member">tripal_get_term_details</ref>($vocabulary,<sp/>$accession);</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$label<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"></highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>token!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens[$token]<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$label,</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$details)<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$required</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/>];</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Recurse<sp/>to<sp/>include<sp/>sub<sp/>elements</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">,<sp/>$details))<sp/>{</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a95c7d0cd51877955bfd3477bf37c5808" kindref="member">_tripal_get_entity_tokens_for_elements</ref>($instance,<sp/>$parent<sp/>.<sp/></highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal"><sp/>.<sp/>$child_term_id,<sp/></highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">],<sp/>$tokens,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1258"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1277" refid="d5/dce/group__tripal__entities__api_1ga050b81319c70291ff5e66b0df460b81a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga050b81319c70291ff5e66b0df460b81a" kindref="member">tripal_replace_entity_tokens</ref>($string,<sp/>&amp;$entity,<sp/>$bundle_entity<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>which<sp/>tokens<sp/>were<sp/>used<sp/>in<sp/>the<sp/>format<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/>$used_tokens<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/\[.*?\]/&apos;</highlight><highlight class="normal">,<sp/>$string,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/>$used_tokens<sp/>=<sp/>$matches[0];</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"></highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>are<sp/>no<sp/>tokens<sp/>then<sp/>just<sp/>return<sp/>the<sp/>string.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($used_tokens)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$string;</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"></highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>fields<sp/>are<sp/>not<sp/>loaded<sp/>for<sp/>the<sp/>entity<sp/>then<sp/>we<sp/>want<sp/>to<sp/>load<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>we<sp/>won&apos;t<sp/>do<sp/>a<sp/>field_attach_load()<sp/>as<sp/>that<sp/>will<sp/>load<sp/>all<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>fields.<sp/>For<sp/>syncing<sp/>(publishing)<sp/>of<sp/>content<sp/>loading<sp/>all<sp/>fields<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>all<sp/>synced<sp/>entities<sp/>causes<sp/>extreme<sp/>slowness,<sp/>so<sp/>we&apos;ll<sp/>only<sp/>attach</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>necessary<sp/>fields<sp/>for<sp/>replacing<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/>$attach_fields<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"></highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($used_tokens<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/>$token<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/[\[\]]/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/>$elements<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_name<sp/>=<sp/>array_shift($elements);</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//$field_name<sp/>=<sp/>str_replace(array(&apos;.&apos;,&apos;[&apos;,&apos;]&apos;),<sp/>array(&apos;__&apos;,&apos;&apos;,&apos;&apos;),<sp/>$field_name);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!property_exists($entity,<sp/>$field_name)<sp/>or<sp/>empty($entity-&gt;{$field_name}))<sp/>{</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($field_name);</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$storage<sp/>=<sp/>$field[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$attach_fields[$storage[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]][</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$storage;</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$attach_fields[$storage[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]][</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][]<sp/><sp/>=<sp/>$field;</highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"></highlight></codeline>
<codeline lineno="1309"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>have<sp/>any<sp/>fields<sp/>that<sp/>need<sp/>attaching,<sp/>then<sp/>do<sp/>so<sp/>now.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1310"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count(array_keys($attach_fields))<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($attach_fields<sp/>as<sp/>$storage_type<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$storage<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1ab2303c817e3b402b77b7f99627b9c319" kindref="member">$fields</ref><sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_ids<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1ab2303c817e3b402b77b7f99627b9c319" kindref="member">$fields</ref><sp/>as<sp/>$field)<sp/>{</highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$field_ids[$field[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]]<sp/>=<sp/>array($entity-&gt;id);</highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$entities<sp/>=<sp/>array($entity-&gt;id<sp/>=&gt;<sp/>$entity);</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/><sp/><sp/>module_invoke($storage[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;field_storage_load&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$entities,<sp/>FIELD_LOAD_CURRENT,<sp/>$field_ids,<sp/>array());</highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>that<sp/>all<sp/>necessary<sp/>fields<sp/>are<sp/>attached<sp/>process<sp/>the<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($used_tokens<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/>$token<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/[\[\]]/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/>$elements<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;,&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_name<sp/>=<sp/>array_shift($elements);</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/>$value<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($entity,<sp/>$field_name))<sp/>{</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note:<sp/>there<sp/>is<sp/>a<sp/>memory<sp/>leak<sp/>in<sp/>field_get_items()<sp/>so<sp/>we<sp/>can&apos;t<sp/>use<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>here<sp/>or<sp/>bulk<sp/>publishing<sp/>will<sp/>slowly<sp/>erode<sp/>memory.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>$field_value<sp/>=<sp/>field_get_items(&apos;TripalEntity&apos;,<sp/>$entity,<sp/>$field_name);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;und&apos;</highlight><highlight class="normal">,<sp/>$entity-&gt;{$field_name})<sp/>and<sp/></highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists(0,<sp/>$entity-&gt;{$field_name}[</highlight><highlight class="stringliteral">&apos;und&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/>$entity-&gt;{$field_name}[</highlight><highlight class="stringliteral">&apos;und&apos;</highlight><highlight class="normal">][0][</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>value<sp/>is<sp/>an<sp/>array<sp/>it<sp/>means<sp/>we<sp/>have<sp/>sub<sp/>elements<sp/>and<sp/>we<sp/>can</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>descend<sp/>through<sp/>the<sp/>array<sp/>to<sp/>look<sp/>for<sp/>matching<sp/>value.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($value)<sp/>and<sp/>count($elements)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a0d5955f1c1d9c7c60821f943d2f3e7a3" kindref="member">_tripal_replace_entity_tokens_for_elements</ref>($elements,<sp/>$value);</highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>TripalBundle__bundle_id<sp/>is<sp/>a<sp/>special<sp/>token<sp/>for<sp/>substituting<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>bundle<sp/>id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($field_name<sp/>===<sp/></highlight><highlight class="stringliteral">&apos;TripalBundle__bundle_id&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>the<sp/>bundle<sp/>entity<sp/>if<sp/>we<sp/>weren&apos;t<sp/>given<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle_entity)<sp/>{</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$bundle_entity<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$entity-&gt;bundle));</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>token<sp/>should<sp/>be<sp/>the<sp/>id<sp/>of<sp/>the<sp/>TripalBundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/>$bundle_entity-&gt;id;</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>TripalBundle__bundle_id<sp/>is<sp/>a<sp/>special<sp/>token<sp/>for<sp/>substituting<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>entty<sp/>id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($field_name<sp/>===<sp/></highlight><highlight class="stringliteral">&apos;TripalEntity__entity_id&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>token<sp/>should<sp/>be<sp/>the<sp/>id<sp/>of<sp/>the<sp/>TripalEntity.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/>$entity-&gt;id;</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"></highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can&apos;t<sp/>support<sp/>tokens<sp/>that<sp/>have<sp/>multiple<sp/>elements<sp/>(i.e.<sp/>in<sp/>an<sp/>array).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($value))<sp/>{</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$string<sp/>=<sp/>str_replace(</highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal"><sp/>.<sp/>$token<sp/>.<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$string);</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$string<sp/>=<sp/>str_replace(</highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal"><sp/>.<sp/>$token<sp/>.<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">,<sp/>$value,<sp/>$string);</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"></highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$string;</highlight></codeline>
<codeline lineno="1373"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"></highlight></codeline>
<codeline lineno="1381" refid="d9/d7f/tripal_8entities_8api_8inc_1a0d5955f1c1d9c7c60821f943d2f3e7a3" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a0d5955f1c1d9c7c60821f943d2f3e7a3" kindref="member">_tripal_replace_entity_tokens_for_elements</ref>($elements,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/>$term_id<sp/>=<sp/>array_shift($elements);</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/>$value<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[$term_id];</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($elements)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$value;</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a0d5955f1c1d9c7c60821f943d2f3e7a3" kindref="member">_tripal_replace_entity_tokens_for_elements</ref>($elements,<sp/>$value);</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1390"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"></highlight></codeline>
<codeline lineno="1402" refid="d5/dce/group__tripal__entities__api_1ga2c17dc368ac82e83398f642885bfd9fb" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga2c17dc368ac82e83398f642885bfd9fb" kindref="member">theme_token_list</ref>($tokens)<sp/>{</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"></highlight></codeline>
<codeline lineno="1404"><highlight class="normal"><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;Token&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Description&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($tokens<sp/>as<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"></highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>theme(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>,<sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>));</highlight></codeline>
<codeline lineno="1415"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"></highlight></codeline>
<codeline lineno="1426" refid="d5/dce/group__tripal__entities__api_1ga5a80b6313c62a09790cdfdb15ac3a122" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5a80b6313c62a09790cdfdb15ac3a122" kindref="member">tripal_entity_label</ref>($entity)<sp/>{</highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($entity,<sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$entity-&gt;title;</highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="1431"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"></highlight></codeline>
<codeline lineno="1446" refid="d5/dce/group__tripal__entities__api_1ga7bad5fec2219d0f880f65290e71ec0d4" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga7bad5fec2219d0f880f65290e71ec0d4" kindref="member">tripal_get_bundle_details</ref>($bundle_name)<sp/>{</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"></highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle)<sp/>{</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga8d7df332ef5e92725a5044692e85ead2" kindref="member">tripal_load_term_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;term_id));</highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/>$vocab<sp/>=<sp/>$term-&gt;vocab;</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/>$instances<sp/>=<sp/>field_info_instances(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;name);</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"></highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;name,</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;label,</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocab-&gt;vocabulary<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;accession,</highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term-&gt;name,</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term-&gt;definition,</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term-&gt;url</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="1467"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1468"><highlight class="normal"></highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>each<sp/>feild<sp/>and<sp/>provide<sp/>a<sp/>discription<sp/>of<sp/>it<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1470"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>it&apos;s<sp/>sub<sp/>elements.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($instances<sp/>as<sp/>$instance)<sp/>{</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Skip<sp/>deleted<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($instance[</highlight><highlight class="stringliteral">&apos;deleted&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"></highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_name<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($field_name);</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"></highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_class<sp/>=<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/>$term_vocab<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/>$term_accession<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_term<sp/>=<sp/><ref refid="de/d00/group__tripal__terms__api_1gaf99a705ba9ec49d8d1e46aa0300505c0" kindref="member">tripal_get_term_details</ref>($term_vocab,<sp/>$term_accession);</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_details<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_name,</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_vocab<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal"><sp/>.<sp/>$term_accession,</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_term[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_term[</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_term[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>These<sp/>items<sp/>can<sp/>be<sp/>overridden<sp/>by<sp/>the<sp/>element_info<sp/>array<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>present<sp/>in<sp/>a<sp/>TripalField<sp/>instance.<sp/><sp/>Here<sp/>we<sp/>set<sp/>defaults.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$instance[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>?<sp/>TRUE<sp/>:<sp/>FALSE,</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;xs:string&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>cardinatlity<sp/>value<sp/>always<sp/>comes<sp/>from<sp/>the<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cardinality&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;cardinality&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1501"><highlight class="normal"></highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="df/d0f/group__tripal__fields__api_1gabb7ea3717ca825f758cfa9eb5c259ac0" kindref="member">tripal_load_include_field_class</ref>($field_class))<sp/>{</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_obj<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>$field_class($field,<sp/>$instance);</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$element_info<sp/>=<sp/>$field_obj-&gt;elementInfo();</highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$element_info<sp/>=<sp/>$element_info[$term_vocab<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term_accession];</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"></highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>element<sp/>info<sp/>for<sp/>this<sp/>field<sp/>sets<sp/>required,<sp/>type<sp/>and<sp/>readonly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>attributes<sp/>then<sp/>set<sp/>those.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;xs:string&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal">]<sp/>:<sp/>TRUE;</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$field_details[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;help&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;help&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;help&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1514"><highlight class="normal"></highlight></codeline>
<codeline lineno="1515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>field<sp/>is<sp/>an<sp/>&apos;xs:complexType&apos;<sp/>then<sp/>it<sp/>will<sp/>have<sp/>sub<sp/>elements.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>need<sp/>to<sp/>add<sp/>those<sp/>as<sp/>well.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>and<sp/>is_array($element_info[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga46df8084aa82f744920d66ac59ae9a38" kindref="member">_tripal_get_bundle_field_element_details</ref>($element_info[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">],<sp/>$field_details);</highlight></codeline>
<codeline lineno="1519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$field_details;</highlight></codeline>
<codeline lineno="1521"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1522"><highlight class="normal"></highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$details;</highlight></codeline>
<codeline lineno="1525"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1533" refid="d5/dce/group__tripal__entities__api_1ga46df8084aa82f744920d66ac59ae9a38" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga46df8084aa82f744920d66ac59ae9a38" kindref="member">_tripal_get_bundle_field_element_details</ref>($elements,<sp/>&amp;$field_details)<sp/>{</highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1535"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($elements<sp/>as<sp/>$element_key<sp/>=&gt;<sp/>$element_info)<sp/>{</highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Handle<sp/>the<sp/>entity<sp/>element<sp/>differnetly.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($element_key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;entity&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>list($term_vocab,<sp/>$term_accession)<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/>$element_key);</highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$term<sp/>=<sp/><ref refid="de/d00/group__tripal__terms__api_1gaf99a705ba9ec49d8d1e46aa0300505c0" kindref="member">tripal_get_term_details</ref>($term_vocab,<sp/>$term_accession);</highlight></codeline>
<codeline lineno="1542"><highlight class="normal"></highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$element_details<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">]<sp/>:<sp/>ucfirst(preg_replace(</highlight><highlight class="stringliteral">&apos;/_/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<sp/>$term[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),</highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;help&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;help&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;help&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_vocab<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term_accession,</highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term[</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE,</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;xs:string&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>?<sp/>$element_info[</highlight><highlight class="stringliteral">&apos;readonly&apos;</highlight><highlight class="normal">]<sp/>:<sp/>TRUE,</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">,<sp/>$element_info)<sp/>and<sp/>is_array($element_info[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga46df8084aa82f744920d66ac59ae9a38" kindref="member">_tripal_get_bundle_field_element_details</ref>($element_info[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">],<sp/>$element_details);</highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$field_details[</highlight><highlight class="stringliteral">&apos;elements&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$element_details;</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1562"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"></highlight></codeline>
<codeline lineno="1576" refid="d9/d7f/tripal_8entities_8api_8inc_1a870d12f8becbd6cd6cff132253738d5c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a870d12f8becbd6cd6cff132253738d5c" kindref="member">tripal_insert_entity</ref>($bundle_name,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>){</highlight></codeline>
<codeline lineno="1577"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="1578"><highlight class="normal"></highlight></codeline>
<codeline lineno="1579"><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="1580"><highlight class="normal"></highlight></codeline>
<codeline lineno="1581"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>fields<sp/>associated<sp/>with<sp/>this<sp/>content<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1582"><highlight class="normal"><sp/><sp/>$instances<sp/>=<sp/>field_info_instances(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;name);</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"></highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($instances<sp/>as<sp/>$instance)<sp/>{</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_name<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($field_name);</highlight></codeline>
<codeline lineno="1587"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_type<sp/>=<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1588"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_settings<sp/>=<sp/>$field[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/><sp/><sp/>$instance_settings<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1590"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_name<sp/>=<sp/>$field[</highlight><highlight class="stringliteral">&apos;field_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1591"><highlight class="normal"><sp/><sp/><sp/><sp/>$vocabulary<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_vocabulary&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1592"><highlight class="normal"><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$instance[</highlight><highlight class="stringliteral">&apos;settings&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_accession&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1593"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_accession<sp/>=<sp/>$vocabulary<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$accession;</highlight></codeline>
<codeline lineno="1594"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_term<sp/>=<sp/><ref refid="de/d00/group__tripal__terms__api_1gaf99a705ba9ec49d8d1e46aa0300505c0" kindref="member">tripal_get_term_details</ref>($vocabulary,<sp/>$accession);</highlight></codeline>
<codeline lineno="1595"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_key<sp/>=<sp/>$field_term[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1596"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_key<sp/>=<sp/>strtolower(preg_replace(</highlight><highlight class="stringliteral">&apos;/<sp/>/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,<sp/>$key));</highlight></codeline>
<codeline lineno="1597"><highlight class="normal"></highlight></codeline>
<codeline lineno="1598"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>There<sp/>are<sp/>three<sp/>ways<sp/>that<sp/>a<sp/>field<sp/>value<sp/>can<sp/>be<sp/>specified.<sp/>Those</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1599"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>are<sp/>as<sp/>the<sp/>controlled<sp/>vocabulary<sp/>accession<sp/>(e.g.<sp/>GO:0000134),<sp/>sa</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>field<sp/>name<sp/>or<sp/>as<sp/>the<sp/>field<sp/>key<sp/>which<sp/>is<sp/>the<sp/>term<sp/>name<sp/>with</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>spaces<sp/>replaced<sp/>with<sp/>underscores.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>make<sp/>sure<sp/>that<sp/>required<sp/>fields<sp/>are<sp/>present.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($instance[</highlight><highlight class="stringliteral">&apos;required&apos;</highlight><highlight class="normal">]<sp/>==<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($field_key,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>and</highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!array_key_exists($field_accession,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>and</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>!array_key_exists($field_name,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(t(</highlight><highlight class="stringliteral">&apos;Cannot<sp/>insert<sp/>the<sp/>record.<sp/>Missing<sp/>the<sp/>required<sp/>field<sp/>&quot;%missing&quot;.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%missing&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_name)));</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"></highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>that<sp/>all<sp/>required<sp/>fields<sp/>are<sp/>present.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1614"><highlight class="normal"></highlight></codeline>
<codeline lineno="1615"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>make<sp/>sure<sp/>the<sp/>user<sp/>has<sp/>permission<sp/>to<sp/>do<sp/>this.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1616"><highlight class="normal"><sp/><sp/>$ec<sp/>=<sp/>entity_get_controller(</highlight><highlight class="stringliteral">&apos;TripalEntity&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/>$entity<sp/>=<sp/>$ec-&gt;create(array(</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;bundle&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name,</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;term_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;term_id,</highlight></codeline>
<codeline lineno="1620"><highlight class="normal"><sp/><sp/>));</highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/>$entity<sp/>=<sp/>$entity-&gt;save();</highlight></codeline>
<codeline lineno="1622"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1623"><highlight class="normal"></highlight></codeline>
<codeline lineno="1632" refid="d9/d7f/tripal_8entities_8api_8inc_1a3dbb32095411987c0cffc4314082fc21" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d7f/tripal_8entities_8api_8inc_1a3dbb32095411987c0cffc4314082fc21" kindref="member">tripal_update_entity</ref>($bundle_name,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1633"><highlight class="normal"></highlight></codeline>
<codeline lineno="1634"><highlight class="normal"></highlight></codeline>
<codeline lineno="1635"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/api/tripal.entities.api.inc"/>
  </compounddef>
</doxygen>
