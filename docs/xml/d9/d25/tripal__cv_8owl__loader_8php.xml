<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d9/d25/tripal__cv_8owl__loader_8php" kind="file" language="PHP">
    <compoundname>tripal_cv.owl_loader.php</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d9/d25/tripal__cv_8owl__loader_8php_1aa293dc41407e8d01f89e6e62c5cc0008" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_cv_parse_owl</definition>
        <argsstring>($filename)</argsstring>
        <name>tripal_cv_parse_owl</name>
        <param>
          <declname>$filename</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Parses an OWL XML file and imports the CV terms into Chado</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$filename</parametername>
</parameternamelist>
<parameterdescription>
<para>The full path to the OWL XML file.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>No return value.</para></simplesect>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" line="22" column="1" bodyfile="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" bodystart="22" bodyend="201"/>
      </memberdef>
      <memberdef kind="function" id="d9/d25/tripal__cv_8owl__loader_8php_1a60e3c05f3297838853df6a5d7f7482c7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_owl_check_class_depedencies</definition>
        <argsstring>(OWLStanza $stanza, $vocab_db_name, &amp;$deps)</argsstring>
        <name>tripal_owl_check_class_depedencies</name>
        <param>
          <type><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref></type>
          <declname>$stanza</declname>
        </param>
        <param>
          <declname>$vocab_db_name</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$deps</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Checks for required vocabularies that are not loaded into Chado.</para><para>Some vocabularies use terms from other ontologies. If this is happens we need to ensure that the dependent vocabularies are present in the database prior to loading this one. This function adds to the $deps array all of the database names and term accessions that are missing in Chado.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$stanza</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref> object for the current stanza from the OWL file. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$vocab_db_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the database for the vocabulary being loded. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$deps</parametername>
</parameternamelist>
<parameterdescription>
<para>The dependencies array. The missing databases are provided in array using a &apos;db&apos; key, and missing terms are in a second array using a &apos;dbxref&apos; key. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" line="221" column="1" bodyfile="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" bodystart="221" bodyend="299"/>
      </memberdef>
      <memberdef kind="function" id="d9/d25/tripal__cv_8owl__loader_8php_1ac1dd7fc68ccbe35d756f97d97646fad9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_owl_handle_annotation_property</definition>
        <argsstring>($stanza, $vocabs)</argsstring>
        <name>tripal_owl_handle_annotation_property</name>
        <param>
          <declname>$stanza</declname>
        </param>
        <param>
          <declname>$vocabs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$stanza</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$vocabs</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" line="320" column="1" bodyfile="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" bodystart="320" bodyend="390"/>
      </memberdef>
      <memberdef kind="function" id="d9/d25/tripal__cv_8owl__loader_8php_1ae6a12b0839e81411b62a148f167394cd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_owl_handle_class</definition>
        <argsstring>(OWLStanza $stanza, $vocabs)</argsstring>
        <name>tripal_owl_handle_class</name>
        <param>
          <type><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref></type>
          <declname>$stanza</declname>
        </param>
        <param>
          <declname>$vocabs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The function goes through owl:Class stanza to insert new vocabularies.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$stanza</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref> object for the current stanza from the OWL file. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$vocabs</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" line="413" column="1" bodyfile="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" bodystart="413" bodyend="510"/>
      </memberdef>
      <memberdef kind="function" id="d9/d25/tripal__cv_8owl__loader_8php_1a860dde68db035cb2f5f52062792ec286" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_owl_handle_description</definition>
        <argsstring>($stanza, $vocabs)</argsstring>
        <name>tripal_owl_handle_description</name>
        <param>
          <declname>$stanza</declname>
        </param>
        <param>
          <declname>$vocabs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$stanza</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$vocabs</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" line="399" column="1" bodyfile="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" bodystart="399" bodyend="400"/>
      </memberdef>
      <memberdef kind="function" id="d9/d25/tripal__cv_8owl__loader_8php_1a65173710c719e8131a2c45cea086320e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_owl_handle_object_property</definition>
        <argsstring>($stanza, $vocabs)</argsstring>
        <name>tripal_owl_handle_object_property</name>
        <param>
          <declname>$stanza</declname>
        </param>
        <param>
          <declname>$vocabs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$stanza</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$vocabs</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" line="309" column="1" bodyfile="tripal_chado/includes/loaders/tripal_cv.owl_loader.php" bodystart="309" bodyend="310"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>file from header </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">//<sp/>This<sp/>Tripal_cv.owl_loader.php<sp/>and<sp/>OWLStanza.inc(CLASS)<sp/>file<sp/>is<sp/>being<sp/>developed<sp/>to<sp/>read<sp/>and<sp/>parse<sp/>through<sp/>any<sp/>scientific</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">//<sp/>ontology<sp/>XML<sp/>Owl<sp/>file<sp/>to<sp/>have<sp/>the<sp/>vocabularies<sp/>be<sp/>inserted<sp/>into<sp/>the<sp/>Chado<sp/>database<sp/>for<sp/>the<sp/>open<sp/>source<sp/>project</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Tripal.info<sp/>to<sp/>be<sp/>used.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal">require_once<sp/>(</highlight><highlight class="stringliteral">&apos;OWLStanza.inc&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="22" refid="d9/d25/tripal__cv_8owl__loader_8php_1aa293dc41407e8d01f89e6e62c5cc0008" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1aa293dc41407e8d01f89e6e62c5cc0008" kindref="member">tripal_cv_parse_owl</ref>($filename)<sp/>{</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>need<sp/>to<sp/>pass<sp/>in<sp/>the<sp/>$db_name<sp/>as<sp/>the<sp/>cv<sp/>name<sp/>into<sp/>the<sp/>function<sp/>when<sp/>you<sp/>see<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>oboInOwl:default-namespace<sp/>that<sp/>is<sp/>not<sp/>the<sp/>same<sp/>as<sp/>$db_name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>this<sp/>all<sp/>should<sp/>occur<sp/>inside<sp/>of<sp/>a<sp/>transaction.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Opening<sp/>the<sp/>OWL<sp/>file<sp/>for<sp/>parsing.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/>$owl<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>XMLReader();</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>command<sp/>will<sp/>open<sp/>and<sp/>read<sp/>the<sp/>any<sp/>Owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$owl-&gt;open($filename))<sp/>{</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>opening<sp/>OWL<sp/>file:<sp/>&apos;$filename&apos;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/>exit();</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>RDF<sp/>stanza.<sp/>We<sp/>pass<sp/>FALSE<sp/>as<sp/>the<sp/>second<sp/>parameter<sp/>to<sp/>prevent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>object<sp/>from<sp/>reading<sp/>the<sp/>entire<sp/>file<sp/>into<sp/>memory.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/>$rdf<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl,<sp/>FALSE);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>ontology<sp/>stanza.<sp/>It<sp/>will<sp/>contain<sp/>the<sp/>values<sp/>for<sp/>the<sp/>database</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>name<sp/>for<sp/>this<sp/>ontology.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/>$ontology<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl);</highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Look<sp/>for<sp/>the<sp/>db<sp/>name<sp/>in<sp/>using<sp/>the<sp/>&apos;oboInOwl:default-namespace<sp/>term.<sp/>If<sp/>it&apos;s</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>not<sp/>present<sp/>then<sp/>we&apos;ll<sp/>use<sp/>the<sp/>&apos;about&apos;<sp/>element<sp/>to<sp/>get<sp/>the<sp/>namespace.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/>$namespace<sp/>=<sp/>$ontology-&gt;getChild(</highlight><highlight class="stringliteral">&apos;oboInOwl:default-namespace&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($namespace)<sp/>{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>$db_name<sp/>=<sp/>$namespace-&gt;getValue();</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>database<sp/>record<sp/>into<sp/>Chado<sp/>using<sp/>the<sp/>owl:Ontology<sp/>stanza<sp/>of<sp/>the<sp/>owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>$about<sp/>=<sp/>$ontology-&gt;getAttribute(</highlight><highlight class="stringliteral">&apos;rdf:about&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>wrote<sp/>the<sp/>regular<sp/>expression<sp/>on<sp/>the<sp/>rdf.about<sp/>line<sp/>to<sp/>get<sp/>the<sp/>database<sp/>name<sp/>for<sp/>any<sp/>particular<sp/>Owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^.*\/(.*?)\..*$/&apos;</highlight><highlight class="normal">,<sp/>$about,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$db_name<sp/>=<sp/>strtoupper($matches[1]);</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Step<sp/>1:<sp/>Make<sp/>sure<sp/>that<sp/>all<sp/>dependencies<sp/>(database<sp/>names)<sp/>are<sp/>met<sp/>for<sp/>each<sp/>Owl<sp/>ontology<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>loop<sp/>through<sp/>each<sp/>stanza,<sp/>one<sp/>at<sp/>a<sp/>time,<sp/>and<sp/>handle<sp/>each<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>based<sp/>on<sp/>the<sp/>tag<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/>$stanza<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>an<sp/>empty<sp/>array<sp/>for<sp/>the<sp/>dependencies<sp/>to<sp/>go<sp/>in.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/>$deps<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array<sp/>(),</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array<sp/>()</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Start<sp/>looping<sp/>and<sp/>parsing<sp/>through<sp/>the<sp/>owl:Class<sp/>stanza<sp/>section<sp/>of<sp/>the<sp/>Owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(!$stanza-&gt;isFinished())<sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>tag<sp/>name<sp/>from<sp/>OWLStanza.inc<sp/>to<sp/>identify<sp/>which<sp/>function<sp/>should<sp/>be<sp/>called.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>($stanza-&gt;getTagName())<sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;owl:Class&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1a60e3c05f3297838853df6a5d7f7482c7" kindref="member">tripal_owl_check_class_depedencies</ref>($stanza,<sp/>$vocab_db_name,<sp/>$deps);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>to<sp/>the<sp/>next<sp/>stanza<sp/>in<sp/>the<sp/>OWL<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>$stanza<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl);</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count(array_keys($deps[</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">]))<sp/>&gt;<sp/>0<sp/>or<sp/>count(array_keys($deps[</highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">]))<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>have<sp/>unmet<sp/>dependencies.<sp/>Print<sp/>those<sp/>out<sp/>and<sp/>return.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>deps<sp/>array<sp/>will<sp/>have<sp/>DB’s,<sp/>then<sp/>terms&apos;<sp/>.<sp/>&quot;\n&quot;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($deps[</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">])<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Cannot<sp/>import<sp/>ontology,<sp/>&quot;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$db_name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&quot;,<sp/>as<sp/>the<sp/>following<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;dependent<sp/>vocabularies<sp/>must<sp/>first<sp/>be<sp/>imported:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>print_r(array_keys($deps[</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">]),<sp/>TRUE)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($deps[</highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">])<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Cannot<sp/>import<sp/>ontology,<sp/>&quot;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$db_name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&quot;,<sp/>as<sp/>the<sp/>following<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;dependent<sp/>terms<sp/>must<sp/>first<sp/>be<sp/>imported:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>print_r(array_keys($deps[</highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">]),<sp/>TRUE)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;\n&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Step<sp/>2:<sp/>If<sp/>we<sp/>pass<sp/>the<sp/>dependency<sp/>check<sp/>in<sp/>step<sp/>1<sp/>then<sp/>we<sp/>can<sp/>insert</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>terms.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Holds<sp/>an<sp/>array<sp/>of<sp/>CV<sp/>and<sp/>DB<sp/>records<sp/>that<sp/>have<sp/>already<sp/>been</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>inserted<sp/>(reduces<sp/>number<sp/>of<sp/>queires).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/>$vocabs<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array<sp/>(),</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array<sp/>(),</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;this&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array<sp/>()</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Reload<sp/>the<sp/>ontology<sp/>to<sp/>reposition<sp/>at<sp/>the<sp/>beginning<sp/>of<sp/>the<sp/>OWl<sp/>file<sp/>for<sp/>inserting<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>new<sp/>terms<sp/>into<sp/>Chado.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/>$owl<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>XMLReader();</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$owl-&gt;open($filename))<sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>opening<sp/>OWL<sp/>file:<sp/>&apos;$filename&apos;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>exit();</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>$rdf<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl,<sp/>FALSE);</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>$ontology<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>database<sp/>record<sp/>into<sp/>Chado<sp/>using<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>owl:Ontology<sp/>stanza.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>$url<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/>$homepage<sp/>=<sp/>$ontology-&gt;getChild(</highlight><highlight class="stringliteral">&apos;foaf:homepage&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($homepage)<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>$url<sp/>=<sp/>$homepage-&gt;getValue();</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/>$db<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url,</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db_name</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Using<sp/>the<sp/>Tripal<sp/>API<sp/>function<sp/>to<sp/>insert<sp/>the<sp/>term<sp/>into<sp/>the<sp/>Chado<sp/>database.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/>$db<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1ga7f331faea3ff3c493fe64ee5ccb972de" kindref="member">chado_insert_db</ref>($db);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>description<sp/>for<sp/>this<sp/>vocabulary.<sp/>This<sp/>should<sp/>be<sp/>in<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>dc:description<sp/>element.<sp/>If<sp/>that<sp/>element<sp/>is<sp/>missing<sp/>then<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>description<sp/>should<sp/>default<sp/>to<sp/>the<sp/>empty<sp/>string.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/>$cv_description<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1a87b032cba06009e3467abf1c8018d960" kindref="member">$description</ref><sp/>=<sp/>$ontology-&gt;getChild(</highlight><highlight class="stringliteral">&apos;dc:description&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="de/d47/tripal__project__base_8tpl_8php_1a87b032cba06009e3467abf1c8018d960" kindref="member">$description</ref>)<sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>$cv_description<sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1a87b032cba06009e3467abf1c8018d960" kindref="member">$description</ref>-&gt;getValue();</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>name<sp/>for<sp/>the<sp/>CV.<sp/>This<sp/>should<sp/>be<sp/>in<sp/>the<sp/>&apos;dc:title&apos;<sp/>element.<sp/>If<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>title<sp/>is<sp/>not<sp/>present<sp/>then<sp/>the<sp/>cv<sp/>name<sp/>should<sp/>default<sp/>to<sp/>the<sp/>database<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>$cv_name<sp/>==<sp/>$namespace<sp/>=<sp/>$ontology-&gt;getChild(</highlight><highlight class="stringliteral">&apos;oboInOwl:default-namespace&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($namespace)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>$cv_name<sp/>=<sp/>$namespace-&gt;getValue();</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/>$title<sp/>=<sp/>$ontology-&gt;getChild(</highlight><highlight class="stringliteral">&apos;dc:title&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($title)<sp/>{</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>$cv_name<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/[^\w]/&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal">,<sp/>strtolower($title-&gt;getValue()));</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>CV<sp/>record<sp/>into<sp/>Chado.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/>$cv<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga69ea5153de0b94fea2be37f336523d48" kindref="member">chado_insert_cv</ref>($cv_name,<sp/>$cv_description);</highlight></codeline>
<codeline lineno="160"><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>this<sp/>CV<sp/>and<sp/>DB<sp/>to<sp/>our<sp/>vocabs<sp/>array<sp/>so<sp/>we<sp/>can<sp/>reuse<sp/>it<sp/>later.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/>$vocabs[$db_name][</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$namespace_cv;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/>$vocabs[$db_name][</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$db;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/>$vocabs[</highlight><highlight class="stringliteral">&apos;this&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$db_name;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>loop<sp/>through<sp/>each<sp/>stanza<sp/>of<sp/>the<sp/>owl<sp/>file,<sp/>one<sp/>at<sp/>a<sp/>time,<sp/>and<sp/>handle<sp/>each<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>based<sp/>on<sp/>the<sp/>tag<sp/>name<sp/>from<sp/>the<sp/>OWLStanza.inc<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/>$stanza<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(!$stanza-&gt;isFinished())<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>tag<sp/>name<sp/>to<sp/>identify<sp/>which<sp/>function<sp/>should<sp/>be<sp/>called.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>($stanza-&gt;getTagName())<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;owl:AnnotationProperty&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tripal_owl_handle_annotation_property($stanza,<sp/>$vocabs);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;rdf:Description&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tripal_owl_handle_description($stanza,<sp/>$vocabs);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;owl:ObjectProperty&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tripal_owl_handle_object_property($stanza,<sp/>$vocabs);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;owl:Class&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1ae6a12b0839e81411b62a148f167394cd" kindref="member">tripal_owl_handle_class</ref>($stanza,<sp/>$vocabs);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;owl:Axiom&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;owl:Restriction&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Unhandled<sp/>stanza:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$stanza-&gt;getTagName());</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit();</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>next<sp/>stanza<sp/>in<sp/>the<sp/>OWL<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>$stanza<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref>($owl);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Close<sp/>the<sp/>XMLReader<sp/>$owl<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>$owl-&gt;close();</highlight></codeline>
<codeline lineno="201"><highlight class="normal">}</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="221" refid="d9/d25/tripal__cv_8owl__loader_8php_1a60e3c05f3297838853df6a5d7f7482c7" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1a60e3c05f3297838853df6a5d7f7482c7" kindref="member">tripal_owl_check_class_depedencies</ref>(<ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref><sp/>$stanza,<sp/>$vocab_db_name,<sp/>&amp;$deps)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>the<sp/>variables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/>$db_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/>$db<sp/>=<sp/>null;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>DB<sp/>name<sp/>and<sp/>accession<sp/>from<sp/>the<sp/>&quot;rdf:about&quot;<sp/>attribute.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>$about<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a3d027b9e9acb41da218daa5b052ca8a1" kindref="member">getAttribute</ref>(</highlight><highlight class="stringliteral">&apos;rdf:about&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$about)<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>some<sp/>owl:Class<sp/>stanzas<sp/>do<sp/>not<sp/>have<sp/>an<sp/>about.<sp/>What<sp/>are<sp/>these?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>how<sp/>should<sp/>we<sp/>handle<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>wrote<sp/>the<sp/>regular<sp/>expression<sp/>on<sp/>the<sp/>rdf.about<sp/>line<sp/>to<sp/>get<sp/>the<sp/>database</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>name<sp/>and<sp/>accession<sp/>term<sp/>for<sp/>any<sp/>particular<sp/>Owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/.*\/(.+)_(.+)/&apos;</highlight><highlight class="normal">,<sp/>$about,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>$db_name<sp/>=<sp/>strtoupper($matches[1]);</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$matches[2];</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;owl:Class<sp/>stanza<sp/>&apos;rdf:about&apos;<sp/>attribute<sp/>is<sp/>not<sp/>formated<sp/>as<sp/>expected:<sp/>&apos;$about&apos;.<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;This<sp/>is<sp/>necessary<sp/>to<sp/>determine<sp/>the<sp/>term&apos;s<sp/>accession:<sp/>\n\n&quot;</highlight><highlight class="normal"><sp/>.<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a8d06c16b889091812d29a8ff2104ae13" kindref="member">getXML</ref>());</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>database<sp/>name<sp/>for<sp/>this<sp/>term<sp/>is<sp/>the<sp/>same<sp/>as<sp/>the<sp/>vocabulary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>are<sp/>trying<sp/>to<sp/>load,<sp/>then<sp/>don&apos;t<sp/>include<sp/>it<sp/>in<sp/>the<sp/>$deps<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($db_name<sp/>!==<sp/>$vocab_db_name)<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>if<sp/>the<sp/>db_name<sp/>does<sp/>not<sp/>exist<sp/>in<sp/>the<sp/>chado.db<sp/>table.<sp/>If<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>does<sp/>not<sp/>exist<sp/>then<sp/>add<sp/>it<sp/>to<sp/>our<sp/>$deps<sp/>array.<sp/>If<sp/>the<sp/>query<sp/>fails<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>throw<sp/>an<sp/>exception.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/>$db<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">,<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/>),<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db_name</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>));</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($db<sp/>===<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>execute<sp/>query<sp/>to<sp/>find<sp/>vocabulary<sp/>in<sp/>chado.db<sp/>table\n\n&quot;</highlight><highlight class="normal"><sp/>.<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a8d06c16b889091812d29a8ff2104ae13" kindref="member">getXML</ref>());</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($db)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>$deps[</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">][$db_name]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Does<sp/>this<sp/>stanza<sp/>provide<sp/>the<sp/>URL<sp/>for<sp/>the<sp/>OWL<sp/>file<sp/>of<sp/>this<sp/>missing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dependency.<sp/>If<sp/>so<sp/>then<sp/>add<sp/>it<sp/>to<sp/>our<sp/>deps<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>$imported_from<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a2c223c111d2d76776a82dd434df4e02f" kindref="member">getChild</ref>(</highlight><highlight class="stringliteral">&apos;obo:IAO_0000412&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($imported_from<sp/>==<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>$url<sp/>=<sp/>$imported_from-&gt;getAttribute(</highlight><highlight class="stringliteral">&apos;rdf:resource&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($url)<sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$deps[</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">][$db_name]<sp/>=<sp/>$url;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>db_name<sp/>exists,<sp/>then<sp/>check<sp/>if<sp/>the<sp/>accession<sp/>exists<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>chado.dbxref<sp/>table.<sp/>If<sp/>it<sp/>doesn&apos;t<sp/>exist<sp/>then<sp/>add<sp/>an<sp/>entry<sp/>to<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$deps<sp/>array.<sp/>If<sp/>the<sp/>query<sp/>fails<sp/>then<sp/>throw<sp/>an<sp/>exception.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db[0]-&gt;db_id,</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>$dbxref<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">,<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/>),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($dbxref<sp/>===<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>execute<sp/>query<sp/>to<sp/>find<sp/>vocabulary<sp/>term<sp/>in<sp/>chado.dbxref<sp/>table\n\n&quot;</highlight><highlight class="normal"><sp/>.<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a8d06c16b889091812d29a8ff2104ae13" kindref="member">getXML</ref>());</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>elseif<sp/>(count($accession)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>$deps[</highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">][$db_name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$accesson]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="299"><highlight class="normal">}</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="309" refid="d9/d25/tripal__cv_8owl__loader_8php_1a65173710c719e8131a2c45cea086320e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1a65173710c719e8131a2c45cea086320e" kindref="member">tripal_owl_handle_object_property</ref>($stanza,<sp/>$vocabs)<sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal">}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="320" refid="d9/d25/tripal__cv_8owl__loader_8php_1ac1dd7fc68ccbe35d756f97d97646fad9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1ac1dd7fc68ccbe35d756f97d97646fad9" kindref="member">tripal_owl_handle_annotation_property</ref>($stanza,<sp/>$vocabs)<sp/>{</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$matches<sp/>=<sp/>array();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$db_name<sp/>=<sp/>&apos;&apos;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$accession<sp/>=<sp/>&apos;&apos;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$about<sp/>=<sp/>$stanza-&gt;getAttribute(&apos;rdf:about&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight><highlight class="comment">//<sp/>//<sp/>Get<sp/>the<sp/>DB<sp/>name<sp/>and<sp/>accession<sp/>from<sp/>the<sp/>about<sp/>attribute<sp/>using<sp/>the<sp/>preg<sp/>match<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>if<sp/>(preg_match(&apos;/.*\/(.+)_(.+)/&apos;,<sp/>$about,<sp/>$matches))<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$db_name<sp/>=<sp/>($matches[1]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$matches[2];</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>else<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>throw<sp/>new<sp/>Exception(&quot;owl:Class<sp/>stanza<sp/>&apos;rdf:about&apos;<sp/>attribute<sp/>is<sp/>not<sp/>formated<sp/>as<sp/>expected:<sp/>&apos;$about&apos;.<sp/>&quot;<sp/>.<sp/>&quot;This<sp/>is<sp/>necessary<sp/>to<sp/>determine<sp/>the<sp/>term&apos;s<sp/>accession:<sp/>\n\n&quot;<sp/>.<sp/>$stanza-&gt;getXML());</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>//<sp/>Insert<sp/>a<sp/>DB<sp/>Record</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight><highlight class="comment">//<sp/>if<sp/>(array_key_exists($db_name,<sp/>$vocabs))<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$db<sp/>=<sp/>$vocabs[$db_name][&apos;db&apos;];</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$default_namespace_cv<sp/>=<sp/>$vocabs[$db_name][&apos;cv&apos;];</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>else<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>//<sp/>Unfortunately,<sp/>all<sp/>we<sp/>have<sp/>is<sp/>the<sp/>name.<sp/>The<sp/>OWL<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>//<sp/>doesn&apos;t<sp/>provides<sp/>us<sp/>the<sp/>URL,<sp/>description,<sp/>etc.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$values<sp/>=<sp/>array(</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>$db_name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$db<sp/>=<sp/>chado_insert_db($values);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight><highlight class="comment">//<sp/>//<sp/>Insert<sp/>a<sp/>dbxref<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$values<sp/>=<sp/>array(</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>&apos;db_id&apos;<sp/>=&gt;<sp/>$db-&gt;db_id,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>&apos;accession&apos;<sp/>=&gt;<sp/>$accession</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$dbxref<sp/>=<sp/>chado_insert_dbxref($values);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$imported_from<sp/>=<sp/>$stanza-&gt;getChild(&apos;obo:IAO_0000114&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>if<sp/>($imported_from<sp/>==<sp/>NULL)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>$url<sp/>=<sp/>$imported_from-&gt;getAttribute(&apos;rdf:resource&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>if<sp/>($url)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>$vocabs[&apos;db&apos;][$db_name]<sp/>=<sp/>$url;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>return;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight><highlight class="comment">//<sp/>//<sp/>Insert<sp/>a<sp/>new<sp/>cvterm<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$cvterm_name<sp/>=<sp/>&apos;&apos;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$definition<sp/>=<sp/>&apos;&apos;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;getChild(&apos;rdfs:label&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>if<sp/>($cvterm_name)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;getValue();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$definition<sp/>=<sp/>$stanza-&gt;getChild(&apos;obo:IAO_0000115&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>if<sp/>($definition)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$definition<sp/>=<sp/>$stanza-&gt;getValue();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$term<sp/>=<sp/>array(</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>&apos;id&apos;<sp/>=&gt;<sp/>$db-&gt;name<sp/>.&apos;:&apos;.<sp/>$dbxref-&gt;accession,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>$cvterm_name,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>&apos;cv_name&apos;<sp/>=&gt;<sp/>$cv-&gt;name,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>&apos;definition&apos;<sp/>=&gt;<sp/>$definition,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$option<sp/>=array();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>if<sp/>($vocabs[&apos;this&apos;]<sp/>!=<sp/>$db-&gt;name){</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>$option[&apos;update_existing&apos;]<sp/>=<sp/>FALSE;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/>$cvterm<sp/>=<sp/>chado_insert_cvterm($term,<sp/>$option);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight><highlight class="comment">//<sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal">}</highlight></codeline>
<codeline lineno="399" refid="d9/d25/tripal__cv_8owl__loader_8php_1a860dde68db035cb2f5f52062792ec286" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1a860dde68db035cb2f5f52062792ec286" kindref="member">tripal_owl_handle_description</ref>($stanza,<sp/>$vocabs)<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal">}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight></codeline>
<codeline lineno="413" refid="d9/d25/tripal__cv_8owl__loader_8php_1ae6a12b0839e81411b62a148f167394cd" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d9/d25/tripal__cv_8owl__loader_8php_1ae6a12b0839e81411b62a148f167394cd" kindref="member">tripal_owl_handle_class</ref>(<ref refid="d5/dcc/classOWLStanza" kindref="compound">OWLStanza</ref><sp/>$stanza,<sp/>$vocabs)<sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>the<sp/>database<sp/>and<sp/>cv<sp/>variables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/>$db_name<sp/>=<sp/>$vocabs[</highlight><highlight class="stringliteral">&apos;this&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/>$is_a<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/>$namespace_cv<sp/>=<sp/>$vocabs[$db_name][</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/>$db<sp/>=<sp/>$vocabs[$db_name][</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>dbxref<sp/>record<sp/>into<sp/>Chado<sp/>using<sp/>the<sp/>owl:Class<sp/>stanza<sp/>of<sp/>the<sp/>owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Any<sp/>oboInOwl:id<sp/>supercedes<sp/>what<sp/>we<sp/>find<sp/>in<sp/>the<sp/>rdf:about<sp/>in<sp/>the<sp/>owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/>$obo_id<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a2c223c111d2d76776a82dd434df4e02f" kindref="member">getChild</ref>(</highlight><highlight class="stringliteral">&apos;oboInOwl:id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($obo_id)<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/.*&gt;(.+):(.+)&lt;.*/&apos;</highlight><highlight class="normal">,<sp/>$about,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$db_name<sp/>=<sp/>strtoupper($matches[1]);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$matches[2];</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$about<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a3d027b9e9acb41da218daa5b052ca8a1" kindref="member">getAttribute</ref>(</highlight><highlight class="stringliteral">&apos;rdf:about&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>wrote<sp/>the<sp/>regular<sp/>expression<sp/>on<sp/>the<sp/>rdf.about<sp/>line<sp/>to<sp/>get<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>db_name<sp/>and<sp/>accession<sp/>for<sp/>any<sp/>particular<sp/>Owl<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/.*\/(.+)_(.+)/&apos;</highlight><highlight class="normal">,<sp/>$about,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$db_name<sp/>=<sp/>strtoupper($matches[1]);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$matches[2];</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;owl:Class<sp/>stanza<sp/>&apos;rdf:about&apos;<sp/>attribute<sp/>is<sp/>not<sp/>formated<sp/>as<sp/>expected:<sp/>&apos;$about&apos;.<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;This<sp/>is<sp/>necessary<sp/>to<sp/>determine<sp/>the<sp/>term&apos;s<sp/>accession:<sp/>\n\n&quot;</highlight><highlight class="normal"><sp/>.<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a8d06c16b889091812d29a8ff2104ae13" kindref="member">getXML</ref>());</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>database<sp/>name<sp/>for<sp/>this<sp/>term<sp/>is<sp/>the<sp/>same<sp/>as<sp/>the<sp/>vocabulary</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>are<sp/>trying<sp/>to<sp/>load,<sp/>then<sp/>do<sp/>include<sp/>it<sp/>in<sp/>the<sp/>$vocabs<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($db_name<sp/>==<sp/>$vocabs[</highlight><highlight class="stringliteral">&apos;this&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>insert<sp/>dbxref</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db-&gt;db_id,</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/>$dbxref<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1gacbea95be42e994968414915482a7ff34" kindref="member">chado_insert_dbxref</ref>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a2c223c111d2d76776a82dd434df4e02f" kindref="member">getChild</ref>(</highlight><highlight class="stringliteral">&apos;rdfs:label&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($cvterm_name)<sp/>{</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a4db61a729c6512566b6ec5887e12758e" kindref="member">getValue</ref>();</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>$definition<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a2c223c111d2d76776a82dd434df4e02f" kindref="member">getChild</ref>(</highlight><highlight class="stringliteral">&apos;obo:IAO_0000115&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($definition)<sp/>{</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/>$definition<sp/>=<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a4db61a729c6512566b6ec5887e12758e" kindref="member">getValue</ref>();</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$dbxref-&gt;accession,</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db-&gt;name,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a4db61a729c6512566b6ec5887e12758e" kindref="member">getValue</ref>(),</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><sp/>$stanza-&gt;<ref refid="d5/dcc/classOWLStanza_1a4db61a729c6512566b6ec5887e12758e" kindref="member">getValue</ref>(),</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="474"><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array<sp/>();</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocabs[</highlight><highlight class="stringliteral">&apos;this&apos;</highlight><highlight class="normal">]<sp/>!=<sp/>$db-&gt;name)<sp/>{</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;update_existing&apos;</highlight><highlight class="normal">]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga8f63166e7d8232eac68393510ddd6411" kindref="member">chado_insert_cvterm</ref>($term,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>//<sp/>Add<sp/>a<sp/>record<sp/>to<sp/>the<sp/>chado<sp/>relationship<sp/>table<sp/>if<sp/>an<sp/>‘rdfs:subClassOf’<sp/>child<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;getChild(&apos;rdfs:subClassOf&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>a<sp/>new<sp/>cvterm<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$cvterm_name<sp/>=<sp/>&apos;&apos;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$definition<sp/>=<sp/>&apos;&apos;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;getChild(&apos;rdfs:label&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>($cvterm_name)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$cvterm_name<sp/>=<sp/>$stanza-&gt;getValue();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$definition<sp/>=<sp/>$stanza-&gt;getChild(&apos;obo:IAO_0000115&apos;);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>($definition)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//$definition<sp/>=<sp/>$stanza-&gt;getValue();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$term<sp/>=<sp/>array<sp/>(</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;id&apos;<sp/>=&gt;<sp/>$db-&gt;name<sp/>.<sp/>&apos;:&apos;<sp/>.<sp/>$dbxref-&gt;accession,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;name&apos;<sp/>=&gt;<sp/>$cvterm_name,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;cv_name&apos;<sp/>=&gt;<sp/>$cv-&gt;name,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;definition&apos;<sp/>=&gt;<sp/>$definition</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$option<sp/>=<sp/>array<sp/>();</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>($vocabs[&apos;this&apos;]<sp/>!=<sp/>$db-&gt;name)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$option[&apos;update_existing&apos;]<sp/>=<sp/>FALSE;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$cvterm<sp/>=<sp/>chado_insert_cvterm($term,<sp/>$option);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado/includes/loaders/tripal_cv.owl_loader.php"/>
  </compounddef>
</doxygen>
