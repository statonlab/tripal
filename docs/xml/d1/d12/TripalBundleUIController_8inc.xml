<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d1/d12/TripalBundleUIController_8inc" kind="file" language="PHP">
    <compoundname>TripalBundleUIController.inc</compoundname>
    <innerclass refid="dd/dfd/classTripalBundleUIController" prot="public">TripalBundleUIController</innerclass>
      <sectiondef kind="func">
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1a3db11f49ee7a6ef6a8c405e505fcb5f6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_admin_access</definition>
        <argsstring>($entity)</argsstring>
        <name>tripal_admin_access</name>
        <param>
          <declname>$entity</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Checks access permissions for a given entity. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="863" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="863" bodyend="898"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1a0a56bd2d1ad7fd59f78f5d0cd930bd86" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_admin_add_type_form</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_admin_add_type_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Form for creating tripal data types.</para><para>This form is available on the menu at Admin &gt;&gt; Structure &gt;&gt; Biological Data Types. It requires that a module implmennt the vocabulary storage. Tripal knows which vocabulary storage methods are available when a module implements the <ref refid="de/d00/group__tripal__terms__api_1ga3bb77ac3f163fdeebab494360af689b2" kindref="member">hook_vocab_storage_info()</ref> hook. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="538" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="538" bodyend="744"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1a0119f0a48a4cff6129912fd766d5437c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_admin_add_type_form_ajax_callback</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>tripal_admin_add_type_form_ajax_callback</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements an AJAX callback for the tripal_chado_vocab_select_term_form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="748" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="748" bodyend="750"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1a41e53c3bb4293034f15efbde95b8601f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_admin_add_type_form_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_admin_add_type_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_submit() for the tripal_admin_add_type_form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="809" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="809" bodyend="858"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1a9d80d5ff428d4e8f8257ae1b00cbb2db" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_admin_add_type_form_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_admin_add_type_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_validate() for the tripal_admin_add_type_form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="755" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="755" bodyend="805"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1ad816edceb86633ab195f315169792602" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_bundle_access</definition>
        <argsstring>($op, $type=NULL, $account=NULL)</argsstring>
        <name>tripal_bundle_access</name>
        <param>
          <declname>$op</declname>
        </param>
        <param>
          <declname>$type</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$account</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Access callback for the entity API. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="525" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="525" bodyend="527"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1a93bad334cbbd9e3d7468c4b3d2575abb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_tripal_bundle_form</definition>
        <argsstring>($form, &amp;$form_state, $entityDataType)</argsstring>
        <name>tripal_tripal_bundle_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <param>
          <declname>$entityDataType</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Tripal content type edit form.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The default form array. Usually empty. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>Build information for the form including the entity type and submitted values. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$entityDataType</parametername>
</parameternamelist>
<parameterdescription>
<para>A string indicating the entity type. This will always be <ref refid="d4/daf/classTripalBundle" kindref="compound">TripalBundle</ref>. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="121" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="121" bodyend="387"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1af06137d266ba2e327ee5fc7a33cee991" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_tripal_bundle_form_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_tripal_bundle_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Submit: Tripal content type edit form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="449" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="449" bodyend="520"/>
      </memberdef>
      <memberdef kind="function" id="d1/d12/TripalBundleUIController_8inc_1ab8b27a855041053d740af0d560eefbe0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_tripal_bundle_form_validate</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>tripal_tripal_bundle_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validate: Tripal content type edit form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/includes/TripalBundleUIController.inc" line="392" column="1" bodyfile="tripal/includes/TripalBundleUIController.inc" bodystart="392" bodyend="444"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="10" refid="dd/dfd/classTripalBundleUIController" refkind="compound"><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="dd/dfd/classTripalBundleUIController" kindref="compound">TripalBundleUIController</ref><sp/></highlight><highlight class="keyword">extends</highlight><highlight class="normal"><sp/>EntityDefaultUIController<sp/>{</highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12" refid="dd/dfd/classTripalBundleUIController_1a767da49fda5811c61d7fd49b7d193f4b" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dd/dfd/classTripalBundleUIController_1a767da49fda5811c61d7fd49b7d193f4b" kindref="member">__construct</ref>($entity_type,<sp/>$entity_info)<sp/>{</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>parent::__construct($entity_type,<sp/>$entity_info);</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="19" refid="dd/dfd/classTripalBundleUIController_1a9502cc271379d084b60dc313518e6c7a" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dd/dfd/classTripalBundleUIController_1a9502cc271379d084b60dc313518e6c7a" kindref="member">hook_menu</ref>()<sp/>{</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>$items<sp/>=<sp/>parent::hook_menu();</highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Alter<sp/>the<sp/>Admin<sp/>&gt;<sp/>Structure<sp/>&gt;<sp/>Tripal<sp/>Content<sp/>Types<sp/>menu<sp/>item.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/>$items[$this-&gt;path][</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Manage<sp/>biological<sp/>content<sp/>types<sp/>that<sp/>are</highlight></codeline>
<codeline lineno="24"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>added<sp/>using<sp/>Tripal.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>don&apos;t<sp/>want<sp/>to<sp/>let<sp/>the<sp/>user<sp/>import<sp/>new<sp/>Tripal<sp/>data<sp/>types.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($items[$this-&gt;path<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/import&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>an<sp/>action<sp/>link<sp/>to<sp/>Admin<sp/>&gt;<sp/>Structure<sp/>&gt;<sp/>Tripal<sp/>Content<sp/>Types<sp/>for<sp/>adding<sp/>types.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/>$items[$this-&gt;path<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/add&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Add<sp/>Tripal<sp/>Content<sp/>Type&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Add<sp/>data<sp/>type<sp/>content&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;page<sp/>callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;drupal_get_form&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;page<sp/>arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_admin_add_type_form&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;access<sp/>arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;manage<sp/>tripal<sp/>content<sp/>types&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>MENU_LOCAL_ACTION,</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>2</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$items;</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="46" refid="dd/dfd/classTripalBundleUIController_1a19e2e4a7c3456b771521023e0a1fd78f" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dd/dfd/classTripalBundleUIController_1a19e2e4a7c3456b771521023e0a1fd78f" kindref="member">hook_forms</ref>()<sp/>{</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/>$forms<sp/>=<sp/>parent::hook_forms();</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>edit<sp/>form<sp/>for<sp/>the<sp/>entity<sp/>type<sp/>by<sp/>default<sp/>expects<sp/>a<sp/>function,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>named<sp/>after<sp/>the<sp/>entity<sp/>type<sp/>but<sp/>we<sp/>can&apos;t<sp/>dynamically<sp/>create<sp/>these</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>functions.<sp/>We&apos;ll<sp/>use<sp/>a<sp/>single<sp/>form<sp/>for<sp/>all<sp/>entity<sp/>types.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>$forms[$this-&gt;entityType<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_form&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_tripal_bundle_form&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback<sp/>arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array($this-&gt;entityType)</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$forms;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="63" refid="dd/dfd/classTripalBundleUIController_1aa28706c1efb58b2e6968f4b9d082f1c5" refkind="member"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">public</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dd/dfd/classTripalBundleUIController_1aa28706c1efb58b2e6968f4b9d082f1c5" kindref="member">overviewTable</ref>($conditions<sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>$entities<sp/>=<sp/>entity_load($this-&gt;entityType,<sp/>FALSE,<sp/>$conditions);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Sort<sp/>the<sp/>entities<sp/>by<sp/>label.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>$sorted<sp/>=<sp/>[];<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($entities<sp/>as<sp/>$entity)<sp/>{</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sorted[$entity-&gt;label]<sp/>=<sp/>$entity;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>ksort($sorted,<sp/>SORT_STRING|SORT_FLAG_CASE);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($sorted<sp/>as<sp/>$entity)<sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>term<sp/>for<sp/>this<sp/>content<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$additional_cols<sp/>=<sp/>[$entity-&gt;term-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/>l($entity-&gt;accession,<sp/></highlight><highlight class="stringliteral">&apos;cv/lookup/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$entity-&gt;term-&gt;vocab-&gt;vocabulary<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$entity-&gt;term-&gt;accession)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>$this-&gt;overviewTableRow($conditions,<sp/></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>entity_id($this-&gt;entityType,<sp/>$entity),<sp/>$entity,</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$additional_cols);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Assemble<sp/>the<sp/>right<sp/>table<sp/>header.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>=<sp/>array(t(</highlight><highlight class="stringliteral">&apos;Label&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($this-&gt;entityInfo[</highlight><highlight class="stringliteral">&apos;exportable&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>[]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;Status&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Term&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>operations<sp/>with<sp/>the<sp/>right<sp/>colspan.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>$field_ui<sp/>=<sp/>!empty($this-&gt;entityInfo[</highlight><highlight class="stringliteral">&apos;bundle<sp/>of&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;<sp/>module_exists(</highlight><highlight class="stringliteral">&apos;field_ui&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>$exportable<sp/>=<sp/>!empty($this-&gt;entityInfo[</highlight><highlight class="stringliteral">&apos;exportable&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>$colspan<sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>$colspan<sp/>=<sp/>$field_ui<sp/>?<sp/>$colspan<sp/>+<sp/>2<sp/>:<sp/>$colspan;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>$colspan<sp/>=<sp/>$exportable<sp/>?<sp/>$colspan<sp/>+<sp/>1<sp/>:<sp/>$colspan;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Operations&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colspan&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$colspan,</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>$render<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#theme&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>,</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#empty&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;None.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$render;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal">}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="121" refid="d1/d12/TripalBundleUIController_8inc_1a93bad334cbbd9e3d7468c4b3d2575abb" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a93bad334cbbd9e3d7468c4b3d2575abb" kindref="member">tripal_tripal_bundle_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state,<sp/>$entityDataType)<sp/>{</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0];</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/>$vocab<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/bio_data_(\d+)/&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;name,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>entity_load(</highlight><highlight class="stringliteral">&apos;TripalTerm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$matches[1]));</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>reset($term);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>$vocab<sp/>=<sp/>entity_load(</highlight><highlight class="stringliteral">&apos;TripalVocab&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term-&gt;vocab_id));</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>$vocab<sp/>=<sp/>reset($vocab);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>a<sp/>validate<sp/>and<sp/>submit<sp/>handler<sp/>to<sp/>save<sp/>the<sp/>data<sp/>in<sp/>this<sp/>form.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_tripal_bundle_form_validate&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_tripal_bundle_form_submit&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#bundle&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$bundle;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>@TODO:<sp/>Move<sp/>this<sp/>into<sp/>a<sp/>css<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;css&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>th.side-header<sp/>{<sp/>width:<sp/>220px;<sp/>}&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;inline&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Vocabulary&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;side-header&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$vocab-&gt;vocabulary</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Term<sp/>Name&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;side-header&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$term-&gt;name</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Accession&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;side-header&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$term-&gt;accession</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Definition&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;side-header&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$term-&gt;definition</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>$table_vars<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;caption&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sticky&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colgroups&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;empty&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Vocabulary<sp/>Term&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>theme_table($table_vars)</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Name&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;The<sp/>human-readable<sp/>name<sp/>of<sp/>this<sp/>content<sp/>type.<sp/>This<sp/>text<sp/>will<sp/>be</highlight></codeline>
<codeline lineno="204"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>displayed<sp/>as<sp/>part<sp/>of<sp/>the<sp/>list<sp/>on<sp/>the<sp/>&lt;em&gt;Add<sp/>new<sp/>content<sp/>page&lt;/em&gt;.<sp/>It<sp/>is<sp/>recommended<sp/>that</highlight></codeline>
<codeline lineno="205"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>this<sp/>name<sp/>begin<sp/>with<sp/>a<sp/>capital<sp/>letter<sp/>and<sp/>contain<sp/>only<sp/>letters,<sp/>numbers,<sp/>and<sp/>spaces.</highlight></codeline>
<codeline lineno="206"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>This<sp/>name<sp/>must<sp/>be<sp/>unique.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;label,</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="209"><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Description&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Describe<sp/>this<sp/>content<sp/>type.<sp/>The<sp/>text<sp/>will<sp/>be<sp/>displayed<sp/>on<sp/>the<sp/>&lt;em&gt;Add<sp/>new<sp/>content<sp/>page&lt;/em&gt;.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term)<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" kindref="member">tripal_get_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/>$term-&gt;definition);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" kindref="member">tripal_get_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/>$empty_fields<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" kindref="member">tripal_get_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Field<sp/>Display&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;hide&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Hide<sp/>empty<sp/>fields&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;show&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Show<sp/>empty<sp/>fields&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Choose<sp/>either<sp/>to<sp/>show<sp/>or<sp/>hide<sp/>all<sp/>empty<sp/>fields.<sp/><sp/>If<sp/>&quot;Show<sp/>empty<sp/>fields&quot;<sp/>is<sp/>selected<sp/>then<sp/>fields<sp/>will<sp/>be<sp/>loaded<sp/>via<sp/>AJAX<sp/>to<sp/>help<sp/>speed<sp/>page<sp/>loads.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>!empty($empty_fields)<sp/>?<sp/>array($empty_fields,)<sp/>:<sp/>array(</highlight><highlight class="stringliteral">&apos;hide&apos;</highlight><highlight class="normal">,),</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;additional_settings&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;vertical_tabs&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>99,</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>Title<sp/>Format.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//-------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/>$title_format<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gaed3e1bc34351087f058114cec1c33081" kindref="member">tripal_get_title_format</ref>($bundle);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Page<sp/>Title<sp/>options&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#tree&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#group&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;additional_settings&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;explanation&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;&lt;p&gt;The<sp/>format<sp/>below<sp/>is<sp/>used<sp/>to<sp/>determine<sp/>the<sp/>title<sp/>displayed<sp/>on<sp/>%type<sp/>content</highlight></codeline>
<codeline lineno="256"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>pages.<sp/>This<sp/>ensures<sp/>all<sp/>content<sp/>of<sp/>this<sp/>type<sp/>is<sp/>consistent<sp/>while<sp/>still<sp/>allowing<sp/>you</highlight></codeline>
<codeline lineno="257"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>indicate<sp/>which<sp/>data<sp/>you<sp/>want<sp/>represented<sp/>in<sp/>the<sp/>title<sp/>(ie:<sp/>which<sp/>data<sp/>would<sp/>most</highlight></codeline>
<codeline lineno="258"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>identify<sp/>your<sp/>content).&lt;/p&gt;</highlight></codeline>
<codeline lineno="259"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p&gt;Keep<sp/>in<sp/>mind<sp/>that<sp/>it<sp/>might<sp/>be<sp/>confusing<sp/>to<sp/>users<sp/>if<sp/>more<sp/>than</highlight></codeline>
<codeline lineno="260"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>one<sp/>page<sp/>has<sp/>the<sp/>same<sp/>title.<sp/>We<sp/>recommend<sp/>you<sp/>&lt;strong&gt;choose<sp/>a<sp/>combination<sp/>of<sp/>tokens<sp/>that</highlight></codeline>
<codeline lineno="261"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>will<sp/>uniquely<sp/>identify<sp/>your<sp/>content&lt;/strong&gt;.&lt;/p&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_format&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Page<sp/>Title<sp/>Format&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;You<sp/>may<sp/>rearrange<sp/>elements<sp/>in<sp/>this<sp/>text<sp/>box<sp/>to<sp/>customize<sp/>the<sp/>page</highlight></codeline>
<codeline lineno="269"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>titles.<sp/>The<sp/>available<sp/>tokens<sp/>are<sp/>listed<sp/>below.<sp/>You<sp/>can<sp/>separate<sp/>or<sp/>include<sp/>any<sp/>text</highlight></codeline>
<codeline lineno="270"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>between<sp/>the<sp/>tokens.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$title_format,</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Available<sp/>Tokens&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Copy<sp/>the<sp/>token<sp/>and<sp/>paste<sp/>it<sp/>into<sp/>the<sp/>&quot;Custom<sp/>Page<sp/>Title&quot;<sp/>text<sp/>field<sp/>above.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" kindref="member">tripal_get_entity_tokens</ref>($bundle);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($tokens)</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga2c17dc368ac82e83398f642885bfd9fb" kindref="member">theme_token_list</ref>($tokens),</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;bp_explanation&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Retroactively<sp/>apply<sp/>the<sp/>new<sp/>title<sp/>pattern<sp/>to</highlight></codeline>
<codeline lineno="297"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>existing<sp/>content<sp/>by<sp/>clicking<sp/>the<sp/>button<sp/>below.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;bulk_update&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Bulk<sp/>update<sp/>all<sp/>titles&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&apos;#submit&apos;<sp/>=&gt;<sp/>array(&apos;tripal_bulk_update_submit&apos;),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>URL<sp/>Alias<sp/>Pattern.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//-------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/>$url_pattern<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gaf73d3966d163775fcb48e86b1253496c" kindref="member">tripal_get_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;url_format&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$url_pattern)<sp/>$url_pattern<sp/>=<sp/>str_replace(</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$term-&gt;name)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/[TripalEntity__entity_id]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;URL<sp/>Path<sp/>options&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#tree&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#group&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;additional_settings&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;explanation&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;&lt;p&gt;The<sp/>pattern<sp/>below<sp/>is<sp/>used<sp/>to<sp/>specify<sp/>the<sp/>URL<sp/>of<sp/>%type<sp/>content<sp/>pages.</highlight></codeline>
<codeline lineno="323"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>This<sp/>allows<sp/>you<sp/>to<sp/>present<sp/>more<sp/>friendly,<sp/>informative<sp/>URLs<sp/>to<sp/>your<sp/>user.&lt;/p&gt;</highlight></codeline>
<codeline lineno="324"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&lt;p&gt;&lt;strong&gt;You<sp/>must<sp/>choose<sp/>a<sp/>combination<sp/>of<sp/>tokens<sp/>that<sp/>results<sp/>in<sp/>a<sp/>unique<sp/>path<sp/>for</highlight></codeline>
<codeline lineno="325"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>each<sp/>page!&lt;/strong&gt;&lt;/p&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_pattern&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;URL<sp/>Alias<sp/>Pattern&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;You<sp/>may<sp/>rearrange<sp/>elements<sp/>in<sp/>this<sp/>text<sp/>box<sp/>to<sp/>customize<sp/>the<sp/>url</highlight></codeline>
<codeline lineno="333"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>alias.<sp/>The<sp/>available<sp/>tokens<sp/>are<sp/>listed<sp/>below.<sp/>&lt;strong&gt;Make<sp/>sure<sp/>the<sp/>pattern<sp/>forms<sp/>a</highlight></codeline>
<codeline lineno="334"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>valid,<sp/>unique<sp/>URL&lt;/strong&gt;.<sp/>Leave<sp/>this<sp/>field<sp/>blank<sp/>to<sp/>use<sp/>the<sp/>original<sp/>path.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url_pattern,</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga7bae80e868c112e2f20e623f7992c79e" kindref="member">tripal_get_entity_tokens</ref>($bundle);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($tokens)</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Available<sp/>Tokens&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Copy<sp/>the<sp/>token<sp/>and<sp/>paste<sp/>it<sp/>into<sp/>the<sp/>&quot;URL<sp/>Alias<sp/>Pattern&quot;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;text<sp/>field<sp/>above.<sp/>Please<sp/>choose<sp/>tokens<sp/>that<sp/>will<sp/>guarantee<sp/>a<sp/>unique<sp/>URL.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga2c17dc368ac82e83398f642885bfd9fb" kindref="member">theme_token_list</ref>($tokens),</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;bp_explanation&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Retroactively<sp/>apply<sp/>the<sp/>new<sp/>url<sp/>alias<sp/>pattern<sp/>to</highlight></codeline>
<codeline lineno="363"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>existing<sp/>content<sp/>by<sp/>clicking<sp/>the<sp/>button<sp/>below.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;bulk_update&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Bulk<sp/>update<sp/>all<sp/>aliases&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//&apos;#submit&apos;<sp/>=&gt;<sp/>array(&apos;tripal_bulk_update_submit&apos;),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Submit<sp/>Buttons</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//-------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;save&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Save<sp/>Content<sp/>Type&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>100</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;delete&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Delete<sp/>Content<sp/>Type&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>101</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="387"><highlight class="normal">}</highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="392" refid="d1/d12/TripalBundleUIController_8inc_1ab8b27a855041053d740af0d560eefbe0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1ab8b27a855041053d740af0d560eefbe0" kindref="member">tripal_tripal_bundle_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>VALIDATE:<sp/>That<sp/>there<sp/>is<sp/>a<sp/>value<sp/>passed<sp/>for<sp/>the<sp/>hide_empty_field<sp/>option.<sp/>If</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>no<sp/>value<sp/>passed<sp/>default<sp/>to<sp/>hide<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">])){</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;hide&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>VALIDATE:<sp/>The<sp/>only<sp/>tokens<sp/>used<sp/>should<sp/>be<sp/>those<sp/>we<sp/>mentioned<sp/>under<sp/>&quot;Available<sp/>Tokens&quot;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>PART<sp/>1:<sp/>Set<sp/>Titles.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/>$tokens_available<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/(\[\w+\])/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_format&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>matches<sp/>of<sp/>the<sp/>first<sp/>and<sp/>only<sp/>pattern<sp/>will<sp/>be<sp/>our<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens_used<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>if<sp/>any<sp/>of<sp/>the<sp/>tokens<sp/>used<sp/>were<sp/>not<sp/>in<sp/>the<sp/>original<sp/>list<sp/>of<sp/>available<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens_missing<sp/>=<sp/>array_diff($tokens_used,<sp/>array_keys($tokens_available));</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tokens_missing)<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$msg<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;You<sp/>must<sp/>only<sp/>use<sp/>tokens<sp/>listed<sp/>under<sp/>available<sp/>tokens.<sp/>You<sp/>used<sp/>the<sp/>following<sp/>incorrect<sp/>tokens:<sp/>%tokens&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%tokens&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>$tokens_missing)));</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;set_titles][title_format&apos;</highlight><highlight class="normal">,<sp/>$msg);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/>$msg<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;You<sp/>should<sp/>use<sp/>at<sp/>least<sp/>one<sp/>token<sp/>in<sp/>your<sp/>title<sp/>format<sp/>or<sp/>the<sp/>title<sp/>for<sp/>all<sp/>%type<sp/>pages<sp/>will<sp/>be<sp/>the<sp/>same.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0]-&gt;label));</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;set_titles][title_format&apos;</highlight><highlight class="normal">,<sp/>$msg);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>PART<sp/>2:<sp/>URL<sp/>Alias&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_pattern&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens_available<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/(\[\w+\])/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_pattern&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>matches<sp/>of<sp/>the<sp/>first<sp/>and<sp/>only<sp/>pattern<sp/>will<sp/>be<sp/>our<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tokens_used<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>if<sp/>any<sp/>of<sp/>the<sp/>tokens<sp/>used<sp/>were<sp/>not<sp/>in<sp/>the<sp/>original<sp/>list<sp/>of<sp/>available<sp/>tokens.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tokens_missing<sp/>=<sp/>array_diff($tokens_used,<sp/>array_keys($tokens_available));</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tokens_missing)<sp/>{</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$msg<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;You<sp/>must<sp/>only<sp/>use<sp/>tokens<sp/>listed<sp/>under<sp/>available<sp/>tokens.<sp/>You<sp/>used<sp/>the<sp/>following<sp/>incorrect<sp/>tokens:<sp/>%tokens&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%tokens&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>$tokens_missing)));</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;url][url_pattern&apos;</highlight><highlight class="normal">,<sp/>$msg);</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$msg<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;You<sp/>should<sp/>use<sp/>at<sp/>least<sp/>one<sp/>token<sp/>in<sp/>your<sp/>URL<sp/>pattern<sp/>or<sp/>the<sp/>URL<sp/>for<sp/>all<sp/>%type<sp/>pages<sp/>will<sp/>be<sp/>the<sp/>same.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0]-&gt;label));</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;url][url_pattern&apos;</highlight><highlight class="normal">,<sp/>$msg);</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal">}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="449" refid="d1/d12/TripalBundleUIController_8inc_1af06137d266ba2e327ee5fc7a33cee991" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1af06137d266ba2e327ee5fc7a33cee991" kindref="member">tripal_tripal_bundle_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/>$trigger<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0];</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($trigger<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Save<sp/>Content<sp/>Type&apos;</highlight><highlight class="normal"><sp/>or<sp/>$trigger<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Bulk<sp/>update<sp/>all<sp/>aliases&apos;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$trigger<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Bulk<sp/>update<sp/>all<sp/>titles&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>label.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle-&gt;label<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle-&gt;save();</highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>description.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" kindref="member">tripal_set_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="464"><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>hide_empty_field<sp/>setting.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" kindref="member">tripal_set_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;hide_empty_field&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>page<sp/>title<sp/>format.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga64ba0896880df6f55c775573634db3ad" kindref="member">tripal_save_title_format</ref>(</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$bundle,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_format&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="473"><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>URL<sp/>alias<sp/>pattern<sp/>if<sp/>it&apos;s<sp/>set.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_pattern&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1gaa2e8552c4c47bf4b406bc58186864e71" kindref="member">tripal_set_bundle_variable</ref>(</highlight><highlight class="stringliteral">&apos;url_format&apos;</highlight><highlight class="normal">,<sp/>$bundle-&gt;id,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_pattern&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="478"><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>There<sp/>are<sp/>two<sp/>submit<sp/>buttons<sp/>for<sp/>this<sp/>either<sp/>updating<sp/>the<sp/>paths<sp/>or<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>titles.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($trigger<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Bulk<sp/>update<sp/>all<sp/>titles&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$update<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_format&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;bundle_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;name,</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;update&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$update,</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$includes<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;includes/tripal.bulk_update&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&apos;Update<sp/>all<sp/>aliases<sp/>for<sp/>content<sp/>type:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;label,<sp/></highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_update_all_urls_and_titles&apos;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($trigger<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Bulk<sp/>update<sp/>all<sp/>aliases&apos;</highlight><highlight class="normal">){</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$update<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_pattern&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;alias&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;bundle_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;name,</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;update&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$update,</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$includes<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;includes/tripal.bulk_update&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&apos;Update<sp/>all<sp/>aliases<sp/>for<sp/>content<sp/>type:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;label,<sp/></highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_update_all_urls_and_titles&apos;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;redirect&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;admin/structure/bio_data&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Successfully<sp/>saved<sp/>%type<sp/>content<sp/>type.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0]-&gt;label)));</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;redirect&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;admin/structure/bio_data/manage/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/delete&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;query&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;destination&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;admin/structure/bio_data&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="520"><highlight class="normal">}</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="525" refid="d1/d12/TripalBundleUIController_8inc_1ad816edceb86633ab195f315169792602" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1ad816edceb86633ab195f315169792602" kindref="member">tripal_bundle_access</ref>($op,<sp/>$type<sp/>=<sp/>NULL,<sp/>$account<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>user_access(</highlight><highlight class="stringliteral">&apos;manage<sp/>tripal<sp/>content<sp/>types&apos;</highlight><highlight class="normal">,<sp/>$account);</highlight></codeline>
<codeline lineno="527"><highlight class="normal">}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="538" refid="d1/d12/TripalBundleUIController_8inc_1a0a56bd2d1ad7fd59f78f5d0cd930bd86" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a0a56bd2d1ad7fd59f78f5d0cd930bd86" kindref="member">tripal_admin_add_type_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/>$stores<sp/>=<sp/>module_invoke_all(</highlight><highlight class="stringliteral">&apos;vocab_storage_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($stores)<sp/>or<sp/>count($stores)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>(</highlight><highlight class="stringliteral">&apos;A<sp/>storage<sp/>backend<sp/>is<sp/>not<sp/>enabled<sp/>for<sp/>managing</highlight></codeline>
<codeline lineno="543"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>vocabulary<sp/>terms<sp/>used<sp/>to<sp/>create<sp/>content.<sp/><sp/>Please<sp/>enable</highlight></codeline>
<codeline lineno="544"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>module<sp/>that<sp/>supports<sp/>storage<sp/>of<sp/>vocabualary<sp/>terms<sp/>(e.g.<sp/>tripal_chado)</highlight></codeline>
<codeline lineno="545"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>and<sp/>return<sp/>to<sp/>create<sp/>new<sp/>Tripal<sp/>content<sp/>types.&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1ad9759873be1ae0c3d8ccc37d121aeb3c" kindref="member">TRIPAL_NOTICE</ref>);</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/>$keys<sp/>=<sp/>array_keys($stores);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/>$module<sp/>=<sp/>$stores[$keys[0]][</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_vocab_select_term_form&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($function))<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>$function(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/>$term_name<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>no<sp/>term<sp/>has<sp/>been<sp/>selected<sp/>yet<sp/>then<sp/>provide<sp/>the<sp/>auto<sp/>complete<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Content<sp/>Type&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;The<sp/>content<sp/>type<sp/>must<sp/>be<sp/>the<sp/>name<sp/>of<sp/>a<sp/>term<sp/>in</highlight></codeline>
<codeline lineno="562"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>controlled<sp/>vocabulary<sp/>and<sp/>the<sp/>controlled<sp/>vocabulary<sp/>should</highlight></codeline>
<codeline lineno="563"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>already<sp/>be<sp/>loaded<sp/>into<sp/>Tripal.<sp/><sp/>For<sp/>example,<sp/>to<sp/>create<sp/>a<sp/>content</highlight></codeline>
<codeline lineno="564"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>type<sp/>for<sp/>storing<sp/>&apos;genes&apos;,<sp/>use<sp/>the<sp/>&apos;gene&apos;<sp/>term<sp/>from<sp/>the</highlight></codeline>
<codeline lineno="565"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Sequence<sp/>Ontology<sp/>(SO).&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_name,</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#autocomplete_path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;admin/tripal/storage/chado/auto_name/cvterm/&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;select_button&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Lookup<sp/>Term&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select_cvterm&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_admin_add_type_form_ajax_callback&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal-vocab-select-form&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id<sp/>=<sp/>&quot;tripal-vocab-select-form&quot;&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="583"><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>term<sp/>has<sp/>been<sp/>provided<sp/>by<sp/>the<sp/>user<sp/>then<sp/>we<sp/>want<sp/>to<sp/>search<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>matching<sp/>terms<sp/>in<sp/>the<sp/>database<sp/>and<sp/>let<sp/>them<sp/>select<sp/>among<sp/>any<sp/>matches.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($term_name)<sp/>{</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>$submit_disabled<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;terms_list&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Matching<sp/>Terms&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Please<sp/>select<sp/>the<sp/>term<sp/>the<sp/>best<sp/>matches<sp/>the</highlight></codeline>
<codeline lineno="592"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>content<sp/>type<sp/>you<sp/>want<sp/>to<sp/>create.<sp/>If<sp/>the<sp/>same<sp/>term<sp/>exists<sp/>in</highlight></codeline>
<codeline lineno="593"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multiple<sp/>vocabularies<sp/>you<sp/>will<sp/>see<sp/>more<sp/>than<sp/>one<sp/>option<sp/>below.&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_name,</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d09/tripal__feature__terms_8tpl_8php_1ad6d756efb764174cfe7a6e9abc97e3eb" kindref="member">$terms</ref><sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>$match,<sp/>array(</highlight><highlight class="stringliteral">&apos;return_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE));</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d09/tripal__feature__terms_8tpl_8php_1ad6d756efb764174cfe7a6e9abc97e3eb" kindref="member">$terms</ref><sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>(<ref refid="d8/d09/tripal__feature__terms_8tpl_8php_1ad6d756efb764174cfe7a6e9abc97e3eb" kindref="member">$terms</ref>,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cvterm.definition&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_terms<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>$selected_term<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Let<sp/>the<sp/>user<sp/>select<sp/>from<sp/>any<sp/>matching<sp/>terms.<sp/>Sometimes<sp/>there<sp/>may<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>more<sp/>than<sp/>one<sp/>that<sp/>match.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d8/d09/tripal__feature__terms_8tpl_8php_1ad6d756efb764174cfe7a6e9abc97e3eb" kindref="member">$terms</ref><sp/>as<sp/>$term)<sp/>{</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>user<sp/>a<sp/>click<sp/>by<sp/>setting<sp/>the<sp/>default<sp/>value<sp/>as<sp/>1<sp/>if<sp/>there&apos;s</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>only<sp/>one<sp/>matching<sp/>term.<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$default<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$attrs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_terms<sp/>==<sp/>0<sp/>and<sp/>count(<ref refid="d8/d09/tripal__feature__terms_8tpl_8php_1ad6d756efb764174cfe7a6e9abc97e3eb" kindref="member">$terms</ref>)<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$attrs<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;checked&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checked&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$term_element_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;term-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;terms_list&apos;</highlight><highlight class="normal">][$term_element_name]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><sp/>$term-&gt;name,</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$default,</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$attrs,</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;b&gt;Vocabulary:&lt;/b&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;cv_id-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;dbxref_id-&gt;db_id-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;)<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;cv_id-&gt;definition<sp/>.</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;b&gt;Term:<sp/>&lt;/b&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;dbxref_id-&gt;db_id-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;dbxref_id-&gt;accession<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;.<sp/><sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;b&gt;Definition:&lt;/b&gt;<sp/><sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;definition,</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_admin_add_type_form_ajax_callback&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal-vocab-select-form&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and<sp/>array_key_exists($term_element_name,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">])<sp/>and</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][$term_element_name]<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$selected_term<sp/>=<sp/>$term;</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$num_terms++;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Next<sp/>find<sp/>terms<sp/>that<sp/>are<sp/>synonyms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_name,</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/>$termsyn<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvtermsynonym&apos;</highlight><highlight class="normal">,<sp/>$match,<sp/>array(</highlight><highlight class="stringliteral">&apos;return_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE));</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Let<sp/>the<sp/>user<sp/>select<sp/>from<sp/>any<sp/>matching<sp/>terms.<sp/>Sometimes<sp/>there<sp/>may<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>more<sp/>than<sp/>one<sp/>that<sp/>match.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($termsyn<sp/>as<sp/>$synonym)<sp/>{</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$term<sp/>=<sp/>$synonym-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>user<sp/>a<sp/>click<sp/>by<sp/>setting<sp/>the<sp/>default<sp/>value<sp/>as<sp/>1<sp/>if<sp/>there&apos;s</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>only<sp/>one<sp/>matching<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$default<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$attrs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_terms<sp/>==<sp/>0<sp/>and<sp/>count(<ref refid="d8/d09/tripal__feature__terms_8tpl_8php_1ad6d756efb764174cfe7a6e9abc97e3eb" kindref="member">$terms</ref>)<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$attrs<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;checked&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checked&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$term_element_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;term-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;term_match&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;terms_list&apos;</highlight><highlight class="normal">][$term_element_name]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><sp/>$term-&gt;name,</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$default,</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$attrs,</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;b&gt;Vocabulary:&lt;/b&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;cv_id-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;dbxref_id-&gt;db_id-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;)<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;cv_id-&gt;definition<sp/>.</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;b&gt;Term:<sp/>&lt;/b&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;dbxref_id-&gt;db_id-&gt;name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;dbxref_id-&gt;accession<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;.<sp/><sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;b&gt;Definition:&lt;/b&gt;<sp/><sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$term-&gt;definition<sp/>.</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;b&gt;Synonym:&lt;/b&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$synonym-&gt;synonym,</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_admin_add_type_form_ajax_callback&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal-vocab-select-form&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and<sp/>array_key_exists($term_element_name,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">])<sp/>and</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][$term_element_name]<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$selected_term<sp/>=<sp/>$term;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$num_terms++;</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_terms<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;terms_list&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;none&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;i&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>t(</highlight><highlight class="stringliteral">&apos;There<sp/>is<sp/>no<sp/>term<sp/>that<sp/>matches<sp/>the<sp/>entered<sp/>text.&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/i&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>let<sp/>the<sp/>user<sp/>select<sp/>where<sp/>the<sp/>data<sp/>type<sp/>will<sp/>be<sp/>stored.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Storage<sp/>Settings&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;The<sp/>primary<sp/>record<sp/>for<sp/>each<sp/>content<sp/>of<sp/>this<sp/>type</highlight></codeline>
<codeline lineno="693"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>must<sp/>be<sp/>stored<sp/>in<sp/>a<sp/>single<sp/>storage<sp/>backend.<sp/>Please<sp/>select<sp/>the</highlight></codeline>
<codeline lineno="694"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>storage<sp/>method<sp/>and<sp/>settings<sp/>for<sp/>this<sp/>content<sp/>type.&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="696"><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>there<sp/>should<sp/>be<sp/>a<sp/>way<sp/>for<sp/>each<sp/>storage<sp/>backend<sp/>to<sp/>determine<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>can<sp/>handle<sp/>the<sp/>content<sp/>type.<sp/><sp/>Maybe<sp/>certain<sp/>content<sp/>types<sp/>aren&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>yet<sp/>supported<sp/>by<sp/>every<sp/>storage<sp/>backend.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>$default_store<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;term_chado_storage&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>$store_options<sp/>=<sp/>array(0<sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;--<sp/>Select<sp/>--&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($stores<sp/>as<sp/>$store_type<sp/>=&gt;<sp/>$store)<sp/>{</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$store_options[$store_type]<sp/>=<sp/>$store[</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;store_select&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$default_store<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;store_select&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;store_select&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Storage<sp/>backend&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$store_options,</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$default_store,</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_admin_add_type_form_ajax_callback&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal-vocab-select-form&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>storage<sp/>background<sp/>for<sp/>this<sp/>content<sp/>type.&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="722"><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($default_store)<sp/>{</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$selected_store_module<sp/>=<sp/>$stores[$store_type][</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$selected_store_module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_field_storage_bundle_mapping_form&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($function))<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$store_form<sp/>=<sp/>$function(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state,<sp/>$selected_term,<sp/>$submit_disabled);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;storage&apos;</highlight><highlight class="normal">][$store_type]<sp/>=<sp/>$store_form;</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>in<sp/>the<sp/>button<sp/>for<sp/>the<sp/>cases<sp/>of<sp/>no<sp/>terms<sp/>or<sp/>too<sp/>many.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;submit_button&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Create<sp/>content<sp/>type&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;use_cvterm&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#disabled&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$submit_disabled,</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="741"><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"></highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="744"><highlight class="normal">}</highlight></codeline>
<codeline lineno="748" refid="d1/d12/TripalBundleUIController_8inc_1a0119f0a48a4cff6129912fd766d5437c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a0119f0a48a4cff6129912fd766d5437c" kindref="member">tripal_admin_add_type_form_ajax_callback</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="750"><highlight class="normal">}</highlight></codeline>
<codeline lineno="755" refid="d1/d12/TripalBundleUIController_8inc_1a9d80d5ff428d4e8f8257ae1b00cbb2db" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a9d80d5ff428d4e8f8257ae1b00cbb2db" kindref="member">tripal_admin_add_type_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/>$stores<sp/>=<sp/>module_invoke_all(</highlight><highlight class="stringliteral">&apos;vocab_storage_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/>$store_select<sp/>=<sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;store_select&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;store_select&apos;</highlight><highlight class="normal">]<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;clicked_button&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;clicked_button&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">]<sp/>==</highlight><highlight class="stringliteral">&apos;use_cvterm&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm_id<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>we<sp/>have<sp/>a<sp/>cvterm<sp/>selected</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_selected<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$key<sp/>=&gt;<sp/>$value)<sp/>{</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$matches<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&quot;/^term-(\d+)$/&quot;</highlight><highlight class="normal">,<sp/>$key,<sp/>$matches)<sp/>and</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$matches[1]])<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$cvterm_id<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$term<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm_id));</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$num_selected++;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_selected<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>select<sp/>at<sp/>least<sp/>one<sp/>term.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_selected<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;term-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$cvterm_id,<sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>select<sp/>only<sp/>one<sp/>term<sp/>from<sp/>the<sp/>list<sp/>below.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>term<sp/>to<sp/>the<sp/>form<sp/>state<sp/>so<sp/>we<sp/>can<sp/>access<sp/>it<sp/>later.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$term-&gt;dbxref_id-&gt;db_id-&gt;name;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$term-&gt;dbxref_id-&gt;accession;</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$term-&gt;name;</highlight></codeline>
<codeline lineno="787"><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>the<sp/>submit<sp/>hook<sp/>for<sp/>this<sp/>form<sp/>for<sp/>the<sp/>storage<sp/>method<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>will<sp/>be<sp/>responsible<sp/>for<sp/>this<sp/>cotent<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stores<sp/>=<sp/>module_invoke_all(</highlight><highlight class="stringliteral">&apos;vocab_storage_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$selected_store_module<sp/>=<sp/>$stores[$store_select][</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$selected_term<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$selected_store_module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_field_storage_bundle_mapping_form_validate&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($function))<sp/>{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$function(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state,<sp/>$selected_term);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>any<sp/>other<sp/>button<sp/>click<sp/>it&apos;s<sp/>an<sp/>AJAX<sp/>call<sp/>and<sp/>we<sp/>just<sp/>want<sp/>to<sp/>reubild</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>form.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;rebuild&apos;</highlight><highlight class="normal">]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="805"><highlight class="normal">}</highlight></codeline>
<codeline lineno="809" refid="d1/d12/TripalBundleUIController_8inc_1a41e53c3bb4293034f15efbde95b8601f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a41e53c3bb4293034f15efbde95b8601f" kindref="member">tripal_admin_add_type_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/>$vocabulary<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">,<sp/>$form_state))<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>$selected_term<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;term&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/>$store_select<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;store_select&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/>$vocabulary<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">,<sp/>$selected_term)<sp/>?<sp/>$selected_term[</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">,<sp/>$selected_term)<sp/>?<sp/>$selected_term[</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/>$term_name<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal">,<sp/>$selected_term)<sp/>?<sp/>$selected_term[</highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="818"><highlight class="normal"></highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Before<sp/>we<sp/>try<sp/>to<sp/>add<sp/>this<sp/>type,<sp/>check<sp/>to<sp/>see<sp/>if<sp/>it<sp/>already<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>a<sp/>bundle.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/>$term<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga8d7df332ef5e92725a5044692e85ead2" kindref="member">tripal_load_term_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary,<sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession));</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$term)<sp/>{</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>the<sp/>submit<sp/>hook<sp/>for<sp/>this<sp/>form<sp/>for<sp/>the<sp/>storage<sp/>method<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>will<sp/>be<sp/>responsible<sp/>for<sp/>this<sp/>cotent<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stores<sp/>=<sp/>module_invoke_all(</highlight><highlight class="stringliteral">&apos;vocab_storage_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$selected_store_module<sp/>=<sp/>$stores[$store_select][</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="828"><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$storage_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$selected_store_module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_field_storage_bundle_mapping_form_submit&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($function))<sp/>{</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$function(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state,<sp/>$term,<sp/>$storage_args);</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary,</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;term_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_name,</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;storage_args&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$storage_args,</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="841"><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1gae741bc8f60274eee9fbe4e2ca062fe83" kindref="member">tripal_create_bundle</ref>($args,<sp/>$error);</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle)<sp/>{</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message($error,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;redirect&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;admin/structure/bio_data&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;New<sp/>content<sp/>type<sp/>created!&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Please<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>l(</highlight><highlight class="stringliteral">&quot;set<sp/>the<sp/>user<sp/>permissions&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;admin/people/permissions&quot;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>for<sp/>this<sp/>new<sp/>content<sp/>type.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a3db11f49ee7a6ef6a8c405e505fcb5f6" kindref="member">tripal_admin_access</ref>($bundle);</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;redirect&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;admin/structure/bio_data&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;The<sp/>term<sp/>&apos;$accession&apos;<sp/>already<sp/>exists<sp/>as<sp/>a<sp/>content<sp/>type.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="858"><highlight class="normal">}</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="863" refid="d1/d12/TripalBundleUIController_8inc_1a3db11f49ee7a6ef6a8c405e505fcb5f6" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d12/TripalBundleUIController_8inc_1a3db11f49ee7a6ef6a8c405e505fcb5f6" kindref="member">tripal_admin_access</ref>($entity)<sp/>{</highlight></codeline>
<codeline lineno="864"><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($entity)<sp/>{</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/>$bundle_name<sp/>=<sp/>$entity-&gt;name;</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="871"><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>bundle<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="874"><highlight class="normal"></highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$bundle)<sp/>{</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>load<sp/>bundle<sp/>:name<sp/>when<sp/>creating<sp/>permissions.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="880"><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Identify<sp/>the<sp/>administrative<sp/>user<sp/>roles.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/>$admin_role<sp/>=<sp/>user_role_load_by_name(</highlight><highlight class="stringliteral">&apos;administrator&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/>$roles<sp/>=<sp/>array($admin_role-&gt;rid<sp/>=&gt;<sp/>$admin_role-&gt;name);</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Define<sp/>the<sp/>permissions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/>$permission_for_role<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;create<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;name<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;view<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;name<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;edit<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;name<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;delete<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$bundle-&gt;name<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Assign<sp/>the<sp/>permissions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($roles<sp/>as<sp/>$role<sp/>=&gt;<sp/>$value){</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>user_role_change_permissions($role,<sp/>$permission_for_role);</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="896"><highlight class="normal"></highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="898"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/includes/TripalBundleUIController.inc"/>
  </compounddef>
</doxygen>
