<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d1/d0c/tripal__feature_8theme_8inc" kind="file" language="PHP">
    <compoundname>tripal_feature.theme.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1ac33ba6af2c40a1a0d1fecdf1f940e9ad" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_color_sequence</definition>
        <argsstring>($sequence, $parts, $defline)</argsstring>
        <name>tripal_feature_color_sequence</name>
        <param>
          <declname>$sequence</declname>
        </param>
        <param>
          <declname>$parts</declname>
        </param>
        <param>
          <declname>$defline</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns the marked up fasta sequence for the described feature</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$sequence</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$parts</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$defline</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="286" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="286" bodyend="362"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1af1a748eabf2812c104c50fcec3b47c94" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_get_aggregate_relationships</definition>
        <argsstring>($feature_id, $substitute=1, $levels=0, $base_type_id=NULL, $depth=0)</argsstring>
        <name>tripal_feature_get_aggregate_relationships</name>
        <param>
          <declname>$feature_id</declname>
        </param>
        <param>
          <declname>$substitute</declname>
          <defval>1</defval>
        </param>
        <param>
          <declname>$levels</declname>
          <defval>0</defval>
        </param>
        <param>
          <declname>$base_type_id</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$depth</declname>
          <defval>0</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get features related to the current feature to a given depth. Recursive function.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$feature_id</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$substitute</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$levels</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$base_type_id</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$depth</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="960" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="960" bodyend="973"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a38fecd10b7bfe4903d568245cb16d70d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_get_feature_relationships</definition>
        <argsstring>($feature)</argsstring>
        <name>tripal_feature_get_feature_relationships</name>
        <param>
          <declname>$feature</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Using the chado_expand_var function to retrieve a set of relationships can be very slow, especialy if there are many relationships This function is intended to help speed up the retrieval of relationships by only retrieving the base information for the relationship and returning an array with</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$feature</parametername>
</parameternamelist>
<parameterdescription>
<para>The feature object</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An array with two objects </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="697" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="697" bodyend="834"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1afdd33c90c17312be32bab98363e58cff" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_get_matched_alignments</definition>
        <argsstring>($feature)</argsstring>
        <name>tripal_feature_get_matched_alignments</name>
        <param>
          <declname>$feature</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is for features that align through an intermediate such as &apos;EST_match&apos; or &apos;match&apos;. This occurs in the case where two sequences align but where one does not align perfectly. Some ESTs may be in a contig but not all of the EST. Portions may overhang and not be included in the consensus if quality is bad. For example: Feature 1: Contig -----------------<mdash/> Feature 2: EST_match ----<mdash/> Feature 3: EST ------<mdash/></para><para>The feature provided to the function will always be the feature 1. The featureloc columns prefixed with &apos;right&apos; (e.g. right_fmin) belong to the alignment of feature 3 with feature 2</para><para>Features may align to more than one feature and are not matches. We do not want to include these, so we have to filter on the SO terms: match, or _match </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="533" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="533" bodyend="582"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1abbc7203d83869081b2c6c34020be0909" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_load_featureloc_sequences</definition>
        <argsstring>($feature_id, $featurelocs)</argsstring>
        <name>tripal_feature_load_featureloc_sequences</name>
        <param>
          <declname>$feature_id</declname>
        </param>
        <param>
          <declname>$featurelocs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the sequence this feature is located on</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$feature_id</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$featurelocs</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="47" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="47" bodyend="177"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a4506a4efd68d0cb0e62e0521c57a5769" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_load_featurelocs</definition>
        <argsstring>($feature_id, $side=&apos;as_parent&apos;, $aggregate=1)</argsstring>
        <name>tripal_feature_load_featurelocs</name>
        <param>
          <declname>$feature_id</declname>
        </param>
        <param>
          <declname>$side</declname>
          <defval>&apos;as_parent&apos;</defval>
        </param>
        <param>
          <declname>$aggregate</declname>
          <defval>1</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Load the locations for a given feature</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$feature_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The feature to look up locations for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$side</parametername>
</parameternamelist>
<parameterdescription>
<para>Whether the feature is the scrfeature, &apos;as_parent&apos;, or feature, &apos;as_child&apos; </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$aggregate</parametername>
</parameternamelist>
<parameterdescription>
<para>Whether or not to get the locations for related features </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="206" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="206" bodyend="258"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1ad8aabd192af6d7b3d70d5e1047f5e03a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_load_organism_feature_counts</definition>
        <argsstring>($organism)</argsstring>
        <name>tripal_feature_load_organism_feature_counts</name>
        <param>
          <declname>$organism</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Load the arguments for the organism feature counts browser</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$organism</parametername>
</parameternamelist>
<parameterdescription>
<para>The organism of interest </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="600" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="600" bodyend="680"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a5e3907ede6684a34a62a157ea55b6214" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_load_relationships</definition>
        <argsstring>($feature_id, $side=&apos;as_subject&apos;)</argsstring>
        <name>tripal_feature_load_relationships</name>
        <param>
          <declname>$feature_id</declname>
        </param>
        <param>
          <declname>$side</declname>
          <defval>&apos;as_subject&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the relationships for a feature.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$feature_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The feature to get relationships for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$side</parametername>
</parameternamelist>
<parameterdescription>
<para>The side of the relationship this feature is (ie: &apos;as_subject&apos; or &apos;as_object&apos;) </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="986" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="986" bodyend="1032"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a4cf7a70d1e7cd16e3a7e94955eab0e0a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_preprocess_tripal_feature_alignments</definition>
        <argsstring>(&amp;$variables)</argsstring>
        <name>tripal_feature_preprocess_tripal_feature_alignments</name>
        <param>
          <type>&amp;</type>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="408" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="408" bodyend="511"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a1e51e6099b622e225fd373243730297e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_preprocess_tripal_feature_bar_chart_type_organism_summary</definition>
        <argsstring>(&amp;$vars)</argsstring>
        <name>tripal_feature_preprocess_tripal_feature_bar_chart_type_organism_summary</name>
        <param>
          <type>&amp;</type>
          <declname>$vars</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="839" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="839" bodyend="947"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a6a817d5d09f7edd612cdcc7951cf954b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_preprocess_tripal_feature_proteins</definition>
        <argsstring>(&amp;$variables)</argsstring>
        <name>tripal_feature_preprocess_tripal_feature_proteins</name>
        <param>
          <type>&amp;</type>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="395" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="395" bodyend="402"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a2565a782842e8b15fee95f2b163e28a0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_preprocess_tripal_feature_relationships</definition>
        <argsstring>(&amp;$variables)</argsstring>
        <name>tripal_feature_preprocess_tripal_feature_relationships</name>
        <param>
          <type>&amp;</type>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="381" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="381" bodyend="388"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a3621ead6fe85a8514aae9b2cfaae9f70" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_preprocess_tripal_feature_sequence</definition>
        <argsstring>(&amp;$variables)</argsstring>
        <name>tripal_feature_preprocess_tripal_feature_sequence</name>
        <param>
          <type>&amp;</type>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="7" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="7" bodyend="37"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1af010bed83ac47488a63e6f1f2a8f8b99" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_preprocess_tripal_organism_feature_counts</definition>
        <argsstring>(&amp;$variables, $hook)</argsstring>
        <name>tripal_feature_preprocess_tripal_organism_feature_counts</name>
        <param>
          <type>&amp;</type>
          <declname>$variables</declname>
        </param>
        <param>
          <declname>$hook</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="588" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="588" bodyend="591"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1ac2d97faddf74131d7bbf1a70ffea7e82" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_sort_locations</definition>
        <argsstring>($a, $b)</argsstring>
        <name>tripal_feature_sort_locations</name>
        <param>
          <declname>$a</declname>
        </param>
        <param>
          <declname>$b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Used to sort the feature locs by start position</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$a</parametername>
</parameternamelist>
<parameterdescription>
<para>One featureloc record (as an object) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$b</parametername>
</parameternamelist>
<parameterdescription>
<para>The other featureloc record (as an object)</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Which feature location comes first </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="273" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="273" bodyend="275"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a9c8b1a0e0f0295d9119a6ab163b6600d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_sort_rel_parts_by_end</definition>
        <argsstring>($a, $b)</argsstring>
        <name>tripal_feature_sort_rel_parts_by_end</name>
        <param>
          <declname>$a</declname>
        </param>
        <param>
          <declname>$b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Used to sort the list of relationship parts by start position </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="369" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="369" bodyend="375"/>
      </memberdef>
      <memberdef kind="function" id="d1/d0c/tripal__feature_8theme_8inc_1a2cc281437333f55876fd6e6ad9f5c544" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_feature_sort_rel_parts_by_start</definition>
        <argsstring>($a, $b)</argsstring>
        <name>tripal_feature_sort_rel_parts_by_start</name>
        <param>
          <declname>$a</declname>
        </param>
        <param>
          <declname>$b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Used to sort the list of relationship parts by start position </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc" line="183" column="1" bodyfile="legacy/tripal_feature/theme/tripal_feature.theme.inc" bodystart="183" bodyend="193"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="7" refid="d1/d0c/tripal__feature_8theme_8inc_1a3621ead6fe85a8514aae9b2cfaae9f70" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a3621ead6fe85a8514aae9b2cfaae9f70" kindref="member">tripal_feature_preprocess_tripal_feature_sequence</ref>(&amp;$variables)<sp/>{</highlight></codeline>
<codeline lineno="8"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>provide<sp/>a<sp/>new<sp/>variable<sp/>that<sp/>contains<sp/>the<sp/>matched<sp/>features.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;feature;</highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>featureloc<sp/>src<sp/>features</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="13"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;return_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;srcfeature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featureloc&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>because<sp/>there<sp/>are<sp/>two<sp/>foriegn<sp/>keys<sp/>in<sp/>the<sp/>featureloc<sp/>table<sp/>with<sp/>the<sp/>feature<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>have<sp/>to<sp/>access<sp/>the<sp/>records<sp/>for<sp/>each<sp/>by<sp/>specifying<sp/>the<sp/>field<sp/>name<sp/>after<sp/>the<sp/>table<sp/>name:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/>$ffeaturelocs<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;featureloc-&gt;feature_id;</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>extract<sp/>the<sp/>sequences</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1af2fba80848b79fe2d31cb9728e0bc32d" kindref="member">$featureloc_sequences</ref><sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1abbc7203d83869081b2c6c34020be0909" kindref="member">tripal_feature_load_featureloc_sequences</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;feature_id,<sp/>$ffeaturelocs);</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;featureloc_sequences<sp/>=<sp/><ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1af2fba80848b79fe2d31cb9728e0bc32d" kindref="member">$featureloc_sequences</ref>;</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>this<sp/>feature<sp/>has<sp/>associated<sp/>protein<sp/>sequences<sp/>(or<sp/>others<sp/>via<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>we<sp/>want<sp/>to<sp/>make<sp/>sure<sp/>the<sp/>relationships<sp/>are<sp/>added<sp/>so<sp/>that<sp/>we<sp/>can</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>show<sp/>the<sp/>protein<sp/>sequences</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!property_exists(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;all_relationships&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;all_relationships<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a38fecd10b7bfe4903d568245cb16d70d" kindref="member">tripal_feature_get_feature_relationships</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>);</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="37"><highlight class="normal">}</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="47" refid="d1/d0c/tripal__feature_8theme_8inc_1abbc7203d83869081b2c6c34020be0909" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1abbc7203d83869081b2c6c34020be0909" kindref="member">tripal_feature_load_featureloc_sequences</ref>($feature_id,<sp/>$featurelocs)<sp/>{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>don&apos;t<sp/>have<sp/>any<sp/>featurelocs<sp/>then<sp/>no<sp/>point<sp/>in<sp/>continuing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$featurelocs)<sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>array();</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>list<sp/>of<sp/>relationships<sp/>(including<sp/>any<sp/>aggregators)<sp/>and<sp/>iterate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>through<sp/>each<sp/>one<sp/>to<sp/>find<sp/>information<sp/>needed<sp/>to<sp/>color-code<sp/>the<sp/>reference<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/>$relationships<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1af1a748eabf2812c104c50fcec3b47c94" kindref="member">tripal_feature_get_aggregate_relationships</ref>($feature_id);</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$relationships)<sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>array();</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>each<sp/>of<sp/>the<sp/>realtionships<sp/>features<sp/>and<sp/>get<sp/>their</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>locations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($relationships<sp/>as<sp/>$rindex<sp/>=&gt;<sp/>$rel)<sp/>{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>featurelocs<sp/>for<sp/>each<sp/>of<sp/>the<sp/>relationship<sp/>features</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>$rel_featurelocs<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a4506a4efd68d0cb0e62e0521c57a5769" kindref="member">tripal_feature_load_featurelocs</ref>($rel-&gt;subject_id,<sp/></highlight><highlight class="stringliteral">&apos;as_child&apos;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($rel_featurelocs<sp/>as<sp/>$rfindex<sp/>=&gt;<sp/>$rel_featureloc)<sp/>{</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>keep<sp/>track<sp/>of<sp/>this<sp/>unique<sp/>source<sp/>feature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$src<sp/>=<sp/>$rel_featureloc-&gt;src_feature_id<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;-&quot;</highlight><highlight class="normal"><sp/>.<sp/>$rel_featureloc-&gt;src_cvterm_id;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>over<sp/>the<sp/>results<sp/>to<sp/>the<sp/>relationship<sp/>object.<sp/><sp/>Since<sp/>there<sp/>can</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>be<sp/>more<sp/>than<sp/>one<sp/>feature<sp/>location<sp/>for<sp/>each<sp/>relationship<sp/>feature<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>use<sp/>the<sp/>&apos;$src&apos;<sp/>variable<sp/>to<sp/>keep<sp/>track<sp/>of<sp/>these.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src-&gt;src_uniquename<sp/>=<sp/>$rel_featureloc-&gt;src_uniquename;</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src-&gt;src_cvterm_id<sp/><sp/>=<sp/>$rel_featureloc-&gt;src_cvterm_id;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src-&gt;src_cvname<sp/><sp/><sp/><sp/><sp/>=<sp/>$rel_featureloc-&gt;src_cvname;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src-&gt;fmin<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$rel_featureloc-&gt;fmin;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src-&gt;fmax<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$rel_featureloc-&gt;fmax;</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;featurelocs-&gt;$src-&gt;src_name<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$rel_featureloc-&gt;src_name;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>keep<sp/>track<sp/>of<sp/>the<sp/>individual<sp/>parts<sp/>for<sp/>each<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$start<sp/>=<sp/>$rel-&gt;featurelocs-&gt;$src-&gt;fmin;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$end<sp/><sp/><sp/>=<sp/>$rel-&gt;featurelocs-&gt;$src-&gt;fmax;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/><sp/>=<sp/>$rel-&gt;subject_type;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel_locs[$src][</highlight><highlight class="stringliteral">&apos;parts&apos;</highlight><highlight class="normal">][$start][$type][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$start;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel_locs[$src][</highlight><highlight class="stringliteral">&apos;parts&apos;</highlight><highlight class="normal">][$start][$type][</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>=<sp/>$end;</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel_locs[$src][</highlight><highlight class="stringliteral">&apos;parts&apos;</highlight><highlight class="normal">][$start][$type][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/><sp/>=<sp/>$type;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>featurelocs<sp/>array<sp/>provided<sp/>to<sp/>the<sp/>function<sp/>contains<sp/>the<sp/>locations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>where<sp/>this<sp/>feature<sp/>is<sp/>found.<sp/><sp/><sp/>We<sp/>want<sp/>to<sp/>get<sp/>the<sp/>sequence<sp/>for<sp/>each</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>location<sp/>and<sp/>then<sp/>annotate<sp/>it<sp/>with<sp/>the<sp/>parts<sp/>found<sp/>from<sp/>the<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>locations<sp/>determiend<sp/>above.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/>$floc_sequences<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($featurelocs<sp/>as<sp/>$featureloc)<sp/>{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>build<sp/>the<sp/>src<sp/>name<sp/>so<sp/>we<sp/>can<sp/>keep<sp/>track<sp/>of<sp/>the<sp/>different<sp/>parts<sp/>for<sp/>each<sp/>feature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/>$src<sp/>=<sp/>$featureloc-&gt;srcfeature_id-&gt;feature_id<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;-&quot;</highlight><highlight class="normal"><sp/>.<sp/>$featureloc-&gt;srcfeature_id-&gt;type_id-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>orient<sp/>the<sp/>parts<sp/>to<sp/>the<sp/>beginning<sp/>of<sp/>the<sp/>feature<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($rel_locs[$src][</highlight><highlight class="stringliteral">&apos;parts&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$parts<sp/>=<sp/>$rel_locs[$src][</highlight><highlight class="stringliteral">&apos;parts&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rparts<sp/>=<sp/>array();<sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>will<sp/>fill<sp/>this<sp/>up<sp/>if<sp/>we&apos;re<sp/>on<sp/>the<sp/>reverse<sp/>strand</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($parts<sp/>as<sp/>$start<sp/>=&gt;<sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>)<sp/>{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>as<sp/>$type_name<sp/>=&gt;<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($featureloc-&gt;strand<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>on<sp/>the<sp/>forward<sp/>strand.<sp/><sp/>We<sp/>need<sp/>to<sp/>convert<sp/>the<sp/>start<sp/>on<sp/>the<sp/>src<sp/>feature<sp/>to<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>start<sp/>on<sp/>this<sp/>feature&apos;s<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">]<sp/>-<sp/>$featureloc-&gt;fmin;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>=<sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">]<sp/>-<sp/>$featureloc-&gt;fmin;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/><sp/>=<sp/>$type_name;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>on<sp/>the<sp/>reverse<sp/>strand.<sp/><sp/>We<sp/>need<sp/>to<sp/>swap<sp/>the<sp/>start<sp/>and<sp/>stop<sp/>and<sp/>calculate<sp/>from<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>begining<sp/>of<sp/>the<sp/>reverse<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$size<sp/>=<sp/>($featureloc-&gt;fmax<sp/>-<sp/>$featureloc-&gt;fmin);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$start_orig<sp/>=<sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$end_orig<sp/>=<sp/>$parts[$start][$type_name][</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_start<sp/>=<sp/>$size<sp/>-<sp/>($end_orig<sp/>-<sp/>$featureloc-&gt;fmin);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_end<sp/>=<sp/>$size<sp/>-<sp/>($start_orig<sp/>-<sp/>$featureloc-&gt;fmin);</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rparts[$new_start][$type_name][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$new_start;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rparts[$new_start][$type_name][</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>=<sp/>$new_end;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rparts[$new_start][$type_name][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/><sp/>=<sp/>$type_name;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>sort<sp/>the<sp/>parts</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we&apos;re<sp/>on<sp/>the<sp/>reverse<sp/>strand<sp/>we<sp/>need<sp/>to<sp/>resort</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($featureloc-&gt;strand<sp/>&gt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>usort($parts,<sp/></highlight><highlight class="stringliteral">&apos;tripal_feature_sort_rel_parts_by_start&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>usort($rparts,<sp/></highlight><highlight class="stringliteral">&apos;tripal_feature_sort_rel_parts_by_start&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parts<sp/>=<sp/>$rparts;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$src;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$featureloc-&gt;feature_id-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$featureloc-&gt;srcfeature_id-&gt;feature_id);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$start<sp/>=<sp/>$featureloc-&gt;fmin<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$size<sp/>=<sp/>$featureloc-&gt;fmax<sp/>-<sp/>$featureloc-&gt;fmin;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>fix<sp/>the<sp/>hard<sp/>coded<sp/>$start<sp/>and<sp/>$size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>$start<sp/>and<sp/>$size<sp/>variables<sp/>are<sp/>hard-coded<sp/>in<sp/>the<sp/>SQL<sp/>statement</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>because<sp/>the<sp/>db_query<sp/>function<sp/>places<sp/>quotes<sp/>around<sp/>all<sp/>placeholders</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(e.g.<sp/>:start<sp/>&amp;<sp/>:size)<sp/>and<sp/>screws<sp/>up<sp/>the<sp/>substring<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>substring(residues<sp/>from<sp/>$start<sp/>for<sp/>$size)<sp/>as<sp/>residues</highlight></codeline>
<codeline lineno="155"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{feature}</highlight></codeline>
<codeline lineno="156"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>feature_id<sp/>=<sp/>:feature_id</highlight></codeline>
<codeline lineno="157"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sequence<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>$args)-&gt;fetchObject();</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1ae0b563a9d2ff83fe90b8a4f16ba21eaa" kindref="member">$residues</ref><sp/>=<sp/>$sequence-&gt;residues;</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($featureloc-&gt;strand<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1ae0b563a9d2ff83fe90b8a4f16ba21eaa" kindref="member">$residues</ref><sp/>=<sp/><ref refid="d1/d3c/group__tripal__chado__module__DEPRECATED__api_1ga2d28be85d9ed19c6064addf881f5cd13" kindref="member">tripal_reverse_compliment_sequence</ref>(<ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1ae0b563a9d2ff83fe90b8a4f16ba21eaa" kindref="member">$residues</ref>);</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$strand<sp/>=<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($featureloc-&gt;strand<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$strand<sp/>=<sp/></highlight><highlight class="charliteral">&apos;+&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>($featureloc-&gt;strand<sp/>==<sp/>-1)<sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$strand<sp/>=<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="d1/d3c/group__tripal__chado__module__DEPRECATED__api_1ga10d041fe1cd67d0cca20ad3a1a5debc7" kindref="member">tripal_get_location_string</ref>($featureloc);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;defline&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="d1/d3c/group__tripal__chado__module__DEPRECATED__api_1ga5117c49e0f5dbed592b9e48d88635de5" kindref="member">tripal_get_fasta_defline</ref>($featureloc-&gt;feature_id,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$featureloc,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>strlen(<ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1ae0b563a9d2ff83fe90b8a4f16ba21eaa" kindref="member">$residues</ref>));</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;featureloc&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$featureloc;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;formatted_seq&apos;</highlight><highlight class="normal">]<sp/>=<sp/><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1ac33ba6af2c40a1a0d1fecdf1f940e9ad" kindref="member">tripal_feature_color_sequence</ref>(<ref refid="d7/dcc/tripal__feature__sequence_8tpl_8php_1ae0b563a9d2ff83fe90b8a4f16ba21eaa" kindref="member">$residues</ref>,<sp/>$parts,<sp/>$floc_sequences[$src][</highlight><highlight class="stringliteral">&apos;defline&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$floc_sequences;</highlight></codeline>
<codeline lineno="177"><highlight class="normal">}</highlight></codeline>
<codeline lineno="183" refid="d1/d0c/tripal__feature_8theme_8inc_1a2cc281437333f55876fd6e6ad9f5c544" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a2cc281437333f55876fd6e6ad9f5c544" kindref="member">tripal_feature_sort_rel_parts_by_start</ref>($a,<sp/>$b)<sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($a<sp/>as<sp/>$type_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>$astart<sp/>=<sp/>$a[$type_name][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($b<sp/>as<sp/>$type_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>$bstart<sp/>=<sp/>$b[$type_name][</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>strnatcmp($astart,<sp/>$bstart);</highlight></codeline>
<codeline lineno="193"><highlight class="normal">}</highlight></codeline>
<codeline lineno="206" refid="d1/d0c/tripal__feature_8theme_8inc_1a4506a4efd68d0cb0e62e0521c57a5769" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a4506a4efd68d0cb0e62e0521c57a5769" kindref="member">tripal_feature_load_featurelocs</ref>($feature_id,<sp/>$side<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;as_parent&apos;</highlight><highlight class="normal">,<sp/>$aggregate<sp/>=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="209"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT</highlight></codeline>
<codeline lineno="210"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>F.name,<sp/>F.feature_id,<sp/>F.uniquename,</highlight></codeline>
<codeline lineno="211"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FS.name<sp/>as<sp/>src_name,<sp/>FS.feature_id<sp/>as<sp/>src_feature_id,<sp/>FS.uniquename<sp/>as<sp/>src_uniquename,</highlight></codeline>
<codeline lineno="212"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CVT.name<sp/>as<sp/>cvname,<sp/>CVT.cvterm_id,</highlight></codeline>
<codeline lineno="213"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CVTS.name<sp/>as<sp/>src_cvname,<sp/>CVTS.cvterm_id<sp/>as<sp/>src_cvterm_id,</highlight></codeline>
<codeline lineno="214"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL.fmin,<sp/>FL.fmax,<sp/>FL.is_fmin_partial,<sp/>FL.is_fmax_partial,FL.strand,<sp/>FL.phase</highlight></codeline>
<codeline lineno="215"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{featureloc}<sp/>FL</highlight></codeline>
<codeline lineno="216"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{feature}<sp/>F<sp/><sp/><sp/>ON<sp/>FL.feature_id<sp/>=<sp/>F.feature_id</highlight></codeline>
<codeline lineno="217"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{feature}<sp/>FS<sp/><sp/>ON<sp/>FS.feature_id<sp/>=<sp/>FL.srcfeature_id</highlight></codeline>
<codeline lineno="218"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVT<sp/><sp/>ON<sp/>F.type_id<sp/><sp/><sp/><sp/><sp/>=<sp/>CVT.cvterm_id</highlight></codeline>
<codeline lineno="219"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVTS<sp/>ON<sp/>FS.type_id<sp/><sp/><sp/><sp/>=<sp/>CVTS.cvterm_id</highlight></codeline>
<codeline lineno="220"><highlight class="stringliteral"><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($side,<sp/></highlight><highlight class="stringliteral">&apos;as_parent&apos;</highlight><highlight class="normal">)==0)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;WHERE<sp/>FL.srcfeature_id<sp/>=<sp/>:feature_id<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($side,<sp/></highlight><highlight class="stringliteral">&apos;as_child&apos;</highlight><highlight class="normal">)==0)<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;WHERE<sp/>FL.feature_id<sp/>=<sp/>:feature_id<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/>$flresults<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$feature_id));</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>copy<sp/>the<sp/>results<sp/>into<sp/>an<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/>$i=0;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/>$featurelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($loc<sp/>=<sp/>$flresults-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>a<sp/>drupal<sp/>node<sp/>exists<sp/>for<sp/>this<sp/>feature<sp/>then<sp/>add<sp/>the<sp/>nid<sp/>to<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>results<sp/>object</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>$loc-&gt;fnid<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga3ae4379f4a565328b49b2025ff3e5477" kindref="member">chado_get_nid_from_id</ref>(</highlight><highlight class="stringliteral">&apos;feature&apos;</highlight><highlight class="normal">,<sp/>$loc-&gt;feature_id);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>$loc-&gt;snid<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga3ae4379f4a565328b49b2025ff3e5477" kindref="member">chado_get_nid_from_id</ref>(</highlight><highlight class="stringliteral">&apos;feature&apos;</highlight><highlight class="normal">,<sp/>$loc-&gt;src_feature_id);</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>result<sp/>to<sp/>the<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>$featurelocs[$i++]<sp/>=<sp/>$loc;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>relationship<sp/>feature<sp/>locs<sp/>if<sp/>aggregate<sp/>is<sp/>turned<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($aggregate<sp/>and<sp/>strcmp($side,<sp/></highlight><highlight class="stringliteral">&apos;as_parent&apos;</highlight><highlight class="normal">)==0)<sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>relationships<sp/>for<sp/>this<sp/>feature<sp/>without<sp/>substituting<sp/>any<sp/>children</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>the<sp/>parent.<sp/>We<sp/>want<sp/>all<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>$relationships<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1af1a748eabf2812c104c50fcec3b47c94" kindref="member">tripal_feature_get_aggregate_relationships</ref>($feature_id,<sp/>0);</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($relationships<sp/>as<sp/>$rindex<sp/>=&gt;<sp/>$rel)<sp/>{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>featurelocs<sp/>for<sp/>each<sp/>of<sp/>the<sp/>relationship<sp/>features</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel_featurelocs<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a4506a4efd68d0cb0e62e0521c57a5769" kindref="member">tripal_feature_load_featurelocs</ref>($rel-&gt;subject_id,<sp/></highlight><highlight class="stringliteral">&apos;as_child&apos;</highlight><highlight class="normal">,<sp/>0);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($rel_featurelocs<sp/>as<sp/>$findex<sp/>=&gt;<sp/>$rfloc)<sp/>{</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$featurelocs[$i++]<sp/>=<sp/>$rfloc;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/>usort($featurelocs,<sp/></highlight><highlight class="stringliteral">&apos;tripal_feature_sort_locations&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$featurelocs;</highlight></codeline>
<codeline lineno="258"><highlight class="normal">}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="273" refid="d1/d0c/tripal__feature_8theme_8inc_1ac2d97faddf74131d7bbf1a70ffea7e82" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1ac2d97faddf74131d7bbf1a70ffea7e82" kindref="member">tripal_feature_sort_locations</ref>($a,<sp/>$b)<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>strnatcmp($a-&gt;fmin,<sp/>$b-&gt;fmin);</highlight></codeline>
<codeline lineno="275"><highlight class="normal">}</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="286" refid="d1/d0c/tripal__feature_8theme_8inc_1ac33ba6af2c40a1a0d1fecdf1f940e9ad" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1ac33ba6af2c40a1a0d1fecdf1f940e9ad" kindref="member">tripal_feature_color_sequence</ref>($sequence,<sp/>$parts,<sp/>$defline)<sp/>{</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>get<sp/>the<sp/>list<sp/>of<sp/>types<sp/>so<sp/>we<sp/>can<sp/>create<sp/>a<sp/>color<sp/>legend</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($parts<sp/>as<sp/>$index<sp/>=&gt;<sp/>$t)<sp/>{</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($t<sp/>as<sp/>$type_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>[$type_name]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/>$newseq<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&lt;div<sp/>id=\&quot;tripal_feature-featureloc_sequence-legend\&quot;&gt;Legend:<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>as<sp/>$type_name<sp/>=&gt;<sp/>$present)<sp/>{</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&lt;span<sp/>id=\&quot;tripal_feature-legend-$type_name\&quot;<sp/>class=\&quot;tripal_feature-legend-item<sp/>tripal_feature-featureloc_sequence-$type_name\&quot;<sp/>script=\&quot;\&quot;&gt;$type_name&lt;/span&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&lt;/div&gt;Hold<sp/>the<sp/>cursor<sp/>over<sp/>a<sp/>type<sp/>above<sp/>to<sp/>highlight<sp/>its<sp/>positions<sp/>in<sp/>the<sp/>sequence<sp/>below.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>background<sp/>color<sp/>of<sp/>the<sp/>rows<sp/>based<sp/>on<sp/>the<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/>$pos<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&lt;pre<sp/>class=\&quot;tripal_feature-sequence\&quot;&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&gt;$defline&lt;br&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>parts.<sp/>They<sp/>should<sp/>be<sp/>in<sp/>order.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>$starts<sp/><sp/><sp/>=<sp/>array();<sp/></highlight><highlight class="comment">//<sp/>an<sp/>array<sp/>holding<sp/>all<sp/>of<sp/>the<sp/>children<sp/>starting<sp/>locations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/>$ends<sp/><sp/><sp/><sp/><sp/>=<sp/>array();<sp/></highlight><highlight class="comment">//<sp/>an<sp/>array<sp/>holding<sp/>all<sp/>of<sp/>the<sp/>children&apos;s<sp/>ending<sp/>locations</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/>$seqcount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($parts<sp/>as<sp/>$index<sp/>=&gt;<sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>)<sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>start<sp/>for<sp/>this<sp/>part.<sp/><sp/>All<sp/>types<sp/>in<sp/>this<sp/>part<sp/>start<sp/>at<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>same<sp/>position<sp/>so<sp/>we<sp/>only<sp/>need<sp/>the<sp/>first<sp/>record</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>as<sp/>$type<sp/>=&gt;<sp/>$child)<sp/>{</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$start<sp/>=<sp/>$child[</highlight><highlight class="stringliteral">&apos;start&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$starts[$start][]<sp/>=<sp/>$type;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>next,<sp/>sort<sp/>the<sp/>parts<sp/>by<sp/>their<sp/>end.<sp/>We<sp/>want<sp/>the<sp/>span<sp/>tag<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>be<sp/>added<sp/>in<sp/>the<sp/>order<sp/>the<sp/>parts<sp/>end.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>usort(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>,<sp/></highlight><highlight class="stringliteral">&apos;tripal_feature_sort_rel_parts_by_end&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>types<sp/>in<sp/>order<sp/>that<sp/>then<sp/>end<sp/>and<sp/>create<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>span<sp/>for<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>as<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$end<sp/>=<sp/>$type[</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$ends[$end][]<sp/>=<sp/>$type;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>each<sp/>nucleotide<sp/>in<sp/>the<sp/>sequence,<sp/>add<sp/>a<sp/>new<sp/>line<sp/>very</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>50<sp/>characters<sp/>and<sp/>add<sp/>the<sp/>spans<sp/>as<sp/>we<sp/>encounter<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>($i<sp/>=<sp/>0;<sp/>$i<sp/>&lt;<sp/>strlen($sequence);<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>are<sp/>at<sp/>and<sp/>end<sp/>of<sp/>a<sp/>span<sp/>then<sp/>close<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($i,<sp/>$ends))<sp/>{</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($ends[$i]<sp/>as<sp/>$index<sp/>=&gt;<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&lt;/span&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>are<sp/>at<sp/>and<sp/>end<sp/>of<sp/>a<sp/>span<sp/>then<sp/>close<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($i,<sp/>$starts))<sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($starts[$i]<sp/>as<sp/>$index<sp/>=&gt;<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$class<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;tripal_feature-featureloc_sequence-&quot;</highlight><highlight class="normal"><sp/>.<sp/>$type;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&lt;span<sp/>class=\&quot;$class\&quot;&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/>$newseq<sp/>.=<sp/>$sequence{$i};</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/>$seqcount++;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($seqcount<sp/>%<sp/>50<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/>$newseq<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;&lt;/pre&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$newseq;</highlight></codeline>
<codeline lineno="362"><highlight class="normal">}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="369" refid="d1/d0c/tripal__feature_8theme_8inc_1a9c8b1a0e0f0295d9119a6ab163b6600d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a9c8b1a0e0f0295d9119a6ab163b6600d" kindref="member">tripal_feature_sort_rel_parts_by_end</ref>($a,<sp/>$b)<sp/>{</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/>$val<sp/>=<sp/>strnatcmp($b[</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">],<sp/>$a[</highlight><highlight class="stringliteral">&apos;end&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($val<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>strcmp($a[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">],<sp/>$b[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$val;</highlight></codeline>
<codeline lineno="375"><highlight class="normal">}</highlight></codeline>
<codeline lineno="381" refid="d1/d0c/tripal__feature_8theme_8inc_1a2565a782842e8b15fee95f2b163e28a0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a2565a782842e8b15fee95f2b163e28a0" kindref="member">tripal_feature_preprocess_tripal_feature_relationships</ref>(&amp;$variables)<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>provide<sp/>a<sp/>new<sp/>variable<sp/>that<sp/>contains<sp/>the<sp/>matched<sp/>features.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;feature;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!property_exists(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;all_relationships&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;all_relationships<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a38fecd10b7bfe4903d568245cb16d70d" kindref="member">tripal_feature_get_feature_relationships</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>);</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="388"><highlight class="normal">}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="395" refid="d1/d0c/tripal__feature_8theme_8inc_1a6a817d5d09f7edd612cdcc7951cf954b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a6a817d5d09f7edd612cdcc7951cf954b" kindref="member">tripal_feature_preprocess_tripal_feature_proteins</ref>(&amp;$variables)<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>provide<sp/>a<sp/>new<sp/>variable<sp/>that<sp/>contains<sp/>the<sp/>matched<sp/>features.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;feature;</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!property_exists(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;all_relationships&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;all_relationships<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a38fecd10b7bfe4903d568245cb16d70d" kindref="member">tripal_feature_get_feature_relationships</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal">}</highlight></codeline>
<codeline lineno="408" refid="d1/d0c/tripal__feature_8theme_8inc_1a4cf7a70d1e7cd16e3a7e94955eab0e0a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a4cf7a70d1e7cd16e3a7e94955eab0e0a" kindref="member">tripal_feature_preprocess_tripal_feature_alignments</ref>(&amp;$variables)<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>provide<sp/>a<sp/>new<sp/>variable<sp/>that<sp/>contains<sp/>the<sp/>matched<sp/>features.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;feature;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;return_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;srcfeature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featureloc&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>alignments<sp/>as<sp/>child</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/>$cfeaturelocs<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;featureloc-&gt;feature_id;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cfeaturelocs)<sp/>{</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>$cfeaturelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>alignment<sp/>as<sp/>parent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/>$pfeaturelocs<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;featureloc-&gt;srcfeature_id;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$pfeaturelocs)<sp/>{</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>$pfeaturelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>matched<sp/>alignments<sp/>(those<sp/>with<sp/>an<sp/>itermediate<sp/>&apos;match&apos;<sp/>or<sp/>&apos;EST_match&apos;,<sp/>etc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/>$mfeaturelocs<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1afdd33c90c17312be32bab98363e58cff" kindref="member">tripal_feature_get_matched_alignments</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>);</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;matched_featurelocs<sp/>=<sp/>$mfeaturelocs;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>combine<sp/>all<sp/>three<sp/>alignments<sp/>into<sp/>a<sp/>single<sp/>array<sp/>for<sp/>printing<sp/>together<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>single<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a2bac1064c3ad21402f1c8216d4f8a470" kindref="member">$alignments</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($pfeaturelocs<sp/>as<sp/>$featureloc)<sp/>{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>type<sp/>is<sp/>a<sp/>&apos;match&apos;<sp/>then<sp/>ignore<sp/>it.<sp/>We<sp/>will<sp/>handle<sp/>those<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/(^match$|^.*?_match|match_part)$/&apos;</highlight><highlight class="normal">,<sp/>$featureloc-&gt;feature_id-&gt;type_id-&gt;name))<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;record<sp/>=<sp/>$featureloc;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;name<sp/>=<sp/>$featureloc-&gt;feature_id-&gt;name;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;type<sp/>=<sp/>$featureloc-&gt;feature_id-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;fmin<sp/>=<sp/>$featureloc-&gt;fmin;</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;fmax<sp/>=<sp/>$featureloc-&gt;fmax;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;phase<sp/>=<sp/>$featureloc-&gt;phase;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;strand<sp/>=<sp/>$featureloc-&gt;strand;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a2bac1064c3ad21402f1c8216d4f8a470" kindref="member">$alignments</ref>[]<sp/>=<sp/>$alignment;</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($featureloc-&gt;feature_id,<sp/></highlight><highlight class="stringliteral">&apos;nid&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$alignment-&gt;nid<sp/>=<sp/>$featureloc-&gt;feature_id-&gt;nid;</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cfeaturelocs<sp/>as<sp/>$featureloc)<sp/>{</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>type<sp/>is<sp/>a<sp/>&apos;match&apos;<sp/>then<sp/>ignore<sp/>it.<sp/>We<sp/>will<sp/>handle<sp/>those<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/(^match$|^.*?_match|match_part)$/&apos;</highlight><highlight class="normal">,<sp/>$featureloc-&gt;feature_id-&gt;type_id-&gt;name))<sp/>{</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;record<sp/>=<sp/>$featureloc;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;name<sp/>=<sp/>$featureloc-&gt;srcfeature_id-&gt;name;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;type<sp/>=<sp/>$featureloc-&gt;srcfeature_id-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;fmin<sp/>=<sp/>$featureloc-&gt;fmin;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;is_fmin_partial<sp/>=<sp/>$featureloc-&gt;is_fmin_partial;</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;fmax<sp/>=<sp/>$featureloc-&gt;fmax;</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;is_fmax_partial<sp/>=<sp/>$featureloc-&gt;is_fmax_partial;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;phase<sp/>=<sp/>$featureloc-&gt;phase;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;strand<sp/>=<sp/>$featureloc-&gt;strand;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a2bac1064c3ad21402f1c8216d4f8a470" kindref="member">$alignments</ref>[]<sp/>=<sp/>$alignment;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($featureloc-&gt;srcfeature_id,<sp/></highlight><highlight class="stringliteral">&apos;nid&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$alignment-&gt;nid<sp/>=<sp/>$featureloc-&gt;srcfeature_id-&gt;nid;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>matching<sp/>features,<sp/>the<sp/>left<sp/>feature<sp/>is<sp/>always<sp/>the<sp/>feature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>provided<sp/>to<sp/>this<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($mfeaturelocs<sp/>as<sp/>$featureloc)<sp/>{</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>more<sp/>information<sp/>about<sp/>the<sp/>right<sp/>feature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/>$select<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$featureloc-&gt;right_srcfeature_id);</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>$rfeature<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;feature&apos;</highlight><highlight class="normal">,<sp/>$select);</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>add<sp/>to<sp/>the<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;record<sp/>=<sp/>$featureloc;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_feature<sp/>=<sp/>$rfeature;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;name<sp/>=<sp/>$rfeature-&gt;name;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;type<sp/>=<sp/>$rfeature-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;fmin<sp/>=<sp/>$featureloc-&gt;left_fmin;</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;is_fmin_partial<sp/>=<sp/>$featureloc-&gt;left_is_fmin_partial;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;fmax<sp/>=<sp/>$featureloc-&gt;left_fmax;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;is_fmax_partial<sp/>=<sp/>$featureloc-&gt;left_is_fmax_partial;</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;phase<sp/>=<sp/>$featureloc-&gt;left_phase;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;strand<sp/>=<sp/>$featureloc-&gt;left_strand;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_fmin<sp/>=<sp/>$featureloc-&gt;right_fmin;</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_is_fmin_partial<sp/>=<sp/>$featureloc-&gt;right_is_fmin_partial;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_fmax<sp/>=<sp/>$featureloc-&gt;right_fmax;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_is_fmax_partial<sp/>=<sp/>$featureloc-&gt;right_is_fmax_partial;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_phase<sp/>=<sp/>$featureloc-&gt;right_phase;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/>$alignment-&gt;right_strand<sp/>=<sp/>$featureloc-&gt;right_strand;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a2bac1064c3ad21402f1c8216d4f8a470" kindref="member">$alignments</ref>[]<sp/>=<sp/>$alignment;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($rfeature,<sp/></highlight><highlight class="stringliteral">&apos;nid&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$alignment-&gt;nid<sp/>=<sp/>$rfeature-&gt;nid;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;all_featurelocs<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a2bac1064c3ad21402f1c8216d4f8a470" kindref="member">$alignments</ref>;</highlight></codeline>
<codeline lineno="511"><highlight class="normal">}</highlight></codeline>
<codeline lineno="533" refid="d1/d0c/tripal__feature_8theme_8inc_1afdd33c90c17312be32bab98363e58cff" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1afdd33c90c17312be32bab98363e58cff" kindref="member">tripal_feature_get_matched_alignments</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>)<sp/>{</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="536"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>SELECT</highlight></codeline>
<codeline lineno="537"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.featureloc_id<sp/><sp/><sp/><sp/>as<sp/>left_featureloc_id,</highlight></codeline>
<codeline lineno="538"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.srcfeature_id<sp/><sp/><sp/><sp/>as<sp/>left_srcfeature_id,</highlight></codeline>
<codeline lineno="539"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.feature_id<sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_feature_id,</highlight></codeline>
<codeline lineno="540"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.fmin<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_fmin,</highlight></codeline>
<codeline lineno="541"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.is_fmin_partial<sp/><sp/>as<sp/>left_is_fmin_partial,</highlight></codeline>
<codeline lineno="542"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.fmax<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_fmax,</highlight></codeline>
<codeline lineno="543"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.is_fmax_partial<sp/><sp/>as<sp/>left_is_fmax_partial,</highlight></codeline>
<codeline lineno="544"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.strand<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_strand,</highlight></codeline>
<codeline lineno="545"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.phase<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_phase,</highlight></codeline>
<codeline lineno="546"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.locgroup<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_locgroup,</highlight></codeline>
<codeline lineno="547"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL1.rank<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>left_rank,</highlight></codeline>
<codeline lineno="548"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.featureloc_id<sp/><sp/><sp/><sp/>as<sp/>right_featureloc_id,</highlight></codeline>
<codeline lineno="549"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.srcfeature_id<sp/><sp/><sp/><sp/>as<sp/>right_srcfeature_id,</highlight></codeline>
<codeline lineno="550"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.feature_id<sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_feature_id,</highlight></codeline>
<codeline lineno="551"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.fmin<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_fmin,</highlight></codeline>
<codeline lineno="552"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.is_fmin_partial<sp/><sp/>as<sp/>right_is_fmin_partial,</highlight></codeline>
<codeline lineno="553"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.fmax<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_fmax,</highlight></codeline>
<codeline lineno="554"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.is_fmax_partial<sp/><sp/>as<sp/>right_is_fmax_partial,</highlight></codeline>
<codeline lineno="555"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.strand<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_strand,</highlight></codeline>
<codeline lineno="556"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.phase<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_phase,</highlight></codeline>
<codeline lineno="557"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.locgroup<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_locgroup,</highlight></codeline>
<codeline lineno="558"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL2.rank<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>as<sp/>right_rank</highlight></codeline>
<codeline lineno="559"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{feature}<sp/>F1</highlight></codeline>
<codeline lineno="560"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{featureloc}<sp/>FL1<sp/>on<sp/>FL1.srcfeature_id<sp/>=<sp/>F1.feature_id</highlight></codeline>
<codeline lineno="561"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{feature}<sp/>F2<sp/>on<sp/>FL1.feature_id<sp/>=<sp/>F2.feature_id</highlight></codeline>
<codeline lineno="562"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{featureloc}<sp/>FL2<sp/>on<sp/>FL2.feature_id<sp/>=<sp/>F2.feature_id</highlight></codeline>
<codeline lineno="563"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVT2<sp/>on<sp/>F2.type_id<sp/>=<sp/>CVT2.cvterm_id</highlight></codeline>
<codeline lineno="564"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="565"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>F1.feature_id<sp/>=<sp/>:feature_id<sp/><sp/>AND</highlight></codeline>
<codeline lineno="566"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(CVT2.name<sp/>=<sp/>&apos;match&apos;<sp/>or<sp/>CVT2.name<sp/>like<sp/>&apos;%_match&apos;)</highlight></codeline>
<codeline lineno="567"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>FL1.fmin</highlight></codeline>
<codeline lineno="568"><highlight class="stringliteral"><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="569"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;feature_id));</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>results<sp/>and<sp/>add<sp/>them<sp/>to<sp/>our<sp/>featurelocs<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/>$featurelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($fl<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ignore<sp/>featurelocs<sp/>where<sp/>the<sp/>left<sp/>and<sp/>right<sp/>srcfeature<sp/>is<sp/>the<sp/>same</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($fl-&gt;left_srcfeature_id,<sp/>$fl-&gt;right_srcfeature_id)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/>$featurelocs[]<sp/>=<sp/>$fl<sp/>;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$featurelocs;</highlight></codeline>
<codeline lineno="582"><highlight class="normal">}</highlight></codeline>
<codeline lineno="588" refid="d1/d0c/tripal__feature_8theme_8inc_1af010bed83ac47488a63e6f1f2a8f8b99" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1af010bed83ac47488a63e6f1f2a8f8b99" kindref="member">tripal_feature_preprocess_tripal_organism_feature_counts</ref>(&amp;$variables,<sp/>$hook)<sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;organism;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>-&gt;feature_counts<sp/>=<sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1ad8aabd192af6d7b3d70d5e1047f5e03a" kindref="member">tripal_feature_load_organism_feature_counts</ref>(<ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>);</highlight></codeline>
<codeline lineno="591"><highlight class="normal">}</highlight></codeline>
<codeline lineno="600" refid="d1/d0c/tripal__feature_8theme_8inc_1ad8aabd192af6d7b3d70d5e1047f5e03a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1ad8aabd192af6d7b3d70d5e1047f5e03a" kindref="member">tripal_feature_load_organism_feature_counts</ref>(<ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>)<sp/>{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/>$order<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/>$names<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>should<sp/>not<sp/>assume<sp/>this<sp/>table<sp/>is<sp/>present<sp/>since<sp/>it<sp/>is<sp/>a<sp/>materialized<sp/>view.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>(</highlight><highlight class="stringliteral">&apos;organism_feature_count&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>build<sp/>the<sp/>where<sp/>clause<sp/>for<sp/>the<sp/>SQL<sp/>statement<sp/>if<sp/>we<sp/>have<sp/>a<sp/>custom<sp/>term<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we&apos;ll<sp/>also<sp/>keep<sp/>track<sp/>of<sp/>the<sp/>names<sp/>the<sp/>admin<sp/>provided<sp/>(if<sp/>any)<sp/>and<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>order<sp/>that<sp/>the<sp/>terms<sp/>should<sp/>appear.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/>$is_custom<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/>$temp<sp/>=<sp/>rtrim(variable_get(</highlight><highlight class="stringliteral">&apos;tripal_feature_summary_report_mapping&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/>$where<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($temp)<sp/>{</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_custom<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>$temp<sp/>=<sp/>explode(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">,<sp/>$temp);</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/>$i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($temp<sp/>as<sp/>$value)<sp/>{</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>separate<sp/>the<sp/>key<sp/>value<sp/>pairs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$temp2<sp/>=<sp/>explode(</highlight><highlight class="stringliteral">&quot;=&quot;</highlight><highlight class="normal">,<sp/>$value);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$feature_type<sp/>=<sp/>rtrim($temp2[0]);</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$order[]<sp/>=<sp/>$feature_type;<sp/><sp/></highlight><highlight class="comment">//<sp/>save<sp/>the<sp/>order<sp/>of<sp/>the<sp/>these<sp/>terms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>OFC.feature_type<sp/>=<sp/>:name$i<sp/>OR<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args[</highlight><highlight class="stringliteral">&quot;:name$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>rtrim($temp2[0]);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>admin<sp/>specified<sp/>a<sp/>new<sp/>name<sp/>then<sp/>store<sp/>that<sp/>otherwise<sp/>use<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>default<sp/>sequence<sp/>ontology<sp/>term<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(count($temp2)<sp/>==<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$names[]<sp/>=<sp/>rtrim($temp2[1]);</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$names[]<sp/>=<sp/>$feature_type;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($where)<sp/>{</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>=<sp/>drupal_substr($where,<sp/>0,<sp/>-4);<sp/><sp/>#<sp/></highlight><highlight class="keyword">remove</highlight><highlight class="normal"><sp/>OR<sp/>from<sp/>the<sp/>end</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;($where)<sp/>AND&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>feature<sp/>counts.<sp/><sp/>This<sp/>is<sp/>dependent<sp/>on<sp/>a<sp/>materialized<sp/>view</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>installed<sp/>with<sp/>the<sp/>organism<sp/>module</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="648"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>OFC.num_features,OFC.feature_type,CVT.definition</highlight></codeline>
<codeline lineno="649"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{organism_feature_count}<sp/>OFC</highlight></codeline>
<codeline lineno="650"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVT<sp/>on<sp/>OFC.cvterm_id<sp/>=<sp/>CVT.cvterm_id</highlight></codeline>
<codeline lineno="651"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>$where<sp/>organism_id<sp/>=<sp/>:organism_id</highlight></codeline>
<codeline lineno="652"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>num_features<sp/>desc</highlight></codeline>
<codeline lineno="653"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/>$args[</highlight><highlight class="stringliteral">&apos;:organism_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>-&gt;organism_id;</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/>$org_features<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>$args);</highlight></codeline>
<codeline lineno="656"><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($type<sp/>=<sp/>$org_features-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>[$type-&gt;feature_type]<sp/>=<sp/>$type;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>don&apos;t<sp/>have<sp/>an<sp/>order<sp/>this<sp/>means<sp/>we<sp/>didn&apos;t<sp/>go<sp/>through<sp/>the<sp/>loop</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>above<sp/>to<sp/>set<sp/>the<sp/>names,<sp/>so<sp/>do<sp/>that<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_custom)<sp/>{</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$names[]<sp/>=<sp/>$type-&gt;feature_type;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$order[]<sp/>=<sp/>$type-&gt;feature_type;</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>reorder<sp/>the<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/>$ordered_types<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($order<sp/>as<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($type,<sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>))<sp/>{</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$ordered_types[]<sp/>=<sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>[$type];</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>array(</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;types&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$ordered_types,</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;names&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$names</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="680"><highlight class="normal">}</highlight></codeline>
<codeline lineno="681"><highlight class="normal"></highlight></codeline>
<codeline lineno="697" refid="d1/d0c/tripal__feature_8theme_8inc_1a38fecd10b7bfe4903d568245cb16d70d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a38fecd10b7bfe4903d568245cb16d70d" kindref="member">tripal_feature_get_feature_relationships</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>)<sp/>{</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>expand<sp/>the<sp/>feature<sp/>object<sp/>to<sp/>include<sp/>the<sp/>feature<sp/>relationships.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;return_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;order_by&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ASC&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>fully<sp/>recurse<sp/>we<sp/>only<sp/>need<sp/>information<sp/>about<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>relationship<sp/>type<sp/>and<sp/>the<sp/>object<sp/>and<sp/>subject<sp/>features<sp/>(including<sp/>feature<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>organism)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;feature_relationship&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>subject<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/>$srelationships<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;feature_relationship-&gt;subject_id;</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/>$orelationships<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;feature_relationship-&gt;object_id;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>alignment<sp/>as<sp/>child.<sp/>The<sp/>$feature-&gt;featureloc<sp/>element</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>already<sp/>populated<sp/>from<sp/>the<sp/>alignment<sp/>preprocess<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;srcfeature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref><sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>(<ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>,<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featureloc&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/>$cfeaturelocs<sp/>=<sp/><ref refid="d0/d37/tripal__feature__alignments_8tpl_8php_1a306f40abf7512b36a7251235d46684cc" kindref="member">$feature</ref>-&gt;featureloc-&gt;feature_id;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cfeaturelocs)<sp/>{</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/>$cfeaturelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/>elseif<sp/>(!is_array($cfeaturelocs))<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>$cfeaturelocs<sp/>=<sp/>array($cfeaturelocs);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>prepare<sp/>the<sp/>SQL<sp/>statement<sp/>to<sp/>get<sp/>the<sp/>featureloc<sp/>for<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>feature<sp/>in<sp/>the<sp/>relationships.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/>$flrels_sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="744"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT</highlight></codeline>
<codeline lineno="745"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FL.featureloc_id,<sp/>F.name<sp/>as<sp/>srcfeature_name,<sp/>FL.srcfeature_id,</highlight></codeline>
<codeline lineno="746"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FL.feature_id,<sp/>FL.fmin,<sp/>FL.fmax,<sp/>FL.strand,<sp/>FL.phase</highlight></codeline>
<codeline lineno="747"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{featureloc}<sp/>FL</highlight></codeline>
<codeline lineno="748"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{feature}<sp/>F<sp/>ON<sp/>F.feature_id<sp/>=<sp/>FL.srcfeature_id</highlight></codeline>
<codeline lineno="749"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>FL.feature_id<sp/>=<sp/>:feature_id<sp/>and<sp/>FL.srcfeature_id<sp/>=<sp/>:srcfeature_id</highlight></codeline>
<codeline lineno="750"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>combine<sp/>both<sp/>object<sp/>and<sp/>subject<sp/>relationshisp<sp/>into<sp/>a<sp/>single<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/>$relationships<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>object<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($orelationships)<sp/>{</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($orelationships<sp/>as<sp/>$relationship)<sp/>{</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>locations<sp/>where<sp/>the<sp/>child<sp/>feature<sp/>and<sp/>this<sp/>feature<sp/>overlap<sp/>with<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>same<sp/>landmark<sp/>feature.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;child_featurelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cfeaturelocs<sp/>as<sp/>$featureloc)<sp/>{</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$res<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($flrels_sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;subject_id-&gt;feature_id,<sp/></highlight><highlight class="stringliteral">&apos;:srcfeature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$featureloc-&gt;srcfeature_id-&gt;feature_id));</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($loc<sp/>=<sp/>$res-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>in<sp/>the<sp/>node<sp/>id<sp/>of<sp/>the<sp/>src<sp/>feature<sp/>if<sp/>it<sp/>exists<sp/>and<sp/>save<sp/>this<sp/>location</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($featureloc-&gt;srcfeature_id,<sp/></highlight><highlight class="stringliteral">&apos;nid&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$loc-&gt;nid<sp/>=<sp/>$featureloc-&gt;srcfeature_id-&gt;nid;</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;child_featurelocs[]<sp/>=<sp/>$loc;</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;record<sp/>=<sp/>$relationship;</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>relationship<sp/>and<sp/>child<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel_type<sp/>=<sp/>t(preg_replace(</highlight><highlight class="stringliteral">&apos;/_/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">,<sp/>$relationship-&gt;type_id-&gt;name));</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$child_type<sp/>=<sp/>$relationship-&gt;subject_id-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="779"><highlight class="normal"></highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>node<sp/>id<sp/>of<sp/>the<sp/>subject</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>nid<sp/>FROM<sp/>{chado_feature}<sp/>WHERE<sp/>feature_id<sp/>=<sp/>:feature_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$n<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;subject_id-&gt;feature_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($n)<sp/>{</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;record-&gt;nid<sp/>=<sp/>$n-&gt;nid;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($rel_type,<sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">][$rel_type]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($child_type,<sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">][$rel_type]))<sp/>{</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">][$rel_type][$child_type]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object&apos;</highlight><highlight class="normal">][$rel_type][$child_type][]<sp/>=<sp/>$rel;</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="796"><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>add<sp/>in<sp/>the<sp/>subject<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($srelationships)<sp/>{</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($srelationships<sp/>as<sp/>$relationship)<sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>locations<sp/>where<sp/>this<sp/>feature<sp/>overlaps<sp/>with<sp/>the<sp/>parent</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;parent_featurelocs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cfeaturelocs<sp/>as<sp/>$featureloc)<sp/>{</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$res<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($flrels_sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;object_id-&gt;feature_id,<sp/></highlight><highlight class="stringliteral">&apos;:srcfeature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$featureloc-&gt;srcfeature_id-&gt;feature_id));</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($loc<sp/>=<sp/>$res-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>in<sp/>the<sp/>node<sp/>id<sp/>of<sp/>the<sp/>src<sp/>feature<sp/>if<sp/>it<sp/>exists<sp/>and<sp/>save<sp/>this<sp/>location</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($featureloc-&gt;srcfeature_id,<sp/></highlight><highlight class="stringliteral">&apos;nid&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$loc-&gt;nid<sp/>=<sp/>$featureloc-&gt;srcfeature_id-&gt;nid;</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;parent_featurelocs[]<sp/>=<sp/>$loc;</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;record<sp/>=<sp/>$relationship;</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel_type<sp/>=<sp/>t(preg_replace(</highlight><highlight class="stringliteral">&apos;/_/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal">,<sp/>$relationship-&gt;type_id-&gt;name));</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$parent_type<sp/>=<sp/>$relationship-&gt;object_id-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>node<sp/>id<sp/>of<sp/>the<sp/>subject</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>nid<sp/>FROM<sp/>{chado_feature}<sp/>WHERE<sp/>feature_id<sp/>=<sp/>:feature_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$n<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;object_id-&gt;feature_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($n)<sp/>{</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;record-&gt;nid<sp/>=<sp/>$n-&gt;nid;</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($rel_type,<sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject&apos;</highlight><highlight class="normal">][$rel_type]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($parent_type,<sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject&apos;</highlight><highlight class="normal">][$rel_type]))<sp/>{</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject&apos;</highlight><highlight class="normal">][$rel_type][$parent_type]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject&apos;</highlight><highlight class="normal">][$rel_type][$parent_type][]<sp/>=<sp/>$rel;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$relationships;</highlight></codeline>
<codeline lineno="834"><highlight class="normal">}</highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight></codeline>
<codeline lineno="839" refid="d1/d0c/tripal__feature_8theme_8inc_1a1e51e6099b622e225fd373243730297e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a1e51e6099b622e225fd373243730297e" kindref="member">tripal_feature_preprocess_tripal_feature_bar_chart_type_organism_summary</ref>(&amp;$vars)<sp/>{</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>in<sp/>all<sp/>the<sp/>javascript/css<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><ref refid="db/d54/group__tripal__d3js__api_1gafe3571aa0b93a1516786f56c2e80e47a" kindref="member">tripal_add_d3js</ref>();</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/>drupal_add_css(drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;tripal_feature&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/css/tripal_feature.css&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/>drupal_add_js(drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;tripal_feature&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/js/tripalFeature.adminChart.js&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="845"><highlight class="normal"></highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Retrieve<sp/>and<sp/>process<sp/>all<sp/>the<sp/>data<sp/>and<sp/>save<sp/>it<sp/>as<sp/>javascript<sp/>settings.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="848"><highlight class="normal"></highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>are<sp/>using<sp/>the<sp/>organism_feature_count<sp/>materialized<sp/>view<sp/>as<sp/>the<sp/>source<sp/>for<sp/>our<sp/>data.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Thus<sp/>grab<sp/>all<sp/>the<sp/>records<sp/>from<sp/>this<sp/>materialized<sp/>view.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/>$organism_feature_count<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_feature_count&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/>array(),</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;order_by&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;genus&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ASC&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;species&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ASC&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;feature_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ASC&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;num_features&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;DESC&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="857"><highlight class="normal"></highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>variables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/>$chart<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/>$type_names<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/>$organism_names<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/>$max_bar_height<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="863"><highlight class="normal"></highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Process<sp/>each<sp/>row<sp/>of<sp/>the<sp/>materialzied<sp/>view<sp/>into<sp/>the<sp/>chart<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Note:<sp/>it&apos;s<sp/>first<sp/>keyed<sp/>by<sp/>type<sp/>since<sp/>each<sp/>type<sp/>will<sp/>be<sp/>a<sp/>bar.<sp/>Each<sp/>type<sp/>will<sp/>have</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>a<sp/>&quot;bars&quot;<sp/>array<sp/>with<sp/>the<sp/>start<sp/>(y0)<sp/>and<sp/>end<sp/>(y1)<sp/>height<sp/>on<sp/>the<sp/>bar<sp/>for<sp/>a<sp/>given</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>organism.<sp/>Finally<sp/>we<sp/>keep<sp/>a<sp/>record<sp/>of<sp/>the<sp/>names<sp/>of<sp/>the<sp/>types<sp/>&amp;<sp/>organisms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>axis&apos;<sp/>and<sp/>legend<sp/>generation<sp/>respectively.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($organism_feature_count<sp/>as<sp/>$row)<sp/>{</highlight></codeline>
<codeline lineno="870"><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>up<sp/>the<sp/>easy<sp/>details<sp/>for<sp/>the<sp/>current<sp/>row&apos;s<sp/>type.<sp/>These<sp/>will<sp/>be<sp/>overridden</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>multiple<sp/>times<sp/>but<sp/>that&apos;s<sp/>more<sp/>efficient<sp/>than<sp/>checking<sp/>each<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$row-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>str_replace(</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<sp/>$row-&gt;feature_type);</highlight></codeline>
<codeline lineno="875"><highlight class="normal"></highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>the<sp/>name<sp/>of<sp/>the<sp/>type<sp/>and<sp/>organism<sp/>into<sp/>their<sp/>respective<sp/>arrays</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>generation<sp/>of<sp/>axis&apos;<sp/>and<sp/>legends<sp/>for<sp/>the<sp/>chart.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/>$type_names[$row-&gt;cvterm_id]<sp/>=<sp/>$row-&gt;feature_type;</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/>$organism_names[$row-&gt;organism_id]<sp/>=<sp/>$row-&gt;genus<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$row-&gt;species;</highlight></codeline>
<codeline lineno="880"><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>information<sp/>about<sp/>the<sp/>current<sp/>organism.<sp/>This<sp/>isn&apos;t<sp/>actually<sp/>used<sp/>by<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>chart<sp/>but<sp/>can<sp/>be<sp/>used<sp/>to<sp/>debug<sp/>the<sp/>bar<sp/>generation<sp/>to<sp/>follow.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;organisms&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$row-&gt;genus<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$row-&gt;species,</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>$row-&gt;num_features</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="887"><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>to<sp/>build<sp/>the<sp/>bar<sp/>array<sp/>with<sp/>the<sp/>start<sp/>(y0)<sp/>and<sp/>end<sp/>(y1)<sp/>height<sp/>on<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>bar<sp/>for<sp/>a<sp/>given<sp/>organism.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>we<sp/>cannot<sp/>assume<sp/>the<sp/>types<sp/>are<sp/>all<sp/>in<sp/>order<sp/>so<sp/>store<sp/>y0<sp/>&amp;<sp/>y1<sp/>in<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>$chart[type]<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>y0<sp/>has<sp/>not<sp/>yet<sp/>been<sp/>set<sp/>for<sp/>this<sp/>type<sp/>then<sp/>we&apos;re<sp/>starting<sp/>with<sp/>the<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>chunk<sp/>(organism)<sp/>on<sp/>the<sp/>bar.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y0&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y0&apos;</highlight><highlight class="normal">]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y1&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$row-&gt;num_features;</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Otherwise,<sp/>add<sp/>the<sp/>next<sp/>chunk<sp/>(organism)<sp/>on<sp/>top<sp/>of<sp/>the<sp/>pre-existing<sp/>bar.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y0&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y1&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y1&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y0&apos;</highlight><highlight class="normal">]<sp/>+<sp/>$row-&gt;num_features;</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>save<sp/>the<sp/>bar<sp/>chunk<sp/>we<sp/>just<sp/>determined.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;bars&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$row-&gt;genus<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$row-&gt;species,</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;y0&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y0&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;y1&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y1&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>also<sp/>need<sp/>to<sp/>keep<sp/>track<sp/>of<sp/>the<sp/>total<sp/>number<sp/>of<sp/>features<sp/>for<sp/>a<sp/>single<sp/>bar<sp/>(Type).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;total_features&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(int)<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;y1&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>And<sp/>the<sp/>maximum<sp/>&quot;height&quot;<sp/>for<sp/>all<sp/>bars.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>($max_bar_height<sp/>&lt;<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;total_features&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$max_bar_height<sp/>=<sp/>(int)<sp/>$chart[$row-&gt;cvterm_id][</highlight><highlight class="stringliteral">&apos;total_features&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="917"><highlight class="normal"></highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Sort<sp/>based<sp/>on<sp/>the<sp/>total<sp/>number<sp/>of<sp/>features.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>This<sp/>changes<sp/>the<sp/>keys<sp/>so<sp/>it&apos;s<sp/>no<sp/>longer<sp/>the<sp/>organism/type_id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/>usort($chart,<sp/></highlight><highlight class="stringliteral">&apos;tripal_feature_admin_summary_sort&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/>sort($type_names);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/>sort($organism_names);</highlight></codeline>
<codeline lineno="923"><highlight class="normal"></highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>also<sp/>need<sp/>to<sp/>add<sp/>information<sp/>about<sp/>the<sp/>materialized<sp/>views</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>that<sp/>admin<sp/>can<sp/>update<sp/>it<sp/>and<sp/>know<sp/>how<sp/>recent<sp/>the<sp/>data<sp/>is.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/>$mview<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&apos;</highlight></codeline>
<codeline lineno="927"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>mview_id,<sp/>name,<sp/>last_update</highlight></codeline>
<codeline lineno="928"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>tripal_mviews</highlight></codeline>
<codeline lineno="929"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>mv_table=:mv_table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:mv_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;organism_feature_count&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/>)-&gt;fetchObject();</highlight></codeline>
<codeline lineno="932"><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/>$vars[</highlight><highlight class="stringliteral">&apos;chart_details&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;summary&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chart,</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;types&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_names,</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organisms&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$organism_names,</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;legendPosition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;top&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;maxBarHeight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$max_bar_height,</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;mviewUrl&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>url(</highlight><highlight class="stringliteral">&apos;admin/tripal/storage/chado/mviews/update/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$mview-&gt;mview_id),</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;mviewTable&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$mview-&gt;name,</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;mviewLastUpdate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$mview-&gt;last_update<sp/>?<sp/>format_date($mview-&gt;last_update)<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="943"><highlight class="normal"></highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Save<sp/>everything<sp/>we<sp/>just<sp/>determined<sp/>as<sp/>a<sp/>Drupal<sp/>JS<sp/>settings<sp/>so<sp/>that<sp/>we<sp/>have<sp/>access<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>in<sp/>our<sp/>js<sp/>script.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/>drupal_add_js(array(</highlight><highlight class="stringliteral">&apos;tripalFeature&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;admin&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vars[</highlight><highlight class="stringliteral">&apos;chart_details&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;setting&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="947"><highlight class="normal">}</highlight></codeline>
<codeline lineno="948"><highlight class="normal"></highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight></codeline>
<codeline lineno="960" refid="d1/d0c/tripal__feature_8theme_8inc_1af1a748eabf2812c104c50fcec3b47c94" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1af1a748eabf2812c104c50fcec3b47c94" kindref="member">tripal_feature_get_aggregate_relationships</ref>($feature_id,<sp/>$substitute=1,</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/>$levels=0,<sp/>$base_type_id=NULL,<sp/>$depth=0)<sp/>{</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>only<sp/>want<sp/>to<sp/>recurse<sp/>to<sp/>as<sp/>many<sp/>levels<sp/>deep<sp/>as<sp/>indicated<sp/>by<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>$levels<sp/>variable,<sp/>but<sp/>only<sp/>if<sp/>this<sp/>variable<sp/>is<sp/>&gt;<sp/>0.<sp/>If<sp/>0<sp/>then<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>recurse<sp/>until<sp/>we<sp/>reach<sp/>the<sp/>end<sp/>of<sp/>the<sp/>relationships<sp/>tree.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($levels<sp/>&gt;<sp/>0<sp/>and<sp/>$levels<sp/>==<sp/>$depth)<sp/>{</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>get<sp/>the<sp/>relationships<sp/>for<sp/>this<sp/>feature</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a5e3907ede6684a34a62a157ea55b6214" kindref="member">tripal_feature_load_relationships</ref>($feature_id,<sp/></highlight><highlight class="stringliteral">&apos;as_object&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="973"><highlight class="normal">}</highlight></codeline>
<codeline lineno="974"><highlight class="normal"></highlight></codeline>
<codeline lineno="986" refid="d1/d0c/tripal__feature_8theme_8inc_1a5e3907ede6684a34a62a157ea55b6214" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d0c/tripal__feature_8theme_8inc_1a5e3907ede6684a34a62a157ea55b6214" kindref="member">tripal_feature_load_relationships</ref>($feature_id,<sp/>$side<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;as_subject&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>relationships<sp/>for<sp/>this<sp/>feature.<sp/><sp/>The<sp/>query<sp/>below<sp/>is<sp/>used<sp/>for<sp/>both</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>querying<sp/>the<sp/>object<sp/>and<sp/>subject<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="990"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT</highlight></codeline>
<codeline lineno="991"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FS.name<sp/>as<sp/>subject_name,<sp/>FS.uniquename<sp/>as<sp/>subject_uniquename,</highlight></codeline>
<codeline lineno="992"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>CVTS.name<sp/>as<sp/>subject_type,<sp/>CVTS.cvterm_id<sp/>as<sp/>subject_type_id,</highlight></codeline>
<codeline lineno="993"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FR.subject_id,<sp/>FR.type_id<sp/>as<sp/>relationship_type_id,<sp/>FR.object_id,<sp/>FR.rank,</highlight></codeline>
<codeline lineno="994"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>CVT.name<sp/>as<sp/>rel_type,</highlight></codeline>
<codeline lineno="995"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FO.name<sp/>as<sp/>object_name,<sp/>FO.uniquename<sp/>as<sp/>object_uniquename,</highlight></codeline>
<codeline lineno="996"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>CVTO.name<sp/>as<sp/>object_type,<sp/>CVTO.cvterm_id<sp/>as<sp/>object_type_id</highlight></codeline>
<codeline lineno="997"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{feature_relationship}<sp/>FR</highlight></codeline>
<codeline lineno="998"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVT<sp/><sp/>ON<sp/>FR.type_id<sp/><sp/><sp/><sp/>=<sp/>CVT.cvterm_id</highlight></codeline>
<codeline lineno="999"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{feature}<sp/>FS<sp/><sp/>ON<sp/>FS.feature_id<sp/>=<sp/>FR.subject_id</highlight></codeline>
<codeline lineno="1000"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{feature}<sp/>FO<sp/><sp/>ON<sp/>FO.feature_id<sp/>=<sp/>FR.object_id</highlight></codeline>
<codeline lineno="1001"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVTO<sp/>ON<sp/>FO.type_id<sp/><sp/><sp/><sp/>=<sp/>CVTO.cvterm_id</highlight></codeline>
<codeline lineno="1002"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVTS<sp/>ON<sp/>FS.type_id<sp/><sp/><sp/><sp/>=<sp/>CVTS.cvterm_id</highlight></codeline>
<codeline lineno="1003"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($side,<sp/></highlight><highlight class="stringliteral">&apos;as_object&apos;</highlight><highlight class="normal">)==0)<sp/>{</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>WHERE<sp/>FR.object_id<sp/>=<sp/>:feature_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($side,<sp/></highlight><highlight class="stringliteral">&apos;as_subject&apos;</highlight><highlight class="normal">)==0)<sp/>{</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>WHERE<sp/>FR.subject_id<sp/>=<sp/>:feature_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/>$sql<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>ORDER<sp/>BY<sp/>FR.rank&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>relationships.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$feature_id));</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>the<sp/>relationships,<sp/>put<sp/>these<sp/>in<sp/>an<sp/>array<sp/>and<sp/>add</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>the<sp/>Drupal<sp/>node<sp/>id<sp/>if<sp/>one<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/>$i=0;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/>$nodesql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>nid<sp/>FROM<sp/>{chado_feature}<sp/>WHERE<sp/>feature_id<sp/>=<sp/>:feature_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/>$relationships<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($rel<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref><sp/>=<sp/>db_query($nodesql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$rel-&gt;subject_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;subject_nid<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid;</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref><sp/>=<sp/>db_query($nodesql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:feature_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$rel-&gt;object_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rel-&gt;object_nid<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid;</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/>$relationships[$i++]<sp/>=<sp/>$rel;</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$relationships;</highlight></codeline>
<codeline lineno="1032"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="legacy/tripal_feature/theme/tripal_feature.theme.inc"/>
  </compounddef>
</doxygen>
