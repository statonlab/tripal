<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_core.chado_nodes.relationships.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga6646656f80b03567ae5ab8ebc3c11443" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships</definition>
        <argsstring>(&amp;$form, &amp;$form_state, $details)</argsstring>
        <name>chado_add_node_form_relationships</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Provides a form for adding to BASE_relationship and relationship tables</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal form array into which the relationship elements will be added </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>The corresponding form_state array for the form </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para>An array defining details needed by this form. Required Keys are:<itemizedlist>
<listitem><para>relationship_table: the name of the relationship table (ie: feature_relationship)</para></listitem><listitem><para>base_table: the name of the base table (ie: feature)</para></listitem><listitem><para>base_foreign_key: the name of the foreign key in the relationship table field linking this table to the non-relationship table (ie: feature_id)</para></listitem><listitem><para>base_key_value: the value of the base_foreign_key for the current form (ie: 999 if the feature_id=999)</para></listitem><listitem><para>nodetype: the non-translated singular title of this node type One of the following:</para></listitem><listitem><para>cv_id: the id of the ontology to supply terms for the type dropdown</para></listitem><listitem><para>cv_name: the name of the ontology to supply terms for the type dropdown Optional keys include:</para></listitem><listitem><para>fieldset_title: the non-translated title for this fieldset</para></listitem><listitem><para>additional_instructions: a non-translated string providing additional instructions</para></listitem><listitem><para>nodetype_plural: the non-translated plural title of this node type</para></listitem><listitem><para>select_options: must be an array where the [key] is a valid cvterm_id and the [value] is the human-readable name of the option. This is generated from the cv_name/id by default</para></listitem><listitem><para>base_name_field: the field in your base table you want to be used as the name of the record</para></listitem><listitem><para>subject_field_name: the name of the subject field in your relationship table (default: subject_id)</para></listitem><listitem><para>object_field_name: the name of the object field in your relationship table (default: object_id) </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="127" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="127" bodyend="595"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1af94299333456ac6f6d9edd737b3c2395" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships_add_button_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_relationships_add_button_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Called by the add button in chado_add_node_form_relationships</para><para>Create an array of additional relationships in the form state. This array will then be used to rebuild the form in subsequent builds </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="730" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="730" bodyend="781"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a3d7f3e569b2fadc091582834ca6751b8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships_add_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_relationships_add_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validate the user input for creating a new relationship. Called by the add button in chado_add_node_form_relationships. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="602" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="602" bodyend="721"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a348aad93ab28d145c9d9e7ca57444e78" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships_create_relationship_formstate_array</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_relationships_create_relationship_formstate_array</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Creates an array in form_state containing the existing relationships. This array is then modified by the add/remove buttons and used as a source for rebuilding the form.</para><para>$form_state[&apos;chado_relationships&apos;] = array( &apos;[type_id]-[rank]&apos; =&gt; array( &apos;object_id&apos; =&gt; [the _relationship.object_id value], &apos;object_name&apos; =&gt; [the base_table.uniquename value linked on base_foreign_key=object_id], &apos;subject_id&apos; =&gt; [the _relationship.subject_id value], &apos;subject_name&apos; =&gt; [the base_table.uniquename value linked on base_foreign_key=subject_id], &apos;type_id&apos; =&gt; [the _relationship.type_id value], &apos;type_name&apos; =&gt; [the cvterm.name value linked on type_id], &apos;rank&apos; =&gt; [the _relationship.rank value], ), ); </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="828" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="828" bodyend="851"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0cca21cb3cf96fd69ab490ba7b6545b3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships_name_to_id_callback</definition>
        <argsstring>($base_table, $name_field, $string)</argsstring>
        <name>chado_add_node_form_relationships_name_to_id_callback</name>
        <param>
          <declname>$base_table</declname>
        </param>
        <param>
          <declname>$name_field</declname>
        </param>
        <param>
          <declname>$string</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Handles autocomplete for subject &amp; object id</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$string</parametername>
</parameternamelist>
<parameterdescription>
<para>The part of the string already typed in the textfield </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="1038" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="1038" bodyend="1065"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1ac5110801efb4d2fb4c47d799e6578ed6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships_remove_button_submit</definition>
        <argsstring>(&amp;$form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_relationships_remove_button_submit</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Remove the correct relationship from the form Called by the many remove buttons in chado_add_node_form_relationships </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="796" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="796" bodyend="809"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0236b2ec64f4400f076640df4e94349f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_relationships_remove_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_relationships_remove_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Called by the many remove buttons in chado_add_node_form_relationships </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="787" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="787" bodyend="789"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga64a1a298825f2e5cd5e19587fad1c15c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_retrieve_node_form_relationships</definition>
        <argsstring>($node)</argsstring>
        <name>chado_retrieve_node_form_relationships</name>
        <param>
          <declname>$node</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used in a hook_insert, hook_update for a node form when the relationships form has been added to the form. It retrieves all of the relationships and returns them in an array of the format:</para><para>$relationships[&lt;type_id&gt;][&lt;rank&gt;] = array( &apos;subject_id&apos; =&gt; &lt;subject_id&gt;, &apos;object_id&apos; =&gt; &lt;object_id&gt;, );</para><para>This array can then be used for inserting or updating relationships manually</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$node</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A relationship array </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="928" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="928" bodyend="943"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gadf49a9526719dfe4b75346b349592f92" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_update_node_form_relationships</definition>
        <argsstring>($node, $details, $retrieved_relationships=FALSE)</argsstring>
        <name>chado_update_node_form_relationships</name>
        <param>
          <declname>$node</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <param>
          <declname>$retrieved_relationships</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used in hook_insert or hook_update and handles inserting of relationships between the current nodetype and other memebers of the same nodetype</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$node</parametername>
</parameternamelist>
<parameterdescription>
<para>The node passed into hook_insert &amp; hook_update </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para><itemizedlist>
<listitem><para>relationship_table: the name of the _relationship linking table (ie: feature_relationship)</para></listitem><listitem><para>foreignkey_value: the value of the foreign key (ie: 445, if there exists a feature where feature_id=445) </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$retrieved_relationships</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of relationships from chado_retrieve_node_form_relationships($node). This can be used if you need special handling for some of the relationships. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="960" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="960" bodyend="1028"/>
      </memberdef>
      <memberdef kind="function" id="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1afbfc7e910e9e475b69aa1b6955702ef6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>theme_chado_add_node_form_relationships_table</definition>
        <argsstring>($variables)</argsstring>
        <name>theme_chado_add_node_form_relationships_table</name>
        <param>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Function to theme the add/remove relationships form into a table </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" line="857" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc" bodystart="857" bodyend="907"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>API to manage the chado _relationship table for various Tripal Node Types</para><para>How To Use: <programlisting><codeline><highlight class="normal">function<sp/>chado_example_form($form,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Default<sp/>values<sp/>for<sp/>form<sp/>elements<sp/>can<sp/>come<sp/>in<sp/>the<sp/>following<sp/>ways:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>1)<sp/>as<sp/>elements<sp/>of<sp/>the<sp/>$node<sp/>object.<sp/><sp/>This<sp/>occurs<sp/>when<sp/>editing<sp/>an<sp/>existing<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>2)<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;]<sp/>array<sp/>which<sp/>occurs<sp/>on<sp/>a<sp/>failed<sp/>validation<sp/>or</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>ajax<sp/>callbacks<sp/>when<sp/>the<sp/>ajax<sp/>call<sp/>originates<sp/>from<sp/>non-submit<sp/>fields<sp/>other</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>than<sp/>button</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>3)<sp/>in<sp/>the<sp/>$form_state[&apos;input&apos;]<sp/>array<sp/>which<sp/>occurs<sp/>on<sp/>ajax<sp/>callbacks<sp/>from<sp/>submit</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>form<sp/>elements<sp/>(e.g.<sp/>buttons)<sp/>and<sp/>the<sp/>form<sp/>is<sp/>being<sp/>rebuilt<sp/>but<sp/>has<sp/>not<sp/>yet</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>been<sp/>validated</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>The<sp/>reference<sp/>elements<sp/>added<sp/>by<sp/>this<sp/>function<sp/>do<sp/>use<sp/>AJAX<sp/>calls<sp/>from<sp/>buttons,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>therefore,<sp/>it<sp/>is<sp/>important<sp/>to<sp/>check<sp/>for<sp/>form<sp/>values<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;]</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>for<sp/>case<sp/>#2<sp/>above,<sp/>and<sp/>in<sp/>the<sp/>$form_state[&apos;input&apos;]<sp/>for<sp/>case<sp/>#3.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>See<sp/>the<sp/>chado<sp/>analysis<sp/>node<sp/>form<sp/>for<sp/>an<sp/>example.</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Next,<sp/>add<sp/>in<sp/>all<sp/>the<sp/>form<sp/>array<sp/>definition<sp/>particular<sp/>to<sp/>your<sp/>node<sp/>type</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>To<sp/>add<sp/>in<sp/>the<sp/>relationship<sp/>form<sp/>elements,<sp/>you<sp/>first<sp/>need<sp/>to<sp/>prepare<sp/>the<sp/>arguments</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>for<sp/>the<sp/>function<sp/>call.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;relationship_table&apos;<sp/>=&gt;<sp/>&apos;example_relationship&apos;,<sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>table<sp/>linking<sp/>additional<sp/>dbxrefs<sp/>to<sp/>this<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;base_table&apos;<sp/>=&gt;<sp/>&apos;example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>chado<sp/>table<sp/>this<sp/>node<sp/>links<sp/>to</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;base_foreign_key&apos;<sp/>=&gt;<sp/>&apos;example_id&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>key<sp/>to<sp/>link<sp/>to<sp/>the<sp/>chado<sp/>content<sp/>created<sp/>by<sp/>this<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;base_key_value&apos;<sp/>=&gt;<sp/>$example_id,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>value<sp/>of<sp/>the<sp/>above<sp/>key</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;fieldset_title&apos;<sp/>=&gt;<sp/>&apos;Relationships&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>non-translated<sp/>title<sp/>for<sp/>this<sp/>fieldset</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;additional_instructions&apos;<sp/>=&gt;<sp/>&apos;&apos;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>a<sp/>non-stranslated<sp/>string<sp/>providing<sp/>additional<sp/>instructions</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Finally,<sp/>and<sp/>add<sp/>the<sp/>additional<sp/>form<sp/>elements<sp/>to<sp/>the<sp/>form</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>chado_add_node_form_relationships($form,<sp/>$form_state,<sp/>$details);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$form;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>chado_example_insert($node)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>if<sp/>there<sp/>is<sp/>an<sp/>example_id<sp/>in<sp/>the<sp/>$node<sp/>object<sp/>then<sp/>this<sp/>must<sp/>be<sp/>a<sp/>sync<sp/>so</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>we<sp/>can<sp/>skip<sp/>adding<sp/>the<sp/>chado_example<sp/>as<sp/>it<sp/>is<sp/>already<sp/>there,<sp/>although</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>we<sp/>do<sp/>need<sp/>to<sp/>proceed<sp/>with<sp/>the<sp/>rest<sp/>of<sp/>the<sp/>insert</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!property_exists($node,<sp/>&apos;example_id&apos;))<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>record<sp/>to<sp/>chado<sp/>example<sp/>table</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>to<sp/>any<sp/>other<sp/>tables<sp/>needed</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>all<sp/>relationships</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Existing<sp/>_relationship<sp/>links<sp/>with<sp/>the<sp/>current<sp/>example<sp/>as<sp/>either<sp/>the<sp/>subject_id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>or<sp/>object_id<sp/>will<sp/>be<sp/>cleared<sp/>and<sp/>then<sp/>re-added</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>chado_update_node_form_relationships(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example_relationship&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node-&gt;example_id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>record<sp/>to<sp/>chado_example<sp/>linking<sp/>example_id<sp/>to<sp/>new<sp/>node</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>chado_example_update($node)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>record<sp/>in<sp/>chado<sp/>example<sp/>table</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>any<sp/>other<sp/>tables<sp/>needed</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>all<sp/>additional<sp/>database<sp/>references</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Existing<sp/>_relationship<sp/>links<sp/>with<sp/>the<sp/>current<sp/>example<sp/>as<sp/>either<sp/>the<sp/>subject_id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>or<sp/>object_id<sp/>will<sp/>be<sp/>cleared<sp/>and<sp/>then<sp/>re-added</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>chado_update_node_form_relationships(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example_relationship&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node-&gt;example_id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Don&apos;t<sp/>need<sp/>to<sp/>update<sp/>chado_example<sp/>linking<sp/>table<sp/>since<sp/>niether<sp/>example_id<sp/>or<sp/>nid<sp/>can<sp/>be<sp/>changed<sp/>in<sp/>update</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting> </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="127" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6646656f80b03567ae5ab8ebc3c11443" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6646656f80b03567ae5ab8ebc3c11443" kindref="member">chado_add_node_form_relationships</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state,<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>relationship<sp/>table<sp/>exists<sp/>before<sp/>proceeding.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>($details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>relationship<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>relationship<sp/>table,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;,<sp/>does<sp/>not<sp/>exists&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcrel_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>relationship<sp/>elements<sp/>to<sp/>the<sp/>form.</highlight></codeline>
<codeline lineno="134"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>The<sp/>relationship<sp/>table,<sp/>&apos;%name&apos;,<sp/>cannot<sp/>be<sp/>found.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="137"><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>specified<sp/>cv<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>cv_name<sp/>is<sp/>real</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">),array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>relationship<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>name,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;,<sp/>does<sp/>not<sp/>exists&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcrel_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>relationship<sp/>elements<sp/>to<sp/>the<sp/>form.</highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>The<sp/>CV<sp/>named,<sp/>&apos;%name&apos;,<sp/>cannot<sp/>be<sp/>found.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>cv_id<sp/>option<sp/>to<sp/>the<sp/>details<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;cv_id;</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/>elseif<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>cv_id<sp/>is<sp/>real</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">),<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>relationship<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>ID,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;,<sp/>does<sp/>not<sp/>exist&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcrel_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>relationship<sp/>elements</highlight></codeline>
<codeline lineno="159"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>ID,<sp/>&apos;%id&apos;,<sp/>cannot<sp/>be<sp/>found.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>cv_name<sp/>option<sp/>to<sp/>the<sp/>details<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;name;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>didn&apos;t<sp/>get<sp/>given<sp/>a<sp/>cv<sp/>identifier,<sp/>then<sp/>try<sp/>retrieving<sp/>the<sp/>default<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>using<sp/>the<sp/>new<sp/>cv<sp/>defaults<sp/>api</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/>$default_cv<sp/>=<sp/><ref refid="d0/ddc/group__tripal__legacy__chado__cv__api_1ga9b021168fdc9c38c1559c858f3e71457" kindref="member">tripal_get_default_cv</ref>($details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($default_cv))<sp/>{</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$default_cv-&gt;cv_id;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$default_cv-&gt;name;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$default_form_link<sp/>=<sp/>l(</highlight><highlight class="stringliteral">&apos;vocabulary<sp/>defaults<sp/>configuration<sp/>page&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/vocab/defaults&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;target&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;_blank&apos;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>ucwords(str_replace(</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$message<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;There<sp/>is<sp/>not<sp/>a<sp/>default<sp/>vocabulary<sp/>set<sp/>for<sp/>$table<sp/>Releationship<sp/>Types.<sp/>Please<sp/>set<sp/>one<sp/>using<sp/>the<sp/><sp/>$default_form_link.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>($message,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcrel_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>provide<sp/>either<sp/>a</highlight></codeline>
<codeline lineno="185"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;cv_name&apos;<sp/>or<sp/>&apos;cv_id&apos;<sp/>as<sp/>an<sp/>option<sp/>for<sp/>adding<sp/>relationship<sp/>to<sp/>the<sp/>form&quot;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>Defaults<sp/>for<sp/>optional<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;Relationships&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype_plural&apos;</highlight><highlight class="normal">]<sp/><sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;nodetype_plural&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype_plural&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;s&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;uniquename&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;form_element_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;form_element_name&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;form_element_name&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Some<sp/>relationship<sp/>tables<sp/>don&apos;t<sp/>have<sp/>a<sp/>rank</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>thus<sp/>we<sp/>need<sp/>to<sp/>first<sp/>check<sp/>this<sp/>table<sp/>has<sp/>a<sp/>rank<sp/>before<sp/>trying<sp/>to<sp/>set<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/>$table_schema<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>($details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;table_has_rank&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($table_schema[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>TRUE<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>Relationship<sp/>Types<sp/>for<sp/>the<sp/>Select<sp/>List</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;select_options&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>$type_options<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;select_options&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_options<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_options[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>Type&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="215"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>DISTINCT<sp/>CVT.cvterm_id,<sp/>CVT.name,<sp/>CVT.definition,<sp/>CV.cv_id<sp/>as<sp/>cv_id</highlight></codeline>
<codeline lineno="216"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/><sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="217"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>ON<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="218"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="219"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CV.name<sp/>=<sp/>:cv_name<sp/>AND</highlight></codeline>
<codeline lineno="220"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NOT<sp/>CVT.is_obsolete<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="221"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>CVT.name<sp/>ASC</highlight></codeline>
<codeline lineno="222"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvterms<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($term<sp/>=<sp/>$cvterms-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type_options[$term-&gt;cvterm_id]<sp/>=<sp/>$term-&gt;name;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$term-&gt;cv_id;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_options<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_options[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>Type&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="233"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>DISTINCT<sp/>CVT.cvterm_id,<sp/>CVT.name,<sp/>CVT.definition,<sp/>CV.name<sp/>AS<sp/>cv_name</highlight></codeline>
<codeline lineno="234"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/><sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="235"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>ON<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="236"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="237"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CV.cv_id<sp/>=<sp/>:cv_id<sp/>AND</highlight></codeline>
<codeline lineno="238"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NOT<sp/>CVT.is_obsolete<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="239"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>CVT.name<sp/>ASC</highlight></codeline>
<codeline lineno="240"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvterms<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($term<sp/>=<sp/>$cvterms-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type_options[$term-&gt;cvterm_id]<sp/>=<sp/>$term-&gt;name;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$term-&gt;cv_name;</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Tell<sp/>tripal<sp/>administrators<sp/>how<sp/>to<sp/>add<sp/>terms<sp/>to<sp/>the<sp/>relationship<sp/>types<sp/>drop<sp/>down.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($type_options))<sp/>{</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/>$tripal_message<sp/>=<sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>(</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>t(</highlight><highlight class="stringliteral">&apos;There<sp/>are<sp/>currently<sp/>no<sp/>relationship<sp/>types!<sp/>To<sp/>add<sp/>additional<sp/>relationship<sp/>types<sp/>to<sp/>the<sp/>drop</highlight></codeline>
<codeline lineno="253"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>down<sp/>list,<sp/>you<sp/>need<sp/>to<sp/>&lt;a<sp/>href=&quot;@cvtermlink&quot;&gt;add<sp/>a<sp/>controlled<sp/>vocabulary<sp/>term&lt;/a&gt;</highlight></codeline>
<codeline lineno="254"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>the<sp/>%cv_name<sp/>controlled<sp/>vocabulary.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;@cvtermlink&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>url(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/chado_vocabs/chado_cv/&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;/cvterm/add&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;return_html&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE)</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>$tripal_message<sp/>=<sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>(</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>t(</highlight><highlight class="stringliteral">&apos;To<sp/>add<sp/>additional<sp/>relationship<sp/>types<sp/>to<sp/>the<sp/>drop<sp/>down<sp/>list,<sp/>you<sp/>need<sp/>to<sp/>&lt;a<sp/>href=&quot;@cvtermlink&quot;&gt;add</highlight></codeline>
<codeline lineno="267"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>controlled<sp/>vocabulary<sp/>term&lt;/a&gt;<sp/>to<sp/>the<sp/>%cv_name<sp/>controlled<sp/>vocabulary.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;@cvtermlink&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>url(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/chado_vocabs/chado_cv/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/cvterm/add&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1ae3246842a9b0bc4b8ecf2951cb1a949a" kindref="member">TRIPAL_INFO</ref>,</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;return_html&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE)</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Group<sp/>all<sp/>of<sp/>the<sp/>chado<sp/>node<sp/>api<sp/>fieldsets<sp/>into<sp/>vertical<sp/>tabs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;vertical_tabs&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;css&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado-node-api&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_core&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/css/chado_node_api.css&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#group&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>10,</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado-node-api&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">)),</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;js&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado-node-api-vertical-tabs&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_core&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/js/chadoNodeApi_updateVerticalTabSummary.js&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/>$instructions<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Relationships<sp/>should<sp/>be<sp/>read<sp/>like<sp/>a<sp/>sentence<sp/>([subject]<sp/>[type]</highlight></codeline>
<codeline lineno="304"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>[object])<sp/>in<sp/>order<sp/>to<sp/>determine<sp/>their<sp/>direction<sp/>and<sp/>thus<sp/>their<sp/>meaning.<sp/>When</highlight></codeline>
<codeline lineno="305"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>adding<sp/>a<sp/>relationship,<sp/>it<sp/>is<sp/>easiest<sp/>to<sp/>first<sp/>select<sp/>the<sp/>type<sp/>of<sp/>relationship<sp/>you<sp/>would</highlight></codeline>
<codeline lineno="306"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>like<sp/>to<sp/>enter<sp/>and<sp/>then<sp/>select<sp/>whether<sp/>the<sp/>current<sp/>%nodetype<sp/>is<sp/>the<sp/>subject</highlight></codeline>
<codeline lineno="307"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>or<sp/>object<sp/>(based<sp/>on<sp/>which<sp/>&quot;sentence&quot;<sp/>makes<sp/>sense).<sp/>Finally<sp/>enter<sp/>the<sp/>other</highlight></codeline>
<codeline lineno="308"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>%nodetype<sp/>in<sp/>the<sp/>remaining<sp/>text<sp/>box<sp/>(making<sp/>sure<sp/>to<sp/>select<sp/>from<sp/>the</highlight></codeline>
<codeline lineno="309"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>autocomplete<sp/>drop-down)<sp/>before<sp/>clicking<sp/>&quot;Add&quot;.<sp/>To<sp/>remove<sp/>incorrect<sp/>relationships,<sp/>click<sp/>the</highlight></codeline>
<codeline lineno="310"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;Remove&quot;<sp/>button.<sp/>Note:<sp/>you<sp/>cannot<sp/>edit<sp/>previously<sp/>added<sp/>relationships</highlight></codeline>
<codeline lineno="311"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>but<sp/>instead<sp/>need<sp/>to<sp/>remove<sp/>and<sp/>re-add<sp/>them.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;descrip&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;&lt;p&gt;&lt;strong&gt;Relate<sp/>the<sp/>current<sp/>%nodetype<sp/>with<sp/>others<sp/>that<sp/>already<sp/>exist.&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&apos;</highlight><highlight class="normal">.<sp/>$instructions<sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/p&gt;&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%nodetype&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">])),</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>form<sp/>element<sp/>is<sp/>a<sp/>tree,<sp/>so<sp/>that<sp/>we<sp/>don&apos;t<sp/>puke<sp/>all<sp/>of<sp/>the<sp/>values<sp/>into<sp/>then<sp/>node<sp/>variable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>is<sp/>set<sp/>as<sp/>a<sp/>tree,<sp/>and<sp/>keeps<sp/>them<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;][&apos;relationship_table&apos;]<sp/>heading.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#tree&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;tripal-generic-edit-relationships-table&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#theme&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;chado_node_relationships_form_table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>5</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>defaults<sp/>into<sp/>form_state<sp/>to<sp/>be<sp/>used<sp/>elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($details)</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>to<sp/>provide<sp/>feedback<sp/>to<sp/>the<sp/>user<sp/>that<sp/>changes<sp/>made</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>are<sp/>not<sp/>saved<sp/>until<sp/>the<sp/>node<sp/>is<sp/>saved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;save_warning&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;relationship-save-warning&quot;<sp/>class=&quot;messages<sp/>warning&quot;<sp/>style=&quot;display:none;&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;*<sp/>The<sp/>changes<sp/>to<sp/>these<sp/>relationships<sp/>will<sp/>not<sp/>be<sp/>saved<sp/>until<sp/>the<sp/>&quot;Save&quot;<sp/>button<sp/>at<sp/>the<sp/>bottom<sp/>of<sp/>this<sp/>form<sp/>is<sp/>clicked.<sp/>&lt;span<sp/>class=&quot;specific-changes&quot;&gt;&lt;/span&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;js&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado-node-api-unsaved&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_core&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/js/chadoNodeApi_unsavedNotify.js&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>relationships<sp/>already<sp/>attached<sp/>to<sp/>the<sp/>node</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//---------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Relationships<sp/>can<sp/>come<sp/>to<sp/>us<sp/>in<sp/>two<sp/>ways:</highlight></codeline>
<codeline lineno="351"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="352"><highlight class="comment"><sp/><sp/><sp/>*<sp/>1)<sp/>In<sp/>the<sp/>form<sp/>state<sp/>in<sp/>the<sp/>$form_state[&apos;chado_relationships&apos;].<sp/>Data<sp/>is<sp/>in<sp/>this<sp/>field</highlight></codeline>
<codeline lineno="353"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>when<sp/>an<sp/>AJAX<sp/>call<sp/>updates<sp/>the<sp/>form<sp/>state<sp/>or<sp/>a<sp/>validation<sp/>error.</highlight></codeline>
<codeline lineno="354"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="355"><highlight class="comment"><sp/><sp/><sp/>*<sp/>2)<sp/>Directly<sp/>from<sp/>the<sp/>database<sp/>if<sp/>the<sp/>record<sp/>already<sp/>has<sp/>_relationships<sp/>associated.<sp/><sp/>This</highlight></codeline>
<codeline lineno="356"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>data<sp/>is<sp/>only<sp/>used<sp/>the<sp/>first<sp/>time<sp/>the<sp/>form<sp/>is<sp/>loaded.<sp/>On<sp/>AJAX<sp/>calls<sp/>or<sp/>validation</highlight></codeline>
<codeline lineno="357"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>errors<sp/>the<sp/>fields<sp/>on<sp/>the<sp/>form<sp/>are<sp/>populated<sp/>from<sp/>the<sp/>$form_state[&apos;chado_relationships&apos;]</highlight></codeline>
<codeline lineno="358"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>entry.</highlight></codeline>
<codeline lineno="359"><highlight class="comment"><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/>$existing_rels<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>$existing_rels<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>(</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT</highlight></codeline>
<codeline lineno="366"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rel.*,</highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;_id<sp/>as<sp/>relationship_id,</highlight></codeline>
<codeline lineno="368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>as<sp/>subject_id,</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>as<sp/>object_id,</highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base1.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>as<sp/>object_name,</highlight></codeline>
<codeline lineno="371"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>base2.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>as<sp/>subject_name,</highlight></codeline>
<codeline lineno="372"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cvterm.name<sp/>as<sp/>type_name</highlight></codeline>
<codeline lineno="373"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;}<sp/>rel</highlight></codeline>
<codeline lineno="374"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LEFT<sp/>JOIN<sp/>{&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;}<sp/>base1<sp/>ON<sp/>base1.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;base_foreign_key&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="375"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LEFT<sp/>JOIN<sp/>{&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;}<sp/>base2<sp/>ON<sp/>base2.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;base_foreign_key&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="376"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LEFT<sp/>JOIN<sp/>{cvterm}<sp/>cvterm<sp/>ON<sp/>cvterm.cvterm_id<sp/>=<sp/>rel.type_id</highlight></codeline>
<codeline lineno="377"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>:base_key_value</highlight></codeline>
<codeline lineno="378"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>OR<sp/>rel.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>:base_key_value&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:base_key_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_key_value&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>format<sp/>of<sp/>the<sp/>$existing_rels&apos;<sp/>array<sp/>is<sp/>either:</highlight></codeline>
<codeline lineno="384"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="385"><highlight class="comment"><sp/><sp/><sp/>*<sp/>From<sp/>the<sp/>chado_relationships<sp/>array:</highlight></codeline>
<codeline lineno="386"><highlight class="comment"><sp/><sp/><sp/>*<sp/>$form_state[&apos;chado_relationships&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="387"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>&apos;[type_id]-[_relationship_id]&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="388"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;relationship_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship._relationship_id<sp/>value<sp/>OR<sp/>a<sp/>temporary<sp/>value<sp/>if<sp/>not<sp/>yet<sp/>saved<sp/>to<sp/>the<sp/>database],</highlight></codeline>
<codeline lineno="389"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;object_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.object_id<sp/>value],</highlight></codeline>
<codeline lineno="390"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;object_name&apos;<sp/>=&gt;<sp/>[the<sp/>base_table.uniquename<sp/>value<sp/>linked<sp/>on<sp/>base_foreign_key=object_id],</highlight></codeline>
<codeline lineno="391"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;subject_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.subject_id<sp/>value],</highlight></codeline>
<codeline lineno="392"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;subject_name&apos;<sp/>=&gt;<sp/>[the<sp/>base_table.uniquename<sp/>value<sp/>linked<sp/>on<sp/>base_foreign_key=subject_id],</highlight></codeline>
<codeline lineno="393"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.type_id<sp/>value],</highlight></codeline>
<codeline lineno="394"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_name&apos;<sp/>=&gt;<sp/>[the<sp/>cvterm.name<sp/>value<sp/>linked<sp/>on<sp/>type_id],</highlight></codeline>
<codeline lineno="395"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;rank&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.rank<sp/>value<sp/>OR<sp/>NULL<sp/>if<sp/>not<sp/>yet<sp/>saved<sp/>to<sp/>the<sp/>database],</highlight></codeline>
<codeline lineno="396"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="397"><highlight class="comment"><sp/><sp/><sp/>*<sp/>);</highlight></codeline>
<codeline lineno="398"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="399"><highlight class="comment"><sp/><sp/><sp/>*<sp/>OR</highlight></codeline>
<codeline lineno="400"><highlight class="comment"><sp/><sp/><sp/>*<sp/>Populated<sp/>from<sp/>the<sp/>database:</highlight></codeline>
<codeline lineno="401"><highlight class="comment"><sp/><sp/><sp/>*<sp/>$existing_rels<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="402"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>0<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="403"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;relationship_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship._relationship_id<sp/>value],</highlight></codeline>
<codeline lineno="404"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;object_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.object_id<sp/>value],</highlight></codeline>
<codeline lineno="405"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;object_name&apos;<sp/>=&gt;<sp/>[the<sp/>base_table.uniquename<sp/>value<sp/>linked<sp/>on<sp/>base_foreign_key=object_id],</highlight></codeline>
<codeline lineno="406"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;subject_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.subject_id<sp/>value],</highlight></codeline>
<codeline lineno="407"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;subject_name&apos;<sp/>=&gt;<sp/>[the<sp/>base_table.uniquename<sp/>value<sp/>linked<sp/>on<sp/>base_foreign_key=subject_id],</highlight></codeline>
<codeline lineno="408"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_id&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.type_id<sp/>value],</highlight></codeline>
<codeline lineno="409"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_name&apos;<sp/>=&gt;<sp/>[the<sp/>cvterm.name<sp/>value<sp/>linked<sp/>on<sp/>type_id],</highlight></codeline>
<codeline lineno="410"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;rank&apos;<sp/>=&gt;<sp/>[the<sp/>_relationship.rank<sp/>value],</highlight></codeline>
<codeline lineno="411"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="412"><highlight class="comment"><sp/><sp/><sp/>*<sp/>);</highlight></codeline>
<codeline lineno="413"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="414"><highlight class="comment"><sp/><sp/><sp/>*<sp/>NOTE:<sp/>The<sp/>main<sp/>difference<sp/>is<sp/>the<sp/>key</highlight></codeline>
<codeline lineno="415"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="416"><highlight class="comment"><sp/><sp/><sp/>*<sp/>Loop<sp/>on<sp/>the<sp/>array<sp/>elements<sp/>of<sp/>the<sp/>$existing_rels<sp/>array<sp/>and<sp/>add</highlight></codeline>
<codeline lineno="417"><highlight class="comment"><sp/><sp/><sp/>*<sp/>an<sp/>element<sp/>to<sp/>the<sp/>form<sp/>for<sp/>each<sp/>one.</highlight></codeline>
<codeline lineno="418"><highlight class="comment"><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/>$num_relationships<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($existing_rels<sp/>as<sp/>$relationship)<sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($relationship-&gt;type_id,<sp/>$type_options))<sp/>{</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$num_relationships++;</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_class<sp/>=<sp/>str_replace(array(</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal">,<sp/>$relationship-&gt;type_name);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$current_class<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;current-unknown&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($details[</highlight><highlight class="stringliteral">&apos;base_key_value&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($relationship-&gt;object_id<sp/>==<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_key_value&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$current_class<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;current-object&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>($relationship-&gt;subject_id<sp/>==<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_key_value&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$current_class<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;current-subject&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][</highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][</highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;saved&apos;</highlight><highlight class="normal">,<sp/>$type_class,<sp/>$current_class)</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>whether<sp/>this<sp/>relationship<sp/>is<sp/>unsaved<sp/>or<sp/>not.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can<sp/>tell<sp/>this<sp/>by<sp/>looking<sp/>at<sp/>the<sp/>relationship_id:<sp/>if<sp/>it&apos;s<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>saved<sp/>yet<sp/>we<sp/>will<sp/>have<sp/>entered<sp/>a<sp/>TEMP###.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^TEMP/&apos;</highlight><highlight class="normal">,<sp/>$relationship-&gt;relationship_id))<sp/>{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;unsaved&apos;</highlight><highlight class="normal">,<sp/>$type_class,<sp/>$current_class)</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;relationship_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;relationship_id</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="457"><highlight class="normal"></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;object_id</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;subject_id</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;type_id</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;object_name</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;type_name</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="482"><highlight class="normal"></highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship-&gt;subject_name,</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;row-unsaved-warning&quot;&gt;&lt;/span&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($relationship-&gt;rank))<sp/>?<sp/>$relationship-&gt;rank<sp/>:<sp/>NULL</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$relationship-&gt;type_id][$relationship-&gt;relationship_id][</highlight><highlight class="stringliteral">&apos;rel_action&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Remove&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;relationships_remove-&quot;</highlight><highlight class="normal">.$relationship-&gt;type_id.</highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal">.$relationship-&gt;relationship_id,</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtable_ajax_update&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-generic-edit-relationships-table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;prevent&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;click&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>When<sp/>this<sp/>button<sp/>is<sp/>clicked,<sp/>the<sp/>form<sp/>will<sp/>be<sp/>validated<sp/>and<sp/>submitted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore,<sp/>we<sp/>set<sp/>custom<sp/>submit<sp/>and<sp/>validate<sp/>functions<sp/>to<sp/>override<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>node<sp/>form<sp/>submit.<sp/><sp/>In<sp/>the<sp/>validate<sp/>function<sp/>we<sp/>validate<sp/>only<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>relationship<sp/>fields<sp/>and<sp/>in<sp/>the<sp/>submit<sp/>we<sp/>remove<sp/>the<sp/>indicated<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>from<sp/>the<sp/>chado_relationships<sp/>array.<sp/>In<sp/>order<sp/>to<sp/>keep<sp/>validate<sp/>errors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>from<sp/>the<sp/>node<sp/>form<sp/>validate<sp/>and<sp/>Drupal<sp/>required<sp/>errors<sp/>for<sp/>non-relationship<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>preventing<sp/>the<sp/>user<sp/>from<sp/>removing<sp/>relationships<sp/>we<sp/>set<sp/>the<sp/>#limit_validation_errors<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_remove_button_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_remove_button_submit&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Limit<sp/>the<sp/>validation<sp/>of<sp/>the<sp/>form<sp/>upon<sp/>clicking<sp/>this<sp/>button<sp/>to<sp/>the<sp/>relationship_table<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>other<sp/>fields<sp/>will<sp/>be<sp/>validated<sp/>(ie:<sp/>no<sp/>fields<sp/>from<sp/>the<sp/>main<sp/>form<sp/>or<sp/>any<sp/>other<sp/>api</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>added<sp/>form).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#limit_validation_errors&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">)<sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>all<sp/>fields<sp/>within<sp/>$form_state[&apos;values&apos;][&apos;relationship_table&apos;]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Quickly<sp/>add<sp/>a<sp/>hidden<sp/>field<sp/>stating<sp/>how<sp/>many<sp/>relationships<sp/>are<sp/>currently<sp/>added.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_relationships&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$num_relationships,</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;num-relationships&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Form<sp/>elements<sp/>for<sp/>adding<sp/>a<sp/>new<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//---------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#autocomplete_path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_ajax/relationship_nodeform/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;/name_to_id&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="537"><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_is_current&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="542"><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_options,</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#autocomplete_path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_ajax/relationship_nodeform/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;/name_to_id&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="552"><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Current<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;rel_action&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Add&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;relationships-add&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtable_ajax_update&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-generic-edit-relationships-table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>When<sp/>this<sp/>button<sp/>is<sp/>clicked,<sp/>the<sp/>form<sp/>will<sp/>be<sp/>validated<sp/>and<sp/>submitted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore,<sp/>we<sp/>set<sp/>custom<sp/>submit<sp/>and<sp/>validate<sp/>functions<sp/>to<sp/>override<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>node<sp/>form<sp/>submit.<sp/><sp/>In<sp/>the<sp/>validate<sp/>function<sp/>we<sp/>validate<sp/>only<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>relationship<sp/>fields<sp/>and<sp/>in<sp/>the<sp/>submit<sp/>we<sp/>add<sp/>them<sp/>to<sp/>the<sp/>chado_relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>array.<sp/>In<sp/>order<sp/>to<sp/>keep<sp/>validate<sp/>errors<sp/>from<sp/>the<sp/>node<sp/>form<sp/>validate<sp/>and<sp/>Drupal</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>required<sp/>errors<sp/>for<sp/>non-relationship<sp/>fields<sp/>preventing<sp/>the<sp/>user<sp/>from<sp/>adding<sp/>relationships<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>#limit_validation_errors<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_add_button_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_add_button_submit&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Limit<sp/>the<sp/>validation<sp/>of<sp/>the<sp/>form<sp/>upon<sp/>clicking<sp/>this<sp/>button<sp/>to<sp/>the<sp/>relationship_table<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>other<sp/>fields<sp/>will<sp/>be<sp/>validated<sp/>(ie:<sp/>no<sp/>fields<sp/>from<sp/>the<sp/>main<sp/>form<sp/>or<sp/>any<sp/>other<sp/>api</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>added<sp/>form).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#limit_validation_errors&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">)<sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>relationship<sp/>table<sp/>results<sp/>are<sp/>not<sp/>discarded.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;admin_message&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$tripal_message,</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>10</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="595"><highlight class="normal">}</highlight></codeline>
<codeline lineno="596"><highlight class="normal"></highlight></codeline>
<codeline lineno="602" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a3d7f3e569b2fadc091582834ca6751b8" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a3d7f3e569b2fadc091582834ca6751b8" kindref="member">chado_add_node_form_relationships_add_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>deal<sp/>with<sp/>autocomplete<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Extract<sp/>the<sp/>base_id<sp/>assuming<sp/>&apos;(###)<sp/>NAME<sp/>FIELD&apos;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/\((\d+)\)<sp/>.*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][subject_name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;You<sp/>need<sp/>to<sp/>select<sp/>the<sp/>subject<sp/>from<sp/>the<sp/>autocomplete<sp/>drop-down&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/\((\d+)\)<sp/>.*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][object_name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;You<sp/>need<sp/>to<sp/>select<sp/>the<sp/>object<sp/>from<sp/>the<sp/>autocomplete<sp/>drop-down&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="624"><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>NOTE:<sp/>The<sp/>only<sp/>way<sp/>to<sp/>specify<sp/>the<sp/>current<sp/>node<sp/>is<sp/>via<sp/>checkbox.<sp/>This<sp/>is<sp/>by</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>design<sp/>since<sp/>guessing<sp/>if<sp/>they<sp/>meant<sp/>the<sp/>current<sp/>node<sp/>by<sp/>name<sp/>is<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>chicken-egg<sp/>problem<sp/>due<sp/>to<sp/>the<sp/>name<sp/>field<sp/>only<sp/>being<sp/>set<sp/>to<sp/>just<sp/>the<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>only<sp/>happens<sp/>once<sp/>it<sp/>has<sp/>been<sp/>determined<sp/>which<sp/>germplasm<sp/>is<sp/>the<sp/>current</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>one.<sp/>Furthermore,<sp/>we<sp/>can&apos;t<sp/>use<sp/>the<sp/>primary<sp/>key<sp/>since<sp/>this<sp/>will<sp/>not<sp/>have</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>been<sp/>set<sp/>on<sp/>insert.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>At<sp/>least<sp/>one<sp/>of<sp/>the<sp/>participants<sp/>must<sp/>be<sp/>the<sp/>current<sp/>node.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">]<sp/>OR<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_is_current&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][object_is_current&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;At<sp/>least<sp/>one<sp/>member<sp/>of<sp/>the<sp/>relationship<sp/>must<sp/>be</highlight></codeline>
<codeline lineno="636"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;.<sp/>This<sp/>is<sp/>specified<sp/>by<sp/>checking<sp/>the<sp/>&quot;Current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;&quot;</highlight></codeline>
<codeline lineno="637"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>checkbox<sp/>for<sp/>either<sp/>the<sp/>subject<sp/>or<sp/>object.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Only<sp/>one<sp/>of<sp/>the<sp/>participants<sp/>may<sp/>be<sp/>the<sp/>current<sp/>node.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>do<sp/>not<sp/>support<sp/>circular<sp/>relationships.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>AND<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_is_current&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][object_is_current&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Only<sp/>one<sp/>member<sp/>of<sp/>the<sp/>relationship<sp/>may<sp/>be</highlight></codeline>
<codeline lineno="645"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;<sp/>in<sp/>order<sp/>to<sp/>avoid<sp/>a<sp/>circular<sp/>relationship.<sp/>If<sp/>you<sp/>really<sp/>meant<sp/>to</highlight></codeline>
<codeline lineno="646"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>add<sp/>a<sp/>circular<sp/>relationship<sp/>then<sp/>check<sp/>the<sp/>&quot;Current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;&quot;<sp/>for<sp/>one<sp/>side<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="647"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>relationship<sp/>and<sp/>enter<sp/>the<sp/>current<sp/>stock<sp/>name<sp/>via<sp/>the<sp/>autocomplete<sp/>for<sp/>the<sp/>other<sp/>side<sp/>of<sp/>the<sp/>relationship.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it<sp/>was<sp/>determined<sp/>current<sp/>via<sp/>checkbox,<sp/>we<sp/>need<sp/>to<sp/>ensure<sp/>the<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>provided<sp/>actually<sp/>matches<sp/>the<sp/>current<sp/>node.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/>AND<sp/>!empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/>AND<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">]<sp/>!=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][$details[</highlight><highlight class="stringliteral">&apos;form_element_name&apos;</highlight><highlight class="normal">]])<sp/>{</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][subject_name&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>name<sp/>you<sp/>supplied<sp/>for<sp/>the<sp/>current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;<sp/>doesn\&apos;t<sp/>match<sp/>the<sp/>actual<sp/>name</highlight></codeline>
<codeline lineno="657"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>of<sp/>this<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;.<sp/>If<sp/>you<sp/>really<sp/>meant<sp/>the<sp/>subject<sp/>should<sp/>be<sp/>the<sp/>current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;,</highlight></codeline>
<codeline lineno="658"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>simply<sp/>leave<sp/>the<sp/>textfield<sp/>empty<sp/>and<sp/>re-add<sp/>this<sp/>relationship.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_is_current&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>AND<sp/>!empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/>AND<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">]<sp/>!=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][$details[</highlight><highlight class="stringliteral">&apos;form_element_name&apos;</highlight><highlight class="normal">]])<sp/>{</highlight></codeline>
<codeline lineno="663"><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][object_name&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;The<sp/>name<sp/>you<sp/>supplied<sp/>for<sp/>the<sp/>current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;<sp/>doesn\&apos;t<sp/>match<sp/>the<sp/>actual<sp/>name</highlight></codeline>
<codeline lineno="666"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>of<sp/>this<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;.<sp/>If<sp/>you<sp/>really<sp/>meant<sp/>the<sp/>object<sp/>should<sp/>be<sp/>the<sp/>current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;,</highlight></codeline>
<codeline lineno="667"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>simply<sp/>leave<sp/>the<sp/>textfield<sp/>empty<sp/>and<sp/>re-add<sp/>this<sp/>relationship.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="669"><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>non-current<sp/>uniquename<sp/>must<sp/>be<sp/>exist<sp/>in<sp/>the<sp/>base<sp/>table<sp/>(subject).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array($details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array($details[</highlight><highlight class="stringliteral">&apos;base_foreign_key&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($result[0]))<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][subject_name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>subject<sp/>must<sp/>be<sp/>the<sp/>unique<sp/>name<sp/>of<sp/>an</highlight></codeline>
<codeline lineno="680"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>existing<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;<sp/>unless<sp/>the<sp/>&quot;Current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;&quot;<sp/>checkbox<sp/>is<sp/>selected&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]};</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="686"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>non-current<sp/>uniquename<sp/>must<sp/>exist<sp/>in<sp/>the<sp/>base<sp/>table<sp/>(object).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_is_current&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array($details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array($details[</highlight><highlight class="stringliteral">&apos;base_foreign_key&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($result[0]))<sp/>{</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][object_name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>object<sp/>must<sp/>be<sp/>the<sp/>unique<sp/>name<sp/>of<sp/>an</highlight></codeline>
<codeline lineno="696"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>existing<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;<sp/>unless<sp/>the<sp/>&quot;Current<sp/>&apos;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&apos;&quot;<sp/>checkbox<sp/>is<sp/>selected&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]};</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>type<sp/>must<sp/>be<sp/>a<sp/>valid<sp/>cvterm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($result[0]))<sp/>{</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][type_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>select<sp/>type<sp/>is<sp/>not<sp/>a<sp/>valid<sp/>controlled<sp/>vocabulary<sp/>term.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;name;</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;relationship_table][new][type_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>select<sp/>a<sp/>type<sp/>of<sp/>relationship&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal">}</highlight></codeline>
<codeline lineno="722"><highlight class="normal"></highlight></codeline>
<codeline lineno="730" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1af94299333456ac6f6d9edd737b3c2395" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1af94299333456ac6f6d9edd737b3c2395" kindref="member">chado_add_node_form_relationships_add_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="734"><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>chado_relationships<sp/>array<sp/>is<sp/>not<sp/>set<sp/>then<sp/>this<sp/>is<sp/>the<sp/>first<sp/>time<sp/>modifying<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>relationship<sp/>table.<sp/>this<sp/>means<sp/>we<sp/>need<sp/>to<sp/>include<sp/>all<sp/>the<sp/>relationships<sp/>from<sp/>the<sp/>db</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a348aad93ab28d145c9d9e7ca57444e78" kindref="member">chado_add_node_form_relationships_create_relationship_formstate_array</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]}-&gt;uniquename))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]}-&gt;uniquename<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;CURRENT&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="742"><highlight class="normal"></highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>details<sp/>for<sp/>the<sp/>new<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>$relationship<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]}-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_foreign_key&apos;</highlight><highlight class="normal">]},</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>NULL,</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;relationship_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;TEMP&apos;</highlight><highlight class="normal"><sp/>.<sp/>uniqid()</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>the<sp/>new<sp/>element<sp/>to<sp/>pick<sp/>up<sp/>the<sp/>values<sp/>from<sp/>the<sp/>previous<sp/>element<sp/>so<sp/>wipe<sp/>them<sp/>out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>$relationship<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]}-&gt;{$details[</highlight><highlight class="stringliteral">&apos;base_foreign_key&apos;</highlight><highlight class="normal">]},</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>NULL,</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;relationship_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;TEMP&apos;</highlight><highlight class="normal"><sp/>.<sp/>uniqid(),</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>the<sp/>new<sp/>element<sp/>to<sp/>pick<sp/>up<sp/>the<sp/>values<sp/>from<sp/>the<sp/>previous<sp/>element<sp/>so<sp/>wipe<sp/>them<sp/>out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/>$key<sp/>=<sp/>$relationship[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$relationship[</highlight><highlight class="stringliteral">&apos;relationship_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">][$key]<sp/>=<sp/>(object)<sp/>$relationship;</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>the<sp/>new<sp/>element<sp/>to<sp/>pick<sp/>up<sp/>the<sp/>values<sp/>from<sp/>the<sp/>previous<sp/>element<sp/>so<sp/>wipe<sp/>them<sp/>out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="781"><highlight class="normal">}</highlight></codeline>
<codeline lineno="782"><highlight class="normal"></highlight></codeline>
<codeline lineno="787" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0236b2ec64f4400f076640df4e94349f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0236b2ec64f4400f076640df4e94349f" kindref="member">chado_add_node_form_relationships_remove_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>validation<sp/>needed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal">}</highlight></codeline>
<codeline lineno="790"><highlight class="normal"></highlight></codeline>
<codeline lineno="796" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1ac5110801efb4d2fb4c47d799e6578ed6" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1ac5110801efb4d2fb4c47d799e6578ed6" kindref="member">chado_add_node_form_relationships_remove_button_submit</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>chado_relationships<sp/>array<sp/>is<sp/>not<sp/>set<sp/>then<sp/>this<sp/>is<sp/>the<sp/>first<sp/>time<sp/>modifying<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>relationship<sp/>table.<sp/>this<sp/>means<sp/>we<sp/>need<sp/>to<sp/>include<sp/>all<sp/>the<sp/>relationships<sp/>from<sp/>the<sp/>db</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a348aad93ab28d145c9d9e7ca57444e78" kindref="member">chado_add_node_form_relationships_create_relationship_formstate_array</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>specified<sp/>relationship<sp/>from<sp/>the<sp/>form<sp/>relationship<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(preg_match(</highlight><highlight class="stringliteral">&apos;/relationships_remove-([^-]+-[^-]+)/&apos;</highlight><highlight class="normal">,$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],$match))<sp/>{</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/>$key<sp/>=<sp/>$match[1];</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($key,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">][$key]);</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="809"><highlight class="normal">}</highlight></codeline>
<codeline lineno="810"><highlight class="normal"></highlight></codeline>
<codeline lineno="828" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a348aad93ab28d145c9d9e7ca57444e78" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a348aad93ab28d145c9d9e7ca57444e78" kindref="member">chado_add_node_form_relationships_create_relationship_formstate_array</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="829"><highlight class="normal"></highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="831"><highlight class="normal"></highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">])<sp/>as<sp/>$type_id)<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type_id<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$type_id])<sp/>as<sp/>$relationship_id)<sp/>{</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref><sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">][$type_id][$relationship_id];</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rel<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;relationship_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$relationship_id,</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$key<sp/>=<sp/>$rel[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/>$rel[</highlight><highlight class="stringliteral">&apos;relationship_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_relationships&apos;</highlight><highlight class="normal">][$key]<sp/>=<sp/>(object)<sp/>$rel;</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="851"><highlight class="normal">}</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="857" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1afbfc7e910e9e475b69aa1b6955702ef6" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1afbfc7e910e9e475b69aa1b6955702ef6" kindref="member">theme_chado_add_node_form_relationships_table</ref>($variables)<sp/>{</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;element&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>unserialize(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="861"><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Subject<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Type&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Object<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_name_field&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rel_action&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Action&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="868"><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>)<sp/>as<sp/>$type_id)<sp/>{</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type_id<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$row<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="873"><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>as<sp/>$fieldname<sp/>=&gt;<sp/>$title)<sp/>{</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($fieldname<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;subject_name&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$fieldname])<sp/>.<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][</highlight><highlight class="stringliteral">&apos;subject_is_current&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>($fieldname<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;object_name&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$fieldname])<sp/>.<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][</highlight><highlight class="stringliteral">&apos;object_is_current&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$fieldname]);</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>$row;</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id])<sp/>as<sp/>$rank)<sp/>{</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$rank][</highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>as<sp/>$fieldname<sp/>=&gt;<sp/>$title)<sp/>{</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$rank][$fieldname]);</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>$row;</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;save_warning&apos;</highlight><highlight class="normal">])<sp/>.<sp/>theme(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/>array(</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>,</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sticky&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/>));</highlight></codeline>
<codeline lineno="907"><highlight class="normal">}</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight></codeline>
<codeline lineno="928" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga64a1a298825f2e5cd5e19587fad1c15c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga64a1a298825f2e5cd5e19587fad1c15c" kindref="member">chado_retrieve_node_form_relationships</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/>$rels<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="930"><highlight class="normal"></highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;relationship_table))<sp/>{</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;relationship_table<sp/>as<sp/>$type_id<sp/>=&gt;<sp/>$elements)<sp/>{</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type_id<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal"><sp/>AND<sp/>$type_id<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($elements<sp/>as<sp/>$rank<sp/>=&gt;<sp/>$relationships)<sp/>{</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rels[$type_id][$rank][</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$relationships[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rels[$type_id][$rank][</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$relationships[</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="941"><highlight class="normal"></highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$rels;</highlight></codeline>
<codeline lineno="943"><highlight class="normal">}</highlight></codeline>
<codeline lineno="944"><highlight class="normal"></highlight></codeline>
<codeline lineno="960" refid="d8/d43/group__tripal__legacy__chado__node__api_1gadf49a9526719dfe4b75346b349592f92" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gadf49a9526719dfe4b75346b349592f92" kindref="member">chado_update_node_form_relationships</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>,<sp/>$details,<sp/>$retrieved_relationships<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="961"><highlight class="normal"></highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/>$relationship_table<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/>$current_id<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="964"><highlight class="normal"></highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;relationship_table)<sp/>AND<sp/>($current_id<sp/>&gt;<sp/>0))<sp/>{</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>whether<sp/>there<sp/>is<sp/>a<sp/>rank<sp/>in<sp/>this<sp/>relationship<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_details<sp/>=<sp/>unserialize(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;relationship_table[</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/>$has_rank<sp/>=<sp/>$form_details[</highlight><highlight class="stringliteral">&apos;table_has_rank&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="970"><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>remove<sp/>existing<sp/>relationships<sp/>links</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gaad9a3b9f75cdf27faac5d05d39d4831d" kindref="member">chado_delete_record</ref>(</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$relationship_table,</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array($form_details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$current_id)</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gaad9a3b9f75cdf27faac5d05d39d4831d" kindref="member">chado_delete_record</ref>(</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$relationship_table,</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array($form_details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$current_id)</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="980"><highlight class="normal"></highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>back<sp/>in<sp/>relationships<sp/>as<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($retrieved_relationships)<sp/>{</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$relationships<sp/>=<sp/>$retrieved_relationships;</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$relationships<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga64a1a298825f2e5cd5e19587fad1c15c" kindref="member">chado_retrieve_node_form_relationships</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($relationships<sp/>as<sp/>$type_id<sp/>=&gt;<sp/>$ranks)<sp/>{</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($ranks<sp/>as<sp/>$rank<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>)<sp/>{</highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id,</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="996"><highlight class="normal"></highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>the<sp/>current<sp/>id<sp/>if<sp/>not<sp/>already</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>usually<sp/>only<sp/>necessary<sp/>in<sp/>an<sp/>insert</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[$form_details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]]))<sp/>{</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[$form_details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]]<sp/>=<sp/>$current_id;</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[$form_details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]]))<sp/>{</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[$form_details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]]<sp/>=<sp/>$current_id;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"></highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($has_rank)<sp/>{</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>that<sp/>the<sp/>rank<sp/>is<sp/>Set<sp/>&amp;<sp/>Current</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rank_select<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga58c9cf065ae5581e5c8cb43b32ff92b4" kindref="member">chado_get_table_max_rank</ref>(</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relationship_table,</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_details[</highlight><highlight class="stringliteral">&apos;subject_field_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_details[</highlight><highlight class="stringliteral">&apos;object_field_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$rank_select<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"></highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success_link<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relationship_table,</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"></highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1028"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"></highlight></codeline>
<codeline lineno="1038" refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0cca21cb3cf96fd69ab490ba7b6545b3" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0cca21cb3cf96fd69ab490ba7b6545b3" kindref="member">chado_add_node_form_relationships_name_to_id_callback</ref>($base_table,<sp/>$name_field,<sp/>$string)<sp/>{</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/>$matches<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"></highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/>$base_key<sp/>=<sp/>$base_table.</highlight><highlight class="stringliteral">&apos;_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"></highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>the<sp/>chado<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/>$chado<sp/>=<sp/><ref refid="da/ddd/group__tripal__chado__DEPRECATED__api_1ga6b60657960d2ea45c1c8dddc6970d03e" kindref="member">tripal_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"></highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/>db_select($chado<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table,<sp/></highlight><highlight class="charliteral">&apos;b&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="charliteral">&apos;b&apos;</highlight><highlight class="normal">,<sp/>array($base_key,<sp/>$name_field))</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition($name_field,<sp/></highlight><highlight class="charliteral">&apos;%&apos;</highlight><highlight class="normal"><sp/>.<sp/>db_like($string)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;%&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;LIKE&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"></highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/>$result<sp/>=<sp/>$query-&gt;execute();</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"></highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>save<sp/>the<sp/>query<sp/>to<sp/>matches</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($result<sp/>as<sp/>$row)<sp/>{</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strlen($row-&gt;{$name_field})<sp/>&gt;<sp/>50)<sp/>{</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$key<sp/>=<sp/></highlight><highlight class="charliteral">&apos;(&apos;</highlight><highlight class="normal">.$row-&gt;{$base_key}.</highlight><highlight class="stringliteral">&apos;)<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>substr($row-&gt;{$name_field},<sp/>0,<sp/>50)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;...&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$key<sp/>=<sp/></highlight><highlight class="charliteral">&apos;(&apos;</highlight><highlight class="normal">.$row-&gt;{$base_key}.</highlight><highlight class="stringliteral">&apos;)<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$row-&gt;{$name_field};</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/>$matches[$key]<sp/>=<sp/>check_plain($row-&gt;{$name_field});</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"></highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>for<sp/>JS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/>drupal_json_output($matches);</highlight></codeline>
<codeline lineno="1065"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="legacy/tripal_core/api/tripal_core.chado_nodes.relationships.api.inc"/>
  </compounddef>
</doxygen>
