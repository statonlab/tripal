<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="df/da1/tripal__chado_8install_8inc" kind="file" language="PHP">
    <compoundname>tripal_chado.install.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a0156b7552c6bde2578894a4c8b9d01f0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_install_chado</definition>
        <argsstring>($action, TripalJob $job=NULL)</argsstring>
        <name>tripal_chado_install_chado</name>
        <param>
          <declname>$action</declname>
        </param>
        <param>
          <type><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref></type>
          <declname>$job</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Install Chado Schema </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="205" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="205" bodyend="257"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a7ec4966c74aa8343406ba490cf9cc321" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_install_chado_1_11</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_install_chado_1_11</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="324" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="324" bodyend="352"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1ad7a04a694228829784945e22c4f4ecc1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_install_chado_1_2</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_install_chado_1_2</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Installs Chado v1.2. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="293" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="293" bodyend="320"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a49cf1609ea62c44c09f68e65e5d3c880" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_install_chado_1_3</definition>
        <argsstring>(TripalJob $job=NULL)</argsstring>
        <name>tripal_chado_install_chado_1_3</name>
        <param>
          <type><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref></type>
          <declname>$job</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Installs Chado v1.3. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="262" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="262" bodyend="289"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1abfcdb0d424c71dead69c52569131a879" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_install_done</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_install_done</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Finish the Chado Schema Installation </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="815" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="815" bodyend="819"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_install_sql</definition>
        <argsstring>($sql_file)</argsstring>
        <name>tripal_chado_install_sql</name>
        <param>
          <declname>$sql_file</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Execute the provided SQL</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$sql_file</parametername>
</parameternamelist>
<parameterdescription>
<para>Contains SQL statements to be executed </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="586" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="586" bodyend="808"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1ad93b874915a666dbb96a37eb2544d9b8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_load_drush_submit</definition>
        <argsstring>($version)</argsstring>
        <name>tripal_chado_load_drush_submit</name>
        <param>
          <declname>$version</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Submit Load Chado Schema Form </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="194" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="194" bodyend="199"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1ad6ab2f7598b7d4074ab46cac799b1ce4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_load_form</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>tripal_chado_load_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Load Chado Schema Form </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="12" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="12" bodyend="120"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1ae6c39a1cd62c811d8fb4786f8b31a22e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_load_form_ajax_callback</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>tripal_chado_load_form_ajax_callback</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Ajax callback function for the gensas_job_view_panel_form.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="128" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="128" bodyend="131"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a279b76d7f41d64d0bc746a002de3f841" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_load_form_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_chado_load_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Submit Load Chado Schema Form </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="179" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="179" bodyend="187"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a80d3340c911c57a5e66dd675793e38c3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_load_form_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_chado_load_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="133" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="133" bodyend="173"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1ac83b10ef16d0891291fbdbe9e7e138a2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_reset_chado_schema</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_reset_chado_schema</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Reset the Chado Schema This drops the current chado and chado-related schema and re-creates it </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="531" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="531" bodyend="576"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a5626a992f72c2caefab546d7cbe3dd3b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_upgrade_chado_1_11_to_1_2</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_upgrade_chado_1_11_to_1_2</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Upgrades Chado from v1.11 to v1.2 </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="503" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="503" bodyend="523"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1a781d25bb1d74858adb2b100c0e15a211" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_upgrade_chado_1_2_to_1_3</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_upgrade_chado_1_2_to_1_3</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Upgrades Chado from v1.2 to v1.3 </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="356" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="356" bodyend="376"/>
      </memberdef>
      <memberdef kind="function" id="df/da1/tripal__chado_8install_8inc_1abc147d50affbba6356b4eabcc18dc4a9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_chado_upgrade_chado_1_2_to_1_3_pre_alter</definition>
        <argsstring>()</argsstring>
        <name>tripal_chado_upgrade_chado_1_2_to_1_3_pre_alter</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Upgrade custom tables that may match the tables now in Chado v1.3.</para><para>There were many new tables that were added to Chado v1.3 that were suggested by the Chado user community. Some of those were Tripal users. Therefore, to help these Tripal users upgrade more seemlessly this function checks if those custom tables already exists, and if so updates them as best it can to match. At a minimum it will create the table if it doesn&apos;t exist and if it does it will change the primary keys and foreign keys to be big ints. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/tripal_chado.install.inc" line="389" column="1" bodyfile="tripal_chado/includes/tripal_chado.install.inc" bodystart="389" bodyend="498"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Functions to install chado schema through Drupal </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="12" refid="df/da1/tripal__chado_8install_8inc_1ad6ab2f7598b7d4074ab46cac799b1ce4" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1ad6ab2f7598b7d4074ab46cac799b1ce4" kindref="member">tripal_chado_load_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>force<sp/>the<sp/>version<sp/>of<sp/>Chado<sp/>to<sp/>be<sp/>set<sp/>properly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/>$real_version<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" kindref="member">chado_get_version</ref>(TRUE);</highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>effective<sp/>version.<sp/><sp/>Pass<sp/>true<sp/>as<sp/>second<sp/>argument</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>warn<sp/>the<sp/>user<sp/>if<sp/>the<sp/>current<sp/>version<sp/>is<sp/>not<sp/>compatible</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/>$version<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" kindref="member">chado_get_version</ref>(FALSE,<sp/>TRUE);</highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state))<sp/>{</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Upgrade<sp/>Chado<sp/>v1.2<sp/>to<sp/>v1.3&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tables_list<sp/>=<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;analysis_cvterm&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;analysis_dbxref&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;analysis_pub&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;analysis_relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;contactprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dbprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;feature_contact&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featuremap_contact&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featuremap_dbxref&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featuremap_organism&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featuremapprop&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featureposprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_contact&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_expression&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_expressionprop&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_featureprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_relationship_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;nd_experiment_analysis&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_cvterm&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;organism_cvtermprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;organism_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;organism_relationship&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organismprop_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;phenotypeprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;phylotreeprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project_analysis&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="30"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;project_dbxref&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project_feature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project_stock&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pubauthor_contact&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stock_feature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;stock_featuremap&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;stock_library&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;stockcollection_db&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$items<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;PostgreSQL<sp/>version<sp/>9.1<sp/>is<sp/>required<sp/>to<sp/>perform<sp/>this<sp/>upgrade.<sp/>If<sp/>your<sp/>Tripal</highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>site<sp/>uses<sp/>an<sp/>older<sp/>version<sp/>please<sp/>upgrade<sp/>before<sp/>proceeding.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;A<sp/>major<sp/>change<sp/>between<sp/>Chado<sp/>v1.2<sp/>and<sp/>v1.3<sp/>is<sp/>that<sp/>primary<sp/>and<sp/>foreign</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>keys<sp/>were<sp/>upgraded<sp/>from<sp/>integers<sp/>to<sp/>big<sp/>integers.<sp/>If<sp/>your<sp/>site<sp/>has<sp/>custom</highlight></codeline>
<codeline lineno="37"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>materialized<sp/>views<sp/>that<sp/>will<sp/>hold<sp/>data<sp/>derived<sp/>from<sp/>fields<sp/>changed<sp/>to</highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>big<sp/>integers<sp/>then<sp/>you<sp/>may<sp/>need<sp/>to<sp/>alter<sp/>the<sp/>views<sp/>to<sp/>change<sp/>the<sp/>fields</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>from<sp/>integers<sp/>to<sp/>big<sp/>integers<sp/>and<sp/>repopulate<sp/>those<sp/>views.<sp/>If<sp/>you<sp/>have<sp/>not</highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>added<sp/>any<sp/>materialized<sp/>views<sp/>you<sp/>can<sp/>ignore<sp/>this<sp/>issue.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Custom<sp/>PL/pgSQL<sp/>functions<sp/>that<sp/>expect<sp/>primary<sp/>and</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreign<sp/>key<sp/>fields<sp/>to<sp/>be<sp/>integers<sp/>will<sp/>not<sp/>work<sp/>after<sp/>the<sp/>upgrade.</highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Those<sp/>functions<sp/>will<sp/>need<sp/>to<sp/>be<sp/>altered<sp/>to<sp/>accept<sp/>big<sp/>integers.<sp/>If<sp/>you</highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>do<sp/>not<sp/>have<sp/>any<sp/>custom<sp/>PL/pgSQL<sp/>functions<sp/>you<sp/>can<sp/>ignore<sp/>this<sp/>issue.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;PostgreSQL<sp/>Views<sp/>that<sp/>use<sp/>fields<sp/>that<sp/>are<sp/>converted<sp/>to<sp/>big</highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>integers<sp/>will<sp/>cause<sp/>this<sp/>upgrade<sp/>to<sp/>fail.<sp/><sp/>You<sp/>must<sp/>first<sp/>remove</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>those<sp/>views,<sp/>perform<sp/>the<sp/>upgrade<sp/>and<sp/>then<sp/>recreate<sp/>them<sp/>with<sp/>the</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>appropriate<sp/>fields<sp/>change<sp/>to<sp/>big<sp/>integers.<sp/>If<sp/>you<sp/>do<sp/>not<sp/>have<sp/>custom</highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PostgreSQL<sp/>Views<sp/>you<sp/>can<sp/>ignore<sp/>this<sp/>issue.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Several<sp/>new<sp/>tables<sp/>were<sp/>added<sp/>to<sp/>Chado<sp/>v1.3.<sp/><sp/>However,<sp/>some<sp/>groups<sp/>have</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>added<sp/>these<sp/>tables<sp/>to<sp/>their<sp/>Chado<sp/>v1.2<sp/>installation.<sp/><sp/>The<sp/>Tripal<sp/>upgrader</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>will<sp/>alter<sp/>the<sp/>primary<sp/>and<sp/>foreign<sp/>keys<sp/>of<sp/>those<sp/>tables<sp/>to<sp/>be<sp/>&quot;bigints&quot;</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>they<sp/>already<sp/>exist<sp/>but<sp/>will<sp/>otherwise<sp/>leave<sp/>them<sp/>the<sp/>same.<sp/><sp/>You<sp/>should</highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>verify<sp/>that<sp/>any<sp/>tables<sp/>with<sp/>Chado<sp/>v1.3<sp/>names<sp/>correctly<sp/>match<sp/>the<sp/>v1.3<sp/>schema.</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Otherwise<sp/>you<sp/>may<sp/>have<sp/>problems<sp/>using<sp/>Tripal.<sp/>If<sp/>you<sp/>have<sp/>not<sp/>added<sp/>any</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Chado<sp/>v1.3<sp/>tables<sp/>to<sp/>your<sp/>Chado<sp/>v1.2<sp/>database<sp/>you<sp/>can<sp/>ignore<sp/>this<sp/>issue.</highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>These<sp/>are<sp/>the<sp/>newly<sp/>added<sp/>tables:<sp/><sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tables_list<sp/><sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$list<sp/>=<sp/>theme_item_list(array(</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;items&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$items,</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ul&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Please<sp/>note:<sp/>the<sp/>upgrade<sp/>of<sp/>Chado<sp/>from<sp/>v1.2<sp/>to<sp/>v1.3<sp/>may</highlight></codeline>
<codeline lineno="67"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>require<sp/>several<sp/>fixes<sp/>to<sp/>your<sp/>database.<sp/>Please<sp/>review<sp/>the<sp/>following</highlight></codeline>
<codeline lineno="68"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>list<sp/>to<sp/>ensure<sp/>a<sp/>safe<sp/>upgrade.<sp/>The<sp/>Tripal<sp/>upgrader<sp/>is</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>not<sp/>able<sp/>to<sp/>fix<sp/>these<sp/>problems<sp/>automatically:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$list,<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>Chado<sp/>v1.3&quot;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>Chado<sp/>v1.2&quot;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>Chado<sp/>v1.11&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Please<sp/>note:<sp/>if<sp/>Chado<sp/>is<sp/>already<sp/>installed<sp/>it<sp/>will</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>removed<sp/>and<sp/>recreated<sp/>and<sp/>all<sp/>data<sp/>will<sp/>be<sp/>lost.<sp/>If<sp/>this<sp/>is</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>desired<sp/>or<sp/>if<sp/>this<sp/>is<sp/>the<sp/>first<sp/>time<sp/>Chado<sp/>has<sp/>been<sp/>installed</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>you<sp/>can<sp/>ignore<sp/>this<sp/>issue.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;current_version&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;Current<sp/>installed<sp/>version<sp/>of<sp/>Chado:&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$real_version,</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;radios&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Installation/Upgrade<sp/>Action&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Install<sp/>Chado<sp/>v1.3&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;New<sp/>Install<sp/>of<sp/>Chado<sp/>v1.3<sp/>(erases<sp/>all<sp/>existing<sp/>Chado<sp/>data<sp/>if<sp/>Chado<sp/>already<sp/>exists)&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Upgrade<sp/>Chado<sp/>v1.2<sp/>to<sp/>v1.3&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Upgrade<sp/>existing<sp/>Chado<sp/>v1.2<sp/>to<sp/>v1.3<sp/>(no<sp/>data<sp/>is<sp/>lost)&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Install<sp/>Chado<sp/>v1.2&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;New<sp/>Install<sp/>of<sp/>Chado<sp/>v1.2<sp/>(erases<sp/>all<sp/>existing<sp/>Chado<sp/>data<sp/>if<sp/>Chado<sp/>already<sp/>exists)&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Upgrade<sp/>Chado<sp/>v1.11<sp/>to<sp/>v1.2&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Upgrade<sp/>existing<sp/>Chado<sp/>v1.11<sp/>to<sp/>v1.2<sp/>(no<sp/>data<sp/>is<sp/>lost)&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Install<sp/>Chado<sp/>v1.11&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;New<sp/>Install<sp/>of<sp/>Chado<sp/>v1.11<sp/>(erases<sp/>all<sp/>existing<sp/>Chado<sp/>data<sp/>if<sp/>Chado<sp/>already<sp/>exists)&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Select<sp/>an<sp/>action<sp/>to<sp/>perform.<sp/>If<sp/>you<sp/>want<sp/>to<sp/>install<sp/>Chado<sp/>all<sp/>other<sp/>Tripal<sp/>modules<sp/>must<sp/>not<sp/>be<sp/>installed.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_chado_load_form_ajax_callback&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_load_form&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;&lt;div&gt;&lt;font<sp/>color=\&quot;red\&quot;&gt;WARNING:&lt;/font&gt;&quot;</highlight><highlight class="normal"><sp/>.<sp/>t(</highlight><highlight class="stringliteral">&apos;A<sp/>new<sp/>install<sp/>of</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>Chado<sp/>will<sp/>remove<sp/>and<sp/>recreate<sp/>the<sp/>Chado<sp/>database<sp/>if<sp/>it<sp/>already<sp/>exists.&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;button&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Install/Upgrade<sp/>Chado&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;tripal_chado_load_form&quot;&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="120"><highlight class="normal">}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="128" refid="df/da1/tripal__chado_8install_8inc_1ae6c39a1cd62c811d8fb4786f8b31a22e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1ae6c39a1cd62c811d8fb4786f8b31a22e" kindref="member">tripal_chado_load_form_ajax_callback</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="131"><highlight class="normal">}</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133" refid="df/da1/tripal__chado_8install_8inc_1a80d3340c911c57a5e66dd675793e38c3" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a80d3340c911c57a5e66dd675793e38c3" kindref="member">tripal_chado_load_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>do<sp/>not<sp/>want<sp/>to<sp/>allow<sp/>re-installation<sp/>of<sp/>Chado<sp/>if<sp/>other</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Tripal<sp/>modules<sp/>are<sp/>installed.<sp/><sp/>This<sp/>is<sp/>because<sp/>the<sp/>install<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>those<sp/>modules<sp/>may<sp/>add<sp/>content<sp/>to<sp/>Chado<sp/>and<sp/>reinstalling<sp/>Chado</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>removes<sp/>that<sp/>content<sp/>which<sp/>may<sp/>break<sp/>the<sp/>modules.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>Chado<sp/>v1.3&quot;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>Chado<sp/>v1.2&quot;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>Chado<sp/>v1.11&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>$modules<sp/>=<sp/>system_get_info(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>tripal_chado_views<sp/>module<sp/>should<sp/>not<sp/>be<sp/>included<sp/>as<sp/>it&apos;s<sp/>a<sp/>required</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>dependency<sp/>of<sp/>tripal_chado</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($modules[</highlight><highlight class="stringliteral">&apos;tripal_chado_views&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>$list<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$mname<sp/>=&gt;<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;dependencies&apos;</highlight><highlight class="normal">,<sp/>$module)<sp/>and<sp/>in_array(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/>$module[</highlight><highlight class="stringliteral">&apos;dependencies&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$list[]<sp/>=<sp/>$module[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>($mname)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($list)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&quot;action_to_do&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Chado<sp/>cannot<sp/>be<sp/>installed<sp/>while<sp/>other<sp/>Tripal<sp/>modules</highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>are<sp/>enabled.<sp/><sp/>You<sp/>must<sp/>fully<sp/>uninstall<sp/>the<sp/>following<sp/>modules<sp/>if<sp/>you</highlight></codeline>
<codeline lineno="155"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>would<sp/>like<sp/>to<sp/>install<sp/>or<sp/>re-install<sp/>chado.&lt;br&gt;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>implode(</highlight><highlight class="stringliteral">&quot;&lt;br&gt;&quot;</highlight><highlight class="normal">,<sp/>$list));</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Upgrade<sp/>Chado<sp/>v1.11<sp/>to<sp/>v1.2&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>we<sp/>are<sp/>already<sp/>not<sp/>at<sp/>v1.2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/>$real_version<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" kindref="member">chado_get_version</ref>(TRUE);</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($real_version<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;1.2&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&quot;action_to_do&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;You<sp/>are<sp/>already<sp/>at<sp/>v1.2.<sp/><sp/>There<sp/>is<sp/>no<sp/>need<sp/>to<sp/>upgrade.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;Upgrade<sp/>Chado<sp/>v1.2<sp/>to<sp/>v1.3&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>we<sp/>are<sp/>already<sp/>not<sp/>at<sp/>v1.3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>$real_version<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" kindref="member">chado_get_version</ref>(TRUE);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($real_version<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;1.3&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&quot;action_to_do&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;You<sp/>are<sp/>already<sp/>at<sp/>v1.3.<sp/><sp/>There<sp/>is<sp/>no<sp/>need<sp/>to<sp/>upgrade.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="173"><highlight class="normal">}</highlight></codeline>
<codeline lineno="179" refid="df/da1/tripal__chado_8install_8inc_1a279b76d7f41d64d0bc746a002de3f841" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a279b76d7f41d64d0bc746a002de3f841" kindref="member">tripal_chado_load_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/>$action_to_do<sp/>=<sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;action_to_do&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array($action_to_do);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/>$includes<sp/>=<sp/>array(module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;includes/tripal_chado.install&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>($action_to_do,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_install_chado&apos;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="187"><highlight class="normal">}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="194" refid="df/da1/tripal__chado_8install_8inc_1ad93b874915a666dbb96a37eb2544d9b8" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1ad93b874915a666dbb96a37eb2544d9b8" kindref="member">tripal_chado_load_drush_submit</ref>($version)<sp/>{</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array($version);</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/>$includes<sp/>=<sp/>array(module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;includes/tripal_chado.install&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>($version,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_install_chado&apos;</highlight><highlight class="normal">,<sp/>$args,<sp/>1,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="199"><highlight class="normal">}</highlight></codeline>
<codeline lineno="205" refid="df/da1/tripal__chado_8install_8inc_1a0156b7552c6bde2578894a4c8b9d01f0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a0156b7552c6bde2578894a4c8b9d01f0" kindref="member">tripal_chado_install_chado</ref>($action,<sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref><sp/>$job<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/>$vsql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="208"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>INSERT<sp/>INTO<sp/>{chadoprop}<sp/>(type_id,<sp/>value)</highlight></codeline>
<codeline lineno="209"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>VALUES<sp/>(</highlight></codeline>
<codeline lineno="210"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(SELECT<sp/>cvterm_id</highlight></codeline>
<codeline lineno="211"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="212"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>on<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="213"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>CV.name<sp/>=<sp/>&apos;chado_properties&apos;<sp/>AND<sp/>CVT.name<sp/>=<sp/>&apos;version&apos;),</highlight></codeline>
<codeline lineno="214"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:version)</highlight></codeline>
<codeline lineno="215"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/>$vusql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="218"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>UPDATE<sp/>{chadoprop}</highlight></codeline>
<codeline lineno="219"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SET<sp/>value<sp/>=<sp/>:version</highlight></codeline>
<codeline lineno="220"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>type_id<sp/>=<sp/>(SELECT<sp/>cvterm_id</highlight></codeline>
<codeline lineno="221"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="222"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>on<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="223"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>CV.name<sp/>=<sp/>&apos;chado_properties&apos;<sp/>AND<sp/>CVT.name<sp/>=<sp/>&apos;version&apos;)</highlight></codeline>
<codeline lineno="224"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($action<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Install<sp/>Chado<sp/>v1.3&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a49cf1609ea62c44c09f68e65e5d3c880" kindref="member">tripal_chado_install_chado_1_3</ref>();</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($vsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:version&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;1.3&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($action<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Upgrade<sp/>Chado<sp/>v1.2<sp/>to<sp/>v1.3&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a781d25bb1d74858adb2b100c0e15a211" kindref="member">tripal_chado_upgrade_chado_1_2_to_1_3</ref>();</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($vusql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:version&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;1.3&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($action<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Install<sp/>Chado<sp/>v1.2&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1ad7a04a694228829784945e22c4f4ecc1" kindref="member">tripal_chado_install_chado_1_2</ref>();</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($vsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:version&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;1.2&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($action<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Upgrade<sp/>Chado<sp/>v1.11<sp/>to<sp/>v1.2&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a5626a992f72c2caefab546d7cbe3dd3b" kindref="member">tripal_chado_upgrade_chado_1_11_to_1_2</ref>();</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($vsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:version&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;1.2&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($action<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Install<sp/>Chado<sp/>v1.11&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a7ec4966c74aa8343406ba490cf9cc321" kindref="member">tripal_chado_install_chado_1_11</ref>();</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1abfcdb0d424c71dead69c52569131a879" kindref="member">tripal_chado_install_done</ref>();</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage(),<sp/>array(</highlight><highlight class="stringliteral">&apos;print&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE));</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal">}</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="262" refid="df/da1/tripal__chado_8install_8inc_1a49cf1609ea62c44c09f68e65e5d3c880" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a49cf1609ea62c44c09f68e65e5d3c880" kindref="member">tripal_chado_install_chado_1_3</ref>(<ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref><sp/>$job<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>path<sp/>to<sp/>the<sp/>schema<sp/>and<sp/>init<sp/>SQL<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/>$schema_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/default_schema-1.3.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/>$init_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/initialize-1.3.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Erase<sp/>the<sp/>Chado<sp/>schema<sp/>if<sp/>it<sp/>exists<sp/>and<sp/>perform<sp/>the<sp/>install.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="df/da1/tripal__chado_8install_8inc_1ac83b10ef16d0891291fbdbe9e7e138a2" kindref="member">tripal_chado_reset_chado_schema</ref>())<sp/>{</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($schema_file);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>of<sp/>Chado<sp/>v1.3<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Successful!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Installation<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($init_file);</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>of<sp/>Chado<sp/>v1.3<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Successful.\nInstallation<sp/>Complete\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Installation<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;ERROR:<sp/>cannot<sp/>install<sp/>chado.<sp/><sp/>Please<sp/>check<sp/>database<sp/>permissions&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293" refid="df/da1/tripal__chado_8install_8inc_1ad7a04a694228829784945e22c4f4ecc1" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1ad7a04a694228829784945e22c4f4ecc1" kindref="member">tripal_chado_install_chado_1_2</ref>()<sp/>{</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>path<sp/>to<sp/>the<sp/>schema<sp/>and<sp/>init<sp/>SQL<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>$schema_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/default_schema-1.2.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/>$init_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/initialize-1.2.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Erase<sp/>the<sp/>Chado<sp/>schema<sp/>if<sp/>it<sp/>exists<sp/>and<sp/>perform<sp/>the<sp/>install.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="df/da1/tripal__chado_8install_8inc_1ac83b10ef16d0891291fbdbe9e7e138a2" kindref="member">tripal_chado_reset_chado_schema</ref>())<sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($schema_file);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>of<sp/>Chado<sp/>v1.2<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Successful!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Installation<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($init_file);</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>of<sp/>Chado<sp/>v1.2<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Successful.\nInstallation<sp/>Complete\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Installation<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;ERROR:<sp/>cannot<sp/>install<sp/>chado.<sp/><sp/>Please<sp/>check<sp/>database<sp/>permissions&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="320"><highlight class="normal">}</highlight></codeline>
<codeline lineno="324" refid="df/da1/tripal__chado_8install_8inc_1a7ec4966c74aa8343406ba490cf9cc321" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a7ec4966c74aa8343406ba490cf9cc321" kindref="member">tripal_chado_install_chado_1_11</ref>()<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>path<sp/>to<sp/>the<sp/>schema<sp/>and<sp/>init<sp/>SQL<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/>$schema_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/default_schema-1.11.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/>$init_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/initialize-1.11.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Erase<sp/>the<sp/>Chado<sp/>schema<sp/>if<sp/>it<sp/>exists<sp/>and<sp/>perform<sp/>the<sp/>install.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="df/da1/tripal__chado_8install_8inc_1ac83b10ef16d0891291fbdbe9e7e138a2" kindref="member">tripal_chado_reset_chado_schema</ref>())<sp/>{</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($schema_file);</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>of<sp/>Chado<sp/>v1.11<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Successful!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Installation<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($init_file);</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Install<sp/>of<sp/>Chado<sp/>v1.11<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Successful.\nInstallation<sp/>Complete!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Installation<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;ERROR:<sp/>cannot<sp/>install<sp/>chado.<sp/><sp/>Please<sp/>check<sp/>database<sp/>permissions&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="352"><highlight class="normal">}</highlight></codeline>
<codeline lineno="356" refid="df/da1/tripal__chado_8install_8inc_1a781d25bb1d74858adb2b100c0e15a211" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a781d25bb1d74858adb2b100c0e15a211" kindref="member">tripal_chado_upgrade_chado_1_2_to_1_3</ref>()<sp/>{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Upgrade<sp/>some<sp/>of<sp/>the<sp/>custom<sp/>tables<sp/>that<sp/>Tripal<sp/>created<sp/>that<sp/>are<sp/>now<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Chado<sp/>v1.3.<sp/><sp/>We&apos;ll<sp/>do<sp/>this<sp/>ahead<sp/>of<sp/>time<sp/>because<sp/>the<sp/>upgrade<sp/>script<sp/>won&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>upgrade<sp/>tables<sp/>if<sp/>they<sp/>already<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Checking<sp/>for<sp/>existing<sp/>v1.3<sp/>tables<sp/>in<sp/>v1.2<sp/>and<sp/>fixing<sp/>bigints...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1abc147d50affbba6356b4eabcc18dc4a9" kindref="member">tripal_chado_upgrade_chado_1_2_to_1_3_pre_alter</ref>();</highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>path<sp/>to<sp/>the<sp/>diff<sp/>schema<sp/>and<sp/>upgrade<sp/>SQL<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Incorporating<sp/>additional<sp/>changes...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/>$diff_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/default_schema-1.2-1.3-diff.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($diff_file);</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Upgrade<sp/>from<sp/>v1.2<sp/>to<sp/>v1.3<sp/>Successful!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Upgrade<sp/>problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="376"><highlight class="normal">}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="389" refid="df/da1/tripal__chado_8install_8inc_1abc147d50affbba6356b4eabcc18dc4a9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1abc147d50affbba6356b4eabcc18dc4a9" kindref="member">tripal_chado_upgrade_chado_1_2_to_1_3_pre_alter</ref>()<sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Include<sp/>the<sp/>Chado<sp/>v1.3<sp/>schema<sp/>definitions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/>module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;/api/tripal_chado.schema_v1.3.api&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>list<sp/>of<sp/>new<sp/>tables<sp/>in<sp/>Chado<sp/>v1.3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/>$new_tables<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;analysis_cvterm&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;analysis_dbxref&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;analysis_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;analysis_relationship&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;contactprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;dbprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;feature_contact&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featuremap_contact&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featuremap_dbxref&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featuremap_organism&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featuremapprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;featureposprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_contact&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_expression&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_expressionprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_featureprop&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;library_relationship_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;nd_experiment_analysis&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_cvterm&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;organism_cvtermprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;organism_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;organism_relationship&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organismprop_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;phenotypeprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;phylotreeprop&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project_analysis&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;project_dbxref&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project_feature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project_stock&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pubauthor_contact&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stock_feature&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;stock_featuremap&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;stock_library&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;stockcollection_db&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>name<sp/>of<sp/>the<sp/>chado<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/>$chado_schema<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>the<sp/>new<sp/>Chado<sp/>tables<sp/>and<sp/>create<sp/>them<sp/>or<sp/>if<sp/>they<sp/>already</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>exist<sp/>then<sp/>update<sp/>them.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($new_tables<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>schema<sp/>for<sp/>this<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/>$function<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_chado_schema_v1_3_&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/>$schema<sp/>=<sp/>$function();</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>table<sp/>exists<sp/>then<sp/>fix<sp/>the<sp/>pkeys<sp/>and<sp/>fkeys.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>))<sp/>{</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>primary<sp/>key<sp/>fields<sp/>to<sp/>be<sp/>bigints.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1ab2303c817e3b402b77b7f99627b9c319" kindref="member">$fields</ref><sp/>=<sp/>$schema[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1ab2303c817e3b402b77b7f99627b9c319" kindref="member">$fields</ref><sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$field)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;serial&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1ga6b0a91d47d38c3239f05ff029c6ceb27" kindref="member">chado_column_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$field_name))<sp/>{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;ALTER<sp/>TABLE<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}<sp/>ALTER<sp/>COLUMN<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field_name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>TYPE<sp/>bigint&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>alter<sp/>primary<sp/>key<sp/>to<sp/>bigint:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field_name);</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>foreign<sp/>key<sp/>fields<sp/>to<sp/>be<sp/>bigints.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$fkeys<sp/>=<sp/>$schema[</highlight><highlight class="stringliteral">&apos;foreign<sp/>keys&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($fkeys<sp/>as<sp/>$fktable<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($details[</highlight><highlight class="stringliteral">&apos;columns&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$leftkey<sp/>=&gt;<sp/>$rightkey)<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1ga6b0a91d47d38c3239f05ff029c6ceb27" kindref="member">chado_column_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$leftkey))<sp/>{</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;ALTER<sp/>TABLE<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}<sp/>ALTER<sp/>COLUMN<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$leftkey<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>TYPE<sp/>bigint&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql);</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>alter<sp/>foreign<sp/>key<sp/>to<sp/>bigint:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$leftkey);</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>create<sp/>the<sp/>sequences<sp/>if<sp/>they<sp/>don&apos;t<sp/>already<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/>$sequences<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;analysis_cvterm_analysis_cvterm_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;analysis_dbxref_analysis_dbxref_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;analysis_pub_analysis_pub_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;analysis_relationship_analysis_relationship_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;contactprop_contactprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbprop_dbprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;feature_contact_feature_contact_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featuremap_contact_featuremap_contact_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featuremap_dbxref_featuremap_dbxref_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featuremap_organism_featuremap_organism_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featuremapprop_featuremapprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;featureposprop_featureposprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_contact_library_contact_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_expression_library_expression_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_expressionprop_library_expressionprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_featureprop_library_featureprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_relationship_library_relationship_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;library_relationship_pub_library_relationship_pub_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;nd_experiment_analysis_nd_experiment_analysis_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_cvterm_organism_cvterm_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_cvtermprop_organism_cvtermprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_pub_organism_pub_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_relationship_organism_relationship_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organismprop_pub_organismprop_pub_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;phenotypeprop_phenotypeprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;phylotreeprop_phylotreeprop_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;project_analysis_project_analysis_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;project_dbxref_project_dbxref_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;project_feature_project_feature_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;project_stock_project_stock_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pubauthor_contact_pubauthor_contact_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stock_feature_stock_feature_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stock_featuremap_stock_featuremap_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stock_library_stock_library_id_seq&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;stockcollection_db_stockcollection_db_id_seq&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($sequences<sp/>as<sp/>$sequence)<sp/>{</highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>add<sp/>in<sp/>the<sp/>sequences<sp/>if<sp/>they<sp/>don&apos;t<sp/>already<sp/>exist.<sp/>There<sp/>is<sp/>no</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>PostgreSQL<sp/>&apos;CREATE<sp/>SEQUENCE<sp/>IF<sp/>NOT<sp/>EXIST&apos;<sp/>so<sp/>we&apos;re<sp/>forced<sp/>to<sp/>do<sp/>it<sp/>here</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>these<sp/>create<sp/>statements<sp/>were<sp/>removed<sp/>from<sp/>the<sp/>diff<sp/>upgrade<sp/>file.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="d4/d51/group__tripal__chado__schema__api_1ga8c2e920a0173ad23e39efc5260aa70d5" kindref="member">chado_sequence_exists</ref>($sequence))<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CREATE<sp/>SEQUENCE<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$sequence<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>START<sp/>WITH<sp/>1<sp/>INCREMENT<sp/>BY<sp/>1<sp/>NO<sp/>MINVALUE<sp/>NO<sp/>MAXVALUE<sp/>CACHE<sp/>1&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql);</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="498"><highlight class="normal">}</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="503" refid="df/da1/tripal__chado_8install_8inc_1a5626a992f72c2caefab546d7cbe3dd3b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a5626a992f72c2caefab546d7cbe3dd3b" kindref="member">tripal_chado_upgrade_chado_1_11_to_1_2</ref>()<sp/>{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>path<sp/>to<sp/>the<sp/>schema<sp/>diff<sp/>and<sp/>upgarde<sp/>SQL<sp/>files.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/>$schema_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/default_schema-1.11-1.2-diff.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/>$init_file<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/chado_schema/upgrade-1.11-1.2.sql&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($schema_file);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Upgrade<sp/>from<sp/>v1.11<sp/>to<sp/>v1.2<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>Successful!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Upgrade<sp/>(Step<sp/>1<sp/>of<sp/>2)<sp/>problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($init_file);</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Upgrade<sp/>from<sp/>v1.11<sp/>to<sp/>v1.2<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>Successful.\nUpgrade<sp/>Complete!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;Upgrade<sp/>(Step<sp/>2<sp/>of<sp/>2)<sp/>problems!<sp/><sp/>Please<sp/>check<sp/>output<sp/>above<sp/>for<sp/>errors.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal">}</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="531" refid="df/da1/tripal__chado_8install_8inc_1ac83b10ef16d0891291fbdbe9e7e138a2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1ac83b10ef16d0891291fbdbe9e7e138a2" kindref="member">tripal_chado_reset_chado_schema</ref>()<sp/>{</highlight></codeline>
<codeline lineno="532"><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>the<sp/>schema<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/>$chado_schema<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/>$chado_dot<sp/>=<sp/>$chado_schema<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>drop<sp/>current<sp/>chado<sp/>and<sp/>chado-related<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>(</highlight><highlight class="stringliteral">&apos;genetic_code&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Dropping<sp/>existing<sp/>&apos;genetic_code&apos;<sp/>schema\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;drop<sp/>schema<sp/>genetic_code<sp/>cascade&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>(</highlight><highlight class="stringliteral">&apos;so&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Dropping<sp/>existing<sp/>&apos;so&apos;<sp/>schema\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;drop<sp/>schema<sp/>so<sp/>cascade&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>(</highlight><highlight class="stringliteral">&apos;frange&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Dropping<sp/>existing<sp/>&apos;frange&apos;<sp/>schema\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;drop<sp/>schema<sp/>frange<sp/>cascade&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>($chado_schema))<sp/>{</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($chado_schema<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Dropping<sp/>existing<sp/>Chado<sp/>(&apos;$chado_schema&apos;)<sp/>schema\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Dropping<sp/>existing<sp/>&apos;chado&apos;<sp/>schema\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;drop<sp/>schema<sp/>$chado_schema<sp/>cascade&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="559"><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>create<sp/>the<sp/>new<sp/>chado<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Creating<sp/>&apos;chado&apos;<sp/>schema\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;create<sp/>schema<sp/>$chado_schema&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>before<sp/>creating<sp/>the<sp/>plpgsql<sp/>language<sp/>let&apos;s<sp/>check<sp/>to<sp/>make<sp/>sure</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>doesn&apos;t<sp/>already<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>COUNT(*)<sp/>FROM<sp/>pg_language<sp/>WHERE<sp/>lanname<sp/>=<sp/>&apos;plpgsql&apos;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>$count<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$count<sp/>or<sp/>$count-&gt;count<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;create<sp/>language<sp/>plpgsql&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="576"><highlight class="normal">}</highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="586" refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1a6df2219551751ee264ece16f010a8467" kindref="member">tripal_chado_install_sql</ref>($sql_file)<sp/>{</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/>$chado_local<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>the<sp/>schema<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/>$chado_schema<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/>$chado_dot<sp/>=<sp/>$chado_schema<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($chado_local)<sp/>{</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;set<sp/>search_path<sp/>to<sp/>$chado_schema&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Loading<sp/>$sql_file...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/>$lines<sp/>=<sp/>file($sql_file,<sp/>FILE_SKIP_EMPTY_LINES);</highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$lines)<sp/>{</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;Cannot<sp/>open<sp/>$schema_file&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/>$stack<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/>$in_string<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/>$in_function<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/>$i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($lines<sp/>as<sp/>$line_num<sp/>=&gt;<sp/>$line)<sp/>{</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>and<sp/>remove<sp/>comments<sp/>except<sp/>when<sp/>inside<sp/>of<sp/>strings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/--/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!preg_match(</highlight><highlight class="stringliteral">&quot;/&apos;.*?--.*?&apos;/&quot;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/--.*$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$line);<sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>comments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/\/\*.*?\*\//&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/\/\*.*?\*\//&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$line);<sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>comments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>empty<sp/>lines</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>or<sp/>strcmp($line,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)==0)<sp/>{</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>SQL<sp/>for<sp/>new<sp/>objects</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+TABLE/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*ALTER\s+TABLE\s+/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;alter_table&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*SET/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;set&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+SCHEMA/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;schema&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+SEQUENCE/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;sequence&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+(?:OR\s+REPLACE\s+)*VIEW/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;view&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*COMMENT/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)==0<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+(?:OR\s+REPLACE\s+)*FUNCTION/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$in_function<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;function&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+INDEX/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;index&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*INSERT\s+INTO/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;insert&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$line<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public\./&quot;</highlight><highlight class="normal">,<sp/>$chado_dot,<sp/>$line);</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+TYPE/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*GRANT/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;grant&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*CREATE\s+AGGREGATE/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;aggregate&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*DROP\s+FUNCTION/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;drop_function&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*DROP\s+VIEW/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;drop_view&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*DROP\s+INDEX/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;drop_index&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*DROP\s+SEQUENCE/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;drop_seq&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*ALTER\s+TYPE\s+/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;alter_type&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^\s*ALTER\s+SEQUENCE\s+/i&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string<sp/>and<sp/>!$in_function)<sp/>{</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$stack[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;alter_seq&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>if<sp/>we<sp/>are<sp/>in<sp/>a<sp/>string<sp/>that<sp/>spans<sp/>a<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/>$matches<sp/>=<sp/>preg_match_all(</highlight><highlight class="stringliteral">&quot;/[&apos;]/i&quot;</highlight><highlight class="normal">,<sp/>$line,<sp/>$temp);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>$in_string<sp/>=<sp/>$in_string<sp/>-<sp/>($matches<sp/>%<sp/>2);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/>$in_string<sp/>=<sp/>abs($in_string);</highlight></codeline>
<codeline lineno="695"><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we&apos;ve<sp/>reached<sp/>the<sp/>end<sp/>of<sp/>an<sp/>object<sp/>then<sp/>pop<sp/>the<sp/>stack</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/\);\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;alter_table&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;set&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;schema&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;sequence&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;view&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;function&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="719"><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(preg_match(</highlight><highlight class="stringliteral">&apos;/LANGUAGE.*?;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$in_function<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//print<sp/>&quot;FUNCTION<sp/>DONE<sp/>($i):<sp/>$line&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(preg_match(</highlight><highlight class="stringliteral">&apos;/\$_\$;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$in_function<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//print<sp/>&quot;FUNCTION<sp/>DONE<sp/>($i):<sp/>$line&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(preg_match(</highlight><highlight class="stringliteral">&apos;/\$\$;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$in_function<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>print<sp/>&quot;FUNCTION<sp/>DONE<sp/>($i):<sp/>$line&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>print<sp/>&quot;FUNCTION<sp/>($i):<sp/>$line&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;index&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;insert&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/\);\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/\);\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;grant&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line)<sp/>and<sp/>!$in_string)<sp/>{</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;aggregate&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/\);\s*$/&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;drop_function&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;drop_view&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;drop_index&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&quot;/;\s*$/i&quot;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;drop_seq&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&quot;/;\s*$/i&quot;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;alter_type&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(strcmp($stack[</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)-1],<sp/></highlight><highlight class="stringliteral">&apos;alter_seq&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/;\s*$/i&apos;</highlight><highlight class="normal">,<sp/>$line))<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>array_pop($stack);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we&apos;re<sp/>in<sp/>a<sp/>recognized<sp/>SQL<sp/>statement<sp/>then<sp/>let&apos;s<sp/>keep<sp/>track<sp/>of<sp/>lines</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type<sp/>or<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;$line&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;UNHANDLED<sp/>$i,<sp/>$in_string:<sp/>$line&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&quot;/\n/&quot;</highlight><highlight class="normal">,<sp/>$query,<sp/>$temp)<sp/>&gt;<sp/>1000)<sp/>{</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;SQL<sp/>query<sp/>is<sp/>too<sp/>long.<sp/><sp/>Terminating:\n$query\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type<sp/>and<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($stack)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//print<sp/>&quot;Adding<sp/>$type:<sp/>line<sp/>$i\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rewrite<sp/>the<sp/>set<sp/>search_path<sp/>to<sp/>make<sp/>&apos;public&apos;<sp/>be<sp/>&apos;chado&apos;,<sp/>but<sp/>only<sp/>if<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>chado<sp/>schema<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($type,<sp/></highlight><highlight class="stringliteral">&apos;set&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0<sp/>and<sp/>$chado_local)<sp/>{</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/public/m&quot;</highlight><highlight class="normal">,<sp/>$chado_schema,<sp/>$query);</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>execute<sp/>the<sp/>statement</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_query($query);</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$error<sp/><sp/>=<sp/>$e-&gt;getMessage();</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;FAILED.<sp/>Line<sp/><sp/>$i,<sp/>$in_string\n$error:\n$query\n\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="798"><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$result)<sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$error<sp/><sp/>=<sp/>pg_last_error();</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(</highlight><highlight class="stringliteral">&quot;FAILED.<sp/>Line<sp/><sp/>$i,<sp/>$in_string\n$error:\n$query\n\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1abfcdb0d424c71dead69c52569131a879" kindref="member">tripal_chado_install_done</ref>();</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$success;</highlight></codeline>
<codeline lineno="808"><highlight class="normal">}</highlight></codeline>
<codeline lineno="809"><highlight class="normal"></highlight></codeline>
<codeline lineno="815" refid="df/da1/tripal__chado_8install_8inc_1abfcdb0d424c71dead69c52569131a879" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/da1/tripal__chado_8install_8inc_1abfcdb0d424c71dead69c52569131a879" kindref="member">tripal_chado_install_done</ref>()<sp/>{</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/>$drupal_schema<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;drupal&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;set<sp/>search_path<sp/>to<sp/>$drupal_schema&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="819"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado/includes/tripal_chado.install.inc"/>
  </compounddef>
</doxygen>
