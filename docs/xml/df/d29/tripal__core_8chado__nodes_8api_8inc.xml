<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="df/d29/tripal__core_8chado__nodes_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_core.chado_nodes.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a363beaa21e3590224b1cbfb84e712197" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_subtable_ajax_update</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_subtable_ajax_update</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Ajax function which returns the section of the form to be re-rendered for either the properties, dbxref or relationship sub-sections. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="308" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="308" bodyend="333"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a78396dcda625227340c0630ab0d79ba5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_subtables_add_button_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_subtables_add_button_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add subtable entries to the node forms. Supported subtables: Properties, Relationships, Additional DBxrefs.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="204" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="204" bodyend="228"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1ac59ae2b6cb582d5dd9580d9b6c1d8505" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_subtables_add_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_subtables_add_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validate Adding Subtables entries from the node forms. Supported subtables: Properties, Relationships, Additional DBxrefs.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="175" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="175" bodyend="195"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a9e074d7489f8eb05bce21a44918da531" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_subtables_remove_button_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_subtables_remove_button_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Remove subtable entries to the node forms. Supported subtables: Properties, Relationships, Additional DBxrefs.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="276" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="276" bodyend="300"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a2cfe14b58846f9ab1f0f4d5d2726929f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_subtables_remove_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_subtables_remove_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validate Removing Subtables entries from the node forms. Supported subtables: Properties, Relationships, Additional DBxrefs.</para><para>Since Removing isn&apos;t associated with any user input the only thing we need to validate is that Drupal has determined the triggering element correctly. That said, we will call each subtables associated validate function just incase there is some case-specific validation we do not know of or have not anticipated.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>array</parametertype>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="242" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="242" bodyend="267"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga742e5f56a6a2ed5b826e0a3b557349a2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_cleanup_orphaned_nodes</definition>
        <argsstring>($table, $nentries=25000, $linking_table=NULL, $node_type=NULL, $job_id=NULL)</argsstring>
        <name>chado_cleanup_orphaned_nodes</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$nentries</declname>
          <defval>25000</defval>
        </param>
        <param>
          <declname>$linking_table</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$node_type</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is a wrapper for the chado_cleanup_orphaned_nodes function. It breaks up the work of chado_cleanup_orphaned_nodes into smaller pieces that are more managable for servers that may have low php memory settings.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table that corresonds to the node type we want to clean up. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$nentries</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. The number of entries to parse at one time (ie: the batch size). Set to zero if no limit is needed. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$linking_table</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. The name of the linking table that maps Drupal nodes to Chado records. This is only required if the linking table name is not of the form: chado_[table] where [table] is the value provided to the $table argument. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$node_type</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. The name of the node type for the records. This is only required if the node type is not of the form: chado_[table] where [table] is the value provided to the $table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. This should be the job id from the Tripal jobs system. Typically, only the Tripal jobs system will use the argument. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="1003" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="1003" bodyend="1054"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gad6dd911a15ce9e07b97e2f6652e80187" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_cleanup_orphaned_nodes_part</definition>
        <argsstring>($table, $job_id=NULL, $nentries, $offset, $linking_table, $node_type)</argsstring>
        <name>chado_cleanup_orphaned_nodes_part</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$nentries</declname>
        </param>
        <param>
          <declname>$offset</declname>
        </param>
        <param>
          <declname>$linking_table</declname>
        </param>
        <param>
          <declname>$node_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function will delete Drupal nodes for any sync&apos;ed table (e.g. feature, organism, analysis, stock, library) if the chado record has been deleted or the entry in the chado_[table] table has been removed.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table that corresonds to the node type we want to clean up. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>This should be the job id from the Tripal jobs system. This function will update the job status using the provided job ID. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="1069" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="1069" bodyend="1196"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga4b1cdb30165d8a7fa2b2b788d651475f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_id_from_nid</definition>
        <argsstring>($table, $nid, $linking_table=NULL)</argsstring>
        <name>chado_get_id_from_nid</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$nid</declname>
        </param>
        <param>
          <declname>$linking_table</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get chado id for a node. E.g, if you want to get &apos;analysis_id&apos; from the &apos;analysis&apos; table for a synced &apos;chado_analysis&apos; node, (the same for organisms and features): $analysis_id = chado_get_id_from_nid (&apos;analysis&apos;, $node-&gt;nid) $organism_id = chado_get_id_from_nid (&apos;organism&apos;, $node-&gt;nid) $feature_id = chado_get_id_from_nid (&apos;feature&apos;, $node-&gt;nid)</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The chado table the chado record is from </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$nid</parametername>
</parameternamelist>
<parameterdescription>
<para>The value of the primary key of node </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$linking_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal table linking the chado record to it&apos;s node. This field is optional and defaults to chado_$table</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The chado id of the associated chado record </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="57" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="57" bodyend="64"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga3ae4379f4a565328b49b2025ff3e5477" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_nid_from_id</definition>
        <argsstring>($table, $id, $linking_table=NULL)</argsstring>
        <name>chado_get_nid_from_id</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$id</declname>
        </param>
        <param>
          <declname>$linking_table</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get node id for a chado feature/organism/analysis. E.g, if you want to get the node id for an analysis, use: $nid = chado_get_nid_from_id (&apos;analysis&apos;, $analysis_id) Likewise, $nid = chado_get_nid_from_id (&apos;organism&apos;, $organism_id) $nid = chado_get_nid_from_id (&apos;feature&apos;, $feature_id)</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The chado table the id is from </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$id</parametername>
</parameternamelist>
<parameterdescription>
<para>The value of the primary key from the $table chado table (ie: feature_id) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$linking_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal table linking the chado record to it&apos;s node. This field is optional and defaults to chado_$table</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The nid of the associated node </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="87" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="87" bodyend="94"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_base_table</definition>
        <argsstring>($content_type, $module=FALSE)</argsstring>
        <name>chado_node_get_base_table</name>
        <param>
          <declname>$content_type</declname>
        </param>
        <param>
          <declname>$module</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Determine the chado base table for a given content type</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$content_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The machine name of the content type (node type) you want to determine the base chado table of </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$module</parametername>
</parameternamelist>
<parameterdescription>
<para>(Optional) The machine-name of the module implementing the content type</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The name of the chado base table for the specified content type </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="111" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="111" bodyend="134"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga753ddb12263511e4667c6081cb4aab2f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_sync_form</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_node_sync_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="416" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="416" bodyend="650"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a435e56c05a729a37de4c7d65c7bd5b7f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_sync_form_submit</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>chado_node_sync_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generic Sync Form Submit </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="677" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="677" bodyend="750"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a87b0829854e9d5b75b35ad7ecf26ef8b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_sync_form_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_node_sync_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generic Sync Form Validate </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="657" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="657" bodyend="670"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga7145af80db3d89b022703df056227023" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_sync_records</definition>
        <argsstring>($base_table, $max_sync=FALSE, $organism_id=FALSE, $types=array(), $ids=array(), $linking_table=FALSE, $node_type=FALSE, $job_id=NULL)</argsstring>
        <name>chado_node_sync_records</name>
        <param>
          <declname>$base_table</declname>
        </param>
        <param>
          <declname>$max_sync</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$organism_id</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$types</declname>
          <defval>array()</defval>
        </param>
        <param>
          <declname>$ids</declname>
          <defval>array()</defval>
        </param>
        <param>
          <declname>$linking_table</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$node_type</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generic function for syncing records in Chado with Drupal nodes.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$base_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the Chado table containing the record that should be synced </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$max_sync</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional: A numeric value to indicate the maximum number of records to sync. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$organism_id</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional: Limit the list of records to be synced to only those that are associated with this organism_id. If the record is not assocaited with an organism then this field is not needed. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$types</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional: Limit the list of records to be synced to only those that match the types listed in this array. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$ids</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional: Limit the list of records to bye synced to only those whose primary key value matches the ID provided in this array. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$linking_table</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional: Tripal maintains &quot;linking&quot; tables in the Drupal schema to link Drupal nodes with Chado records. By default these tables are named as &apos;chado_&apos; . $base_table. But if for some reason the linking table is not named in this way then it can be provided by this argument. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$node_type</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional: Tripal maintains &quot;linking&quot; tables in the Drupal schema to link Drupal nodes with Chado records. By default, Tripal expects that the node_type and linking table are named the same. However, if this is not the case, you can provide the node type name here. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. Used by the Trpial Jobs system when running this function as a job. It is not needed othewise. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="786" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="786" bodyend="976"/>
      </memberdef>
      <memberdef kind="function" id="df/d29/tripal__core_8chado__nodes_8api_8inc_1a6504ee945cde81cd2f92970e36fefc87" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_validate_node_form_triggering_element</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_validate_node_form_triggering_element</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="157" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="157" bodyend="166"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga191042f2717f754ed7974e4504ec6dfd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_chado_node_sync_create_new_node</definition>
        <argsstring>($new_node, $record)</argsstring>
        <name>hook_chado_node_sync_create_new_node</name>
        <param>
          <declname>$new_node</declname>
        </param>
        <param>
          <declname>$record</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Create New Node</para><para>Note: For your own module, replace hook in the function name with the machine-name of your chado node type (ie: chado_feature).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$new_node</parametername>
</parameternamelist>
<parameterdescription>
<para>a basic new node object </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$record</parametername>
</parameternamelist>
<parameterdescription>
<para>the record object from chado specifying the biological data for this node</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A node object containing all the fields necessary to create a new node during sync </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="1215" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="1215" bodyend="1224"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gaba5aa7ceebcb65b26b34c1bb685eaf92" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_chado_node_sync_form</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>hook_chado_node_sync_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Alter the Chado node sync form.</para><para>This might be necessary if you need additional filtering options for choosing which chado records to sync or even if you just want to further customize the help text provided by the form.</para><para>Note: For your own module, replace hook in the function name with the machine-name of your chado node type (ie: chado_feature). </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="1238" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="1238" bodyend="1244"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga6cd8d30962617a8cf05c2fa037031ecf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_chado_node_sync_form_submit</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>hook_chado_node_sync_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Bypass chado node api sync form submit.</para><para>Allows you to use this function as your own submit.</para><para>This might be necessary if you want to add additional arguments to the tripal job or to call your own sync&apos;ing function if the generic <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga7145af80db3d89b022703df056227023" kindref="member">chado_node_sync_records()</ref> is not sufficient.</para><para>Note: For your own module, replace hook in the function name with the machine-name of your chado node type (ie: chado_feature). </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="1260" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="1260" bodyend="1289"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gad8268cb0dec1581bd1c48102e62d4e9a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_chado_node_sync_select_query</definition>
        <argsstring>($query)</argsstring>
        <name>hook_chado_node_sync_select_query</name>
        <param>
          <declname>$query</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Alter the query that retrieves records to be sync&apos;d (optional)</para><para>This might be necessary if you need fields from other chado tables to create your node or if your chado node type only supports a subset of a given table (ie: a germplasm node type might only support node creation for cerain types of stock records in which case you would need to filter the results to only those types).</para><para>Note: For your own module, replace hook in the function name with the machine-name of your chado node type (ie: chado_feature).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$query</parametername>
</parameternamelist>
<parameterdescription>
<para>An array containing the following: &apos;select&apos;: An array of select clauses &apos;joins: An array of joins (ie: a single join could be &apos;LEFT JOIN {chadotable} alias ON base.id=alias.id&apos;) &apos;where_clauses: An array of where clauses which will all be AND&apos;ed together. Use :placeholders for values. &apos;where_args: An associative array of arguments to be subbed in to the where clause where the </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" line="1316" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc" bodystart="1316" bodyend="1343"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>API to handle much of the common functionality implemented when creating a drupal node type. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="57" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga4b1cdb30165d8a7fa2b2b788d651475f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga4b1cdb30165d8a7fa2b2b788d651475f" kindref="member">chado_get_id_from_nid</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$nid,<sp/>$linking_table<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($linking_table))<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_id<sp/>as<sp/>id<sp/>FROM<sp/>{$linking_table}<sp/>WHERE<sp/>nid<sp/>=<sp/>:nid&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:nid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$nid))-&gt;fetchField();</highlight></codeline>
<codeline lineno="64"><highlight class="normal">}</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="87" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga3ae4379f4a565328b49b2025ff3e5477" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga3ae4379f4a565328b49b2025ff3e5477" kindref="member">chado_get_nid_from_id</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$id,<sp/>$linking_table<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($linking_table))<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>nid<sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>WHERE<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_id<sp/>=<sp/>:&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&quot;:&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_id&quot;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$id))-&gt;fetchField();</highlight></codeline>
<codeline lineno="94"><highlight class="normal">}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="111" refid="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" kindref="member">chado_node_get_base_table</ref>($content_type,<sp/>$module<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($module)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_info<sp/>=<sp/>call_user_func($details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_node_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_types<sp/>=<sp/>module_invoke_all(</highlight><highlight class="stringliteral">&apos;node_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($node_types[$content_type]))<sp/>{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node_info<sp/>=<sp/>$node_types[$content_type];</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($node_info[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$node_info[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal">}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="157" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a6504ee945cde81cd2f92970e36fefc87" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a6504ee945cde81cd2f92970e36fefc87" kindref="member">chado_validate_node_form_triggering_element</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>are<sp/>going<sp/>to<sp/>inspect<sp/>the<sp/>post<sp/>to<sp/>determine<sp/>what<sp/>PHP<sp/>knows<sp/>is<sp/>the<sp/>triggering</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>element<sp/>and<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>agree<sp/>with<sp/>Drupal<sp/>then<sp/>we<sp/>are<sp/>actually<sp/>going<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>change<sp/>it<sp/>in<sp/>Drupal.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($_POST[</highlight><highlight class="stringliteral">&apos;_triggering_element_name&apos;</highlight><highlight class="normal">]<sp/>!=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$_POST[</highlight><highlight class="stringliteral">&apos;_triggering_element_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal">}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="175" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1ac59ae2b6cb582d5dd9580d9b6c1d8505" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1ac59ae2b6cb582d5dd9580d9b6c1d8505" kindref="member">chado_add_node_form_subtables_add_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Based<sp/>on<sp/>triggering<sp/>element<sp/>call<sp/>the<sp/>correct<sp/>validation<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>ASUMPTION<sp/>#1:<sp/>each<sp/>of<sp/>the<sp/>buttons<sp/>must<sp/>have<sp/>property,<sp/>dbxref<sp/>or<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>the<sp/>first<sp/>part<sp/>of<sp/>the<sp/>#name<sp/>to<sp/>uniquely<sp/>identify<sp/>the<sp/>subsection.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^([a-z]+).*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/>$subsection<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">($subsection)<sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a8d90195bc15c4d74c36f7df8a4af7a21" kindref="member">chado_add_node_form_properties_add_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;dbxrefs&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d09/tripal__core_8chado__nodes_8dbxrefs_8api_8inc_1a661a7a026f6d16e0c69e62b8f7cfd91c" kindref="member">chado_add_node_form_dbxrefs_add_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a3d7f3e569b2fadc091582834ca6751b8" kindref="member">chado_add_node_form_relationships_add_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="195"><highlight class="normal">}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="204" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a78396dcda625227340c0630ab0d79ba5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a78396dcda625227340c0630ab0d79ba5" kindref="member">chado_add_node_form_subtables_add_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Based<sp/>on<sp/>triggering<sp/>element<sp/>call<sp/>the<sp/>correct<sp/>submit<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>ASUMPTION<sp/>#1:<sp/>each<sp/>of<sp/>the<sp/>buttons<sp/>must<sp/>have<sp/>properties,<sp/>dbxrefs<sp/>or<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>the<sp/>first<sp/>part<sp/>of<sp/>the<sp/>#name<sp/>to<sp/>uniquely<sp/>identify<sp/>the<sp/>subsection.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^([a-z]+).*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>$subsection<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">($subsection)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7470784204c95102ace1a0f336558d59" kindref="member">chado_add_node_form_properties_add_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;dbxrefs&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d09/tripal__core_8chado__nodes_8dbxrefs_8api_8inc_1a62c5b991589a3c10e04770fac314a052" kindref="member">chado_add_node_form_dbxrefs_add_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1af94299333456ac6f6d9edd737b3c2395" kindref="member">chado_add_node_form_relationships_add_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>needed<sp/>to<sp/>ensure<sp/>the<sp/>form<sp/>builder<sp/>function<sp/>is<sp/>called<sp/>for<sp/>the<sp/>node</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>form<sp/>in<sp/>order<sp/>for<sp/>any<sp/>of<sp/>these<sp/>changes<sp/>to<sp/>be<sp/>seen.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;rebuild&apos;</highlight><highlight class="normal">]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="228"><highlight class="normal">}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="242" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a2cfe14b58846f9ab1f0f4d5d2726929f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a2cfe14b58846f9ab1f0f4d5d2726929f" kindref="member">chado_add_node_form_subtables_remove_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>to<sp/>validate<sp/>the<sp/>trigerring<sp/>element<sp/>since<sp/>Drupal<sp/>has<sp/>known</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>issues<sp/>determining<sp/>this<sp/>correctly<sp/>when<sp/>there<sp/>are<sp/>multiple<sp/>buttons</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>with<sp/>the<sp/>same<sp/>label.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a6504ee945cde81cd2f92970e36fefc87" kindref="member">chado_validate_node_form_triggering_element</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Based<sp/>on<sp/>triggering<sp/>element<sp/>call<sp/>the<sp/>correct<sp/>validation<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>ASUMPTION<sp/>#1:<sp/>each<sp/>of<sp/>the<sp/>buttons<sp/>must<sp/>have<sp/>property,<sp/>dbxref<sp/>or<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>the<sp/>first<sp/>part<sp/>of<sp/>the<sp/>#name<sp/>to<sp/>uniquely<sp/>identify<sp/>the<sp/>subsection.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^([a-z]+).*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>$subsection<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">($subsection)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a9a74ae1a1c5788d1a5bac925bcdf3cc9" kindref="member">chado_add_node_form_properties_remove_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;dbxrefs&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d09/tripal__core_8chado__nodes_8dbxrefs_8api_8inc_1ac33476b84435f592aea5bca984dda2b6" kindref="member">chado_add_node_form_dbxrefs_remove_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1a0236b2ec64f4400f076640df4e94349f" kindref="member">chado_add_node_form_relationships_remove_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="267"><highlight class="normal">}</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="276" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a9e074d7489f8eb05bce21a44918da531" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a9e074d7489f8eb05bce21a44918da531" kindref="member">chado_add_node_form_subtables_remove_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Based<sp/>on<sp/>triggering<sp/>element<sp/>call<sp/>the<sp/>correct<sp/>submit<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>ASUMPTION<sp/>#1:<sp/>each<sp/>of<sp/>the<sp/>buttons<sp/>must<sp/>have<sp/>properties,<sp/>dbxrefs<sp/>or<sp/>relationships</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>the<sp/>first<sp/>part<sp/>of<sp/>the<sp/>#name<sp/>to<sp/>uniquely<sp/>identify<sp/>the<sp/>subsection.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^([a-z]+).*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/>$subsection<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">($subsection)<sp/>{</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7ede10b894f55c39317196b715fff821" kindref="member">chado_add_node_form_properties_remove_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;dbxrefs&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d09/tripal__core_8chado__nodes_8dbxrefs_8api_8inc_1ae7e17c99f0e6553c780567d19d5f900f" kindref="member">chado_add_node_form_dbxrefs_remove_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/d71/tripal__core_8chado__nodes_8relationships_8api_8inc_1ac5110801efb4d2fb4c47d799e6578ed6" kindref="member">chado_add_node_form_relationships_remove_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>needed<sp/>to<sp/>ensure<sp/>the<sp/>form<sp/>builder<sp/>function<sp/>is<sp/>called<sp/>for<sp/>the<sp/>node</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>form<sp/>in<sp/>order<sp/>for<sp/>any<sp/>of<sp/>these<sp/>changes<sp/>to<sp/>be<sp/>seen.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;rebuild&apos;</highlight><highlight class="normal">]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="300"><highlight class="normal">}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="308" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a363beaa21e3590224b1cbfb84e712197" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a363beaa21e3590224b1cbfb84e712197" kindref="member">chado_add_node_form_subtable_ajax_update</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>to<sp/>validate<sp/>the<sp/>trigerring<sp/>element<sp/>since<sp/>Drupal<sp/>has<sp/>known</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>issues<sp/>determining<sp/>this<sp/>correctly<sp/>when<sp/>there<sp/>are<sp/>multiple<sp/>buttons</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>with<sp/>the<sp/>same<sp/>label.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a6504ee945cde81cd2f92970e36fefc87" kindref="member">chado_validate_node_form_triggering_element</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Based<sp/>on<sp/>triggering<sp/>element<sp/>render<sp/>the<sp/>correct<sp/>part<sp/>of<sp/>the<sp/>form.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>ASUMPTION:<sp/>each<sp/>of<sp/>the<sp/>buttons<sp/>must<sp/>have<sp/>property,<sp/>dbxref<sp/>or<sp/>relationship</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>as<sp/>the<sp/>first<sp/>part<sp/>of<sp/>the<sp/>#name<sp/>to<sp/>uniquely<sp/>identify<sp/>the<sp/>subsection.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^([a-z]+).*/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/>$subsection<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal">($subsection)<sp/>{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;dbxrefs&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;addtl_dbxrefs&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;dbxref_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;relationship_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="333"><highlight class="normal">}</highlight></codeline>
<codeline lineno="334"><highlight class="normal"></highlight></codeline>
<codeline lineno="416" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga753ddb12263511e4667c6081cb4aab2f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga753ddb12263511e4667c6081cb4aab2f" kindref="member">chado_node_sync_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0]))<sp/>{</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/>$module<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][0];</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_type<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;build_info&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;args&apos;</highlight><highlight class="normal">][1];</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_info<sp/>=<sp/>call_user_func($module<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_node_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>linking<sp/>table<sp/>is<sp/>set<sp/>in<sp/>the<sp/>node_info<sp/>array<sp/>then<sp/>use<sp/>that,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>otherwise<sp/>ues<sp/>the<sp/>node_type<sp/>as<sp/>the<sp/>linking<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;linking_table&apos;</highlight><highlight class="normal">,<sp/>$node_info[$node_type][</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/>$node_info[$node_type][</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;linking_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$node_info[$node_type][</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>$node_info[$node_type][</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$args;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;linking_table&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linking_table</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;node_type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_type</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>define<sp/>the<sp/>fieldsets</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Sync<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#descrpition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;%title_plural<sp/>of<sp/>the<sp/>types<sp/>listed<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;below<sp/>in<sp/>the<sp/>%title_singular<sp/>Types<sp/>box<sp/>will<sp/>be<sp/>synced<sp/>(leave<sp/>blank<sp/>to<sp/>sync<sp/>all<sp/>types).<sp/>You<sp/>may<sp/>limit<sp/>the<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;%title_plural<sp/>to<sp/>be<sp/>synced<sp/>by<sp/>a<sp/>specific<sp/>organism.<sp/>Depending<sp/>on<sp/>the<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;number<sp/>of<sp/>%title_plural<sp/>in<sp/>the<sp/>chado<sp/>database<sp/>this<sp/>may<sp/>take<sp/>a<sp/>long<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;time<sp/>to<sp/>complete.<sp/>&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/>)),</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($args[</highlight><highlight class="stringliteral">&apos;sync_filters&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_ids&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;%title_singular<sp/>Types&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)),</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;Enter<sp/>the<sp/>names<sp/>of<sp/>the<sp/>%title_singular<sp/>types<sp/>to<sp/>sync.<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Leave<sp/>blank<sp/>to<sp/>sync<sp/>all<sp/>%title_plural.<sp/>Separate<sp/>each<sp/>type<sp/>with<sp/>a<sp/>comma<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;or<sp/>new<sp/>line.<sp/>Pages<sp/>for<sp/>these<sp/>%title_singular<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;types<sp/>will<sp/>be<sp/>created<sp/>automatically<sp/>for<sp/>%title_plural<sp/>that<sp/>exist<sp/>in<sp/>the<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado<sp/>database.<sp/>The<sp/>names<sp/>must<sp/>match<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;exactly<sp/>(spelling<sp/>and<sp/>case)<sp/>with<sp/>terms<sp/>in<sp/>the<sp/>ontologies&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)),</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="487"><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>list<sp/>of<sp/>organisms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($args[</highlight><highlight class="stringliteral">&apos;sync_filters&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{organism}<sp/>ORDER<sp/>BY<sp/>genus,<sp/>species&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql);</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/>$organisms[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$organisms[<ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>-&gt;organism_id]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;$organism-&gt;genus<sp/>$organism-&gt;species<sp/>($organism-&gt;common_name)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Organism&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;Choose<sp/>the<sp/>organism<sp/>for<sp/>which<sp/>%title_plural<sp/>types<sp/>set<sp/>above<sp/>will<sp/>be<sp/>synced.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)),</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$organisms,</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">]<sp/>:<sp/>0,</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>list<sp/>of<sp/>organisms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;checkboxes&apos;</highlight><highlight class="normal">,<sp/>$args[</highlight><highlight class="stringliteral">&apos;sync_filters&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>base<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/>$table_info<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>($base_table);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>base<sp/>table<sp/>does<sp/>not<sp/>have<sp/>a<sp/>primary<sp/>key<sp/>or<sp/>has<sp/>more<sp/>than<sp/>one<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>can&apos;t<sp/>proceed,<sp/>otherwise,<sp/>generate<sp/>the<sp/>checkboxes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;primary<sp/>key&apos;</highlight><highlight class="normal">,<sp/>$table_info)<sp/>and<sp/>count($table_info[</highlight><highlight class="stringliteral">&apos;primary<sp/>key&apos;</highlight><highlight class="normal">])<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pkey<sp/>=<sp/>$table_info[</highlight><highlight class="stringliteral">&apos;primary<sp/>key&apos;</highlight><highlight class="normal">][0];</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a19d2a3d21fe02053311fde465e6ae2e9" kindref="member">$columns</ref><sp/><sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;sync_filters&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;checkboxes&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$select_cols<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a19d2a3d21fe02053311fde465e6ae2e9" kindref="member">$columns</ref><sp/>as<sp/>$column)<sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$select_cols<sp/>.=<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$column<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;||<sp/>&apos;<sp/>&apos;<sp/>||&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>trailing<sp/>||<sp/>&apos;<sp/>&apos;<sp/>||</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$select_cols<sp/>=<sp/>substr($select_cols,<sp/>0,<sp/>-9);</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$base_table_id<sp/><sp/>=<sp/>$base_table<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$select<sp/>=<sp/>array($base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$pkey,<sp/>$select_cols<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>as<sp/>value&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$joins<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_clauses<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>module<sp/>to<sp/>update<sp/>the<sp/>query.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$hook_query_alter<sp/>=<sp/>$node_type<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_sync_select_query&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook_query_alter))<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$update<sp/>=<sp/>call_user_func($hook_query_alter,<sp/>array(</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$select,</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$joins,</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;where_clauses&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$where_clauses,</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;where_args&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$where_args,</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>add<sp/>in<sp/>any<sp/>new<sp/>changes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($update<sp/>and<sp/>is_array($update))<sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$select<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$joins<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$where_clauses<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;where_clauses&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$where_args<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;where_args&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="549"><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>Query,<sp/>we<sp/>do<sp/>a<sp/>left<sp/>join<sp/>on<sp/>the<sp/>chado_xxxx<sp/>table<sp/>in<sp/>the<sp/>Drupal<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>that<sp/>if<sp/>no<sp/>criteria<sp/>are<sp/>specified<sp/>we<sp/>only<sp/>get<sp/>those<sp/>items<sp/>that<sp/>have<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>yet<sp/>been<sp/>synced.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>$select)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;FROM<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<sp/>$joins)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>LEFT<sp/>JOIN<sp/>[&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;]<sp/>CT<sp/>ON<sp/>CT.$base_table_id<sp/>=<sp/>$base_table.$base_table_id<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;WHERE<sp/>CT.$base_table_id<sp/>IS<sp/>NULL&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>extend<sp/>the<sp/>where<sp/>clause<sp/>if<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($where_clauses<sp/>as<sp/>$category<sp/>=&gt;<sp/>$items)<sp/>{</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/>AND<sp/>(&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($items<sp/>as<sp/>$item)<sp/>{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/>$item<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>OR<sp/>&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>=<sp/>substr($where,<sp/>0,<sp/>-4);<sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>trailing<sp/>&apos;OR&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;)<sp/>&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sql_args<sp/>=<sp/>array_merge($sql_args,<sp/>$where_args[$category]);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($where)<sp/>{</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>.=<sp/>$where;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>ORDER<sp/>BY<sp/>$base_table.&quot;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&quot;,<sp/>$base_table.&quot;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a19d2a3d21fe02053311fde465e6ae2e9" kindref="member">$columns</ref>);</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($query,<sp/>$sql_args);</highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/>$result)<sp/>{</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[$result-&gt;$pkey]<sp/>=<sp/>$result-&gt;value;</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;ids&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Avaliable<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkboxes&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;ids&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;ids&apos;</highlight><highlight class="normal">]<sp/>:<sp/>array(),</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&lt;br&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;The<sp/>following<sp/><sp/>%title_plural<sp/>have<sp/>not<sp/>been<sp/>synced.<sp/>Check<sp/>those<sp/>to<sp/>be<sp/>synced<sp/>or<sp/>leave<sp/>all<sp/>unchecked<sp/>to<sp/>sync<sp/>them<sp/>all.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title_plural&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>))<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>style=&quot;height:<sp/>200px;<sp/>overflow:<sp/>scroll&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;no_ids&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;&lt;p&gt;There<sp/>are<sp/>no<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/><sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>to<sp/>sync.&lt;/p&gt;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>provide<sp/>a<sp/>list<sp/>of<sp/>checkboxes<sp/>we<sp/>shouldn&apos;t<sp/>need<sp/>a<sp/>max_sync</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;max_sync&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Maximum<sp/>number<sp/>of<sp/>records<sp/>to<sp/>Sync&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Leave<sp/>this<sp/>field<sp/>empty<sp/>to<sp/>sync<sp/>all<sp/>records,<sp/>regardless<sp/>of<sp/>number&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;max_sync&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;max_sync&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="611"><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;sync&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;button&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Sync<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>3,</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="617"><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;cleanup&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Clean<sp/>Up&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;cleanup&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;&lt;p&gt;With<sp/>Drupal<sp/>and<sp/>chado<sp/>residing<sp/>in<sp/>different<sp/>databases<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;it<sp/>is<sp/>possible<sp/>that<sp/>nodes<sp/>in<sp/>Drupal<sp/>and<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>in<sp/>Chado<sp/>become<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;\&quot;orphaned\&quot;.<sp/><sp/>This<sp/>can<sp/>occur<sp/>if<sp/>a<sp/>node<sp/>in<sp/>Drupal<sp/>is<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;deleted<sp/>but<sp/>the<sp/>corresponding<sp/>chado<sp/>records<sp/>is<sp/>not<sp/>and/or<sp/>vice<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;versa.<sp/>Click<sp/>the<sp/>button<sp/>below<sp/>to<sp/>resolve<sp/>these<sp/>discrepancies.&lt;/p&gt;&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>-10,</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;cleanup&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Batch<sp/>Size&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;The<sp/>number<sp/>of<sp/>records<sp/>to<sp/>analyze<sp/>together<sp/>in<sp/>a<sp/>batch.<sp/>If<sp/>you<sp/>are<sp/>having<sp/>memory<sp/>issues<sp/>you<sp/>might<sp/>want<sp/>to<sp/>decrease<sp/>this<sp/>number.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;chado_node_api_cleanup_batch_size&apos;</highlight><highlight class="normal">,<sp/>25000),</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;cleanup&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;button&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Clean<sp/>up<sp/>orphaned<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>strtolower($args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>2,</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>each<sp/>module<sp/>to<sp/>alter<sp/>this<sp/>form<sp/>as<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/>$hook_form_alter<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;hook_prefix&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_sync_form&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook_form_alter))<sp/>{</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>call_user_func($hook_form_alter,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="648"><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="650"><highlight class="normal">}</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="657" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a87b0829854e9d5b75b35ad7ecf26ef8b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a87b0829854e9d5b75b35ad7ecf26ef8b" kindref="member">chado_node_sync_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="658"><highlight class="normal"></highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]<sp/>=<sp/>25000;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;You<sp/>entered<sp/>a<sp/>Batch<sp/>Size<sp/>of<sp/>0<sp/>for<sp/>Cleaning-up<sp/>orphaned<sp/>nodes.<sp/>Since<sp/>this<sp/>is<sp/>not<sp/>valid,<sp/>we<sp/>reset<sp/>it<sp/>to<sp/>the<sp/>default<sp/>of<sp/>25,000.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/>elseif<sp/>(!is_numeric($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>batch<sp/>size<sp/>must<sp/>be<sp/>a<sp/>postitive<sp/>whole<sp/>number.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Round<sp/>the<sp/>value<sp/>just<sp/>to<sp/>make<sp/>sure.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]<sp/>=<sp/>abs(round($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="670"><highlight class="normal">}</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="677" refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a435e56c05a729a37de4c7d65c7bd5b7f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="df/d29/tripal__core_8chado__nodes_8api_8inc_1a435e56c05a729a37de4c7d65c7bd5b7f" kindref="member">chado_node_sync_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="678"><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^Sync/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>arguments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>$module<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;hook_prefix&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;linking_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_type<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;node_type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>each<sp/>module<sp/>to<sp/>hijack<sp/>the<sp/>submit<sp/>if<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>$hook_form_hijack_submit<sp/>=<sp/>$args[</highlight><highlight class="stringliteral">&apos;hook_prefix&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_sync_form_submit&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook_form_hijack_submit))<sp/>{</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>call_user_func($hook_form_hijack_submit,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>types<sp/>separated<sp/>into<sp/>a<sp/>consistent<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_ids&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>seperate<sp/>by<sp/>new<sp/>line<sp/>or<sp/>comma.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$temp_types<sp/>=<sp/>preg_split(</highlight><highlight class="stringliteral">&quot;/[,\n\r]+/&quot;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_ids&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>any<sp/>extra<sp/>spacing<sp/>around<sp/>the<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">($i<sp/>=<sp/>0;<sp/>$i<sp/>&lt;<sp/>count($temp_types);<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>empty<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($temp_types[$i])<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>[$i]<sp/>=<sp/>trim($temp_types[$i]);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>ids<sp/>to<sp/>be<sp/>synced</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>$ids<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;ids&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">])){</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;ids&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$id<sp/>=&gt;<sp/>$selected)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($selected)<sp/>{</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$ids[]<sp/>=<sp/>$id;</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="720"><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>organism<sp/>to<sp/>be<sp/>synced</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>$organism_id<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">,<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$organism_id<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Job<sp/>Arguments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/>$job_args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$base_table,</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;max_sync&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(!empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;max_sync&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;max_sync&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE,</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$organism_id,</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;types&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>,</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ids&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$ids,</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;linking_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linking_table,</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;node_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_type</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>$title<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Sync<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$args[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>($title,<sp/>$module,<sp/></highlight><highlight class="stringliteral">&apos;chado_node_sync_records&apos;</highlight><highlight class="normal">,<sp/>$job_args,<sp/>$user-&gt;uid);</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^Clean<sp/>up<sp/>orphaned/&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/>$module<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;hook_prefix&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;linking_table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_type<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;node_type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/>$job_args<sp/>=<sp/>array($base_table,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">],<sp/>$linking_table,<sp/>$node_type);</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/>variable_set(</highlight><highlight class="stringliteral">&apos;chado_node_api_cleanup_batch_size&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cleanup_batch_size&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">],<sp/>$module,<sp/></highlight><highlight class="stringliteral">&apos;chado_cleanup_orphaned_nodes&apos;</highlight><highlight class="normal">,<sp/>$job_args,<sp/>$user-&gt;uid);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal">}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="786" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga7145af80db3d89b022703df056227023" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga7145af80db3d89b022703df056227023" kindref="member">chado_node_sync_records</ref>($base_table,<sp/>$max_sync<sp/>=<sp/>FALSE,</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/>$organism_id<sp/>=<sp/>FALSE,<sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>=<sp/>array(),<sp/>$ids<sp/>=<sp/>array(),</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/>FALSE,<sp/>$node_type<sp/>=<sp/>FALSE,<sp/>$job_id<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/>$base_table_id<sp/>=<sp/>$base_table<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$linking_table)<sp/>{</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table;</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$node_type)<sp/>{</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table;</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="799"><highlight class="normal"></highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nSync&apos;ing<sp/>$base_table<sp/>records.<sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="801"><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>START<sp/>BUILDING<sp/>QUERY<sp/>TO<sp/>GET<sp/>ALL<sp/>RECORD<sp/>FROM<sp/>BASE<sp/>TABLE<sp/>THAT<sp/>MATCH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/>$select<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&quot;$base_table.*&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/>$joins<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/>$where_clauses<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/>$where_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>types<sp/>are<sp/>supplied<sp/>then<sp/>handle<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/>$restrictions<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/>$restrictions<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>Type(s):<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref>)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="812"><highlight class="normal"></highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>$select[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;cvterm.name<sp/>as<sp/>cvtname&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/>$joins[]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;LEFT<sp/>JOIN<sp/>{cvterm}<sp/>cvterm<sp/>ON<sp/>$base_table.type_id<sp/>=<sp/>cvterm.cvterm_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref><sp/>as<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sanitized_type<sp/>=<sp/>str_replace(</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,$type);</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_clauses[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">][]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;cvterm.name<sp/>=<sp/>:type_name_$sanitized_type&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_args[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;:type_name_$sanitized_type&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$type;</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="821"><highlight class="normal"></highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>IDs<sp/>have<sp/>been<sp/>supplied</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($ids)<sp/>{</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/>$restrictions<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>Specific<sp/>Records:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>count($ids)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>recored(s)<sp/>specified.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($ids<sp/>as<sp/>$id)<sp/>{</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_clauses[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">][]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;$base_table.$base_table_id<sp/>=<sp/>:id_$id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_args[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;:id_$id&quot;</highlight><highlight class="normal">]<sp/>=<sp/>$id;</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="830"><highlight class="normal"></highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>Organism<sp/>is<sp/>supplied</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($organism_id)<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;organism&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/>array(</highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$organism_id));</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/>$restrictions<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>Organism:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>[0]-&gt;genus<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="dc/dc0/tripal__organism__base_8tpl_8php_1ab6511d37d4b38235252feb7977bb5433" kindref="member">$organism</ref>[0]-&gt;species<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="835"><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/>$select[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;organism.*&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/>$joins[]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;LEFT<sp/>JOIN<sp/>{organism}<sp/>organism<sp/>ON<sp/>organism.organism_id<sp/>=<sp/>$base_table.organism_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/>$where_clauses[</highlight><highlight class="stringliteral">&apos;organism&apos;</highlight><highlight class="normal">][]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;organism.organism_id<sp/>=<sp/>:organism_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/>$where_args[</highlight><highlight class="stringliteral">&apos;organism&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;:organism_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$organism_id;</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="841"><highlight class="normal"></highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Allow<sp/>module<sp/>to<sp/>add<sp/>to<sp/>query</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/>$hook_query_alter<sp/>=<sp/>$node_type<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_sync_select_query&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook_query_alter))<sp/>{</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><sp/><sp/>$update<sp/>=<sp/>call_user_func($hook_query_alter,<sp/>array(</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$select,</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$joins,</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;where_clauses&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$where_clauses,</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;where_args&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$where_args,</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>add<sp/>in<sp/>any<sp/>new<sp/>changes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="852"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($update<sp/>and<sp/>is_array($update))<sp/>{</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$select<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$joins<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_clauses<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;where_clauses&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where_args<sp/>=<sp/>$update[</highlight><highlight class="stringliteral">&apos;where_args&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>Query,<sp/>we<sp/>do<sp/>a<sp/>left<sp/>join<sp/>on<sp/>the<sp/>chado_xxxx<sp/>table<sp/>in<sp/>the<sp/>Drupal<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>that<sp/>if<sp/>no<sp/>criteria<sp/>are<sp/>specified<sp/>we<sp/>only<sp/>get<sp/>those<sp/>items<sp/>that<sp/>have<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>yet<sp/>been<sp/>synced.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="863"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>$select)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;FROM<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<sp/>$joins)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>LEFT<sp/>JOIN<sp/>[&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;]<sp/>CT<sp/>ON<sp/>CT.$base_table_id<sp/>=<sp/>$base_table.$base_table_id<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;WHERE<sp/>CT.$base_table_id<sp/>IS<sp/>NULL<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="867"><highlight class="normal"></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>extend<sp/>the<sp/>where<sp/>clause<sp/>if<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/>$where<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/>$sql_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($where_clauses<sp/>as<sp/>$category<sp/>=&gt;<sp/>$items)<sp/>{</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/>AND<sp/>(&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($items<sp/>as<sp/>$item)<sp/>{</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/>$item<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>OR<sp/>&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/>$where<sp/>=<sp/>substr($where,<sp/>0,<sp/>-4);<sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>trailing<sp/>&apos;OR&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/>$where<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;)<sp/>&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql_args<sp/>=<sp/>array_merge($sql_args,<sp/>$where_args[$category]);</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="880"><highlight class="normal"></highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($where)<sp/>{</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/>$query<sp/>.=<sp/>$where;</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/>$query<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>ORDER<sp/>BY<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$base_table_id;</highlight></codeline>
<codeline lineno="885"><highlight class="normal"></highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>Maximum<sp/>number<sp/>to<sp/>Sync<sp/>is<sp/>supplied</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($max_sync)<sp/>{</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/>$query<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>LIMIT<sp/>$max_sync&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/>$restrictions<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/>Limited<sp/>to<sp/>$max_sync<sp/>records.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($restrictions)<sp/>{</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Records<sp/>matching<sp/>these<sp/>criteria<sp/>will<sp/>be<sp/>synced:<sp/>\n$restrictions&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"></highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>execute<sp/>the<sp/>query</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($query,<sp/>$sql_args);</highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>records<sp/>that<sp/>need<sp/>to<sp/>be<sp/>synced</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/>$count<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;rowCount();</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/>$interval<sp/>=<sp/>intval($count<sp/>*<sp/>0.01);</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($interval<sp/>&lt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/>$interval<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n$count<sp/>$base_table<sp/>records<sp/>found.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="910"><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/>$i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nNOTE:<sp/>Syncing<sp/>is<sp/>performed<sp/>using<sp/>a<sp/>database<sp/>transaction.<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;If<sp/>the<sp/>sync<sp/>fails<sp/>or<sp/>is<sp/>terminated<sp/>prematurely<sp/>then<sp/>the<sp/>entire<sp/>set<sp/>of<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;synced<sp/>items<sp/>is<sp/>rolled<sp/>back<sp/>and<sp/>will<sp/>not<sp/>be<sp/>found<sp/>in<sp/>the<sp/>database\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>)<sp/>{</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>job<sp/>status<sp/>every<sp/>1%<sp/>features.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job_id<sp/>and<sp/>$i<sp/>%<sp/>$interval<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>(($i<sp/>+<sp/>1)<sp/>/<sp/>$count)<sp/>*<sp/>100);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Syncing<sp/>$base_table<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>($i<sp/>+<sp/>1)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>of<sp/>$count<sp/>(&quot;</highlight><highlight class="normal"><sp/>.<sp/>$percent<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;%).<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\r&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval(($i/$count)*100));</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="925"><highlight class="normal"></highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>if<sp/>the<sp/>record<sp/>is<sp/>already<sp/>in<sp/>the<sp/>chado<sp/>linking<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(ie:<sp/>check<sp/>to<sp/>see<sp/>if<sp/>it<sp/>is<sp/>already<sp/>linked<sp/>to<sp/>a<sp/>node).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_select($linking_table,<sp/></highlight><highlight class="stringliteral">&apos;lnk&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;lnk&apos;</highlight><highlight class="normal">,array(</highlight><highlight class="stringliteral">&apos;nid&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition($base_table_id,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;{$base_table_id},<sp/></highlight><highlight class="charliteral">&apos;=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="933"><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($result))<sp/>{</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>generic<sp/>new<sp/>node.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node-&gt;type<sp/>=<sp/>$node_type;</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node-&gt;uid<sp/>=<sp/>$user-&gt;uid;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node-&gt;{$base_table_id}<sp/>=<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;{$base_table_id};</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node-&gt;$base_table<sp/>=<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>;</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node-&gt;language<sp/>=<sp/>LANGUAGE_NONE;</highlight></codeline>
<codeline lineno="942"><highlight class="normal"></highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>should<sp/>we<sp/>get<sp/>rid<sp/>of<sp/>this<sp/>hook<sp/>and<sp/>use<sp/>hook_node_presave()<sp/>instead?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>allow<sp/>base<sp/>module<sp/>to<sp/>set<sp/>additional<sp/>fields<sp/>as<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$hook_create_new_node<sp/>=<sp/>$node_type<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_sync_create_new_node&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook_create_new_node))<sp/>{</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_node<sp/>=<sp/>call_user_func($hook_create_new_node,<sp/>$new_node,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>);</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>and<sp/>Save<sp/>New<sp/>Node</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>node_validate($new_node,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="954"><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!form_get_errors())<sp/>{</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref><sp/>=<sp/>node_submit($new_node);</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>are<sp/>memory<sp/>leaks<sp/>on<sp/>the<sp/>node_save<sp/>it<sp/>is<sp/>probably</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>caused<sp/>by<sp/>the<sp/>hook_node_insert()<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>node_save(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Exception(t(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>insert<sp/>$base_table:<sp/>%title&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$new_node-&gt;title)));</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n\nComplete!\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="969"><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>we<sp/>start<sp/>errors<sp/>on<sp/>new<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog_exception(</highlight><highlight class="stringliteral">&apos;trp-fsync&apos;</highlight><highlight class="normal">,<sp/>$e);</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;FAILED:<sp/>Rolling<sp/>back<sp/>database<sp/>changes...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="976"><highlight class="normal">}</highlight></codeline>
<codeline lineno="977"><highlight class="normal"></highlight></codeline>
<codeline lineno="1003" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga742e5f56a6a2ed5b826e0a3b557349a2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga742e5f56a6a2ed5b826e0a3b557349a2" kindref="member">chado_cleanup_orphaned_nodes</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$nentries<sp/>=<sp/>25000,</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/>NULL,<sp/>$node_type<sp/>=<sp/>NULL,<sp/>$job_id<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"></highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>max<sp/>number<sp/>of<sp/>records<sp/>either<sp/>as<sp/>nodes<sp/>or<sp/>linked<sp/>records.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/>$count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Will<sp/>hold<sp/>the<sp/>number<sp/>of<sp/>nodes<sp/>of<sp/>this<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/>$ncount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Will<sp/>hold<sp/>the<sp/>number<sp/>of<sp/>linked<sp/>records.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/>$clcount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"></highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$node_type)<sp/>{</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$linking_table)<sp/>{</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/>$linking_table<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>the<sp/>number<sp/>nodes<sp/>of<sp/>type<sp/>chado_$table<sp/>and<sp/>find<sp/>the<sp/>number<sp/>of<sp/>entries</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>chado_$table;<sp/>keep<sp/>the<sp/>larger<sp/>of<sp/>the<sp/>two<sp/>numbers.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/>$dsql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>COUNT(*)<sp/>FROM<sp/>{node}<sp/>WHERE<sp/>type<sp/>=<sp/>:node_type&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/>$ndat<sp/>=<sp/>db_query($dsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:node_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_type));</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/>$temp<sp/>=<sp/>$ndat-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/>$ncount<sp/>=<sp/>$temp-&gt;count;</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/>$clsql=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>COUNT(*)<sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/>$cdat<sp/>=<sp/>db_query($clsql);</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/>$clcount<sp/>=<sp/>$cdat-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($ncount<sp/>&lt;<sp/>$clcount)<sp/>{</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/>$count<sp/>=<sp/>$clcount;</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/>$count<sp/>=<sp/>$ncount;</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nNOTE:<sp/>This<sp/>operation<sp/>is<sp/>performed<sp/>using<sp/>a<sp/>database<sp/>transaction.<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;If<sp/>it<sp/>fails<sp/>or<sp/>is<sp/>terminated<sp/>prematurely<sp/>then<sp/>the<sp/>entire<sp/>set<sp/>of<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;changes<sp/>is<sp/>rolled<sp/>back<sp/>and<sp/>will<sp/>not<sp/>be<sp/>found<sp/>in<sp/>the<sp/>database\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/>$m<sp/>=<sp/>ceil($count<sp/>/<sp/>$nentries);</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>($i<sp/>=<sp/>0;<sp/>$i<sp/>&lt;<sp/>$m;<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/da2/tripal__stock__nd__genotypes_8tpl_8php_1aec4de82415d7f05cb9748d12d3a95a87" kindref="member">$offset</ref><sp/>=<sp/>($nentries<sp/>*<sp/>$i);</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad6dd911a15ce9e07b97e2f6652e80187" kindref="member">chado_cleanup_orphaned_nodes_part</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$job_id,<sp/>$nentries,<sp/><ref refid="de/da2/tripal__stock__nd__genotypes_8tpl_8php_1aec4de82415d7f05cb9748d12d3a95a87" kindref="member">$offset</ref>,</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$linking_table,<sp/>$node_type);</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>we<sp/>start<sp/>errors<sp/>on<sp/>new<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog_exception(</highlight><highlight class="stringliteral">&apos;trp-fsync&apos;</highlight><highlight class="normal">,<sp/>$e);</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;FAILED:<sp/>Rolling<sp/>back<sp/>database<sp/>changes...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1054"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"></highlight></codeline>
<codeline lineno="1069" refid="d8/d43/group__tripal__legacy__chado__node__api_1gad6dd911a15ce9e07b97e2f6652e80187" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad6dd911a15ce9e07b97e2f6652e80187" kindref="member">chado_cleanup_orphaned_nodes_part</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$job_id<sp/>=<sp/>NULL,<sp/>$nentries,</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/da2/tripal__stock__nd__genotypes_8tpl_8php_1aec4de82415d7f05cb9748d12d3a95a87" kindref="member">$offset</ref>,<sp/>$linking_table,<sp/>$node_type)<sp/>{</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"></highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/>$count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"></highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Retrieve<sp/>all<sp/>of<sp/>the<sp/>entries<sp/>in<sp/>the<sp/>linker<sp/>table<sp/>for<sp/>a<sp/>given<sp/>node<sp/>type</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>place<sp/>into<sp/>an<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Verifying<sp/>$linking_table<sp/>records...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/>$cnodes<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/>$clsql=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1079"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>*</highlight></codeline>
<codeline lineno="1080"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>LT</highlight></codeline>
<codeline lineno="1081"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>LT.nid<sp/>LIMIT<sp/>$nentries<sp/>OFFSET<sp/>$offset&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/>$res<sp/>=<sp/>db_query($clsql);</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($res<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/>$cnodes[$count]<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>;</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>$count++;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>all<sp/>of<sp/>the<sp/>$linking_table<sp/>entries<sp/>and<sp/>remove<sp/>those</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>don&apos;t<sp/>have<sp/>a<sp/>node<sp/>or<sp/>don&apos;t<sp/>have<sp/>a<sp/>$table<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/>$deleted<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($count<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/>$i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/>$interval<sp/>=<sp/>intval($count<sp/>*<sp/>0.01);</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($interval<sp/>&lt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$interval<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cnodes<sp/>as<sp/>$linker)<sp/>{</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>job<sp/>status<sp/>every<sp/>1%<sp/>analyses</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job_id<sp/>and<sp/>$i<sp/>%<sp/>$interval<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>($i<sp/>/<sp/>$count)<sp/>*<sp/>100);</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval($percent));</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Percent<sp/>complete:<sp/>$percent%.<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>if<sp/>the<sp/>node<sp/>exits,<sp/>if<sp/>not<sp/>remove<sp/>the<sp/>entry<sp/>from<sp/>linking<sp/>table<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$nsql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{node}<sp/>WHERE<sp/>nid<sp/>=<sp/>:nid<sp/>AND<sp/>type<sp/>=<sp/>:node_type&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($nsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:nid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linker-&gt;nid,<sp/></highlight><highlight class="stringliteral">&apos;:node_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_type));</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref><sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$deleted++;</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>WHERE<sp/>nid<sp/>=<sp/>:nid&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:nid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linker-&gt;nid));</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//print<sp/>&quot;$linking_table<sp/>missing<sp/>node....<sp/>DELETING<sp/>where<sp/>nid=&quot;.$linker-&gt;nid.&quot;<sp/>$linking_table<sp/>entry.\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"></highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Does<sp/>record<sp/>in<sp/>chado<sp/>exists,<sp/>if<sp/>not<sp/>remove<sp/>entry<sp/>from<sp/>$linking_table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$table_id<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$lsql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>where<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$table_id<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>:chado_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($lsql,<sp/>array(</highlight><highlight class="stringliteral">&quot;:chado_id&quot;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linker-&gt;$table_id));</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$deleted++;</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>WHERE<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$table_id<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>:chado_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&quot;:chado_id&quot;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linker-&gt;$table_id));</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//print<sp/>&quot;$linking_table<sp/>missing<sp/>$table....<sp/>DELETING<sp/>where<sp/>$table_id=&quot;.$linker-&gt;$table_id.&quot;<sp/>$linking_table<sp/>entry.\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>($i<sp/>/<sp/>$count)<sp/>*<sp/>100);</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval($percent));</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Percent<sp/>complete:<sp/>$percent%.<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nDeleted<sp/>$deleted<sp/>record(s)<sp/>from<sp/>$linking_table<sp/>missing<sp/>either<sp/>a<sp/>node<sp/>or<sp/>chado<sp/>entry.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"></highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>the<sp/>SQL<sp/>statements<sp/>needed<sp/>to<sp/>check<sp/>if<sp/>nodes<sp/>point<sp/>to<sp/>valid<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Verifying<sp/>nodes...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/>$dsql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1137"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>*</highlight></codeline>
<codeline lineno="1138"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{node}</highlight></codeline>
<codeline lineno="1139"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>type<sp/>=<sp/>:node_type</highlight></codeline>
<codeline lineno="1140"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>nid</highlight></codeline>
<codeline lineno="1141"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>LIMIT<sp/>$nentries<sp/>OFFSET<sp/>$offset</highlight></codeline>
<codeline lineno="1142"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"></highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/>$dsql_args<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;:node_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_type);</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/>$nodes<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/>$res<sp/>=<sp/>db_query($dsql,<sp/>$dsql_args);</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/>$count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($res<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/>$nodes[$count]<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>;</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/>$count++;</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"></highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>all<sp/>of<sp/>the<sp/>nodes<sp/>and<sp/>delete<sp/>those<sp/>that<sp/>don&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>have<sp/>a<sp/>corresponding<sp/>entry<sp/>in<sp/>the<sp/>linking<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/>$deleted<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($count<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/>$i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/>$interval<sp/>=<sp/>intval($count<sp/>*<sp/>0.01);</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($interval<sp/>&lt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$interval<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($nodes<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>the<sp/>job<sp/>status<sp/>every<sp/>1%</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job_id<sp/>and<sp/>$i<sp/>%<sp/>$interval<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>($i<sp/>/<sp/>$count)<sp/>*<sp/>100);</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval($percent));</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Percent<sp/>complete:<sp/>$percent%.<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\r&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>node<sp/>has<sp/>a<sp/>corresponding<sp/>entry</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>the<sp/>$linking_table<sp/>table.<sp/>If<sp/>not<sp/>then<sp/>delete<sp/>the<sp/>node.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$csql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$linking_table<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>WHERE<sp/>nid<sp/>=<sp/>:nid<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($csql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:nid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid));</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$link<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$link)<sp/>{</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Checking<sp/>node_access<sp/>creates<sp/>a<sp/>memory<sp/>leak.<sp/>Commenting<sp/>out<sp/>for<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>assuming<sp/>that<sp/>this<sp/>code<sp/>can<sp/>only<sp/>be<sp/>run<sp/>by<sp/>a<sp/>site<sp/>administrator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>anyway.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1179"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(node_access(&apos;delete&apos;,<sp/>$node))<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$deleted++;</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>node_delete(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid);</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1183"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>else<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1184"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/>&quot;\nNode<sp/>missing<sp/>in<sp/>$linking_table<sp/>table....<sp/>but<sp/>cannot<sp/>delete<sp/>due<sp/>to<sp/>improper<sp/>permissions<sp/>(node<sp/>$node-&gt;nid)\n&quot;;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1185"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>($i<sp/>/<sp/>$count)<sp/>*<sp/>100);</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval($percent));</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Percent<sp/>complete:<sp/>$percent%.<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\r&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nDeleted<sp/>$deleted<sp/>node(s)<sp/>that<sp/>did<sp/>not<sp/>have<sp/>corresponding<sp/>$linking_table<sp/>entries.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1196"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"></highlight></codeline>
<codeline lineno="1215" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga191042f2717f754ed7974e4504ec6dfd" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga191042f2717f754ed7974e4504ec6dfd" kindref="member">hook_chado_node_sync_create_new_node</ref>($new_node,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"></highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>relevant<sp/>chado<sp/>details<sp/>to<sp/>the<sp/>new<sp/>node<sp/>object.<sp/>This<sp/>really<sp/>only</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>needs<sp/>to<sp/>be<sp/>the<sp/>fields<sp/>from<sp/>the<sp/>node<sp/>used<sp/>during<sp/>node<sp/>creation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>including<sp/>values<sp/>used<sp/>to<sp/>generate<sp/>the<sp/>title,<sp/>etc.<sp/>All<sp/>additional<sp/>chado</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>data<sp/>will<sp/>be<sp/>added<sp/>via<sp/>nodetype_load<sp/>when<sp/>the<sp/>node<sp/>is<sp/>later<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/>$new_node-&gt;uniquename<sp/>=<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;uniquename;</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"></highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$new_node;</highlight></codeline>
<codeline lineno="1224"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"></highlight></codeline>
<codeline lineno="1238" refid="d8/d43/group__tripal__legacy__chado__node__api_1gaba5aa7ceebcb65b26b34c1bb685eaf92" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gaba5aa7ceebcb65b26b34c1bb685eaf92" kindref="member">hook_chado_node_sync_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"></highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Change<sp/>or<sp/>add<sp/>to<sp/>the<sp/>form<sp/>array<sp/>as<sp/>needed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Any<sp/>changes<sp/>should<sp/>be<sp/>made<sp/>in<sp/>accordance<sp/>with<sp/>the<sp/>Drupal<sp/>Form<sp/>API.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1242"><highlight class="normal"></highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="1244"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"></highlight></codeline>
<codeline lineno="1260" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6cd8d30962617a8cf05c2fa037031ecf" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6cd8d30962617a8cf05c2fa037031ecf" kindref="member">hook_chado_node_sync_form_submit</ref><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"></highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"></highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/>$job_args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>base<sp/>chado<sp/>table<sp/>(ie:<sp/>feature).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/>$base_table,</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>maximum<sp/>number<sp/>of<sp/>records<sp/>to<sp/>sync<sp/>or<sp/>FALSE<sp/>for<sp/>sync<sp/>all<sp/>that<sp/>match.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/>$max_sync,</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>organism_id<sp/>to<sp/>restrict<sp/>records<sp/>to<sp/>or<sp/>FALSE<sp/>if<sp/>not<sp/>to<sp/>restrict<sp/>by<sp/>organism_id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/>$organism_id,</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>string<sp/>with<sp/>the<sp/>cvterm.name<sp/>of<sp/>the<sp/>types<sp/>to<sp/>restrict<sp/>to<sp/>separated<sp/>by<sp/>|||</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="da/df3/tripal__organism__feature__counts_8tpl_8php_1a92d70a97331cc6fc0a79d9da50895be8" kindref="member">$types</ref></highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"></highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>You<sp/>should<sp/>register<sp/>a<sp/>tripal<sp/>job</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>title<sp/>of<sp/>the<sp/>job<sp/>-be<sp/>descriptive.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/>$title,</highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>name<sp/>of<sp/>your<sp/>module.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/>$module,</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>chado<sp/>node<sp/>api<sp/>sync<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado_node_sync_records&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>array<sp/>with<sp/>the<sp/>arguments<sp/>to<sp/>pass<sp/>to<sp/>the<sp/>above<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/>$job_args,</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>user<sp/>who<sp/>submitted<sp/>the<sp/>job.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/>$user-&gt;uid</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"></highlight></codeline>
<codeline lineno="1289"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"></highlight></codeline>
<codeline lineno="1291"><highlight class="normal"></highlight></codeline>
<codeline lineno="1316" refid="d8/d43/group__tripal__legacy__chado__node__api_1gad8268cb0dec1581bd1c48102e62d4e9a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad8268cb0dec1581bd1c48102e62d4e9a" kindref="member">hook_chado_node_sync_select_query</ref>($query)<sp/>{</highlight></codeline>
<codeline lineno="1317"><highlight class="normal"></highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>You<sp/>can<sp/>add<sp/>fields<sp/>to<sp/>be<sp/>selected.<sp/>Be<sp/>sure<sp/>to<sp/>prefix<sp/>each<sp/>field<sp/>with<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>tale<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/>$query[</highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">][]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;example.myfavfield&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Provide<sp/>any<sp/>join<sp/>you<sp/>may<sp/>need<sp/>to<sp/>the<sp/>joins<sp/>array.<sp/>Be<sp/>sure<sp/>to<sp/>wrap<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>table<sp/>name<sp/>in<sp/>curly<sp/>brackets.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/>$query[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">][]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;LEFT<sp/>JOIN<sp/>{exampleprop}<sp/>PROP<sp/>ON<sp/>PROP.example_id=EXAMPLE.example_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"></highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>category<sp/>should<sp/>be<sp/>a<sp/>unique<sp/>id<sp/>for<sp/>a<sp/>group<sp/>of<sp/>items<sp/>that<sp/>will<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>concatenated<sp/>together<sp/>via<sp/>an<sp/>SQL<sp/>&apos;OR&apos;.<sp/><sp/>By<sp/>default<sp/>the<sp/>$where_clases</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>variable<sp/>will<sp/>come<sp/>with<sp/>categories<sp/>of<sp/>&apos;id&apos;,<sp/>&apos;organism&apos;<sp/>and<sp/>&apos;type&apos;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>you<sp/>can<sp/>add<sp/>your<sp/>own<sp/>unique<sp/>category<sp/>or<sp/>alter<sp/>the<sp/>contents<sp/>of<sp/>the<sp/>existing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>categories.<sp/><sp/>Be<sp/>sure<sp/>to<sp/>make<sp/>sure<sp/>the<sp/>category<sp/>doesn&apos;t<sp/>already<sp/>exist</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>the<sp/>$query[&apos;where_clauses&apos;]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/>$category<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;my_category&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"></highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Provide<sp/>any<sp/>aditionall<sp/>where<sp/>clauses<sp/>and<sp/>their<sp/>necessary<sp/>arguments.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Be<sp/>sure<sp/>to<sp/>prefix<sp/>the<sp/>field<sp/>with<sp/>the<sp/>table<sp/>name.<sp/><sp/><sp/>Be<sp/>sure<sp/>that<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>placeholder<sp/>is<sp/>unique<sp/>across<sp/>all<sp/>categories<sp/>(perhaps<sp/>add<sp/>a<sp/>unique</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>prefix/suffix).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/>$query[</highlight><highlight class="stringliteral">&apos;where_clauses&apos;</highlight><highlight class="normal">][$category][]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;example.myfavfield<sp/>=<sp/>:favvalue&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/>$query[</highlight><highlight class="stringliteral">&apos;where_args&apos;</highlight><highlight class="normal">][$category][</highlight><highlight class="stringliteral">&apos;:favvalue&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;awesome-ness&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"></highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Must<sp/>return<sp/>the<sp/>updated<sp/>query</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$query;</highlight></codeline>
<codeline lineno="1343"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="legacy/tripal_core/api/tripal_core.chado_nodes.api.inc"/>
  </compounddef>
</doxygen>
