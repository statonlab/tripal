<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_core.chado_nodes.properties.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga166d6725d26f7be0d222684e055586e0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties</definition>
        <argsstring>(&amp;$form, &amp;$form_state, $details)</argsstring>
        <name>chado_add_node_form_properties</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Provides a form for adding to BASEprop table</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal form array into which the property form elements will be added </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>The corresponding form_state array for the form </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para>An array defining details used by this form. Required keys that are always required:<itemizedlist>
<listitem><para>property_table: the name of the property table (e.g.: featureprop, stockprop, etc.) Required keys for forms that update a record.</para></listitem><listitem><para>chado_id: the id of the record to which properties will be associated (e.g.: if a feature has a feature_id of 999 and we want to associate properties for that feature then the chado_id option should be 999) Require ONE of the following to identify the controlled vocabulary containing the properties to use:</para></listitem><listitem><para>cv_id: the unique key from the cv table</para></listitem><listitem><para>cv_name: the cv.name field uniquely identifying the controlled vocabulary Optional keys include:</para></listitem><listitem><para>chado_id_field: the foreign key field that links properties to the chado_id record. If this value is not specified it is determined using the traditional Chado naming scheme for property tables.</para></listitem><listitem><para>additional_instructions: provides additional instructions to the user for dealing with the property elements. These instructions are appended to the default instructions</para></listitem><listitem><para>fieldset_title: An alternate name for the fieldset in which the properties form is placed. By default the title is &apos;Properties&apos;.</para></listitem><listitem><para>default_properties: An array of properties used to initialize the properties form. Each property shoudl be represented as an array with the following keys and values: &apos;cvterm&apos;: The cvterm object for the property type &apos;value&apos;: The property value</para></listitem><listitem><para>select_options: an array of terms to use for the drop down select box. this array will be used rather than populating the drop down with terms from the named vocabulary. The array must have keys with the cvterm_id and values with the cvterm name. </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="140" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="140" bodyend="643"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7470784204c95102ace1a0f336558d59" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties_add_button_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_properties_add_button_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Called by the add button in chado_add_node_form_properties</para><para>Create an array of properties in the form state. This array will then be used to rebuild the form in subsequent builds </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="679" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="679" bodyend="708"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a8d90195bc15c4d74c36f7df8a4af7a21" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties_add_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_properties_add_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validate the user input for creating a new property Called by the add button in chado_add_node_form_properties </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="650" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="650" bodyend="670"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a430b62bb70e66241eafc981110eaa50d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties_ajax_desc</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>chado_add_node_form_properties_ajax_desc</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametertype>unknown</parametertype>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>unknown</parametertype>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>unknown </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="746" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="746" bodyend="748"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a3377ca970ccc494767540813432adba5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties_create_property_formstate_array</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_properties_create_property_formstate_array</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Creates an array in form_state containing the existing properties. This array is then modified by the add/remove buttons and used as a source for rebuilding the form. This function get&apos;s called at each button (add and remove) button submits the first time one of the button&apos;s is clicked to instantiates the $form_state[&apos;chado_properties&apos;] array</para><para>$form_state[&apos;chado_properties&apos;] = array( &apos;[type_id]-[rank]&apos; =&gt; array( &apos;type_id&apos; =&gt; [the cvterm.cvterm_id value] &apos;type_name&apos; =&gt; [the cvterm.name value] &apos;property_id&apos; =&gt; [the property.property_id value, or NULL if it doesn&apos;t yet exist], &apos;value&apos; =&gt; [the BASEprop.value value], &apos;rank&apos; =&gt; [the BASEprop.rank value], ), ); </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="767" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="767" bodyend="787"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7ede10b894f55c39317196b715fff821" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties_remove_button_submit</definition>
        <argsstring>(&amp;$form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_properties_remove_button_submit</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Remove the correct property from the form Called by the many remove buttons in chado_add_node_form_properties </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="723" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="723" bodyend="738"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a9a74ae1a1c5788d1a5bac925bcdf3cc9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_node_form_properties_remove_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>chado_add_node_form_properties_remove_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Called by the many remove buttons in chado_add_node_form_properties </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="714" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="714" bodyend="716"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga030cf5ac5382e71f01d5e8518bd62b5b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_retrieve_node_form_properties</definition>
        <argsstring>($node)</argsstring>
        <name>chado_retrieve_node_form_properties</name>
        <param>
          <declname>$node</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used in a hook_insert, hook_update for a node form when the chado node properties form has been added to the form. It retrieves all of the properties and returns them in an array of the format:</para><para>$dbxefs[&lt;type_id&gt;][&lt;rank&gt;] = </para><para>This array can then be used for inserting or updating properties</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$node</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A property array </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="850" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="850" bodyend="864"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga3437329db2bcf725de92a9e0ded6e651" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_update_node_form_properties</definition>
        <argsstring>($node, $details, $retrieved_properties=FALSE)</argsstring>
        <name>chado_update_node_form_properties</name>
        <param>
          <declname>$node</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <param>
          <declname>$retrieved_properties</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used in hook_insert or hook_update and handles inserting of any new properties</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$node</parametername>
</parameternamelist>
<parameterdescription>
<para>The node passed into hook_insert &amp; hook_update </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para><itemizedlist>
<listitem><para>property_table: the name of the _property linking table (ie: feature_property)</para></listitem><listitem><para>base_table: the name of the base table (ie: feature)</para></listitem><listitem><para>foreignkey_name: the name of the foreign key used to link to the node content (ie: feature_id)</para></listitem><listitem><para>foreignkey_value: the value of the foreign key (ie: 445, if there exists a feature where feature_id=445) </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$retrieved_properties</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of properties from chado_retrieve_node_form_properties($node). This can be used if you need special handling for some of the properties (See FeatureMap chado_featuremap_insert for an example) </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="883" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="883" bodyend="929"/>
      </memberdef>
      <memberdef kind="function" id="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a4237fd72d4395dd8c09835e042e4c546" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>theme_chado_add_node_form_properties</definition>
        <argsstring>($variables)</argsstring>
        <name>theme_chado_add_node_form_properties</name>
        <param>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Function to theme the add/remove properties form into a table </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" line="794" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc" bodystart="794" bodyend="832"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>API to manage the chado prop table for various Tripal Node Types</para><para>How To Use: <programlisting><codeline><highlight class="normal">function<sp/>chado_example_form($form,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Default<sp/>values<sp/>for<sp/>form<sp/>elements<sp/>can<sp/>come<sp/>in<sp/>the<sp/>following<sp/>ways:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>1)<sp/>as<sp/>elements<sp/>of<sp/>the<sp/>$node<sp/>object.<sp/><sp/>This<sp/>occurs<sp/>when<sp/>editing<sp/>an<sp/>existing<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>2)<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;]<sp/>array<sp/>which<sp/>occurs<sp/>on<sp/>a<sp/>failed<sp/>validation<sp/>or</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>ajax<sp/>callbacks<sp/>when<sp/>the<sp/>ajax<sp/>call<sp/>originates<sp/>from<sp/>non-submit<sp/>fields<sp/>other</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>than<sp/>button</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>3)<sp/>in<sp/>the<sp/>$form_state[&apos;input&apos;]<sp/>array<sp/>which<sp/>occurs<sp/>on<sp/>ajax<sp/>callbacks<sp/>from<sp/>submit</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>form<sp/>elements<sp/>(e.g.<sp/>buttons)<sp/>and<sp/>the<sp/>form<sp/>is<sp/>being<sp/>rebuilt<sp/>but<sp/>has<sp/>not<sp/>yet</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>been<sp/>validated</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>The<sp/>reference<sp/>elements<sp/>added<sp/>by<sp/>this<sp/>function<sp/>do<sp/>use<sp/>AJAX<sp/>calls<sp/>from<sp/>buttons,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>therefore,<sp/>it<sp/>is<sp/>important<sp/>to<sp/>check<sp/>for<sp/>form<sp/>values<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;]</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>for<sp/>case<sp/>#2<sp/>above,<sp/>and<sp/>in<sp/>the<sp/>$form_state[&apos;input&apos;]<sp/>for<sp/>case<sp/>#3.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>See<sp/>the<sp/>chado<sp/>analysis<sp/>node<sp/>form<sp/>for<sp/>an<sp/>example.</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Next,<sp/>add<sp/>in<sp/>all<sp/>the<sp/>form<sp/>array<sp/>definition<sp/>particular<sp/>to<sp/>your<sp/>node<sp/>type</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>To<sp/>add<sp/>in<sp/>the<sp/>chado<sp/>properties<sp/>form<sp/>elements,<sp/>you<sp/>first<sp/>need<sp/>to<sp/>prepare<sp/>the<sp/>arguments</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>for<sp/>the<sp/>function<sp/>call.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;property_table&apos;<sp/>=&gt;<sp/>&apos;example_property&apos;,<sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>table<sp/>linking<sp/>additional<sp/>properties<sp/>to<sp/>this<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;chado_id_field&apos;<sp/>=&gt;<sp/>&apos;example_id&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>key<sp/>to<sp/>link<sp/>to<sp/>the<sp/>chado<sp/>content<sp/>created<sp/>by<sp/>this<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;chado_id&apos;<sp/>=&gt;<sp/>$example_id,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>value<sp/>of<sp/>the<sp/>above<sp/>key</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;cv_name&apos;<sp/>=&gt;<sp/>&apos;example_prop_cv&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>cv<sp/>governing<sp/>the<sp/>_prop.type_id</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;fieldset_title&apos;<sp/>=&gt;<sp/>&apos;Additional<sp/>References&apos;,<sp/>//<sp/>the<sp/>non-translated<sp/>title<sp/>for<sp/>this<sp/>fieldset</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;additional_instructions&apos;<sp/>=&gt;<sp/>&apos;&apos;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>a<sp/>non-stranslated<sp/>string<sp/>providing<sp/>additional<sp/>instructions</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Finally,<sp/>and<sp/>add<sp/>the<sp/>additional<sp/>form<sp/>elements<sp/>to<sp/>the<sp/>form</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>chado_add_node_form_properties($form,<sp/>$form_state,<sp/>$details);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$form;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>chado_example_insert($node)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>if<sp/>there<sp/>is<sp/>an<sp/>example_id<sp/>in<sp/>the<sp/>$node<sp/>object<sp/>then<sp/>this<sp/>must<sp/>be<sp/>a<sp/>sync<sp/>so</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>we<sp/>can<sp/>skip<sp/>adding<sp/>the<sp/>chado_example<sp/>as<sp/>it<sp/>is<sp/>already<sp/>there,<sp/>although</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>we<sp/>do<sp/>need<sp/>to<sp/>proceed<sp/>with<sp/>the<sp/>rest<sp/>of<sp/>the<sp/>insert</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!property_exists($node,<sp/>&apos;example_id&apos;))<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>record<sp/>to<sp/>chado<sp/>example<sp/>table</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>to<sp/>any<sp/>other<sp/>tables<sp/>needed</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>all<sp/>properties</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Existing<sp/>_property<sp/>links<sp/>will<sp/>be<sp/>cleared<sp/>and<sp/>then<sp/>re-added</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>tripal_api_chado_node_properties_form_update_properties(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>node<sp/>object<sp/>passed<sp/>in<sp/>via<sp/>hook_insert()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example_property&apos;,<sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>_property<sp/>linking<sp/>table</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>base<sp/>chado<sp/>table<sp/>for<sp/>the<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example_id&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>key<sp/>to<sp/>link<sp/>to<sp/>the<sp/>chado<sp/>content<sp/>created<sp/>by<sp/>this<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node-&gt;example_id<sp/><sp/><sp/><sp/><sp/>//<sp/>value<sp/>of<sp/>the<sp/>above<sp/>key</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>record<sp/>to<sp/>chado_example<sp/>linking<sp/>example_id<sp/>to<sp/>new<sp/>node</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>chado_example_update($node)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>record<sp/>in<sp/>chado<sp/>example<sp/>table</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>any<sp/>other<sp/>tables<sp/>needed</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Update<sp/>all<sp/>properties</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Existing<sp/>_property<sp/>links<sp/>will<sp/>be<sp/>cleared<sp/>and<sp/>then<sp/>re-added</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>tripal_api_chado_node_properties_form_update_properties(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>node<sp/>object<sp/>passed<sp/>in<sp/>via<sp/>hook_insert()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example_property&apos;,<sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>_property<sp/>linking<sp/>table</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>base<sp/>chado<sp/>table<sp/>for<sp/>the<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;example_id&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>key<sp/>to<sp/>link<sp/>to<sp/>the<sp/>chado<sp/>content<sp/>created<sp/>by<sp/>this<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$node-&gt;example_id<sp/><sp/><sp/><sp/><sp/>//<sp/>value<sp/>of<sp/>the<sp/>above<sp/>key</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Don&apos;t<sp/>need<sp/>to<sp/>update<sp/>chado_example<sp/>linking<sp/>table<sp/>since<sp/>niether<sp/>example_id<sp/>or<sp/>nid<sp/>can<sp/>be<sp/>changed<sp/>in<sp/>update</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting> </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga166d6725d26f7be0d222684e055586e0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga166d6725d26f7be0d222684e055586e0" kindref="member">chado_add_node_form_properties</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state,<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>defaults<sp/>for<sp/>optional<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">,<sp/>$details)){</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Properties&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">,<sp/>$details)){</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;default_properties&apos;</highlight><highlight class="normal">,<sp/>$details)){</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;default_properties&apos;</highlight><highlight class="normal">]<sp/>=<sp/><sp/>array();</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($details[</highlight><highlight class="stringliteral">&apos;default_properties&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;The<sp/>&apos;default_properties&apos;<sp/>option<sp/>must<sp/>be<sp/>an<sp/>array&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcprops_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;The<sp/>&apos;default_properties&apos;<sp/>option<sp/>must<sp/>be<sp/>an<sp/>array&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array());</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>property<sp/>table<sp/>exists<sp/>before<sp/>proceeding.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>($details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>property<sp/>table,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;,<sp/>does<sp/>not<sp/>exists&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcprops_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>property<sp/>table,<sp/>&apos;%name&apos;,<sp/>cannot<sp/>be<sp/>found.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>chado_id_field<sp/>is<sp/>not<sp/>specified<sp/>then<sp/>set<sp/>it<sp/>using<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>typical<sp/>chado<sp/>naming<sp/>scheme</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;chado_id_field&apos;</highlight><highlight class="normal">,<sp/>$details))<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>$chado_id_table<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/prop$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>$chado_id_field<sp/>=<sp/>$chado_id_table<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$chado_id_table;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;chado_id_field&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$chado_id_field;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">]<sp/>=<sp/>str_replace(</highlight><highlight class="stringliteral">&apos;_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$details[</highlight><highlight class="stringliteral">&apos;chado_id_field&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>specified<sp/>cv<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>cv_name<sp/>is<sp/>real</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">),array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>name,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;,<sp/>does<sp/>not<sp/>exists&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcprops_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>named,<sp/>&apos;%name&apos;,<sp/>cannot<sp/>be<sp/>found.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>cv_id<sp/>option<sp/>to<sp/>the<sp/>details<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;cv_id;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/>elseif<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>cv_id<sp/>is<sp/>real</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">),<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>ID,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;,<sp/>does<sp/>not<sp/>exist&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;error&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcprops_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>elements<sp/>to<sp/>the<sp/>form.<sp/>The<sp/>CV<sp/>ID,<sp/>&apos;%id&apos;,<sp/>cannot<sp/>be<sp/>found.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>cv_name<sp/>option<sp/>to<sp/>the<sp/>details<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$result[0]-&gt;name;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>didn&apos;t<sp/>get<sp/>given<sp/>a<sp/>cv<sp/>identifier,<sp/>then<sp/>try<sp/>retrieving<sp/>the<sp/>default<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>using<sp/>the<sp/>new<sp/>cv<sp/>defaults<sp/>api</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>$default_cv<sp/>=<sp/><ref refid="d0/ddc/group__tripal__legacy__chado__cv__api_1ga9b021168fdc9c38c1559c858f3e71457" kindref="member">tripal_get_default_cv</ref>($details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($default_cv))<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$default_cv-&gt;cv_id;</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$default_cv-&gt;name;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$default_form_link<sp/>=<sp/>l(</highlight><highlight class="stringliteral">&apos;vocabulary<sp/>defaults<sp/>configuration<sp/>page&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/vocab/defaults&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;target&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;_blank&apos;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$message<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;There<sp/>is<sp/>not<sp/>a<sp/>default<sp/>vocabulary<sp/>set<sp/>for<sp/>Property<sp/>Types.<sp/>Please<sp/>set<sp/>one<sp/>using<sp/>the<sp/>$default_form_link.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/(\w+)_id/&apos;</highlight><highlight class="normal">,$details[</highlight><highlight class="stringliteral">&apos;chado_id_field&apos;</highlight><highlight class="normal">],$matches))<sp/>{</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>ucwords(str_replace(</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>));</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$message<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;There<sp/>is<sp/>not<sp/>a<sp/>default<sp/>vocabulary<sp/>set<sp/>for<sp/>$table<sp/>Property<sp/>Types.<sp/>Please<sp/>set<sp/>one<sp/>using<sp/>the<sp/><sp/>$default_form_link.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>($message,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tcprops_form&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>provide<sp/>either<sp/>a<sp/>&apos;cv_name&apos;<sp/>or<sp/>&apos;cv_id&apos;<sp/>as<sp/>an<sp/>option<sp/>for<sp/>adding<sp/>properties<sp/>to<sp/>the<sp/>form&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array());</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>property<sp/>types<sp/>for<sp/>the<sp/>select<sp/>list.<sp/>If<sp/>the<sp/>user<sp/>has<sp/>provided<sp/>a<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>use<sp/>those,<sp/>otherwise<sp/>get<sp/>them<sp/>from<sp/>the<sp/>cvterm<sp/>table<sp/>for<sp/>specified<sp/>cv.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;select_options&apos;</highlight><highlight class="normal">,<sp/>$details)<sp/>and</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>is_array($details[</highlight><highlight class="stringliteral">&apos;select_options&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>$property_options<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;select_options&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>select<sp/>options<sp/>are<sp/>not<sp/>provided<sp/>then<sp/>try<sp/>to<sp/>get<sp/>them<sp/>on<sp/>our<sp/>own</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>vocabulary<sp/>name<sp/>is<sp/>provided<sp/>in<sp/>the<sp/>details<sp/>then<sp/>use<sp/>that<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>terms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$property_options<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$property_options[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>Property&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="255"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>DISTINCT<sp/>CVT.cvterm_id,<sp/>CVT.name,<sp/>CVT.definition,<sp/>CV.cv_id<sp/>as<sp/>cv_id</highlight></codeline>
<codeline lineno="256"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/><sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="257"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>ON<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="258"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="259"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CV.name<sp/>=<sp/>:cv_name<sp/>AND</highlight></codeline>
<codeline lineno="260"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NOT<sp/>CVT.is_obsolete<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="261"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>CVT.name<sp/>ASC</highlight></codeline>
<codeline lineno="262"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$prop_types<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($prop<sp/>=<sp/>$prop_types-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$property_options[$prop-&gt;cvterm_id]<sp/>=<sp/>$prop-&gt;name;</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>cv_id<sp/>is<sp/>set<sp/>in<sp/>the<sp/>$details<sp/>array<sp/>then<sp/>use<sp/>that<sp/>to<sp/>get<sp/>the<sp/>terms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$property_options<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$property_options[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>Property&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="273"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>DISTINCT<sp/>CVT.cvterm_id,<sp/>CVT.name,<sp/>CVT.definition,<sp/>CV.name<sp/>as<sp/>cv_name</highlight></codeline>
<codeline lineno="274"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/><sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="275"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>ON<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="276"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="277"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CV.cv_id<sp/>=<sp/>:cv_id<sp/>AND</highlight></codeline>
<codeline lineno="278"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NOT<sp/>CVT.is_obsolete<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="279"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>CVT.name<sp/>ASC</highlight></codeline>
<codeline lineno="280"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$prop_types<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($prop<sp/>=<sp/>$prop_types-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$property_options[$prop-&gt;cvterm_id]<sp/>=<sp/>$prop-&gt;name;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Tell<sp/>tripal<sp/>administrators<sp/>how<sp/>to<sp/>add<sp/>terms<sp/>to<sp/>the<sp/>property<sp/>types<sp/>drop<sp/>down.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($property_options))<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>$tripal_message<sp/>=<sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>(</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>t(</highlight><highlight class="stringliteral">&apos;There<sp/>are<sp/>currently<sp/>no<sp/>property<sp/>types!<sp/>To<sp/>add<sp/>properties<sp/>to<sp/>the<sp/>drop</highlight></codeline>
<codeline lineno="292"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>down<sp/>list,<sp/>you<sp/>need<sp/>to<sp/>&lt;a<sp/>href=&quot;@cvtermlink&quot;&gt;add<sp/>a<sp/>controlled<sp/>vocabulary<sp/>term&lt;/a&gt;</highlight></codeline>
<codeline lineno="293"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>the<sp/>%cv_name<sp/>controlled<sp/>vocabulary.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;@cvtermlink&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>url(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/chado_vocabs/chado_cv/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/cvterm/add&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1ad9759873be1ae0c3d8ccc37d121aeb3c" kindref="member">TRIPAL_NOTICE</ref>,</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;return_html&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE)</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>$tripal_message<sp/>=<sp/><ref refid="d9/dae/group__tripal__notify__api_1ga8c4c41c79200e1d3c8145386f12eaa4e" kindref="member">tripal_set_message</ref>(</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>t(</highlight><highlight class="stringliteral">&apos;To<sp/>add<sp/>additional<sp/>properties<sp/>to<sp/>the<sp/>drop<sp/>down<sp/>list,<sp/>you<sp/>need<sp/>to<sp/>&lt;a<sp/>href=&quot;@cvtermlink&quot;&gt;add</highlight></codeline>
<codeline lineno="306"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>controlled<sp/>vocabulary<sp/>term&lt;/a&gt;<sp/>to<sp/>the<sp/>%cv_name<sp/>controlled<sp/>vocabulary.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;@cvtermlink&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>url(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/chado_vocabs/chado_cv/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/cvterm/add&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1ae3246842a9b0bc4b8ecf2951cb1a949a" kindref="member">TRIPAL_INFO</ref>,</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;return_html&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE)</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Group<sp/>all<sp/>of<sp/>the<sp/>chado<sp/>node<sp/>api<sp/>fieldsets<sp/>into<sp/>vertical<sp/>tabs.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;vertical_tabs&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;css&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado-node-api&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_core&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/css/chado_node_api.css&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>fieldset<sp/>of<sp/>the<sp/>property<sp/>elements</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/>$instructions<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;To<sp/>add<sp/>properties<sp/>of<sp/>the<sp/>current<sp/>%nodetype,<sp/>select<sp/>the<sp/>type<sp/>of</highlight></codeline>
<codeline lineno="329"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>information<sp/>from<sp/>the<sp/>drop-down<sp/>below<sp/>and<sp/>enter<sp/>the<sp/>information<sp/>in<sp/>the<sp/>text<sp/>box<sp/>before</highlight></codeline>
<codeline lineno="330"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>clicking<sp/>&quot;Add&quot;.<sp/>To<sp/>remove<sp/>incorrect<sp/>information,<sp/>click<sp/>the<sp/>&quot;Remove&quot;<sp/>button.</highlight></codeline>
<codeline lineno="331"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>Note:<sp/>you<sp/>cannot<sp/>edit<sp/>previously<sp/>added<sp/>information<sp/>but<sp/>instead<sp/>need<sp/>to</highlight></codeline>
<codeline lineno="332"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>remove<sp/>and<sp/>re-add<sp/>it.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;&lt;p&gt;&lt;strong&gt;Additional<sp/>information<sp/>about<sp/>a</highlight></codeline>
<codeline lineno="337"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>%nodetype.&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;&apos;</highlight><highlight class="normal">.<sp/>$instructions<sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/p&gt;&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%nodetype&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;nodetype&apos;</highlight><highlight class="normal">]))<sp/>,</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#group&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#weight&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>8,</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado-node-api&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">)),</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;js&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado-node-api-vertical-tabs&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_core&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/js/chadoNodeApi_updateVerticalTabSummary.js&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>form<sp/>element<sp/>is<sp/>a<sp/>tree,<sp/>so<sp/>that<sp/>we<sp/>don&apos;t<sp/>puke<sp/>all<sp/>of<sp/>the<sp/>values<sp/>into<sp/>then<sp/>node<sp/>variable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>is<sp/>set<sp/>as<sp/>a<sp/>tree,<sp/>and<sp/>keeps<sp/>them<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;][&apos;property_table&apos;]<sp/>heading.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#tree&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;tripal-generic-edit-properties-table&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#theme&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;chado_node_properties_form_table&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>to<sp/>provide<sp/>feedback<sp/>to<sp/>the<sp/>user<sp/>that<sp/>changes<sp/>made</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>are<sp/>not<sp/>saved<sp/>until<sp/>the<sp/>node<sp/>is<sp/>saved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;save_warning&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;property-save-warning&quot;<sp/>class=&quot;messages<sp/>warning&quot;<sp/>style=&quot;display:none;&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;*<sp/>The<sp/>changes<sp/>to<sp/>these<sp/>properties<sp/>will<sp/>not<sp/>be<sp/>saved<sp/>until<sp/>the</highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;Save&quot;<sp/>button<sp/>at<sp/>the<sp/>bottom<sp/>of<sp/>this<sp/>form<sp/>is<sp/>clicked.<sp/>&lt;span<sp/>class=&quot;specific-changes&quot;&gt;&lt;/span&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attached&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;js&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado-node-api-unsaved&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_core&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/theme/js/chadoNodeApi_unsavedNotify.js&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>defaults<sp/>into<sp/>form_state<sp/>to<sp/>be<sp/>used<sp/>elsewhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($details)</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Properties<sp/>can<sp/>come<sp/>to<sp/>us<sp/>in<sp/>two<sp/>ways:</highlight></codeline>
<codeline lineno="382"><highlight class="comment"><sp/><sp/><sp/>*<sp/>1)<sp/>As<sp/>entries<sp/>in<sp/>the<sp/>$details[&apos;default_properties&apos;]<sp/>option</highlight></codeline>
<codeline lineno="383"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="384"><highlight class="comment"><sp/><sp/><sp/>*<sp/>2)<sp/>In<sp/>the<sp/>form<sp/>state<sp/>in<sp/>the<sp/>$form_state[&apos;chado_properties&apos;].<sp/>Data<sp/>is<sp/>in<sp/>this<sp/>field</highlight></codeline>
<codeline lineno="385"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>when<sp/>an<sp/>AJAX<sp/>call<sp/>updates<sp/>the<sp/>form<sp/>state<sp/>or<sp/>a<sp/>validation<sp/>error.</highlight></codeline>
<codeline lineno="386"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="387"><highlight class="comment"><sp/><sp/><sp/>*<sp/>3)<sp/>Directly<sp/>from<sp/>the<sp/>database<sp/>if<sp/>the<sp/>record<sp/>already<sp/>has<sp/>properties<sp/>associated.<sp/><sp/>This</highlight></codeline>
<codeline lineno="388"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>data<sp/>is<sp/>only<sp/>used<sp/>the<sp/>first<sp/>time<sp/>the<sp/>form<sp/>is<sp/>loaded.<sp/>On<sp/>AJAX<sp/>calls<sp/>or<sp/>validation</highlight></codeline>
<codeline lineno="389"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>errors<sp/>the<sp/>fields<sp/>on<sp/>the<sp/>form<sp/>are<sp/>populated<sp/>from<sp/>the<sp/>$form_state[&apos;chado_properties&apos;]</highlight></codeline>
<codeline lineno="390"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/>entry.</highlight></codeline>
<codeline lineno="391"><highlight class="comment"><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>$existing_properties<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>build<sp/>the<sp/>SQL<sp/>for<sp/>extracting<sp/>properties<sp/>already<sp/>assigned<sp/>to<sp/>this<sp/>record</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql_args[</highlight><highlight class="stringliteral">&apos;:chado_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;chado_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">,<sp/>$details))<sp/>{</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cv_where<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CV.name<sp/>=<sp/>:cvname&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql_args[</highlight><highlight class="stringliteral">&apos;:cvname&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">,<sp/>$details))<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cv_where<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;CV.cv_id<sp/>=<sp/>:cvid&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql_args[</highlight><highlight class="stringliteral">&apos;:cvid&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/>$existing_properties<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>(</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT</highlight></codeline>
<codeline lineno="410"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PP.&quot;</highlight><highlight class="normal">.$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">].</highlight><highlight class="stringliteral">&quot;_id<sp/>property_id,</highlight></codeline>
<codeline lineno="411"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CVT.cvterm_id<sp/>as<sp/>type_id,</highlight></codeline>
<codeline lineno="412"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CVT.name<sp/>as<sp/>type_name,</highlight></codeline>
<codeline lineno="413"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CVT.definition,</highlight></codeline>
<codeline lineno="414"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PP.value,</highlight></codeline>
<codeline lineno="415"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PP.rank</highlight></codeline>
<codeline lineno="416"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}<sp/>PP</highlight></codeline>
<codeline lineno="417"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVT<sp/>ON<sp/>CVT.cvterm_id<sp/>=<sp/>PP.type_id</highlight></codeline>
<codeline lineno="418"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/><sp/><sp/><sp/><sp/><sp/>ON<sp/>CVT.cv_id<sp/><sp/><sp/><sp/><sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="419"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="420"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PP.&quot;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;chado_id_field&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>=<sp/>:chado_id<sp/>AND</highlight></codeline>
<codeline lineno="421"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$cv_where</highlight></codeline>
<codeline lineno="422"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>CVT.name,<sp/>PP.rank&quot;</highlight><highlight class="normal">,<sp/>$sql_args)-&gt;fetchAll();</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>next<sp/>add<sp/>in<sp/>any<sp/>default<sp/>properties</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;default_properties&apos;</highlight><highlight class="normal">,<sp/>$details))<sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>next<sp/>iterate<sp/>through<sp/>each<sp/>of<sp/>the<sp/>default<sp/>properties<sp/>and<sp/>create<sp/>a<sp/>new</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>stdClass<sp/>array<sp/>that<sp/>contains<sp/>the<sp/>fields<sp/>needed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($details[</highlight><highlight class="stringliteral">&apos;default_properties&apos;</highlight><highlight class="normal">]<sp/>as<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop-&gt;type_id<sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">]-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop-&gt;type_name<sp/><sp/><sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">]-&gt;name;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop-&gt;definition<sp/><sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">]-&gt;definition;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop-&gt;value<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop-&gt;property_id<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;TEMP&apos;</highlight><highlight class="normal"><sp/>.<sp/>uniqid();</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_prop-&gt;rank<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;TEMP&apos;</highlight><highlight class="normal"><sp/>.<sp/>uniqid();</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$existing_properties[]<sp/>=<sp/>$new_prop;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="441"><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>format<sp/>of<sp/>the<sp/>$existing_properties<sp/>array<sp/>is<sp/>either:</highlight></codeline>
<codeline lineno="443"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="444"><highlight class="comment"><sp/><sp/><sp/>*<sp/>From<sp/>the<sp/>chado_properties<sp/>array:</highlight></codeline>
<codeline lineno="445"><highlight class="comment"><sp/><sp/><sp/>*<sp/>$form_state[&apos;chado_properties&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="446"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>&apos;[type_id]-[rank]&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="447"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_id&apos;<sp/>=&gt;<sp/>[the<sp/>cvterm.cvterm_id<sp/>value]</highlight></codeline>
<codeline lineno="448"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_name&apos;<sp/>=&gt;<sp/>[the<sp/>cvterm.name<sp/>value]</highlight></codeline>
<codeline lineno="449"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;property_id&apos;<sp/>=&gt;<sp/>[the<sp/>property.property_id<sp/>value,<sp/>or<sp/>temporary<sp/>value<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>yet<sp/>exist],</highlight></codeline>
<codeline lineno="450"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;value&apos;<sp/>=&gt;<sp/>[the<sp/>BASEprop.value<sp/>value],</highlight></codeline>
<codeline lineno="451"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;rank&apos;<sp/>=&gt;<sp/>[the<sp/>BASEprop.rank<sp/>value<sp/>or<sp/>NULL<sp/>if<sp/>not<sp/>saved<sp/>yet],</highlight></codeline>
<codeline lineno="452"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="453"><highlight class="comment"><sp/><sp/><sp/>*<sp/>);</highlight></codeline>
<codeline lineno="454"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="455"><highlight class="comment"><sp/><sp/><sp/>*<sp/>OR</highlight></codeline>
<codeline lineno="456"><highlight class="comment"><sp/><sp/><sp/>*<sp/>Populated<sp/>from<sp/>the<sp/>database:</highlight></codeline>
<codeline lineno="457"><highlight class="comment"><sp/><sp/><sp/>*<sp/>$existing_property<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="458"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>0<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="459"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;property_id&apos;<sp/>=&gt;<sp/>[the<sp/>property.property_id<sp/>value],</highlight></codeline>
<codeline lineno="460"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_id&apos;<sp/>=&gt;<sp/>[the<sp/>cvterm.cvterm_id<sp/>value]</highlight></codeline>
<codeline lineno="461"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;type_name&apos;<sp/>=&gt;<sp/>[the<sp/>cvterm.name<sp/>value]</highlight></codeline>
<codeline lineno="462"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;value&apos;<sp/>=&gt;<sp/>[the<sp/>BASEprop.value<sp/>value],</highlight></codeline>
<codeline lineno="463"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/><sp/><sp/>&apos;rank&apos;<sp/>=&gt;<sp/>[the<sp/>BASEprop.rank<sp/>value],</highlight></codeline>
<codeline lineno="464"><highlight class="comment"><sp/><sp/><sp/>*<sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="465"><highlight class="comment"><sp/><sp/><sp/>*<sp/>);</highlight></codeline>
<codeline lineno="466"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="467"><highlight class="comment"><sp/><sp/><sp/>*<sp/>NOTE:<sp/>The<sp/>main<sp/>difference<sp/>is<sp/>the<sp/>key</highlight></codeline>
<codeline lineno="468"><highlight class="comment"><sp/><sp/><sp/>*</highlight></codeline>
<codeline lineno="469"><highlight class="comment"><sp/><sp/><sp/>*<sp/>Loop<sp/>on<sp/>the<sp/>array<sp/>elements<sp/>of<sp/>the<sp/>$existing_properties<sp/>array<sp/>and<sp/>add</highlight></codeline>
<codeline lineno="470"><highlight class="comment"><sp/><sp/><sp/>*<sp/>an<sp/>element<sp/>to<sp/>the<sp/>form<sp/>for<sp/>each<sp/>one<sp/>as<sp/>long<sp/>as<sp/>it&apos;s<sp/>also<sp/>in<sp/>the</highlight></codeline>
<codeline lineno="471"><highlight class="comment"><sp/><sp/><sp/>*<sp/>$properties_options<sp/>array.</highlight></codeline>
<codeline lineno="472"><highlight class="comment"><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/>$num_properties<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($existing_properties<sp/>as<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>)<sp/>{</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id,<sp/>$property_options))<sp/>{</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$num_properties++;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][</highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;property&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;saved&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="486"><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>whether<sp/>this<sp/>property<sp/>is<sp/>unsaved<sp/>or<sp/>not.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can<sp/>tell<sp/>this<sp/>by<sp/>looking<sp/>at<sp/>the<sp/>property_id:<sp/>if<sp/>it&apos;s<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>saved<sp/>yet<sp/>we<sp/>will<sp/>have<sp/>entered<sp/>a<sp/>TEMP###.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^TEMP/&apos;</highlight><highlight class="normal">,<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id))<sp/>{</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;property&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;unsaved&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;prop_type_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;prop_value&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;value</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;prop_rank&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;rank</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;property_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_name,</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;row-unsaved-warning&quot;&gt;&lt;/span&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>definition<sp/>is<sp/>available<sp/>we<sp/>want<sp/>to<sp/>add<sp/>that<sp/>to<sp/>the<sp/>type<sp/>column</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>make<sp/>it<sp/>easier<sp/>for<sp/>users<sp/>to<sp/>determine<sp/>what<sp/>an<sp/>added<sp/>property<sp/>means.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;definition))<sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;i&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;definition<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/i&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;value,</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;rank</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>button</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id][<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id][</highlight><highlight class="stringliteral">&apos;property_action&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Remove&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;properties_remove-&quot;</highlight><highlight class="normal">.<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;type_id.</highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal">.<ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>-&gt;property_id,</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;chado_add_node_form_subtable_ajax_update&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-generic-edit-properties-table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;prevent&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;click&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>When<sp/>this<sp/>button<sp/>is<sp/>clicked,<sp/>the<sp/>form<sp/>will<sp/>be<sp/>validated<sp/>and<sp/>submitted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore,<sp/>we<sp/>set<sp/>custom<sp/>submit<sp/>and<sp/>validate<sp/>functions<sp/>to<sp/>override<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>node<sp/>form<sp/>submit.<sp/><sp/>In<sp/>the<sp/>validate<sp/>function<sp/>we<sp/>validate<sp/>only<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>property<sp/>fields<sp/>and<sp/>in<sp/>the<sp/>submit<sp/>we<sp/>remove<sp/>the<sp/>indicated<sp/>property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>from<sp/>the<sp/>chado_properties<sp/>array.<sp/>In<sp/>order<sp/>to<sp/>keep<sp/>validate<sp/>errors</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>from<sp/>the<sp/>node<sp/>form<sp/>validate<sp/>and<sp/>Drupal<sp/>required<sp/>errors<sp/>for<sp/>non-property<sp/>fields</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>preventing<sp/>the<sp/>user<sp/>from<sp/>removing<sp/>properties<sp/>we<sp/>set<sp/>the<sp/>#limit_validation_errors<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_remove_button_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_remove_button_submit&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Limit<sp/>the<sp/>validation<sp/>of<sp/>the<sp/>form<sp/>upon<sp/>clicking<sp/>this<sp/>button<sp/>to<sp/>the<sp/>property_table<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>other<sp/>fields<sp/>will<sp/>be<sp/>validated<sp/>(ie:<sp/>no<sp/>fields<sp/>from<sp/>the<sp/>main<sp/>form<sp/>or<sp/>any<sp/>other<sp/>api</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>added<sp/>form).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#limit_validation_errors&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">)<sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>all<sp/>fields<sp/>within<sp/>$form_state[&apos;values&apos;][&apos;property_table&apos;]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Quickly<sp/>add<sp/>a<sp/>hidden<sp/>field<sp/>stating<sp/>how<sp/>many<sp/>properties<sp/>are<sp/>currently<sp/>added.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_properties&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$num_properties,</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;num-properties&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="573"><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Form<sp/>elements<sp/>for<sp/>adding<sp/>a<sp/>new<sp/>property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//---------------------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;addtl-properties-add-new-property&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/span&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>value<sp/>selected<sp/>(only<sp/>works<sp/>on<sp/>AJAX<sp/>call)<sp/>and<sp/>print<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>description</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/>$type_desc<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/>$new_type_id<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/>$new_term<sp/>=<sp/><ref refid="d1/d3c/group__tripal__chado__module__DEPRECATED__api_1gadf441e46c4ddcff4ea26bb9d99546a10" kindref="member">tripal_get_cvterm</ref>(array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$new_type_id));</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($new_term)<sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_desc<sp/>=<sp/>$new_term-&gt;definition;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$property_options,<sp/></highlight><highlight class="comment">//<sp/>Set<sp/>at<sp/>top<sp/>of<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>id=&quot;tripal-generic-edit-properties-new-desc&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;i&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$type_desc<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/i&gt;&lt;/span&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;chado_add_node_form_properties_ajax_desc&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-generic-edit-properties-new-desc&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>2,</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="609"><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>button</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_action&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Add&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;properties-add&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;chado_add_node_form_subtable_ajax_update&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-generic-edit-properties-table&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;prevent&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;click&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>When<sp/>this<sp/>button<sp/>is<sp/>clicked,<sp/>the<sp/>form<sp/>will<sp/>be<sp/>validated<sp/>and<sp/>submitted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore,<sp/>we<sp/>set<sp/>custom<sp/>submit<sp/>and<sp/>validate<sp/>functions<sp/>to<sp/>override<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>node<sp/>form<sp/>submit.<sp/><sp/>In<sp/>the<sp/>validate<sp/>function<sp/>we<sp/>validate<sp/>only<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>additional<sp/>property<sp/>fields<sp/>and<sp/>in<sp/>the<sp/>submit<sp/>we<sp/>add<sp/>them<sp/>to<sp/>the<sp/>chado_properties</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>array.<sp/>In<sp/>order<sp/>to<sp/>keep<sp/>validate<sp/>errors<sp/>from<sp/>the<sp/>node<sp/>form<sp/>validate<sp/>and<sp/>Drupal</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>required<sp/>errors<sp/>for<sp/>non-property<sp/>fields<sp/>preventing<sp/>the<sp/>user<sp/>from<sp/>adding<sp/>properties<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>#limit_validation_errors<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_add_button_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_node_form_subtables_add_button_submit&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Limit<sp/>the<sp/>validation<sp/>of<sp/>the<sp/>form<sp/>upon<sp/>clicking<sp/>this<sp/>button<sp/>to<sp/>the<sp/>property_table<sp/>tree</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>other<sp/>fields<sp/>will<sp/>be<sp/>validated<sp/>(ie:<sp/>no<sp/>fields<sp/>from<sp/>the<sp/>main<sp/>form<sp/>or<sp/>any<sp/>other<sp/>api</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>added<sp/>form).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#limit_validation_errors&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">)<sp/><sp/></highlight><highlight class="comment">//<sp/>Validate<sp/>all<sp/>fields<sp/>within<sp/>$form_state[&apos;values&apos;][&apos;property_table&apos;]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="638"><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;admin_message&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;markup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$tripal_message</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="643"><highlight class="normal">}</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="650" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a8d90195bc15c4d74c36f7df8a4af7a21" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a8d90195bc15c4d74c36f7df8a4af7a21" kindref="member">chado_add_node_form_properties_add_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>the<sp/>type_id<sp/>is<sp/>supplied<sp/>&amp;<sp/>Valid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($cvterm[0]))<sp/>{</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;property_table][new][cvterm&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>select<sp/>a<sp/>property<sp/>type<sp/>before<sp/>attempting<sp/>to<sp/>add<sp/>a<sp/>new<sp/>property.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">]<sp/><sp/>=<sp/>$cvterm[0]-&gt;name;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$cvterm[0]-&gt;definition;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>value<sp/>is<sp/>supplied</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;property_table][new][value&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;You<sp/>must<sp/>enter<sp/>the<sp/>property<sp/>value<sp/>before<sp/>attempting<sp/>to<sp/>add<sp/>a<sp/>new<sp/>property.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="670"><highlight class="normal">}</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="679" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7470784204c95102ace1a0f336558d59" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7470784204c95102ace1a0f336558d59" kindref="member">chado_add_node_form_properties_add_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/>$details<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="682"><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>chado_additional_properties<sp/>array<sp/>is<sp/>not<sp/>set<sp/>then<sp/>this<sp/>is<sp/>the<sp/>first<sp/>time<sp/>modifying<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>property<sp/>table.<sp/>this<sp/>means<sp/>we<sp/>need<sp/>to<sp/>include<sp/>all<sp/>the<sp/>properties<sp/>from<sp/>the<sp/>db</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a3377ca970ccc494767540813432adba5" kindref="member">chado_add_node_form_properties_create_property_formstate_array</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>details<sp/>for<sp/>the<sp/>new<sp/>property</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;property_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;TEMP&apos;</highlight><highlight class="normal"><sp/>.<sp/>uniqid(),</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;TEMP&apos;</highlight><highlight class="normal"><sp/>.<sp/>uniqid(),</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/>$key<sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;property_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">][$key]<sp/>=<sp/>(object)<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>the<sp/>new<sp/>element<sp/>to<sp/>pick<sp/>up<sp/>the<sp/>values<sp/>from<sp/>the<sp/>previous<sp/>element<sp/>so<sp/>wipe<sp/>them<sp/>out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal">}</highlight></codeline>
<codeline lineno="709"><highlight class="normal"></highlight></codeline>
<codeline lineno="714" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a9a74ae1a1c5788d1a5bac925bcdf3cc9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a9a74ae1a1c5788d1a5bac925bcdf3cc9" kindref="member">chado_add_node_form_properties_remove_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>validation<sp/>needed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal">}</highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight></codeline>
<codeline lineno="723" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7ede10b894f55c39317196b715fff821" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a7ede10b894f55c39317196b715fff821" kindref="member">chado_add_node_form_properties_remove_button_submit</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="724"><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>chado_properties<sp/>array<sp/>is<sp/>not<sp/>set<sp/>then<sp/>this<sp/>is<sp/>the<sp/>first<sp/>time<sp/>modifying<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>property<sp/>table.<sp/>this<sp/>means<sp/>we<sp/>need<sp/>to<sp/>include<sp/>all<sp/>the<sp/>properties<sp/>from<sp/>the<sp/>db</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a3377ca970ccc494767540813432adba5" kindref="member">chado_add_node_form_properties_create_property_formstate_array</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="730"><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>specified<sp/>property<sp/>from<sp/>the<sp/>form<sp/>property<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(preg_match(</highlight><highlight class="stringliteral">&apos;/properties_remove-([^-]+-[^-]+)/&apos;</highlight><highlight class="normal">,$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">],$match))<sp/>{</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/>$key<sp/>=<sp/>$match[1];</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists($key,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>unset($form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">][$key]);</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="738"><highlight class="normal">}</highlight></codeline>
<codeline lineno="739"><highlight class="normal"></highlight></codeline>
<codeline lineno="746" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a430b62bb70e66241eafc981110eaa50d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a430b62bb70e66241eafc981110eaa50d" kindref="member">chado_add_node_form_properties_ajax_desc</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="748"><highlight class="normal">}</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="767" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a3377ca970ccc494767540813432adba5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a3377ca970ccc494767540813432adba5" kindref="member">chado_add_node_form_properties_create_property_formstate_array</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="770"><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">])<sp/>as<sp/>$type_id)<sp/>{</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type_id<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][$type_id])<sp/>as<sp/>$property_id)<sp/>{</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref><sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">][$type_id][$property_id];</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;prop_type_id&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;property_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;property_id&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$key<sp/>=<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>[</highlight><highlight class="stringliteral">&apos;property_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;chado_properties&apos;</highlight><highlight class="normal">][$key]<sp/>=<sp/>(object)<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="787"><highlight class="normal">}</highlight></codeline>
<codeline lineno="788"><highlight class="normal"></highlight></codeline>
<codeline lineno="794" refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a4237fd72d4395dd8c09835e042e4c546" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d25/tripal__core_8chado__nodes_8properties_8api_8inc_1a4237fd72d4395dd8c09835e042e4c546" kindref="member">theme_chado_add_node_form_properties</ref>($variables)<sp/>{</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;element&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="796"><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Type&apos;</highlight><highlight class="normal">),<sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;width&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;30%&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Value&apos;</highlight><highlight class="normal">),<sp/><sp/></highlight><highlight class="stringliteral">&apos;width&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;50%&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;property_action&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Actions&apos;</highlight><highlight class="normal">),</highlight><highlight class="stringliteral">&apos;width&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;20%&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>)<sp/>as<sp/>$type_id)<sp/>{</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type_id<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$row<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>as<sp/>$fieldname<sp/>=&gt;<sp/>$title)<sp/>{</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$fieldname]);</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>$row;</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(element_children(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id])<sp/>as<sp/>$version)<sp/>{</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="817"><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal">]<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$version][</highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>as<sp/>$fieldname<sp/>=&gt;<sp/>$title)<sp/>{</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$row[</highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[$type_id][$version][$fieldname]);</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>$row;</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;save_warning&apos;</highlight><highlight class="normal">])<sp/>.<sp/>theme(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/>array(</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>,</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref></highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/>));</highlight></codeline>
<codeline lineno="832"><highlight class="normal">}</highlight></codeline>
<codeline lineno="833"><highlight class="normal"></highlight></codeline>
<codeline lineno="850" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga030cf5ac5382e71f01d5e8518bd62b5b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga030cf5ac5382e71f01d5e8518bd62b5b" kindref="member">chado_retrieve_node_form_properties</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a7f675de4b5983d7e84f6573b7d4d453d" kindref="member">$properties</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;property_table))<sp/>{</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;property_table<sp/>as<sp/>$type_id<sp/>=&gt;<sp/>$elements)<sp/>{</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($type_id<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal"><sp/>AND<sp/>$type_id<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;details&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($elements<sp/>as<sp/>$property_id<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>)<sp/>{</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a7f675de4b5983d7e84f6573b7d4d453d" kindref="member">$properties</ref>[$type_id][<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;prop_rank&apos;</highlight><highlight class="normal">]]<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&apos;prop_value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="862"><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a7f675de4b5983d7e84f6573b7d4d453d" kindref="member">$properties</ref>;</highlight></codeline>
<codeline lineno="864"><highlight class="normal">}</highlight></codeline>
<codeline lineno="865"><highlight class="normal"></highlight></codeline>
<codeline lineno="883" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga3437329db2bcf725de92a9e0ded6e651" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga3437329db2bcf725de92a9e0ded6e651" kindref="member">chado_update_node_form_properties</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>,<sp/>$details,<sp/>$retrieved_properties<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="884"><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="886"><highlight class="normal"></highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;property_table)<sp/>AND<sp/>($details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">]<sp/>&gt;<sp/>0))<sp/>{</highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>remove<sp/>existing<sp/>property<sp/>links</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gaad9a3b9f75cdf27faac5d05d39d4831d" kindref="member">chado_delete_record</ref>($details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">],<sp/>array($details[</highlight><highlight class="stringliteral">&apos;foreignkey_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="890"><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>back<sp/>in<sp/>property<sp/>links<sp/>and<sp/>insert<sp/>properties<sp/>as<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($retrieved_properties)<sp/>{</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a7f675de4b5983d7e84f6573b7d4d453d" kindref="member">$properties</ref><sp/>=<sp/>$retrieved_properties;</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a7f675de4b5983d7e84f6573b7d4d453d" kindref="member">$properties</ref><sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga030cf5ac5382e71f01d5e8518bd62b5b" kindref="member">chado_retrieve_node_form_properties</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a7f675de4b5983d7e84f6573b7d4d453d" kindref="member">$properties</ref><sp/>as<sp/>$type_id<sp/>=&gt;<sp/>$ranks)<sp/>{</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($ranks<sp/>as<sp/>$rank<sp/>=&gt;<sp/>$value)<sp/>{</highlight></codeline>
<codeline lineno="900"><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^TEMP/&apos;</highlight><highlight class="normal">,<sp/>$rank))<sp/>{</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rank<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga58c9cf065ae5581e5c8cb43b32ff92b4" kindref="member">chado_get_table_max_rank</ref>(</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rank<sp/>=<sp/>strval($rank<sp/>+<sp/>1);</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;property_table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_name&apos;</highlight><highlight class="normal">]<sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;foreignkey_value&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id,</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$value,</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$rank</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="920"><highlight class="normal"></highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">],<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>Insert:<sp/>Unable<sp/>to<sp/>insert<sp/>property<sp/>type_id<sp/>%cvterm<sp/>with<sp/>value<sp/>%value.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%cvterm&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id,<sp/></highlight><highlight class="stringliteral">&apos;%value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$value));</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="929"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="legacy/tripal_core/api/tripal_core.chado_nodes.properties.api.inc"/>
  </compounddef>
</doxygen>
