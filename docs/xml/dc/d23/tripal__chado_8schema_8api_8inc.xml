<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="dc/d23/tripal__chado_8schema_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_chado.schema.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="dc/d23/tripal__chado_8schema_8api_8inc_1a20c4f980bfbbf611a66e32fbb6be876e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_index</definition>
        <argsstring>($table, $name, $fields)</argsstring>
        <name>chado_add_index</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$name</declname>
        </param>
        <param>
          <declname>$fields</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A Chado-aware wrapper for the db_add_index() function.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The table to be altered. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the index. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$fields</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of field names. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="228" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="228" bodyend="245"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga6b0a91d47d38c3239f05ff029c6ceb27" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_column_exists</definition>
        <argsstring>($table, $column)</argsstring>
        <name>chado_column_exists</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$column</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that any given column in a Chado table exists.</para><para>This function is necessary because Drupal&apos;s db_field_exists() will not look in any other schema but the one were Drupal is installed</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the chado table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$column</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the column in the chado table.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the column exists for the table in the chado schema and FALSE if it does not. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="105" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="105" bodyend="144"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_dbschema_exists</definition>
        <argsstring>($schema)</argsstring>
        <name>chado_dbschema_exists</name>
        <param>
          <declname>$schema</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that any given schema exists.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$schema</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the schema to check the existence of</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE/FALSE depending upon whether or not the schema exists </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="258" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="258" bodyend="273"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1gac8dd761f6e669661f9bf5a967a83d6de" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_base_tables</definition>
        <argsstring>()</argsstring>
        <name>chado_get_base_tables</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns all chado base tables.</para><para>Base tables are those that contain the primary record for a data type. For example, feature, organism, stock, are all base tables. Other tables include linker tables (which link two or more base tables), property tables, and relationship tables. These provide additional information about primary data records and are therefore not base tables. This function retreives only the list of tables that are considered &apos;base&apos; tables.</para><para><simplesect kind="return"><para>An array of base table names. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="587" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="587" bodyend="653"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga3f2cfd756ca4bb2b8bb1d9728b533c83" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_custom_table_schema</definition>
        <argsstring>($table)</argsstring>
        <name>chado_get_custom_table_schema</name>
        <param>
          <declname>$table</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the schema in an array for the specified custom table.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to create.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A Drupal-style Schema API array definition of the table. Returns FALSE on failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="559" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="559" bodyend="570"/>
      </memberdef>
      <memberdef kind="function" id="dc/d23/tripal__chado_8schema_8api_8inc_1a3c1addbe4173e19aeda74ee25e47e573" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_cvterm_mapping</definition>
        <argsstring>($params)</argsstring>
        <name>chado_get_cvterm_mapping</name>
        <param>
          <declname>$params</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get information about which Chado base table a cvterm is mapped to.</para><para>Vocbulary terms that represent content types in Tripal must be mapped to Chado tables. A cvterm can only be mapped to one base table in Chado. This function will return an object that contains the chado table and foreign key field to which the cvterm is mapped. The &apos;chado_table&apos; property of the returned object contains the name of the table, and the &apos;chado_field&apos; property contains the name of the foreign key field (e.g. type_id), and the &apos;cvterm&apos; property contains a cvterm object.</para><para>An associative array that contains the following keys:<itemizedlist>
<listitem><para>cvterm_id: the cvterm ID value for the term.</para></listitem><listitem><para>vocabulary: the short name for the vocabulary (e.g. SO, GO, PATO)</para></listitem><listitem><para>accession: the accession for the term.</para></listitem><listitem><para>bundle_id: the ID for the bundle to which a term is associated. The &apos;vocabulary&apos; and &apos;accession&apos; must be used together, the &apos;cvterm_id&apos; can be used on it&apos;s own. <simplesect kind="return"><para>An object containing the chado_table and chado_field properties or NULL if if no mapping was found for the term. </para></simplesect>
</para></listitem></itemizedlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="678" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="678" bodyend="711"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_schema</definition>
        <argsstring>($table)</argsstring>
        <name>chado_get_schema</name>
        <param>
          <declname>$table</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the chado tables Schema API array.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to retrieve. The function will use the appopriate Tripal chado schema API hooks (e.g. v1.11 or v1.2).</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A Drupal Schema API array defining the table. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="518" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="518" bodyend="545"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1gab04e970eafe1a6789ad11d4e266ebe4b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_table_names</definition>
        <argsstring>($include_custom=NULL)</argsstring>
        <name>chado_get_table_names</name>
        <param>
          <declname>$include_custom</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the list of tables in the Chado schema. By default it only returns the default Chado tables, but can return custom tables added to the Chado schema if requested</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$include_custom</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. Set as TRUE to include any custom tables created in the Chado schema. Custom tables are added to Chado using the tripal_chado_chado_create_table() function.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An associative array where the key and value pairs are the Chado table names. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="467" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="467" bodyend="504"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_version</definition>
        <argsstring>($exact=FALSE, $warn_if_unsupported=FALSE)</argsstring>
        <name>chado_get_version</name>
        <param>
          <declname>$exact</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$warn_if_unsupported</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns the version number of the currently installed Chado instance. It can return the real or effective version. Note, this function is executed in the hook_init() of the tripal_chado module which then sets the $GLOBAL[&apos;exact_chado_version&apos;] and $GLOBAL[&apos;chado_version&apos;] variable. You can access these variables rather than calling this function.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$exact</parametername>
</parameternamelist>
<parameterdescription>
<para>Set this argument to 1 to retrieve the exact version that is installed. Otherwise, this function will set the version to the nearest &apos;tenth&apos;. Chado versioning numbers in the hundreds represent changes to the software and not the schema. Changes in the tenth&apos;s represent changes in the schema.</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$warn_if_unsupported</parametername>
</parameternamelist>
<parameterdescription>
<para>If the currently installed version of Chado is not supported by Tripal this generates a Drupal warning.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The version of Chado </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="356" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="356" bodyend="450"/>
      </memberdef>
      <memberdef kind="function" id="dc/d23/tripal__chado_8schema_8api_8inc_1a05df93b65c138ad0846b37e552abb9f0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_index_exists</definition>
        <argsstring>($table, $name)</argsstring>
        <name>chado_index_exists</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A Chado-aware replacement for the db_index_exists() function.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The table to be altered. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the index. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="200" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="200" bodyend="216"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga1d92b2dfbdb75641ad6c64dc3bfdd86e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_is_installed</definition>
        <argsstring>()</argsstring>
        <name>chado_is_installed</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check whether chado is installed (either in the same or a different database)</para><para><simplesect kind="return"><para>TRUE/FALSE depending upon whether chado is installed. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="321" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="321" bodyend="331"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1gaf22429430bcd57a657c146c576f64189" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_is_local</definition>
        <argsstring>()</argsstring>
        <name>chado_is_local</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that the Chado schema exists within the local database</para><para><simplesect kind="return"><para>TRUE/FALSE depending upon whether it exists </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="283" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="283" bodyend="311"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga8c2e920a0173ad23e39efc5260aa70d5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_sequence_exists</definition>
        <argsstring>($sequence)</argsstring>
        <name>chado_sequence_exists</name>
        <param>
          <declname>$sequence</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that any given column in a Chado table exists.</para><para>This function is necessary because Drupal&apos;s db_field_exists() will not look in any other schema but the one were Drupal is installed</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>sequence</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the sequence </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the seqeuence exists in the chado schema and FALSE if it does not. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="159" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="159" bodyend="191"/>
      </memberdef>
      <memberdef kind="function" id="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_table_exists</definition>
        <argsstring>($table)</argsstring>
        <name>chado_table_exists</name>
        <param>
          <declname>$table</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check that any given Chado table exists.</para><para>This function is necessary because Drupal&apos;s db_table_exists() function will not look in any other schema but the one were Drupal is installed</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the chado table whose existence should be checked.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the table exists in the chado schema and FALSE if it does not. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.schema.api.inc" line="49" column="1" bodyfile="tripal_chado/api/tripal_chado.schema.api.inc" bodystart="49" bodyend="87"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides an application programming interface (API) for describing Chado tables. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="49" refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>default<sp/>database<sp/>and<sp/>chado<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/>$default_db<sp/>=<sp/>$databases[</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;database&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/>$chado_schema<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we&apos;ve<sp/>already<sp/>lookup<sp/>up<sp/>this<sp/>table<sp/>then<sp/>don&apos;t<sp/>do<sp/>it<sp/>again,<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>need<sp/>to<sp/>keep<sp/>querying<sp/>the<sp/>database<sp/>for<sp/>the<sp/>same<sp/>tables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&quot;chado_tables&quot;</highlight><highlight class="normal">,<sp/>$GLOBALS)<sp/>and</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists($default_db,<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_tables&quot;</highlight><highlight class="normal">])<sp/>and</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists($chado_schema,<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_tables&quot;</highlight><highlight class="normal">][$default_db])<sp/>and</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_tables&quot;</highlight><highlight class="normal">][$default_db][$chado_schema]))<sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="66"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>1</highlight></codeline>
<codeline lineno="67"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>information_schema.tables</highlight></codeline>
<codeline lineno="68"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>table_name<sp/>=<sp/>:table_name<sp/>AND</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>table_schema<sp/>=<sp/>:chado<sp/>AND</highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>table_catalog<sp/>=<sp/>:default_db</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:chado&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_schema,</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:default_db&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$default_db</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>$args);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/>$exists<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$exists)<sp/>{</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>this<sp/>table<sp/>in<sp/>the<sp/>GLOBALS<sp/>so<sp/>we<sp/>don&apos;t<sp/>query<sp/>for<sp/>it<sp/>again<sp/>the<sp/>next<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_tables&quot;</highlight><highlight class="normal">][$default_db][$chado_schema][<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="87"><highlight class="normal">}</highlight></codeline>
<codeline lineno="105" refid="d4/d51/group__tripal__chado__schema__api_1ga6b0a91d47d38c3239f05ff029c6ceb27" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga6b0a91d47d38c3239f05ff029c6ceb27" kindref="member">chado_column_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$column)<sp/>{</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/>$default_db<sp/>=<sp/>$databases[</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;database&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/>$cached_obj<sp/>=<sp/>cache_get(</highlight><highlight class="stringliteral">&apos;chado_table_columns&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($cached_obj)<sp/>{</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cached_cols<sp/>=<sp/>$cached_obj-&gt;data;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($cached_cols)<sp/>and</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_exists(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$cached_cols)<sp/>and</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array_key_Exists($column,<sp/>$cached_cols[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>]))<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$cached_cols[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>][$column][</highlight><highlight class="stringliteral">&apos;exists&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="120"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>1</highlight></codeline>
<codeline lineno="121"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>information_schema.columns</highlight></codeline>
<codeline lineno="122"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="123"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>table_name<sp/>=<sp/>:table_name<sp/>AND</highlight></codeline>
<codeline lineno="124"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>column_name<sp/>=<sp/>:column_name<sp/>AND</highlight></codeline>
<codeline lineno="125"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>table_schema<sp/>=<sp/>:chado<sp/>AND</highlight></codeline>
<codeline lineno="126"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>table_catalog<sp/>=<sp/>:default_db</highlight></codeline>
<codeline lineno="127"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:column_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$column,</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:chado&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:default_db&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$default_db</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>$args);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/>$exists<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchField();</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$exists)<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>$cached_cols[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>][$column][</highlight><highlight class="stringliteral">&apos;exists&apos;</highlight><highlight class="normal">]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>cache_set(</highlight><highlight class="stringliteral">&apos;chado_table_columns&apos;</highlight><highlight class="normal">,<sp/>$cached_cols,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">,<sp/>CACHE_TEMPORARY);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/>$cached_cols[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>][$column][</highlight><highlight class="stringliteral">&apos;exists&apos;</highlight><highlight class="normal">]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/>cache_set(</highlight><highlight class="stringliteral">&apos;chado_table_columns&apos;</highlight><highlight class="normal">,<sp/>$cached_cols,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">,<sp/>CACHE_TEMPORARY);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="144"><highlight class="normal">}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="159" refid="d4/d51/group__tripal__chado__schema__api_1ga8c2e920a0173ad23e39efc5260aa70d5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga8c2e920a0173ad23e39efc5260aa70d5" kindref="member">chado_sequence_exists</ref>($sequence)<sp/>{</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/>$default_db<sp/>=<sp/>$databases[</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;database&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/>$cached_obj<sp/>=<sp/>cache_get(</highlight><highlight class="stringliteral">&apos;chado_sequences&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/>$cached_seqs<sp/>=<sp/>$cached_obj-&gt;data;</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($cached_seqs)<sp/>and<sp/>array_key_exists($sequence,<sp/>$cached_seqs))<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$cached_seqs[$sequence][</highlight><highlight class="stringliteral">&apos;exists&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="169"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>1</highlight></codeline>
<codeline lineno="170"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>information_schema.sequences</highlight></codeline>
<codeline lineno="171"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="172"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>sequence_name<sp/>=<sp/>:sequence_name<sp/>AND</highlight></codeline>
<codeline lineno="173"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>sequence_schema<sp/>=<sp/>:sequence_schema<sp/>AND</highlight></codeline>
<codeline lineno="174"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>sequence_catalog<sp/>=<sp/>:sequence_catalog</highlight></codeline>
<codeline lineno="175"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:sequence_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$sequence,</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:sequence_schema&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:sequence_catalog&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$default_db</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>$args);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/>$exists<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchField();</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$exists)<sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/>$cached_seqs[$sequence][</highlight><highlight class="stringliteral">&apos;exists&apos;</highlight><highlight class="normal">]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>cache_set(</highlight><highlight class="stringliteral">&apos;chado_sequences&apos;</highlight><highlight class="normal">,<sp/>$cached_seqs,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">,<sp/>CACHE_TEMPORARY);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/>$cached_seqs[$sequence][</highlight><highlight class="stringliteral">&apos;exists&apos;</highlight><highlight class="normal">]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/>cache_set(</highlight><highlight class="stringliteral">&apos;chado_sequences&apos;</highlight><highlight class="normal">,<sp/>$cached_seqs,<sp/></highlight><highlight class="stringliteral">&apos;cache&apos;</highlight><highlight class="normal">,<sp/>CACHE_TEMPORARY);</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="191"><highlight class="normal">}</highlight></codeline>
<codeline lineno="200" refid="dc/d23/tripal__chado_8schema_8api_8inc_1a05df93b65c138ad0846b37e552abb9f0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d23/tripal__chado_8schema_8api_8inc_1a05df93b65c138ad0846b37e552abb9f0" kindref="member">chado_index_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$name)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/>$indexname<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_idx&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/>$default_db<sp/>=<sp/>$databases[</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;default&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;database&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="208"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>1<sp/>as<sp/>exists</highlight></codeline>
<codeline lineno="209"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>pg_indexes</highlight></codeline>
<codeline lineno="210"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>indexname<sp/>=<sp/>:indexname</highlight></codeline>
<codeline lineno="211"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/>$result<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:indexname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$indexname));</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/>$exists<sp/>=<sp/>$result-&gt;fetchObject();</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$exists-&gt;exists;</highlight></codeline>
<codeline lineno="216"><highlight class="normal">}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="228" refid="dc/d23/tripal__chado_8schema_8api_8inc_1a20c4f980bfbbf611a66e32fbb6be876e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d23/tripal__chado_8schema_8api_8inc_1a20c4f980bfbbf611a66e32fbb6be876e" kindref="member">chado_add_index</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$name,<sp/><ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1ab2303c817e3b402b77b7f99627b9c319" kindref="member">$fields</ref>)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>$indexname<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$name<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_idx&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;CREATE<sp/>INDEX<sp/>&quot;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$indexname<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&quot;<sp/>ON<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}<sp/>&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/>$query<sp/>.=<sp/></highlight><highlight class="charliteral">&apos;(&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/>$temp<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1ab2303c817e3b402b77b7f99627b9c319" kindref="member">$fields</ref><sp/>as<sp/>$field)<sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($field))<sp/>{</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$temp[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;substr(&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field[0]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;,<sp/>1,<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field[1]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$temp[]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field<sp/>.<sp/></highlight><highlight class="charliteral">&apos;&quot;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/>$query<sp/>.=<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,<sp/>$temp);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/>$query<sp/>.=<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($query);</highlight></codeline>
<codeline lineno="245"><highlight class="normal">}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="258" refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1gadf798adf3b589a1f56dee77912c84c4a" kindref="member">chado_dbschema_exists</ref>($schema)<sp/>{</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="261"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>nspname</highlight></codeline>
<codeline lineno="262"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>pg_namespace</highlight></codeline>
<codeline lineno="263"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="264"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>has_schema_privilege(nspname,<sp/>&apos;USAGE&apos;)<sp/>AND</highlight></codeline>
<codeline lineno="265"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>nspname<sp/>=<sp/>:nspname</highlight></codeline>
<codeline lineno="266"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>nspname</highlight></codeline>
<codeline lineno="267"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/>$schema<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:nspname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$schema))-&gt;fetchField();</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($schema)<sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="273"><highlight class="normal">}</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="283" refid="d4/d51/group__tripal__chado__schema__api_1gaf22429430bcd57a657c146c576f64189" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1gaf22429430bcd57a657c146c576f64189" kindref="member">chado_is_local</ref>()<sp/>{</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>is_local<sp/>variable<sp/>has<sp/>been<sp/>set<sp/>then<sp/>we&apos;ve<sp/>already<sp/>checked<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Chado<sp/>is<sp/>local<sp/>and<sp/>we<sp/>don&apos;t<sp/>need<sp/>to<sp/>repeat<sp/>it<sp/>again.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_is_local&quot;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_is_local&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>postgresql-specific<sp/>code<sp/>to<sp/>check<sp/>the<sp/>existence<sp/>of<sp/>the<sp/>chado<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>@coder-ignore:<sp/>acting<sp/>on<sp/>pg_catalog<sp/>schema<sp/>rather<sp/>then<sp/>drupal<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>therefore,<sp/>table<sp/>prefixing<sp/>does<sp/>not<sp/>apply</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="295"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>nspname</highlight></codeline>
<codeline lineno="296"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>pg_namespace</highlight></codeline>
<codeline lineno="297"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="298"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>has_schema_privilege(nspname,<sp/>&apos;USAGE&apos;)<sp/>AND</highlight></codeline>
<codeline lineno="299"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>nspname<sp/>=<sp/>:chado</highlight></codeline>
<codeline lineno="300"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:chado&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($name)<sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>variable_set(</highlight><highlight class="stringliteral">&apos;chado_schema_exists&apos;</highlight><highlight class="normal">,<sp/>FALSE);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>variable_set(</highlight><highlight class="stringliteral">&apos;chado_schema_exists&apos;</highlight><highlight class="normal">,<sp/>TRUE);</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="311"><highlight class="normal">}</highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight></codeline>
<codeline lineno="321" refid="d4/d51/group__tripal__chado__schema__api_1ga1d92b2dfbdb75641ad6c64dc3bfdd86e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga1d92b2dfbdb75641ad6c64dc3bfdd86e" kindref="member">chado_is_installed</ref>()<sp/>{</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>check<sp/>if<sp/>chado<sp/>is<sp/>in<sp/>the<sp/>$databases<sp/>variable<sp/>of<sp/>the<sp/>settings.php<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(<ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">),<sp/>$databases))<sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>to<sp/>make<sp/>sure<sp/>the<sp/>chado<sp/>schema<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1gaf22429430bcd57a657c146c576f64189" kindref="member">chado_is_local</ref>();</highlight></codeline>
<codeline lineno="331"><highlight class="normal">}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="356" refid="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga7a8c121a7619dd4acf42e7942fdeebca" kindref="member">chado_get_version</ref>($exact<sp/>=<sp/>FALSE,<sp/>$warn_if_unsupported<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/>$version<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/>$is_local<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/>$chado_exists<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>Chado<sp/>is<sp/>installed<sp/>if<sp/>not<sp/>return<sp/>&apos;uninstalled<sp/>as<sp/>the<sp/>version&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/>$is_local<sp/>=<sp/>isset($GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_is_local&quot;</highlight><highlight class="normal">])<sp/>&amp;&amp;<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_is_local&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_local)<sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it&apos;s<sp/>not<sp/>in<sp/>the<sp/>drupal<sp/>database<sp/>check<sp/>to<sp/>see<sp/>if<sp/>it&apos;s<sp/>specified<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>$db_url<sp/>in<sp/>the<sp/>settings.php</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(<ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">),<sp/>$databases))<sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>it&apos;s<sp/>not<sp/>in<sp/>the<sp/>drupal<sp/>database<sp/>or<sp/>specified<sp/>in<sp/>the<sp/>$db_url<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>uninstalled<sp/>as<sp/>the<sp/>version</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;not<sp/>installed&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_local<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>$previous_db<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/>$prop_exists<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>(</highlight><highlight class="stringliteral">&apos;chadoprop&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>($previous_db);</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/>$chado_exists<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>@todo<sp/>we<sp/>need<sp/>a<sp/>chado<sp/>aware<sp/>db_table_exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>$prop_exists<sp/>=<sp/>db_table_exists(<ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;.chadoprop&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>table<sp/>doesn&apos;t<sp/>exist<sp/>then<sp/>we<sp/>don&apos;t<sp/>know<sp/>what<sp/>version<sp/>but<sp/>we<sp/>know</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>must<sp/>be<sp/>1.11<sp/>or<sp/>older.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$prop_exists)<sp/>{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/>$version<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;1.11<sp/>or<sp/>older&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="391"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>value</highlight></codeline>
<codeline lineno="392"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{chadoprop}<sp/>CP</highlight></codeline>
<codeline lineno="393"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvterm}<sp/>CVT<sp/>on<sp/>CVT.cvterm_id<sp/>=<sp/>CP.type_id</highlight></codeline>
<codeline lineno="394"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>on<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="395"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>CV.name<sp/>=<sp/>&apos;chado_properties&apos;<sp/>and<sp/>CVT.name<sp/>=<sp/>&apos;version&apos;</highlight></codeline>
<codeline lineno="396"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_local)<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$previous_db<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>($previous_db);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/>$v<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="406"><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>don&apos;t<sp/>have<sp/>a<sp/>version<sp/>in<sp/>the<sp/>chadoprop<sp/>table<sp/>then<sp/>it<sp/>must<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>v1.11<sp/>or<sp/>older</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$v)<sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$version<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&quot;1.11<sp/>or<sp/>older&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$version<sp/>=<sp/><sp/>$v-&gt;value;</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>next<sp/>get<sp/>the<sp/>exact<sp/>Chado<sp/>version<sp/>that<sp/>is<sp/>installed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/>$exact_version<sp/>=<sp/>$version;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Tripal<sp/>only<sp/>supports<sp/>v1.11<sp/>or<sp/>newer..<sp/>really<sp/>this<sp/>is<sp/>the<sp/>same<sp/>as<sp/>v1.1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>at<sp/>the<sp/>time<sp/>the<sp/>v1.11<sp/>schema<sp/>API<sp/>was<sp/>written<sp/>we<sp/>didn&apos;t<sp/>know<sp/>that<sp/>so</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we&apos;ll<sp/>return<sp/>the<sp/>version<sp/>1.11<sp/>so<sp/>the<sp/>schema<sp/>API<sp/>will<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($exact_version,<sp/></highlight><highlight class="stringliteral">&apos;1.11<sp/>or<sp/>older&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/>$exact_version<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;1.11&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($warn_if_unsupported)<sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;WARNING:<sp/>Tripal<sp/>does<sp/>not<sp/>fully<sp/>support<sp/>Chado<sp/>version<sp/>less<sp/>than<sp/>v1.11.<sp/><sp/>If<sp/>you<sp/>are<sp/>certain<sp/>this<sp/>is<sp/>v1.11</highlight></codeline>
<codeline lineno="427"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>or<sp/>if<sp/>Chado<sp/>was<sp/>installed<sp/>using<sp/>an<sp/>earlier<sp/>version<sp/>of<sp/>Tripal<sp/>then<sp/>all<sp/>is<sp/>well.<sp/>If<sp/>not<sp/>please<sp/>upgrade<sp/>to<sp/>v1.11<sp/>or<sp/>later&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>not<sp/>returing<sp/>an<sp/>exact<sp/>version,<sp/>return<sp/>the<sp/>version<sp/>to<sp/>the<sp/>nearest<sp/>10th.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>1.2<sp/>for<sp/>all<sp/>versions<sp/>of<sp/>1.2x</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>$effective_version<sp/>=<sp/>$exact_version;</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^1\.2\d+$/&apos;</highlight><highlight class="normal">,<sp/>$effective_version))<sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/>$effective_version<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;1.2&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^1\.3\d+$/&apos;</highlight><highlight class="normal">,<sp/>$effective_version))<sp/>{</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/>$effective_version<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;1.3&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($warn_if_unsupported<sp/>and<sp/>($effective_version<sp/><sp/>&lt;<sp/>1.11<sp/>and<sp/>$effective_version<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;not<sp/>installed&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;WARNING:<sp/>The<sp/>currently<sp/>installed<sp/>version<sp/>of<sp/>Chado,<sp/>v$exact_version,<sp/>is<sp/>not<sp/>fully<sp/>compatible<sp/>with<sp/>Tripal.&quot;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>callee<sp/>has<sp/>requested<sp/>the<sp/>exact<sp/>version<sp/>then<sp/>return<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($exact)<sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$exact_version;</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$effective_version;</highlight></codeline>
<codeline lineno="450"><highlight class="normal">}</highlight></codeline>
<codeline lineno="451"><highlight class="normal"></highlight></codeline>
<codeline lineno="467" refid="d4/d51/group__tripal__chado__schema__api_1gab04e970eafe1a6789ad11d4e266ebe4b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1gab04e970eafe1a6789ad11d4e266ebe4b" kindref="member">chado_get_table_names</ref>($include_custom<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>get<sp/>the<sp/>chado<sp/>version<sp/>that<sp/>is<sp/>installed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/>$v<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;chado_version&apos;</highlight><highlight class="normal">,<sp/>$GLOBALS)<sp/>?<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_version&quot;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/>$tables<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($v<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;1.3&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/>$tables_v1_3<sp/>=<sp/><ref refid="d6/db7/tripal__chado_8schema__v1_83_8api_8inc_1adf76b37dcf208bbf2f647533a463d808" kindref="member">tripal_chado_chado_get_v1_3_tables</ref>();</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($tables_v1_3<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tables[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>]<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($v<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;1.2&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/>$tables_v1_2<sp/>=<sp/><ref refid="d7/d89/tripal__chado_8schema__v1_82_8api_8inc_1a4c4090fe5f5a13834615d600b5299105" kindref="member">tripal_chado_chado_get_v1_2_tables</ref>();</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($tables_v1_2<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tables[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>]<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($v<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;1.11&apos;</highlight><highlight class="normal"><sp/>or<sp/>$v<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;1.11<sp/>or<sp/>older&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/>$tables_v1_11<sp/>=<sp/><ref refid="dd/dcc/tripal__chado_8schema__v1_811_8api_8inc_1a12ff2e90eba6c216ff71617112364b60" kindref="member">tripal_chado_chado_get_v1_11_tables</ref>();</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($tables_v1_11<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tables[<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>]<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>add<sp/>in<sp/>the<sp/>custom<sp/>tables<sp/>too<sp/>if<sp/>requested</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($include_custom)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>table_name<sp/>FROM<sp/>{tripal_custom_tables}&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>$resource<sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="496"><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($resource<sp/>as<sp/>$r)<sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tables[$r-&gt;table_name]<sp/>=<sp/>$r-&gt;table_name;</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/>asort($tables);</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$tables;</highlight></codeline>
<codeline lineno="504"><highlight class="normal">}</highlight></codeline>
<codeline lineno="505"><highlight class="normal"></highlight></codeline>
<codeline lineno="518" refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>get<sp/>the<sp/>chado<sp/>version<sp/>that<sp/>is<sp/>installed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/>$v<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&quot;chado_version&quot;</highlight><highlight class="normal">,<sp/>$GLOBALS)<sp/>?<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_version&quot;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>table<sp/>array<sp/>from<sp/>the<sp/>proper<sp/>chado<sp/>schema</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/>$v<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&quot;/\./&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal">,<sp/>$v);<sp/></highlight><highlight class="comment">//<sp/>reformat<sp/>version<sp/>for<sp/>hook<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Call<sp/>the<sp/>module_invoke_all.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/>$hook_name<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;chado_schema_v&quot;</highlight><highlight class="normal"><sp/>.<sp/>$v<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/>$table_arr<sp/>=<sp/>module_invoke_all($hook_name);</highlight></codeline>
<codeline lineno="529"><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>module_invoke_all<sp/>returned<sp/>nothing<sp/>then<sp/>let&apos;s<sp/>make<sp/>sure<sp/>there<sp/>isn&apos;t</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>An<sp/>API<sp/>call<sp/>we<sp/>can<sp/>call<sp/>directly.<sp/><sp/>The<sp/>only<sp/>time<sp/>this<sp/>occurs<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>during<sp/>an<sp/>upgrade<sp/>of<sp/>a<sp/>major<sp/>Drupal<sp/>version<sp/>and<sp/>tripal_core<sp/>is<sp/>disabled.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((!$table_arr<sp/>or<sp/>!is_array($table_arr))<sp/>and</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>function_exists(</highlight><highlight class="stringliteral">&apos;tripal_chado_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$hook_name))<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/>$api_hook<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;tripal_chado_&quot;</highlight><highlight class="normal"><sp/>.<sp/>$hook_name;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>$table_arr<sp/>=<sp/>$api_hook();</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="538"><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>table_arr<sp/>is<sp/>empty<sp/>then<sp/>maybe<sp/>this<sp/>is<sp/>a<sp/>custom<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($table_arr)<sp/>or<sp/>count($table_arr)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/>$table_arr<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga3f2cfd756ca4bb2b8bb1d9728b533c83" kindref="member">chado_get_custom_table_schema</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$table_arr;</highlight></codeline>
<codeline lineno="545"><highlight class="normal">}</highlight></codeline>
<codeline lineno="546"><highlight class="normal"></highlight></codeline>
<codeline lineno="559" refid="d4/d51/group__tripal__chado__schema__api_1ga3f2cfd756ca4bb2b8bb1d9728b533c83" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga3f2cfd756ca4bb2b8bb1d9728b533c83" kindref="member">chado_get_custom_table_schema</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>schema<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_name<sp/>=<sp/>:table_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>));</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/>$custom<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$custom)<sp/>{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>unserialize($custom-&gt;schema);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal">}</highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="587" refid="d4/d51/group__tripal__chado__schema__api_1gac8dd761f6e669661f9bf5a967a83d6de" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1gac8dd761f6e669661f9bf5a967a83d6de" kindref="member">chado_get_base_tables</ref>()<sp/>{</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Initialize<sp/>the<sp/>base<sp/>tables<sp/>with<sp/>those<sp/>tables<sp/>that<sp/>are<sp/>missing<sp/>a<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ideally<sp/>they<sp/>should<sp/>have<sp/>a<sp/>type,<sp/>but<sp/>that&apos;s<sp/>for<sp/>a<sp/>future<sp/>version<sp/>of<sp/>Chado.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/>$base_tables<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;organism&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;project&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;analysis&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;biomaterial&apos;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;eimage&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;assay&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="593"><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We&apos;ll<sp/>use<sp/>the<sp/>cvterm<sp/>table<sp/>to<sp/>guide<sp/>which<sp/>tables<sp/>are<sp/>base<sp/>tables.<sp/>Typically</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>base<sp/>tables<sp/>(with<sp/>a<sp/>few<sp/>exceptions)<sp/>all<sp/>have<sp/>a<sp/>type.<sp/><sp/>Iterate<sp/>through<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>referring<sp/>tables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/>$schema<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/>$referring<sp/>=<sp/>$schema[</highlight><highlight class="stringliteral">&apos;referring_tables&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($referring<sp/>as<sp/>$tablename)<sp/>{</highlight></codeline>
<codeline lineno="600"><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Ignore<sp/>the<sp/>cvterm<sp/>tables,<sp/>relationships,<sp/>chadoprop<sp/>tables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;cvterm_dbxref&apos;</highlight><highlight class="normal"><sp/>||<sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;cvterm_relationship&apos;</highlight><highlight class="normal"><sp/>||</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;cvtermpath&apos;</highlight><highlight class="normal"><sp/>||<sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;cvtermprop&apos;</highlight><highlight class="normal"><sp/>||<sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;chadoprop&apos;</highlight><highlight class="normal"><sp/>||</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;cvtermsynonym&apos;</highlight><highlight class="normal"><sp/>||<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/_relationship$/&apos;</highlight><highlight class="normal">,<sp/>$tablename)<sp/>||</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/_cvterm$/&apos;</highlight><highlight class="normal">,<sp/>$tablename)<sp/>||</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Ignore<sp/>prop<sp/>tables</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/prop$/&apos;</highlight><highlight class="normal">,<sp/>$tablename)<sp/>||<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/prop_.+$/&apos;</highlight><highlight class="normal">,<sp/>$tablename)<sp/>||</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Ignore<sp/>nd_tables</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/^nd_/&apos;</highlight><highlight class="normal">,<sp/>$tablename))<sp/>{</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array_push($base_tables,<sp/>$tablename);</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>any<sp/>linker<sp/>tables<sp/>that<sp/>have<sp/>snuck<sp/>in.<sp/><sp/>Linker<sp/>tables<sp/>are<sp/>those</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>whose<sp/>foreign<sp/>key<sp/>constraints<sp/>link<sp/>to<sp/>two<sp/>or<sp/>more<sp/>base<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/>$final_list<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($base_tables<sp/>as<sp/>$i<sp/>=&gt;<sp/>$tablename)<sp/>{</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>A<sp/>few<sp/>tables<sp/>break<sp/>our<sp/>rule<sp/>and<sp/>seems<sp/>to<sp/>look<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>like<sp/>a<sp/>linking<sp/>table,<sp/>but<sp/>we<sp/>want<sp/>to<sp/>keep<sp/>it<sp/>as<sp/>a<sp/>base<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;biomaterial&apos;</highlight><highlight class="normal"><sp/>or<sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;assay&apos;</highlight><highlight class="normal"><sp/>or<sp/>$tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;arraydesign&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$final_list[]<sp/>=<sp/>$tablename;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>phenotype<sp/>table.<sp/>It<sp/>really<sp/>shouldn&apos;t<sp/>be<sp/>a<sp/>base<sp/>table<sp/>as</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it<sp/>is<sp/>meant<sp/>to<sp/>store<sp/>individual<sp/>phenotype<sp/>measurements.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tablename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;phenotype&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_links<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/>$schema<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>($tablename);</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>$fkeys<sp/>=<sp/>$schema[</highlight><highlight class="stringliteral">&apos;foreign<sp/>keys&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($fkeys<sp/>as<sp/>$fkid<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$fktable<sp/>=<sp/>$details[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(in_array($fktable,<sp/>$base_tables))<sp/>{</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$num_links++;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_links<sp/>&lt;<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$final_list[]<sp/>=<sp/>$tablename;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>add<sp/>in<sp/>the<sp/>cvterm<sp/>table<sp/>to<sp/>the<sp/>list.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/>$final_list[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Sort<sp/>the<sp/>tables<sp/>and<sp/>return<sp/>the<sp/>list.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/>sort($final_list);</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$final_list;</highlight></codeline>
<codeline lineno="653"><highlight class="normal">}</highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="678" refid="dc/d23/tripal__chado_8schema_8api_8inc_1a3c1addbe4173e19aeda74ee25e47e573" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d23/tripal__chado_8schema_8api_8inc_1a3c1addbe4173e19aeda74ee25e47e573" kindref="member">chado_get_cvterm_mapping</ref>($params)<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/>$cvterm_id<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">,<sp/>$params)<sp/>?<sp/>$params[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/>$vocabulary<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">,<sp/>$params)<sp/>?<sp/>$params[</highlight><highlight class="stringliteral">&apos;vocabulary&apos;</highlight><highlight class="normal">]<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">,<sp/>$params)<sp/>?<sp/>$params[</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">]<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/>$cvterm<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($cvterm_id)<sp/>{</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm_id));</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($vocabulary<sp/>and<sp/>$accession)<sp/>{</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$vocabulary,</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>$match);</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($cvterm)<sp/>{</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;chado_cvterm_mapping&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tcm&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tcm&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">,<sp/>$cvterm-&gt;cvterm_id)</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>$result-&gt;fetchObject();</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($result)<sp/>{</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result-&gt;cvterm<sp/>=<sp/>$cvterm;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$result;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="711"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado/api/tripal_chado.schema.api.inc"/>
  </compounddef>
</doxygen>
