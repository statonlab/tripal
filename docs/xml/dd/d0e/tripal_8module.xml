<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="dd/d0e/tripal_8module" kind="file" language="C++">
    <compoundname>tripal.module</compoundname>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline><highlight class="normal">&lt;?php</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@file</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>The<sp/>core<sp/>Tripal<sp/>module</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*<sp/>@defgroup<sp/>tripal<sp/>Tripal<sp/>Module</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*<sp/>@ingroup<sp/>tripal_modules</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*<sp/>@{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*<sp/>The<sp/>core<sp/>Tripal<sp/>module<sp/>provides<sp/>functionality<sp/>useful<sp/>for<sp/>all<sp/>other<sp/>Tripal</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*<sp/>modules<sp/>and<sp/>extension<sp/>modules.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*<sp/>@}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@defgroup<sp/>tripal_api<sp/>Tripal<sp/>API</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@ingroup<sp/>tripal</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@{</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Tripal<sp/>provides<sp/>an<sp/>application<sp/>programming<sp/>interface<sp/>(API)<sp/>to<sp/>support</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>customizations<sp/>and<sp/>creation<sp/>of<sp/>new<sp/>extensions.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@}</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">//<sp/>Import<sp/>the<sp/>full<sp/>Tripal<sp/>API<sp/>into<sp/>scope.</highlight></codeline>
<codeline><highlight class="normal">tripal_import_api();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/tripal.field_storage.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/tripal.fields.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/tripal.entity.inc&quot;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalVocab.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalVocabController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalVocabViewsController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalTerm.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalTermController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalTermViewsController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalEntity.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalEntityController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalEntityUIController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalEntityViewsController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalBundle.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalBundleController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalBundleUIController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalBundleViewsController.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalFields/TripalField.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalFields/TripalFieldWidget.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalFields/TripalFieldFormatter.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalFieldQuery.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalJob.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalImporter.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalEntityCollection.inc&quot;;</highlight></codeline>
<codeline><highlight class="normal">require_once<sp/>&quot;includes/TripalFieldDownloaders/TripalFieldDownloader.inc&quot;;</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_views_api().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_views_api()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;api&apos;<sp/>=&gt;<sp/>3,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_init().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@ingroup<sp/>tripal</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_init()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>global<sp/>$base_url;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>add<sp/>some<sp/>variables<sp/>for<sp/>all<sp/>javasript<sp/>to<sp/>use<sp/>for<sp/>building<sp/>URLs</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$clean_urls<sp/>=<sp/>variable_get(&apos;clean_url&apos;,<sp/>0);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$tripal_path<sp/>=<sp/>url(drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_add_js(&quot;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>baseurl<sp/><sp/>=<sp/>&apos;$base_url&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>isClean<sp/><sp/>=<sp/><sp/>$clean_urls;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>var<sp/>tripal_path<sp/>=<sp/>&apos;$tripal_path&apos;;&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;inline&apos;,<sp/>&apos;header&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>make<sp/>sure<sp/>the<sp/>date<sp/>time<sp/>settings<sp/>are<sp/>the<sp/>way<sp/>Tripal<sp/>will<sp/>insert<sp/>them</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>otherwise<sp/>PostgreSQL<sp/>version<sp/>that<sp/>may<sp/>have<sp/>a<sp/>different<sp/>datestyle<sp/>setting</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>will<sp/>fail<sp/>when<sp/>inserting<sp/>or<sp/>updating<sp/>a<sp/>date<sp/>column<sp/>in<sp/>a<sp/>table.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>db_query(&quot;SET<sp/>DATESTYLE<sp/>TO<sp/>:style&quot;,<sp/>array(&apos;:style&apos;<sp/>=&gt;<sp/>&apos;MDY&apos;));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>tripal_menu_alter(&amp;$items)<sp/>{</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_menu().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Defines<sp/>all<sp/>menu<sp/>items<sp/>needed<sp/>by<sp/>Tripal<sp/>Core</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@ingroup<sp/>tripal</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_menu()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Tripal<sp/>setting<sp/>groups</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Tripal&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&quot;Manage<sp/>the<sp/>behavior<sp/>or<sp/>Tripal<sp/>and<sp/>its<sp/>various<sp/>modules.&quot;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>-8,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;system_admin_menu_block_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;system.admin.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;system&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Tripal<sp/>Extensions</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/storage&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Data<sp/>Storage&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&quot;Tripal<sp/>is<sp/>designed<sp/>to<sp/>access<sp/>biological</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>in<sp/>any<sp/>data<sp/>storage<sp/>back-end.<sp/><sp/>A<sp/>storage<sp/>back-end<sp/>must<sp/>have<sp/>a</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>module<sp/>that<sp/>can<sp/>be<sp/>installed<sp/>that<sp/>interfaces<sp/>with<sp/>Tripal.<sp/><sp/>By<sp/>default</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>base<sp/>Tripal<sp/>package<sp/>provides<sp/>The<sp/>Tripal<sp/>Chado<sp/>module<sp/>for<sp/>storing</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>in<sp/>the<sp/>GMOD<sp/>Chado<sp/>database<sp/>schema.<sp/><sp/>All<sp/>available<sp/>storage<sp/>backends</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>and<sp/>their<sp/>administrative<sp/>tools<sp/>are<sp/>found<sp/>here.&quot;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>8,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/extension&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Extensions&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&quot;Configuration<sp/>and<sp/>management<sp/>pages<sp/>for<sp/>Tripal<sp/>extension<sp/>modules.&quot;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>8,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Jobs<sp/>Management</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Jobs&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Provides<sp/>tools<sp/>for<sp/>managing<sp/>jobs<sp/>submitted<sp/>to<sp/>Tripal.<sp/><sp/>In<sp/>some</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cases,<sp/>long-running<sp/>tasks<sp/>are<sp/>too<sp/>slow<sp/>to<sp/>complete<sp/>within<sp/>a<sp/>single</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>browser<sp/>session.<sp/><sp/>The<sp/>Tripal<sp/>jobs<sp/>system<sp/>allows<sp/>long-running<sp/>tasks</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>be<sp/>submitted<sp/>to<sp/>a<sp/>queue<sp/>that<sp/>can<sp/>be<sp/>executed<sp/>manually<sp/>by<sp/>the</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>site<sp/>admin<sp/>or<sp/>automatically<sp/>using<sp/>a<sp/>module<sp/>such<sp/>as<sp/>the<sp/>&apos;)<sp/>.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>l(&apos;Tripal<sp/>Daemon&apos;,<sp/>&apos;https://www.drupal.org/project/tripal_daemon&apos;,<sp/>array(&apos;attributes&apos;<sp/>=&gt;<sp/>array(&apos;target&apos;<sp/>=&gt;<sp/>&apos;_blank&apos;)))<sp/>.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;<sp/>extension<sp/>module.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_jobs_admin_view&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_NORMAL_ITEM,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>0,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.jobs.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/help&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Help&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Help<sp/>for<sp/>the<sp/>tripal<sp/>job<sp/>management<sp/>system&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;theme&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;tripal_job_help&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_LOCAL_TASK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>10</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/cancel/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Jobs&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Cancel<sp/>a<sp/>pending<sp/>job&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_cancel_job&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;api/tripal.jobs.api.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/status/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_jobs_status_view&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.jobs.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/rerun/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Jobs&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Re-run<sp/>an<sp/>existing<sp/>job.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_rerun_job&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.jobs.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/view/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Jobs<sp/>Details&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;View<sp/>job<sp/>details.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_jobs_view&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.jobs.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/views/jobs/enable&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Enable<sp/>Jobs<sp/>Administrative<sp/>View&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_enable_view&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;tripal_admin_jobs&apos;,<sp/>&apos;admin/tripal/tripal_jobs&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.jobs.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/tripal_jobs/execute/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Jobs&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Execute<sp/>an<sp/>existing<sp/>job&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_execute_job&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/*</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>AJAX<sp/>Callbacks.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;bio_data/ajax/field_attach/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_ajax_attach_field&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(3),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.entity.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/*</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Dashboard<sp/>Action<sp/>Item<sp/>callbacks.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/disable/notification/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_disable_admin_notification&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(3),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_blocks.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/import/field/%/%/%/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_admin_notification_import_field&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(3,<sp/>4,<sp/>5,<sp/>6),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_blocks.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/*</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Term<sp/>Lookup</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>$items[&apos;cv/lookup&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Controlled<sp/>Vocabularies&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&quot;A<sp/>tool<sp/>to<sp/>explore<sp/>the<sp/>controlled<sp/>vocabularies<sp/>that<sp/>are<sp/>used<sp/>on<sp/>this<sp/>site.&quot;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_vocabulary_lookup_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.term_lookup.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_NORMAL_ITEM,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;cv/lookup/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Vocabulary<sp/>Details&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&quot;Provides<sp/>a<sp/>tool<sp/>to<sp/>discover<sp/>controlled<sp/>vocabularies&quot;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_vocabulary_lookup_vocab_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(2),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.term_lookup.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;cv/lookup/%/%&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Vocabulary<sp/>Term<sp/>Lookup&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&quot;Provides<sp/>a<sp/>tool<sp/>to<sp/>discover<sp/>controlled<sp/>vocabularies<sp/>terms<sp/>used<sp/>by<sp/>this<sp/>site.&quot;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_vocabulary_lookup_term_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(2,<sp/>3),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.term_lookup.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;cv/lookup/%/%/children&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;access<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_vocabulary_lookup_term_children_ajax&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(2,<sp/>3),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.term_lookup.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Adds<sp/>a<sp/>+Check<sp/>for<sp/>new<sp/>fields<sp/>link<sp/>on<sp/>the<sp/>&apos;Tripal<sp/>Content<sp/>Types&apos;<sp/>page.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/structure/bio_data/manage/%/fields/check&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Check<sp/>for<sp/>new<sp/>fields&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Check<sp/>if<sp/>new<sp/>fields<sp/>should<sp/>be<sp/>added<sp/>to<sp/>this<sp/>content<sp/>type.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_check_new_fields&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;api/tripal.entities.api.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_LOCAL_ACTION,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;tripal/upload&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_file_upload&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;upload<sp/>files&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;/includes/tripal.upload.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/*</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Data<sp/>Loaders<sp/>(TripalImporter)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/loaders&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Data<sp/>Loaders&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Tools<sp/>facilitating<sp/>data<sp/>import.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_NORMAL_ITEM,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>6</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>in<sp/>the<sp/>loaders</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$importers<sp/>=<sp/>tripal_get_importers();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($importers<sp/>as<sp/>$class_name)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>tripal_load_include_importer_class($class_name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(class_exists($class_name))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$machine_name<sp/>=<sp/>$class_name::$machine_name;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$menu_path<sp/>=<sp/>&apos;admin/tripal/loaders/&apos;<sp/>.<sp/>$machine_name;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$callback<sp/>=<sp/>$class_name::$callback;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$callback_path<sp/>=<sp/>$class_name::$callback_path;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$callback_module<sp/>=<sp/>$class_name::$callback_module;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$page_args<sp/>=<sp/>[];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($class_name::$menu_path)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$menu_path<sp/>=<sp/>$class_name::$menu_path;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!$callback)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$callback<sp/>=<sp/>&apos;drupal_get_form&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$page_args<sp/>=<sp/>[&apos;tripal_get_importer_form&apos;,<sp/>$class_name];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!$callback_path)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$callback_path<sp/>=<sp/>&apos;includes/tripal.importer.inc&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$file_path<sp/>=<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($callback_path<sp/>and<sp/>$callback_module)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$file_path<sp/>=<sp/>drupal_get_path(&apos;module&apos;,<sp/>$callback_module);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$items[$menu_path]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>$class_name::$name,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/><sp/>$class_name::$description,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>$callback,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>$page_args,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;use<sp/>&apos;<sp/>.<sp/>$machine_name<sp/>.<sp/>&apos;<sp/>importer&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_NORMAL_ITEM,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>$callback_path,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>$file_path,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>/**</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*<sp/>Data<sp/>Collections</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>*/</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/data-collections&apos;]<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Data<sp/>Collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Your<sp/>list<sp/>of<sp/>saved<sp/>data<sp/>collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_user_collections_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_accesss_user_collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(1),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_LOCAL_TASK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.collections.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/data-collections/%/delete&apos;]<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Delete<sp/>a<sp/>Collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Deletes<sp/>a<sp/>data<sp/>collection.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;tripal_user_collections_delete_form&apos;,<sp/>1,<sp/>3),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_accesss_user_collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(1),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.collections.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/data-collections/%/view&apos;]<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;View<sp/>a<sp/>Collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Views<sp/>a<sp/>data<sp/>collection.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_user_collections_view_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(1,<sp/>3),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_accesss_user_collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(1),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.collections.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/data-collections/generate/%&apos;]<sp/>=<sp/>array<sp/>(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Generate<sp/>a<sp/>file<sp/>for<sp/>download<sp/>of<sp/>a<sp/>Collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Generates<sp/>a<sp/>data<sp/>collection<sp/>file<sp/>for<sp/>download.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;tripal_user_collections_generate_file_form&apos;,<sp/>1,<sp/>4),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_accesss_user_collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(1),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.collections.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/data-collections&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Data<sp/>Collections&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Site-wide<sp/>settings<sp/>for<sp/>data<sp/>collections&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;tripal_admin_data_collection_form&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;administer<sp/>tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_NORMAL_ITEM,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>0,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>USER<sp/>FILE<sp/>MANAGEMENT</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;User<sp/>File<sp/>Management&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Set<sp/>maximum<sp/>upload<sp/>sizes,<sp/>quotas<sp/>and<sp/>view<sp/>usage.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_admin_manage_files_form&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_NORMAL_ITEM,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>30,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files/quota&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;User<sp/>Quotas&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Set<sp/>default<sp/>quota,<sp/>expiration<sp/>date,<sp/>and<sp/>custom<sp/>quotas&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_admin_manage_quota_form&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_LOCAL_TASK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>10,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Admin<sp/>remove<sp/>user<sp/>quota</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files/quota/remove/%&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Remove<sp/>custom<sp/>user<sp/>quota&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&quot;Revert&apos;s<sp/>a<sp/>user&apos;s<sp/>quota<sp/>and<sp/>expiration<sp/>of<sp/>files<sp/>to<sp/>the<sp/>site<sp/>wide<sp/>defaults.&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_admin_remove_quota_form&apos;,<sp/>5],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>user<sp/>quota</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files/quota/add&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Add<sp/>Custom<sp/>Quota&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Gives<sp/>the<sp/>user<sp/>a<sp/>new<sp/>quota<sp/>and<sp/>expiration<sp/>date&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_admin_add_custom_form&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>TODO:<sp/>Ask<sp/>Stephen<sp/>is<sp/>this<sp/>is<sp/>fine<sp/>as<sp/>a<sp/>link<sp/>at<sp/>the<sp/>top<sp/>of<sp/>the<sp/>form</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>as<sp/>well<sp/>as<sp/>a<sp/>link<sp/>in<sp/>the<sp/>table</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Autocomplete<sp/>path<sp/>for<sp/>the<sp/>users<sp/>on<sp/>the<sp/>site</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files/quota/user/autocomplete&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Autocomplete<sp/>for<sp/>existing<sp/>users&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Provide<sp/>a<sp/>list<sp/>of<sp/>existing<sp/>users<sp/>on<sp/>the<sp/>site.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_users_autocomplete&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Edit<sp/>user<sp/>quota</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files/quota/edit/%&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Edit<sp/>Custom<sp/>Quota&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Edit<sp/>an<sp/>existing<sp/>user\&apos;s<sp/>quota<sp/>and/or<sp/>expiration<sp/>date.&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_admin_edit_quota_form&apos;,<sp/>5],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;admin/tripal/files/usage&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;File<sp/>Usage&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Set<sp/>default<sp/>quota,<sp/>expiration<sp/>date,<sp/>and<sp/>custom<sp/>quotas&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_admin_file_usage_page&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;administer<sp/>tripal&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_LOCAL_TASK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.admin_files.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>15</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>USER<sp/>FILES</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>User<sp/>view<sp/>quota<sp/>(Tab)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/files&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Uploads&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Monitors<sp/>what<sp/>files<sp/>that<sp/>have<sp/>been<sp/>uploaded<sp/>by<sp/>user<sp/>through<sp/>the<sp/>tripal<sp/>module&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_user_files_page&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[1],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_access_user_uploads&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;view&apos;,<sp/>1],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_LOCAL_TASK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.user.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>10,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/files/%&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;File<sp/>Details&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&quot;View<sp/>details<sp/>about<sp/>the<sp/>file&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_view_file&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[1,<sp/>3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_access_user_uploads&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;renew&apos;,<sp/>1,<sp/>3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.user.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>User<sp/>file<sp/>renew.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/files/%/renew&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Renew<sp/>File&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&quot;Renew<sp/>a<sp/>user&apos;s<sp/>file&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_renew_file&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_access_user_uploads&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;renew&apos;,<sp/>1,<sp/>3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.user.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>User<sp/>file<sp/>download.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/files/%/download&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Download<sp/>File&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&quot;Download<sp/>a<sp/>user&apos;s<sp/>file<sp/>based<sp/>off<sp/>of<sp/>the<sp/>link<sp/>clicked<sp/>in<sp/>the<sp/>table&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_download_file&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;download&apos;,<sp/>1,<sp/>3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_access_user_uploads&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.user.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>User<sp/>file<sp/>delete.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$items[&apos;user/%/files/%/delete&apos;]<sp/>=<sp/>[</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Delete<sp/>File&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&quot;Delete<sp/>a<sp/>user&apos;s<sp/>file<sp/>based<sp/>on<sp/>either<sp/>user<sp/>action<sp/>or<sp/>expired<sp/>file&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;drupal_get_form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;tripal_delete_file_form&apos;,<sp/>1,<sp/>3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_access_user_uploads&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>[&apos;delete&apos;,<sp/>1,<sp/>3],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.user.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;file<sp/>path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$items;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Checks<sp/>if<sp/>the<sp/>current<sp/>user<sp/>has<sp/>permissions<sp/>to<sp/>perform<sp/>an<sp/>action<sp/>on<sp/>a<sp/>file.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$op</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>operation<sp/>to<sp/>perform.<sp/><sp/>These<sp/>include<sp/>&apos;view&apos;,<sp/>&apos;download&apos;,<sp/>&apos;renew&apos;<sp/>and<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>&apos;delete&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$uid</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>user<sp/>ID<sp/>of<sp/>the<sp/>user&apos;s<sp/>account<sp/>that<sp/>owns<sp/>the<sp/>file.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$fid</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>file<sp/>ID.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_access_user_uploads($op,<sp/>$uid,<sp/>$fid<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>The<sp/>site<sp/>admin<sp/>can<sp/>do<sp/>anything.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(in_array(&apos;administrator&apos;,<sp/>$user-&gt;roles))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Only<sp/>the<sp/>user<sp/>that<sp/>owns<sp/>the<sp/>files<sp/>can<sp/>see<sp/>them.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($uid<sp/>!=<sp/>$user-&gt;uid)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>If<sp/>no<sp/>file<sp/>ID<sp/>is<sp/>provided<sp/>and<sp/>the<sp/>user<sp/>wants<sp/>to<sp/>view<sp/>then</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>this<sp/>is<sp/>the<sp/>case<sp/>where<sp/>the<sp/>user<sp/>wants<sp/>to<sp/>see<sp/>all<sp/>the<sp/>files.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!$fid<sp/>and<sp/>$op<sp/>==<sp/>&apos;view&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$file<sp/>=<sp/>file_load($fid);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>switch<sp/>($op)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;view&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;download&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;renew&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;delete&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($user-&gt;uid<sp/>==<sp/>$file-&gt;uid)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>break;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>An<sp/>access<sp/>function<sp/>for<sp/>data<sp/>collections.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@return<sp/>boolean</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_accesss_user_collections($uid)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!tripal_access_user_data($uid))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$collections_enabled<sp/>=<sp/>variable_get(&apos;tripal_data_collections_enabled&apos;,<sp/>1);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!$collections_enabled)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Autocomplete<sp/>function<sp/>for<sp/>listing<sp/>existing<sp/>users<sp/>on<sp/>the<sp/>site.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@return<sp/>json<sp/>array<sp/>of<sp/>users<sp/>that<sp/>match<sp/>the<sp/>query<sp/>in<sp/>the<sp/>textfield</highlight></codeline>
<codeline><highlight class="normal"><sp/>**/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_users_autocomplete($string)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$matches<sp/>=<sp/>[];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$result<sp/>=<sp/>db_select(&apos;users&apos;,<sp/>&apos;u&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(&apos;u&apos;,<sp/>[&apos;name&apos;])</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(&apos;name&apos;,<sp/>&apos;%&apos;<sp/>.<sp/>db_like($string)<sp/>.<sp/>&apos;%&apos;,<sp/>&apos;LIKE&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($result<sp/>as<sp/>$row)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$matches[$row-&gt;name]<sp/>=<sp/>check_plain($row-&gt;name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_json_output($matches);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Access<sp/>callback<sp/>for<sp/>accessing<sp/>a<sp/>user&apos;s<sp/>Tripal-added<sp/>private<sp/>data.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>The<sp/>User<sp/>account<sp/>being<sp/>accessed<sp/>must<sp/>match<sp/>the<sp/>ID<sp/>of<sp/>the<sp/>current<sp/>user.<sp/>This</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>function<sp/>can<sp/>be<sp/>used<sp/>to<sp/>check<sp/>access<sp/>for<sp/>any<sp/>type<sp/>of<sp/>user-specfic<sp/>data</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>added<sp/>by<sp/>any<sp/>Tripal<sp/>module.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/><sp/>$uid</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>UID<sp/>of<sp/>the<sp/>user&apos;s<sp/>account<sp/>to<sp/>access.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@return<sp/>boolean</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_access_user_data($uid)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($uid<sp/>==<sp/>$user-&gt;uid)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_permission().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_permission()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$permissions<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;administer<sp/>tripal&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;Administer<sp/>Tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allow<sp/>the<sp/>user<sp/>to<sp/>access<sp/>administrative<sp/>pages<sp/>of<sp/>Tripal.<sp/>This<sp/>includes<sp/>management<sp/>of<sp/>jobs,<sp/>the<sp/>storage<sp/>systems,<sp/>extensions<sp/>and<sp/>the<sp/>controlled<sp/>vocabularies.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;access<sp/>tripal<sp/>content<sp/>overview&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;Access<sp/>the<sp/>Tripal<sp/>content<sp/>overview<sp/>page&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Get<sp/>an<sp/>overview<sp/>of<sp/>all<sp/>Tripal<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;manage<sp/>tripal<sp/>content<sp/>types&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;Manage<sp/>Tripal<sp/>content<sp/>types&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allows<sp/>the<sp/>user<sp/>to<sp/>create,<sp/>update<sp/>and<sp/>delete<sp/>Tripal<sp/>content<sp/>types.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;publish<sp/>tripal<sp/>content&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;Publish<sp/>Tripal<sp/>content<sp/>types&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allows<sp/>the<sp/>user<sp/>to<sp/>publish<sp/>Tripal<sp/>content<sp/>for<sp/>online<sp/>access.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;upload<sp/>files&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;Upload<sp/>Files&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allows<sp/>the<sp/>user<sp/>to<sp/>upload<sp/>files<sp/>using<sp/>Tripal\&apos;s<sp/>HTML5<sp/>loader.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;view<sp/>dev<sp/>helps&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;View<sp/>Developer<sp/>Hints&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Tripal<sp/>will<sp/>provide<sp/>blue<sp/>shaded<sp/>boxes<sp/>that<sp/>provide</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>instructions<sp/>for<sp/>how<sp/>to<sp/>customize<sp/>or<sp/>setup<sp/>specific<sp/>pages<sp/>on<sp/>a</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>site.<sp/><sp/>This<sp/>permission<sp/>should<sp/>be<sp/>enabled<sp/>for<sp/>developers.<sp/>But<sp/>can</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>disabled<sp/>once<sp/>developers<sp/>are<sp/>accustomed<sp/>to<sp/>these<sp/>hints.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>permissions<sp/>for<sp/>each<sp/>content<sp/>type.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$bundles<sp/>=<sp/>tripal_get_content_types();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($bundles<sp/>as<sp/>$bundle)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$permissions[&apos;view<sp/>&apos;<sp/>.<sp/>$bundle-&gt;name]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;%label:<sp/>View<sp/>Content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allow<sp/>the<sp/>user<sp/>to<sp/>view<sp/>%label<sp/>content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$permissions[&apos;create<sp/>&apos;<sp/>.<sp/>$bundle-&gt;name]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;%label:<sp/>Create<sp/>Content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allow<sp/>the<sp/>user<sp/>to<sp/>create<sp/>%label<sp/>content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$permissions[&apos;edit<sp/>&apos;<sp/>.<sp/>$bundle-&gt;name]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;%label:<sp/>Edit<sp/>Content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allow<sp/>the<sp/>user<sp/>to<sp/>edit<sp/>%label<sp/>content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$permissions[&apos;delete<sp/>&apos;<sp/>.<sp/>$bundle-&gt;name]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;%label:<sp/>Delete<sp/>Content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allow<sp/>the<sp/>user<sp/>to<sp/>delete<sp/>%label<sp/>content&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$bundle-&gt;label)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>permissions<sp/>for<sp/>each<sp/>Importer</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$importers<sp/>=<sp/>tripal_get_importers();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($importers<sp/>as<sp/>$class_name)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>tripal_load_include_importer_class($class_name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(class_exists($class_name))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$machine_name<sp/>=<sp/>$class_name::$machine_name;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>$class_name::$name;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$permissions[&apos;use<sp/>&apos;<sp/>.<sp/>$machine_name<sp/>.<sp/>&apos;<sp/>importer&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>t(&apos;Importer:<sp/>Use<sp/>the<sp/>%label&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$name)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;Allow<sp/>the<sp/>user<sp/>to<sp/>import<sp/>data<sp/>using<sp/>the<sp/><sp/>%label.<sp/><sp/>Note:<sp/>you<sp/>may<sp/>also<sp/>need<sp/>to<sp/>give<sp/>the<sp/>&quot;Upload<sp/>Files&quot;<sp/>permission<sp/>for<sp/>importers<sp/>to<sp/>work.&apos;,<sp/>array(&apos;%label&apos;<sp/>=&gt;<sp/>$name)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;restrict<sp/>access&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$permissions;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_theme().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Registers<sp/>template<sp/>files/functions<sp/>used<sp/>by<sp/>this<sp/>module.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@ingroup<sp/>tripal</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_theme($existing,<sp/>$type,<sp/>$theme,<sp/>$path)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$themes<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Admin<sp/>messages<sp/>theme</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_admin_message&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;function&apos;<sp/>=&gt;<sp/>&apos;theme_tripal_admin_message&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;variables&apos;<sp/>=&gt;<sp/>array(&apos;message&apos;<sp/>=&gt;<sp/>NULL),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_entity&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;render<sp/>element&apos;<sp/>=&gt;<sp/>&apos;elements&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;template&apos;<sp/>=&gt;<sp/>&apos;tripal_entity&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;path&apos;<sp/>=&gt;<sp/>&quot;$path/theme/templates&quot;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_add_list&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;variables&apos;<sp/>=&gt;<sp/>array(&apos;content&apos;<sp/>=&gt;<sp/>NULL),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Themeing<sp/>for<sp/>all<sp/>fields.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_field_default&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;render<sp/>element&apos;<sp/>=&gt;<sp/>&apos;element&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;includes/tripal.fields.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Themed<sp/>forms</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_views_handler_area_collections_fields_fset&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;render<sp/>element&apos;<sp/>=&gt;<sp/>&apos;form&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;views_handlers/tripal_views_handler_area_collections.inc&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$themes;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_coder_ignore().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Defines<sp/>the<sp/>path<sp/>to<sp/>the<sp/>file<sp/>(tripal.coder_ignores.txt)<sp/>where<sp/>ignore<sp/>rules<sp/>for<sp/>coder<sp/>are<sp/>stored</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_coder_ignore()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;path&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;line<sp/>prefix&apos;<sp/>=&gt;<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_libraries_info().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_libraries_info()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$libraries<sp/>=<sp/>array();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$libraries[&apos;d3&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>&apos;D3.js&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;vendor<sp/>url&apos;<sp/>=&gt;<sp/>&apos;http://d3js.org/&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;download<sp/>url&apos;<sp/>=&gt;<sp/>&apos;https://github.com/mbostock/d3&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;version<sp/>arguments&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;file&apos;<sp/>=&gt;<sp/>&apos;d3.js&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;pattern&apos;<sp/>=&gt;<sp/>&apos;/\s*version:<sp/>&quot;(\d+\.\d+\.\d+)&quot;/&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;files&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;js&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;d3.min.js&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$libraries;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_admin_paths().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Define<sp/>administrative<sp/>paths.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_admin_paths()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$paths<sp/>=<sp/>array();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(variable_get(&apos;node_admin_theme&apos;))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$paths<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;bio_data/*/edit&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;bio_data/*/delete&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;bio_data/add&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;bio_data/add/*&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$paths[&apos;cv/lookup/*/*&apos;]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$paths;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_menu_local_tasks_alter().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Used<sp/>to<sp/>add<sp/>action<sp/>links<sp/>to<sp/>pages.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_menu_local_tasks_alter(&amp;$data,<sp/>$router_item,<sp/>$root_path)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>an<sp/>&quot;Add<sp/>Tripal<sp/>Content&quot;<sp/>action<sp/>link<sp/>to<sp/>the<sp/>Admin<sp/>&gt;&gt;<sp/>Content<sp/>&gt;&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Biological<sp/>Content<sp/>page.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($root_path<sp/>==<sp/>&apos;admin/content/bio_data&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$item<sp/>=<sp/>menu_get_item(&apos;bio_data/add&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>($item[&apos;access&apos;])<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$data[&apos;actions&apos;][&apos;output&apos;][]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#theme&apos;<sp/>=&gt;<sp/>&apos;menu_local_action&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#link&apos;<sp/>=&gt;<sp/>$item,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_shortcut_default_set().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Modify<sp/>the<sp/>shortcut<sp/>menu<sp/>to<sp/>include<sp/>Biological<sp/>content<sp/>links.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>object<sp/>$account</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>user<sp/>account<sp/>whose<sp/>default<sp/>shortcut<sp/>set<sp/>will<sp/>be<sp/>returned.<sp/>If<sp/>not<sp/>provided,<sp/>the</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>function<sp/>will<sp/>return<sp/>the<sp/>currently<sp/>logged-in<sp/>user&apos;s<sp/>default<sp/>shortcut<sp/>set.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@return</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>An<sp/>object<sp/>representing<sp/>the<sp/>default<sp/>shortcut<sp/>set.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_shortcut_default_set($account)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$sets<sp/>=<sp/>shortcut_sets();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$found<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($sets<sp/>as<sp/>$set)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>($set-&gt;title<sp/>==<sp/>&apos;TripalDefault&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$found<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!$found)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$t<sp/>=<sp/>get_t();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Create<sp/>an<sp/>initial<sp/>default<sp/>shortcut<sp/>set.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$shortcut_set<sp/>=<sp/>new<sp/>stdClass();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$shortcut_set-&gt;title<sp/>=<sp/>$t(&apos;TripalDefault&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$shortcut_set-&gt;links<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_path&apos;<sp/>=&gt;<sp/>&apos;node/add&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_title&apos;<sp/>=&gt;<sp/>$t(&apos;Add<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>-35,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_path&apos;<sp/>=&gt;<sp/>&apos;bio_data/add&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_title&apos;<sp/>=&gt;<sp/>&apos;Add<sp/>Tripal<sp/>Content&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>-30,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_path&apos;<sp/>=&gt;<sp/>&apos;admin/content&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_title&apos;<sp/>=&gt;<sp/>$t(&apos;Find<sp/>content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>-25,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_path&apos;<sp/>=&gt;<sp/>&apos;admin/content/bio_data&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;link_title&apos;<sp/>=&gt;<sp/>&apos;Find<sp/>Tripal<sp/>Content&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;weight&apos;<sp/>=&gt;<sp/>-20,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>shortcut_set_save($shortcut_set);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$sets<sp/>=<sp/>shortcut_sets();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($sets<sp/>as<sp/>$set)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>($set-&gt;title<sp/>==<sp/>&apos;TripalDefault&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$set-&gt;set_name;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Menu<sp/>argument<sp/>loader;<sp/>Load<sp/>a<sp/>tripal<sp/>data<sp/>type<sp/>by<sp/>string.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>This<sp/>function<sp/>is<sp/>not<sp/>meant<sp/>to<sp/>be<sp/>used<sp/>as<sp/>an<sp/>API<sp/>function.<sp/>It<sp/>is<sp/>only<sp/>meant</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>for<sp/>use<sp/>in<sp/>the<sp/>menu<sp/>to<sp/>resolve<sp/>the<sp/>%tripal_bundle<sp/>wildcard.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$type</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>machine-readable<sp/>name<sp/>of<sp/>a<sp/>tripal<sp/>data<sp/>type<sp/>to<sp/>load.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@return</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>A<sp/>tripal<sp/>data<sp/>type<sp/>array<sp/>or<sp/>FALSE<sp/>if<sp/>$type<sp/>does<sp/>not<sp/>exist.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>TripalBundle_load($bundle_type,<sp/>$reset<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Get<sp/>the<sp/>type<sp/>of<sp/>entity<sp/>by<sp/>the<sp/>ID.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/>db_select(&apos;tripal_bundle&apos;,<sp/>&apos;tdt&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(&apos;tdt&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(&apos;name&apos;,<sp/>$bundle_type)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchObject();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($bundle)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$entity<sp/>=<sp/>entity_load(&apos;TripalBundle&apos;,<sp/>array($bundle-&gt;id),<sp/>array(),<sp/>$reset);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>return<sp/>reset($entity);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>FALSE;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Allows<sp/>the<sp/>menu<sp/>system<sp/>to<sp/>use<sp/>a<sp/>wildcard<sp/>to<sp/>fetch<sp/>the<sp/>entity.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Make<sp/>sure<sp/>that<sp/>the<sp/>wildcard<sp/>you<sp/>choose<sp/>in<sp/>the<sp/>tripal_entity<sp/>entity</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>definition<sp/>fits<sp/>the<sp/>function<sp/>name<sp/>here.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>This<sp/>function<sp/>is<sp/>not<sp/>meant<sp/>to<sp/>be<sp/>used<sp/>as<sp/>an<sp/>API<sp/>function.<sp/>It<sp/>is<sp/>only<sp/>meant</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>for<sp/>use<sp/>in<sp/>the<sp/>menu<sp/>to<sp/>resolve<sp/>the<sp/>%tripal_entity<sp/>wildcard.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$id</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>Integer<sp/>specifying<sp/>the<sp/>tripal_entity<sp/>id.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$reset</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>A<sp/>boolean<sp/>indicating<sp/>that<sp/>the<sp/>internal<sp/>cache<sp/>should<sp/>be<sp/>reset.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@return</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>A<sp/>fully-loaded<sp/>$tripal_entity<sp/>object<sp/>or<sp/>FALSE<sp/>if<sp/>it<sp/>cannot<sp/>be<sp/>loaded.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@see<sp/>tripal_entity_load_multiple()</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>TripalEntity_load($id,<sp/>$reset<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>$entity<sp/>=<sp/>entity_load(&apos;TripalEntity&apos;,<sp/>array($id),<sp/>array(),<sp/>$reset);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$entity<sp/>=<sp/>tripal_load_entity(&apos;TripalEntity&apos;,<sp/>array($id),<sp/>$reset);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>reset($entity);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Imports<sp/>all<sp/>of<sp/>the<sp/>Tripal<sp/>API<sp/>into<sp/>scope.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Typically<sp/>this<sp/>function<sp/>call<sp/>is<sp/>not<sp/>necessary<sp/>as<sp/>all<sp/>of<sp/>the<sp/>API<sp/>is</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>automaticaly<sp/>included<sp/>by<sp/>the<sp/>tripal<sp/>module.<sp/><sp/>However<sp/>this<sp/>function<sp/>can</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>be<sp/>useful<sp/>in<sp/>the<sp/>.install<sp/>files<sp/>during<sp/>a<sp/>site<sp/>upgrade<sp/>when<sp/>the<sp/>tripal</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>module<sp/>is<sp/>not<sp/>enabld.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Example<sp/>usage:</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@code</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>module_load_include(&apos;module&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;tripal&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>tripal_import_api();</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@endcode</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_import_api()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.d3js.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.fields.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.importer.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.terms.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.entities.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.files.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.jobs.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.notice.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.variables.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.upload.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.collections.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.quotas.api&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal&apos;,<sp/>&apos;api/tripal.DEPRECATED.api&apos;);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_form_FORM_ID_alter().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>The<sp/>field_ui_field_edit_form<sp/>is<sp/>used<sp/>for<sp/>customizing<sp/>the<sp/>settings<sp/>of</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>a<sp/>field<sp/>attached<sp/>to<sp/>an<sp/>entity.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>This<sp/>alter<sp/>function<sp/>disables<sp/>some<sp/>of<sp/>the<sp/>form<sp/>widgets<sp/>when<sp/>the<sp/>storage</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>backend<sp/>indicates<sp/>they<sp/>are<sp/>not<sp/>appropriate.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_form_field_ui_field_edit_form_alter(&amp;$form,<sp/>&amp;$form_state,<sp/>$form_id)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>If<sp/>this<sp/>is<sp/>the<sp/>field_ui_field_edit_form<sp/>(i.e.<sp/>the<sp/>form<sp/>that<sp/>appears</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>when<sp/>editing<sp/>a<sp/>field<sp/>that<sp/>is<sp/>attached<sp/>to<sp/>an<sp/>entity).<sp/>Then<sp/>we<sp/>want</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>to<sp/>add<sp/>term<sp/>settings<sp/>for<sp/>any<sp/>field<sp/>attached<sp/>to<sp/>a<sp/>TripalEntity</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>content<sp/>type.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($form[&apos;#instance&apos;][&apos;entity_type&apos;]<sp/>==<sp/>&apos;TripalEntity&apos;)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>the<sp/>form<sp/>elements<sp/>for<sp/>setting<sp/>the<sp/>vocabulary<sp/>terms.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>tripal_field_instance_settings_form_alter($form,<sp/>$form_state);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Make<sp/>sure<sp/>we<sp/>preserve<sp/>the<sp/>auto_attach<sp/>settings.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$auto_attach<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(array_key_exists(&apos;auto_attach&apos;,<sp/>$form[&apos;#instance&apos;][&apos;settings&apos;]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$auto_attach<sp/>=<sp/>$form[&apos;#instance&apos;][&apos;settings&apos;][&apos;auto_attach&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$form[&apos;instance&apos;][&apos;settings&apos;][&apos;auto_attach&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/>=&gt;<sp/>&apos;value&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#value&apos;<sp/>=&gt;<sp/>$auto_attach,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_form_alter().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_form_alter(&amp;$form,<sp/>$form_state,<sp/>$form_id)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Remove<sp/>fields<sp/>that<sp/>have<sp/>no<sp/>form.<sp/>It&apos;s<sp/>just<sp/>a<sp/>bit<sp/>too<sp/>confusing<sp/>to<sp/>have</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>widgets<sp/>appear<sp/>in<sp/>the<sp/>form<sp/>but<sp/>without<sp/>any<sp/>form<sp/>elements<sp/>inside<sp/>them.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($form_id<sp/>==<sp/>&apos;tripal_entity_form&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$children<sp/>=<sp/>element_children($form);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>foreach<sp/>($children<sp/>as<sp/>$child)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Count<sp/>the<sp/>number<sp/>of<sp/>form<sp/>elements.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(array_key_exists(&apos;und&apos;,<sp/>$form[$child]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_widgets<sp/>=<sp/>0;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Some<sp/>fields<sp/>with<sp/>cardinality<sp/>of<sp/>one<sp/>that<sp/>aren&apos;t<sp/>TripalFields</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>may<sp/>not<sp/>have<sp/>an<sp/>array,<sp/>so<sp/>we<sp/>need<sp/>to<sp/>catch<sp/>those.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(array_key_exists(&apos;#type&apos;,<sp/>$form[$child][&apos;und&apos;]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_widgets++;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach<sp/>($form[$child][&apos;und&apos;]<sp/>as<sp/>$delta<sp/>=&gt;<sp/>$element)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(is_numeric($delta))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_widgets<sp/>+=<sp/>count(element_children($element));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Ignore<sp/>the<sp/>weight<sp/>column</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(array_key_exists(&apos;_weight&apos;,<sp/>$element))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_widgets--;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Ignore<sp/>a<sp/>hidden<sp/>value<sp/>column</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(array_key_exists(&apos;value&apos;,<sp/>$element)<sp/>and<sp/>$element[&apos;value&apos;][&apos;#type&apos;]<sp/>==<sp/>&apos;value&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_widgets--;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Some<sp/>form<sp/>elements<sp/>don&apos;t<sp/>have<sp/>a<sp/>&apos;value&apos;<sp/>and<sp/>they<sp/>don&apos;t<sp/>have<sp/>any</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>widgets<sp/>(i.e<sp/>image<sp/>field<sp/>and<sp/>description<sp/>field.<sp/>We<sp/>don&apos;t</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>want<sp/>to<sp/>loose<sp/>those,<sp/>so<sp/>add<sp/>one<sp/>to<sp/>the<sp/>widget<sp/>count.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!array_key_exists(&apos;value&apos;,<sp/>$element))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$total_widgets++;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>we<sp/>have<sp/>no<sp/>widgets<sp/>then<sp/>here&apos;s<sp/>not<sp/>a<sp/>form<sp/>for<sp/>this<sp/>field<sp/>so<sp/>just</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>remove<sp/>it.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($total_widgets<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($form[$child]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>tripal_check_new_fields($bundle_name)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/>tripal_load_bundle_entity(array(&apos;name&apos;<sp/>=&gt;<sp/>$bundle_name));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$term<sp/>=<sp/>tripal_load_term_entity(array(&apos;term_id&apos;<sp/>=&gt;<sp/>$bundle-&gt;term_id));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$added<sp/>=<sp/>tripal_create_bundle_fields($bundle,<sp/>$term);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(count($added)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(&apos;No<sp/>new<sp/>fields<sp/>were<sp/>added&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($added<sp/>as<sp/>$field_name)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(&apos;Added<sp/>field:<sp/>&apos;<sp/>.<sp/>$field_name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_goto(&quot;admin/structure/bio_data/manage/$bundle_name/fields&quot;);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_block_info().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_block_info()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$blocks<sp/>=<sp/>array();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$admin_theme<sp/>=<sp/>&apos;seven&apos;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$blocks[&apos;notifications_block&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;info&apos;<sp/>=&gt;<sp/>t(&apos;Dashboard<sp/>Notifications&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;visibility&apos;<sp/>=&gt;<sp/>BLOCK_VISIBILITY_LISTED,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;pages&apos;<sp/>=&gt;<sp/>&apos;admin/dashboard&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;status&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;theme&apos;<sp/>=&gt;<sp/>$admin_theme,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;region&apos;<sp/>=&gt;<sp/>&apos;dashboard_main&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;properties&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;administrative&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$blocks[&apos;content_type_barchart&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;info&apos;<sp/>=&gt;<sp/>t(&apos;Published<sp/>Tripal<sp/>Content&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;visibility&apos;<sp/>=&gt;<sp/>BLOCK_VISIBILITY_LISTED,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;pages&apos;<sp/>=&gt;<sp/>&apos;admin/dashboard&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;status&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;theme&apos;<sp/>=&gt;<sp/>$admin_theme,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;region&apos;<sp/>=&gt;<sp/>&apos;dashboard_main&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;properties&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;administrative&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$blocks[&apos;powered_by_tripal&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;info&apos;<sp/>=&gt;<sp/>t(&apos;Powered<sp/>by<sp/>Tripal&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;cache&apos;<sp/>=&gt;<sp/>DRUPAL_NO_CACHE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$blocks;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_block_view().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_block_view($delta<sp/>=<sp/>&apos;&apos;){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>global<sp/>$base_path;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$block<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>The<sp/>$delta<sp/>parameter<sp/>tells<sp/>us<sp/>which<sp/>block<sp/>is<sp/>being<sp/>requested.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>switch<sp/>($delta)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;powered_by_tripal&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$size<sp/>=<sp/>variable_get(&apos;powered_by_tripal_size&apos;,<sp/>&apos;small&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/>variable_get(&apos;powered_by_tripal_type&apos;,<sp/>&apos;bw&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$image<sp/>=<sp/>&apos;powered_by_tripal_bw_small.png&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($size<sp/>==<sp/>&apos;small&apos;<sp/>and<sp/>$type<sp/>==<sp/>&apos;col&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image<sp/>=<sp/>&apos;powered_by_tripal_small.png&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($size<sp/>==<sp/>&apos;large&apos;<sp/>and<sp/>$type<sp/>==<sp/>&apos;bw&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image<sp/>=<sp/>&apos;powered_by_tripal_bw.png&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>($size<sp/>==<sp/>&apos;large&apos;<sp/>and<sp/>$type<sp/>==<sp/>&apos;col&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$image<sp/>=<sp/>&apos;powered_by_tripal.png&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;title&apos;]<sp/>=<sp/>&apos;&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;content&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#markup&apos;<sp/>=&gt;<sp/>&apos;&lt;a<sp/>href=&quot;http://tripal.info&quot;&gt;&lt;img<sp/>border=&quot;0&quot;<sp/>src=&quot;&apos;<sp/>.<sp/>$base_path<sp/>.<sp/>drupal_get_path(&apos;module&apos;,<sp/>&apos;tripal&apos;)<sp/>.<sp/>&apos;/theme/images/&apos;<sp/>.<sp/>$image<sp/>.<sp/>&apos;&quot;&gt;&lt;/a&gt;&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>break;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;content_type_barchart&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>The<sp/>number<sp/>of<sp/>content<sp/>types</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$entity_types<sp/>=<sp/>db_select(&apos;tripal_bundle&apos;,<sp/>&apos;tb&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(&apos;tb&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fetchAll();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$entity_count_listing<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>The<sp/>number<sp/>of<sp/>entities<sp/>per<sp/>content<sp/>type.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>foreach($entity_types<sp/>as<sp/>$entity_types<sp/>=&gt;<sp/>$entity_type){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_select(&apos;chado_&apos;<sp/>.<sp/>$entity_type-&gt;name,<sp/>&apos;et&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(&apos;et&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$number_of_entities<sp/>=<sp/>$result-&gt;rowCount();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$entity_count_listing[$entity_types]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>$entity_type-&gt;label,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;count&apos;<sp/>=&gt;<sp/>$number_of_entities,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>tripal_add_d3js();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_add_js(drupal_get_path<sp/>(&apos;module&apos;,<sp/>&apos;tripal&apos;)<sp/>.<sp/>&apos;/theme/js/tripal.dashboard.js&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_add_css(drupal_get_path<sp/>(&apos;module&apos;,<sp/>&apos;tripal&apos;)<sp/>.<sp/>&apos;/theme/css/tripal.dashboard.css&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_add_library(&apos;system&apos;,<sp/>&apos;drupal.collapse&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_add_js(&quot;var<sp/>entityCountListing<sp/>=<sp/>&quot;<sp/>.<sp/>json_encode($entity_count_listing)<sp/>.<sp/>&quot;;&quot;,<sp/>array(&apos;type&apos;<sp/>=&gt;<sp/>&apos;inline&apos;));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$output<sp/>=<sp/>&quot;&lt;div<sp/>id=\&quot;tripal-entity-types\&quot;<sp/>class=\&quot;tripal-entity-types-pane\&quot;&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;p&gt;A<sp/>list<sp/>of<sp/>the<sp/>published<sp/>Tripal<sp/>content<sp/>types<sp/>and<sp/>the<sp/>number<sp/>of<sp/>each.&lt;/p&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;div<sp/>id=\&quot;tripal-entity-type-chart\&quot;&gt;&lt;/div&gt;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&lt;/div&gt;&quot;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;title&apos;]<sp/>=<sp/>&apos;&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;content&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#markup&apos;<sp/>=&gt;<sp/>$output,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>break;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;notifications_block&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Create<sp/>your<sp/>block<sp/>content<sp/>here</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;content&apos;]<sp/>=<sp/>&apos;&apos;;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Prepare<sp/>table<sp/>header</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$header<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>t(&apos;Title&apos;)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;details&apos;<sp/>=&gt;<sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>t(&apos;Details&apos;)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>t(&apos;Type&apos;),<sp/>&apos;field&apos;<sp/>=&gt;<sp/>&apos;tan.type&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;actions&apos;<sp/>=&gt;<sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>t(&apos;Actions&apos;))</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_select(&apos;tripal_admin_notfications&apos;,<sp/>&apos;tan&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;extend(&apos;TableSort&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$results<sp/>=<sp/>$query-&gt;fields(&apos;tan&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(&apos;enabled&apos;,<sp/>1,<sp/>&apos;=&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;orderByHeader($header)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute()-&gt;fetchAll();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$rows<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>foreach($results<sp/>as<sp/>$result){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$data[&apos;operation&apos;]<sp/>=<sp/>&apos;<sp/>|<sp/>&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$data[&apos;operation&apos;]<sp/>.=<sp/>l(t(&apos;Dismiss<sp/>Notification&apos;),<sp/>&apos;admin/disable/notification/&apos;<sp/>.<sp/>$result-&gt;note_id);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$actions<sp/>=<sp/>unserialize($result-&gt;actions);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>foreach($actions<sp/>as<sp/>$action){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$label<sp/>=<sp/>key($actions);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$link<sp/>=<sp/>$action;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$rows[]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;Title&apos;<sp/>=&gt;<sp/>$result-&gt;title,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;Details&apos;<sp/>=&gt;<sp/>$result-&gt;details,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;Type&apos;<sp/>=&gt;<sp/>$result-&gt;type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;Actions&apos;<sp/>=&gt;<sp/>l(t($label),<sp/>$link)<sp/>.<sp/>$data[&apos;operation&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if(!empty($rows))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//Number<sp/>of<sp/>records<sp/>shown<sp/>in<sp/>per<sp/>page</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$per_page<sp/>=<sp/>10;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$current_page<sp/>=<sp/>pager_default_initialize(count($rows),<sp/>$per_page);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$chunks<sp/>=<sp/>array_chunk($rows,<sp/>$per_page,<sp/>TRUE);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Output<sp/>of<sp/>table<sp/>with<sp/>the<sp/>paging</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$table<sp/>=<sp/>theme(&apos;table&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;header&quot;<sp/>=&gt;<sp/>$header,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;rows&quot;<sp/>=&gt;<sp/>$chunks[<sp/>$current_page<sp/>],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;attributes&quot;<sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;sticky&quot;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;caption&quot;<sp/>=&gt;<sp/>&quot;&quot;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;colgroups&quot;<sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;empty&quot;<sp/>=&gt;<sp/>t(&quot;No<sp/>notifications.&quot;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$table<sp/>.=<sp/>theme(&apos;pager&apos;,<sp/>array(&apos;quantity&apos;,<sp/>count($rows)));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$fieldset_table<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#title&apos;<sp/>=&gt;<sp/>t(&apos;Notifications&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#collapsed&apos;<sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#collapsible&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#attributes&apos;<sp/>=&gt;<sp/>array(&apos;class&apos;<sp/>=&gt;<sp/>array(&apos;collapsible&apos;)),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#children&apos;<sp/>=&gt;<sp/>$table,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//return<sp/>pager<sp/>with<sp/>limited<sp/>number<sp/>of<sp/>records.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;content&apos;]<sp/>=<sp/>theme(&apos;fieldset&apos;,<sp/>array(&apos;element&apos;<sp/>=&gt;<sp/>$fieldset_table));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;content&apos;]<sp/>=<sp/>&apos;There<sp/>are<sp/>no<sp/>notifications<sp/>at<sp/>this<sp/>time.&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$block[&apos;title&apos;]<sp/>=<sp/>&apos;Tripal<sp/>Administrative<sp/>Notifications&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>break;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$block;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_block_save().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_block_save($delta<sp/>=<sp/>&apos;&apos;,<sp/>$edit<sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>switch<sp/>($delta)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;powered_by_tripal&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!empty($edit[&apos;logo_size&apos;]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variable_set(&apos;powered_by_tripal_size&apos;,<sp/>$edit[&apos;logo_size&apos;]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!empty($edit[&apos;logo_type&apos;]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>variable_set(&apos;powered_by_tripal_type&apos;,<sp/>$edit[&apos;logo_type&apos;]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_block_configure().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_block_configure($delta<sp/>=<sp/>&apos;&apos;)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$form<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>switch<sp/>($delta)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;powered_by_tripal&apos;:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form[&apos;logo_size&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/>=&gt;<sp/>&apos;radios&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#title&apos;<sp/>=&gt;<sp/>t(&apos;Logo<sp/>Size&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#default_value&apos;<sp/>=&gt;<sp/>variable_get(&apos;powered_by_tripal_size&apos;,<sp/>&apos;small&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#options&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;large&apos;<sp/>=&gt;<sp/>t(&apos;Large&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;small&apos;<sp/>=&gt;<sp/>t(&apos;Small&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#description&apos;<sp/>=&gt;<sp/>t(&apos;Select<sp/>if<sp/>you<sp/>would<sp/>like<sp/>a<sp/>small<sp/>or<sp/>large<sp/>&quot;Powered<sp/>by<sp/>Tripal&quot;<sp/>logo.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form[&apos;logo_type&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/>=&gt;<sp/>&apos;radios&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#title&apos;<sp/>=&gt;<sp/>t(&apos;Logo<sp/>Type&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#default_value&apos;<sp/>=&gt;<sp/>variable_get(&apos;powered_by_tripal_type&apos;,<sp/>&apos;bw&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#options&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;bw&apos;<sp/>=&gt;<sp/>t(&apos;Gray<sp/>scale&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;col&apos;<sp/>=&gt;<sp/>t(&apos;Colored&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#description&apos;<sp/>=&gt;<sp/>t(&apos;Select<sp/>if<sp/>you<sp/>would<sp/>like<sp/>a<sp/>black<sp/>and<sp/>white<sp/>or<sp/>colored<sp/>&quot;Powered<sp/>by<sp/>Tripal&quot;<sp/>logo.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$form;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_cron().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_cron()<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Add<sp/>jobs<sp/>to<sp/>the<sp/>Tripal<sp/>queue<sp/>for<sp/>commong<sp/>tasks.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>[];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$includes<sp/>=<sp/>[];</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(variable_get(&apos;tripal_admin_notification_creation_during_cron&apos;,<sp/>TRUE))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$modules<sp/>=<sp/>module_implements(&apos;tripal_cron_notification&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>foreach<sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$function<sp/>=<sp/>$module<sp/>.<sp/>&apos;_tripal_cron_notification&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>tripal_add_job(&quot;Cron:<sp/>Checking<sp/>for<sp/>&apos;$module&apos;<sp/>notifications.&quot;,<sp/>&apos;tripal&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Module<sp/>Name</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$function,<sp/>$args,<sp/>1,<sp/>1,<sp/>$includes,<sp/>TRUE);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Check<sp/>for<sp/>expired<sp/>collections.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>tripal_add_job(&apos;Cron:<sp/>Checking<sp/>expired<sp/>collections&apos;,<sp/>&apos;tripal&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_expire_collections&apos;,<sp/>$args,<sp/>1,<sp/>1,<sp/>$includes,<sp/>TRUE);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>tripal_add_job(&apos;Cron:<sp/>Checking<sp/>expired<sp/>files&apos;,<sp/>&apos;tripal&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;tripal_expire_files&apos;,<sp/>$args,<sp/>1,<sp/>1,<sp/>$includes,<sp/>TRUE);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_element_info().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Used<sp/>for<sp/>creating<sp/>new<sp/>form<sp/>API<sp/>elements.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_element_info()<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Element<sp/>for<sp/>uploading<sp/>large<sp/>files.<sp/><sp/>This<sp/>form<sp/>element</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>accepts<sp/>the<sp/>following<sp/>keys<sp/>when<sp/>using<sp/>in<sp/>a<sp/>form:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/>-<sp/>#title:<sp/><sp/>The<sp/>title<sp/>that<sp/>will<sp/>appear<sp/>above<sp/>the<sp/>element.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/>-<sp/>#description:<sp/><sp/>The<sp/>description<sp/>that<sp/>will<sp/>appear<sp/>below<sp/>the<sp/>element.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/>-<sp/>#usage_type:<sp/><sp/>Required.<sp/><sp/>The<sp/>type<sp/>of<sp/>file.<sp/><sp/>This<sp/>will<sp/>be<sp/>stored<sp/>in</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>&apos;type&apos;<sp/>column<sp/>of<sp/>the<sp/>file_usage<sp/>table.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/>-<sp/>#usage_id:<sp/>Required.<sp/>A<sp/>unique<sp/>numeric<sp/>ID<sp/>representing<sp/>an<sp/>entity,<sp/>node</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>or<sp/>some<sp/>other<sp/>record<sp/>identifier.<sp/><sp/>This<sp/>can<sp/>be<sp/>any<sp/>identifier<sp/>that</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>makes<sp/>sense<sp/>to<sp/>the<sp/>module<sp/>that<sp/>implements<sp/>a<sp/>form<sp/>that<sp/>uses<sp/>this</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>element.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>-#usage_module:<sp/>The<sp/>module<sp/>that<sp/>will<sp/>be<sp/>using<sp/>the<sp/>file.<sp/>This<sp/>will<sp/>be</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>stored<sp/>in<sp/>the<sp/>&apos;module&apos;<sp/>column<sp/>of<sp/>the<sp/>file_usage<sp/>table.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>-#allowed_types:<sp/><sp/>An<sp/>array<sp/>of<sp/>file<sp/>extensions<sp/>that<sp/>are<sp/>allowed<sp/>for</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>to<sp/>be<sp/>uploaded.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/>-#cardinality:<sp/><sp/>A<sp/>numeric<sp/>value<sp/>indicating<sp/>the<sp/>number<sp/>of<sp/>files<sp/>the</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>user<sp/>can<sp/>upload.<sp/>Set<sp/>to<sp/>0<sp/>for<sp/>unlimited.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$elements[&apos;html5_file&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#input&apos;<sp/>=&gt;<sp/>&apos;TRUE&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#process&apos;<sp/>=&gt;<sp/>array(&apos;tripal_html5_file_process&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#element_validate&apos;<sp/>=&gt;<sp/>array(&apos;tripal_html5_file_validate&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#value_callback&apos;<sp/>=&gt;<sp/>&apos;tripal_html5_file_value&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$elements;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/>The<sp/>process<sp/>function<sp/>for<sp/>the<sp/>html5_file<sp/>form<sp/>element.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_html5_file_process($element,<sp/>$form_state,<sp/>$complete_form)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$module<sp/>=<sp/>array_key_exists(&apos;#usage_module&apos;,<sp/>$element)<sp/>?<sp/>$element[&apos;#usage_module&apos;]<sp/>:<sp/>&apos;tripal&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$type<sp/>=<sp/>$element[&apos;#usage_id&apos;]<sp/>.<sp/>&apos;-&apos;<sp/>.<sp/>$element[&apos;#usage_type&apos;]<sp/>.<sp/>&apos;-&apos;<sp/>.<sp/>$module;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$type_var_name<sp/>=<sp/>&apos;uploader_&apos;<sp/>.<sp/>$element[&apos;#usage_id&apos;]<sp/>.<sp/>&apos;_&apos;<sp/>.<sp/>$element[&apos;#usage_type&apos;]<sp/>.<sp/>&apos;_&apos;<sp/>.<sp/>$module;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/>$element[&apos;#name&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/>preg_replace(&apos;/[^\w]/&apos;,<sp/>&apos;_&apos;,<sp/>$name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$allowed_types<sp/>=<sp/>array_key_exists(&apos;#allowed_types&apos;,<sp/>$element)<sp/>?<sp/>$element[&apos;#allowed_types&apos;]<sp/>:<sp/>array();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$cardinality<sp/>=<sp/>array_key_exists(&apos;#cardinality&apos;,<sp/>$element)<sp/>?<sp/>$element[&apos;#cardinality&apos;]<sp/>:<sp/>1;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$paired<sp/>=<sp/>array_key_exists(&apos;#paired&apos;,<sp/>$element)<sp/>?<sp/>$element[&apos;#paired&apos;]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($paired)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$headers<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;File<sp/>#1&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Size&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;10%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Upload<sp/>Progress&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;20%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Action&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;10%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;File<sp/>#2&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Size&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;10%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Upload<sp/>Progress&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;20%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Action&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;10%&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$headers<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;File&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Size&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;10%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Upload<sp/>Progress&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;20%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(&apos;data&apos;<sp/>=&gt;<sp/>&apos;Action&apos;,<sp/>&apos;width&apos;<sp/>=&gt;<sp/>&apos;10%&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$rows<sp/>=<sp/>array();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$table_vars<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;header&apos;<sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$headers,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;rows&apos;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$rows,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;attributes&apos;<sp/><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;class&apos;<sp/>=&gt;<sp/>array(&apos;tripal-html5-file-upload-table&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;id&apos;<sp/>=&gt;<sp/>&apos;tripal-html5-file-upload-table-&apos;<sp/>.<sp/>$type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;sticky&apos;<sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;colgroups&apos;<sp/><sp/><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;empty&apos;<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(&apos;There<sp/>are<sp/>currently<sp/>no<sp/>files.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$element[&apos;html5_file_table_key&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/>=&gt;<sp/>&apos;hidden&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#value&apos;<sp/>=&gt;<sp/>$type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#attributes&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;class&apos;<sp/>=&gt;<sp/>array(&apos;tripal-html5-file-upload-table-key&apos;)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$element[&apos;html5_file_table&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/>=&gt;<sp/>&apos;item&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#title&apos;<sp/>=&gt;<sp/>$element[&apos;#title&apos;]<sp/>?<sp/>$element[&apos;#title&apos;]<sp/>:<sp/>&apos;File<sp/>Upload&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#description&apos;<sp/>=&gt;<sp/>$element[&apos;#description&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#markup&apos;<sp/>=&gt;<sp/>theme(&apos;table&apos;,<sp/>$table_vars)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>$element[$name]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/>=&gt;<sp/>&apos;hidden&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#attributes&apos;<sp/>=&gt;<sp/>array(&apos;id&apos;<sp/>=&gt;<sp/>&apos;tripal-html5-upload-fid-&apos;<sp/>.<sp/>$type),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#default_value&apos;<sp/>=&gt;<sp/>$element[&apos;#value&apos;],</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$element[&apos;html5_file_submit&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>&apos;submit&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#value&apos;<sp/><sp/><sp/><sp/>=&gt;<sp/>&apos;Upload<sp/>File&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#name&apos;<sp/>=&gt;<sp/>&apos;tripal_html5_file_upload_submit-&apos;<sp/>.<sp/>$type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>We<sp/>don&apos;t<sp/>want<sp/>this<sp/>button<sp/>to<sp/>submit<sp/>as<sp/>the<sp/>file<sp/>upload</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>is<sp/>handled<sp/>by<sp/>the<sp/>JavaScript<sp/>code.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;#attributes&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;id&apos;<sp/>=&gt;<sp/>&apos;tripal-html5-file-upload-submit-&apos;<sp/>.<sp/>$type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;onclick&apos;<sp/>=&gt;<sp/>&apos;return<sp/>(false);&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(!$paired)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$categories<sp/>=<sp/>array($element[&apos;#usage_id&apos;]<sp/>.<sp/>&apos;-&apos;<sp/>.<sp/>$element[&apos;#usage_type&apos;]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$categories<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$element[&apos;#usage_id&apos;]<sp/>.<sp/>&apos;-&apos;<sp/>.<sp/>$element[&apos;#usage_type&apos;]<sp/>.<sp/>&apos;-f&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$element[&apos;#usage_id&apos;]<sp/>.<sp/>&apos;-&apos;<sp/>.<sp/>$element[&apos;#usage_type&apos;]<sp/>.<sp/>&apos;-r&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$uploader_settings<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;table_id&apos;<sp/>=&gt;<sp/>&apos;#tripal-html5-file-upload-table-&apos;<sp/>.<sp/>$type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;submit_id&apos;<sp/>=&gt;<sp/>&apos;#tripal-html5-file-upload-submit-&apos;<sp/>.<sp/>$type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;category&apos;<sp/>=&gt;<sp/>$categories,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;cardinality&apos;<sp/>=&gt;<sp/>$cardinality,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;target_id&apos;<sp/>=&gt;<sp/>&apos;tripal-html5-upload-fid-&apos;<sp/>.<sp/>$type,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;module&apos;<sp/>=&gt;<sp/>$module,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;allowed_types&apos;<sp/>=&gt;<sp/>$allowed_types,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_add_js(array($type_var_name<sp/>=&gt;<sp/>$uploader_settings),<sp/>&apos;setting&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_add_js(drupal_get_path<sp/>(&apos;module&apos;,<sp/>&apos;tripal&apos;)<sp/>.<sp/>&apos;/theme/js/TripalUploader.js&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_add_js(drupal_get_path<sp/>(&apos;module&apos;,<sp/>&apos;tripal&apos;)<sp/>.<sp/>&apos;/theme/js/TripalUploadFile.js&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>drupal_add_js(drupal_get_path<sp/>(&apos;module&apos;,<sp/>&apos;tripal&apos;)<sp/>.<sp/>&apos;/theme/js/tripal.file.js&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>$element;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>the<sp/>validate<sp/>hook<sp/>for<sp/>the<sp/>html5_file<sp/>form<sp/>element.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_html5_file_validate($element,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$is_required<sp/>=<sp/>$element[&apos;#required&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/>$element[&apos;#name&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/>preg_replace(&apos;/[^\w]/&apos;,<sp/>&apos;_&apos;,<sp/>$name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$fid<sp/>=<sp/>NULL;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>(is_array($element[&apos;#value&apos;])<sp/>and<sp/>$array_key_exists($name,<sp/>$element[&apos;#value&apos;]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$fid<sp/>=<sp/>$element[&apos;#value&apos;][$name];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>TODO:<sp/>the<sp/>fid<sp/>should<sp/>just<sp/>be<sp/>the<sp/>$element[&apos;#value&apos;]<sp/>why<sp/>isn&apos;t<sp/>this</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>working<sp/>given<sp/>the<sp/>tripal_html5_file_value<sp/>function<sp/>below.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($is_required<sp/>and<sp/>!$fid)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>form_error($element,<sp/>t(&apos;A<sp/>file<sp/>must<sp/>be<sp/>provided.&apos;));</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_value()<sp/>for<sp/>the<sp/>html5_file<sp/>form<sp/>element.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_html5_file_value($element,<sp/>$input<sp/>=<sp/>FALSE,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>if<sp/>($input)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(is_array($input))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>$element[&apos;#name&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>preg_replace(&apos;/[^\w]/&apos;,<sp/>&apos;_&apos;,<sp/>$name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$input[$name];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>else<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>$input;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_field_display_alter().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$display</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$context</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_field_display_TripalEntity_alter(&amp;$display,<sp/>$context){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$field_name<sp/>=<sp/>$context[&apos;field&apos;][&apos;field_name&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$bundle<sp/>=<sp/>$context[&apos;entity&apos;]-&gt;bundle;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$bundle_info<sp/>=<sp/>tripal_load_bundle_entity(array(&apos;name&apos;<sp/>=&gt;<sp/>$bundle));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Hide<sp/>fields<sp/>that<sp/>are<sp/>empty,<sp/>but<sp/>only<sp/>if<sp/>the<sp/>hide_empty_field<sp/>variable</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>is<sp/>set<sp/>to<sp/>&apos;hide&apos;<sp/>for<sp/>this<sp/>bundel.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>$hide_variable<sp/>=<sp/>tripal_get_bundle_variable(&apos;hide_empty_field&apos;,<sp/>$bundle_info-&gt;id,<sp/>&apos;hide&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>if($hide_variable<sp/>==<sp/>&apos;hide&apos;){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$item<sp/>=<sp/>field_get_items(&apos;TripalEntity&apos;,<sp/>$context[&apos;entity&apos;],<sp/>$field_name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if($item)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field<sp/>=<sp/>field_info_field($field_name);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if(tripal_field_is_empty($item[0],<sp/>$field))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Stop<sp/>the<sp/>right<sp/>rail<sp/>element<sp/>from<sp/>rendering.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_add_css(&apos;.&apos;<sp/>.<sp/>$field_name.&apos;<sp/>{display:<sp/>none;}&apos;,<sp/>&apos;inline&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">/**</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>Implements<sp/>hook_field_group_table_rows_alter().</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>This<sp/>hook<sp/>is<sp/>used<sp/>for<sp/>hiding<sp/>empty<sp/>rows<sp/>in<sp/>a<sp/>Field<sp/>Group<sp/>Table<sp/>field<sp/>group.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$element</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>The<sp/>field<sp/>group<sp/>object.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/>@param<sp/>$children</highlight></codeline>
<codeline><highlight class="normal"><sp/>*<sp/><sp/><sp/>An<sp/>array<sp/>of<sp/>field<sp/>names<sp/>that<sp/>are<sp/>contained<sp/>in<sp/>the<sp/>field<sp/>group.</highlight></codeline>
<codeline><highlight class="normal"><sp/>*/</highlight></codeline>
<codeline><highlight class="normal">function<sp/>tripal_field_group_table_rows_alter(&amp;$element,<sp/>&amp;$children)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Iterate<sp/>through<sp/>the<sp/>children<sp/>of<sp/>this<sp/>table<sp/>field<sp/>group.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($children<sp/>as<sp/>$index<sp/>=&gt;<sp/>$child)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>if<sp/>(is_array($element[$child]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$bundle<sp/>=<sp/>$element[$child][&apos;#bundle&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$bundle_info<sp/>=<sp/>tripal_load_bundle_entity(array(&apos;name&apos;<sp/>=&gt;<sp/>$bundle));</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>the<sp/>hide<sp/>empty<sp/>variable<sp/>is<sp/>turned<sp/>on<sp/>then<sp/>remove<sp/>fields<sp/>from</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>field<sp/>group.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$hide_variable<sp/>=<sp/>tripal_get_bundle_variable(&apos;hide_empty_field&apos;,<sp/>$bundle_info-&gt;id,<sp/>&apos;hide&apos;);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>if($hide_variable<sp/>==<sp/>&apos;hide&apos;){</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$items<sp/>=<sp/>$element[$child][&apos;#items&apos;];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Case<sp/>#1:<sp/>there<sp/>are<sp/>no<sp/>items.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(count($items)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($children[$index]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($element[$child]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Case<sp/>#2:<sp/>there<sp/>is<sp/>one<sp/>item<sp/>but<sp/>the<sp/>value<sp/>is<sp/>empty.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(count($items)<sp/>==<sp/>1<sp/>and<sp/>array_key_exists(&apos;value&apos;,<sp/>$items[0])<sp/>and<sp/>empty($items[0][&apos;value&apos;]))<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($children[$index]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($element[$child]);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/tripal.module"/>
  </compounddef>
</doxygen>
