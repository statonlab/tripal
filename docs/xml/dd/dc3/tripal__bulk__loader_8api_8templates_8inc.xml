<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="dd/dc3/tripal__bulk__loader_8api_8templates_8inc" kind="file" language="PHP">
    <compoundname>tripal_bulk_loader.api.templates.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d2/ddc/group__tripal__bulk__loader__api_1gabee41f8eca69348430f6cfad27b22ce5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_delete_bulk_loader_field</definition>
        <argsstring>($priority, $delete_field_index, $template_array)</argsstring>
        <name>tripal_delete_bulk_loader_field</name>
        <param>
          <declname>$priority</declname>
        </param>
        <param>
          <declname>$delete_field_index</declname>
        </param>
        <param>
          <declname>$template_array</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>An API function to delete a field from a template array</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the record containing the field </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$delete_field_index</parametername>
</parameternamelist>
<parameterdescription>
<para>The index of the field to be deleted </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$template_array</parametername>
</parameternamelist>
<parameterdescription>
<para>The array describing the template</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The modified template array </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" line="279" column="1" bodyfile="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" bodystart="279" bodyend="304"/>
      </memberdef>
      <memberdef kind="function" id="d2/ddc/group__tripal__bulk__loader__api_1ga1958eebb413afdd6b78b9bd0fa5de177" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_delete_bulk_loader_record</definition>
        <argsstring>($delete_priority, $template_array)</argsstring>
        <name>tripal_delete_bulk_loader_record</name>
        <param>
          <declname>$delete_priority</declname>
        </param>
        <param>
          <declname>$template_array</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>An API function to delete a record from a template array</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$delete_priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the record to be deleted </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$template_array</parametername>
</parameternamelist>
<parameterdescription>
<para>The array describing the template</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The modified template array </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" line="245" column="1" bodyfile="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" bodystart="245" bodyend="262"/>
      </memberdef>
      <memberdef kind="function" id="d2/ddc/group__tripal__bulk__loader__api_1ga464803a3de67130927912835e63a2d09" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_insert_bulk_loader_template</definition>
        <argsstring>($options, &amp;$errors, &amp;$warnings)</argsstring>
        <name>tripal_insert_bulk_loader_template</name>
        <param>
          <declname>$options</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$errors</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$warnings</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Inserts a bulk loader template record.</para><para>This function validates the options passed prior to insertion of the record.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of key/value pairs containing the following keys: &apos;template_name&apos;: The name of the template. &apos;template_array&apos;: The JSON array representing the template. Optional: &apos;strict&apos;: If set then only JSON formatted templates are allowed. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$errors</parametername>
</parameternamelist>
<parameterdescription>
<para>An empty array where validation error messages will be set. The keys of the array will be name of the field from the options array and the value is the error message. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$warnings</parametername>
</parameternamelist>
<parameterdescription>
<para>An empty array where validation warning messagges will be set. The warnings should not stop an insert or an update but should be provided to the user as information by a drupal_set_message() if appropriate. The keys of the array will be name of the field from the options array and the value is the error message. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE for success and FALSE for failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" line="133" column="1" bodyfile="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" bodystart="133" bodyend="182"/>
      </memberdef>
      <memberdef kind="function" id="d2/ddc/group__tripal__bulk__loader__api_1ga3a7a8521857c4de56936a3726276e7bd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_is_bulk_loader_record_name_unique</definition>
        <argsstring>($new_record_name, $template_id, $template_array=NULL, $current_priority=NULL)</argsstring>
        <name>tripal_is_bulk_loader_record_name_unique</name>
        <param>
          <declname>$new_record_name</declname>
        </param>
        <param>
          <declname>$template_id</declname>
        </param>
        <param>
          <declname>$template_array</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$current_priority</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Meant to be called from a form_validate function to ensure a newly added bulk loader record name is unique and not empty.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$new_record_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The record name to check for uniqueness </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$template_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The template_id of the template to add the record to </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$template_array</parametername>
</parameternamelist>
<parameterdescription>
<para>The array describing the template. Optional -will be loaded using template_id if not provided </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$current_priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the already existing record -checks that the name only occurs on this particular record</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the record name is not empty and not already in the template_array; FALSE otherwise </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" line="205" column="1" bodyfile="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" bodystart="205" bodyend="230"/>
      </memberdef>
      <memberdef kind="function" id="d2/ddc/group__tripal__bulk__loader__api_1ga5c15b798374e5a03a5eb10610146f13d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_validate_bulk_loader_template</definition>
        <argsstring>($val_type, &amp;$options, &amp;$errors, &amp;$warnings=array())</argsstring>
        <name>tripal_validate_bulk_loader_template</name>
        <param>
          <declname>$val_type</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$options</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$errors</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$warnings</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validates an $options array for insert or update of a bulk loader record.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$val_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The type of validation. Can be either &apos;insert&apos; or &apos;update&apos;. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of key/value pairs containing the following keys: template_name: The name of the template. template_array: The JSON array representing the template. Optional: strict: If set then only JSON formatted templates are allowed. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$errors</parametername>
</parameternamelist>
<parameterdescription>
<para>An empty array where validation error messages will be set. The keys of the array will be name of the field from the options array and the value is the error message. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$warnings</parametername>
</parameternamelist>
<parameterdescription>
<para>An empty array where validation warning messagges will be set. The warnings should not stop an insert or an update but should be provided to the user as information by a drupal_set_message() if appropriate. The keys of the array will be name of the field from the options array and the value is the error message.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>If validation failes then FALSE is returned. Any options that do not pass validation checks will be added in the $errors array with the key being the option and the value being the error message. If validation is successful then TRUE is returned. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" line="48" column="1" bodyfile="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc" bodystart="48" bodyend="105"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides functions for hooking into bulk loader functionality. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="48" refid="d2/ddc/group__tripal__bulk__loader__api_1ga5c15b798374e5a03a5eb10610146f13d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1ga5c15b798374e5a03a5eb10610146f13d" kindref="member">tripal_validate_bulk_loader_template</ref>($val_type,<sp/>&amp;<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>,<sp/>&amp;$errors,<sp/>&amp;$warnings<sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/>$template_array<sp/>=<sp/>trim(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/>$template_name<sp/>=<sp/>trim(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;template_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/>$strict<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;strict&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>)<sp/><sp/>?<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;strict&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>template<sp/>array<sp/>is<sp/>one<sp/>of<sp/>the<sp/>supported<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>DEPRECATED:<sp/>A<sp/>stringified<sp/>version<sp/>of<sp/>the<sp/>array<sp/>(causes<sp/>security<sp/>issues)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^array/&apos;</highlight><highlight class="normal">,<sp/>$template_array))<sp/>{</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($strict)<sp/>{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$errors[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;Invalid<sp/>template<sp/>array.<sp/>Please<sp/>provide</highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>JSON<sp/>formatted<sp/>array&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$warnings[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;Please<sp/>note<sp/>that<sp/>import<sp/>of</highlight></codeline>
<codeline lineno="63"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bulk<sp/>loader<sp/>templates<sp/>as<sp/>PHP<sp/>arrays<sp/>as<sp/>a<sp/>stringified<sp/>array<sp/>is<sp/>deprecated</highlight></codeline>
<codeline lineno="64"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>and<sp/>will<sp/>be<sp/>removed<sp/>in<sp/>future<sp/>versions<sp/>of<sp/>Tripal.<sp/>Export<sp/>and<sp/>import</highlight></codeline>
<codeline lineno="65"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>format<sp/>will<sp/>be<sp/>JSON.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>DEPRECATED:<sp/>A<sp/>serialized<sp/>PHP<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/>elseif<sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^a:/&apos;</highlight><highlight class="normal">,<sp/>$template_array))<sp/>{</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($strict)<sp/>{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$errors[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;Invalid<sp/>template<sp/>array.<sp/>Please<sp/>provide</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>a<sp/>JSON<sp/>formatted<sp/>array&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$warnings[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;Please<sp/>note<sp/>that<sp/>import<sp/>of</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bulk<sp/>loader<sp/>templates<sp/>as<sp/>PHP<sp/>serialized<sp/>arrays<sp/>is<sp/>deprecated<sp/>and<sp/>will</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>removed<sp/>in<sp/>future<sp/>versions<sp/>of<sp/>Tripal.<sp/>Export<sp/>and<sp/>import<sp/>format<sp/>will</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>be<sp/>JSON.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>JSON<sp/>FORMAT</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/>elseif<sp/>(json_decode($template_array))<sp/>{</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>correct!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>$errors[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;The<sp/>template<sp/>array<sp/>must<sp/>be<sp/>in</highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>JSON<sp/>format<sp/>(although<sp/>PHP<sp/>strigified<sp/>arrays<sp/>and<sp/>PHP<sp/>serialized</highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>arrays<sp/>are<sp/>temporarily<sp/>supported<sp/>for<sp/>backwards<sp/>compatibility).&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>template<sp/>name<sp/>is<sp/>unique</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/>$name_exists<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_bulk_loader_template&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tblt&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tblt&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;template_id&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/>$template_name)</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchField();</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($name_exists)<sp/>{</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/>$errors[</highlight><highlight class="stringliteral">&apos;template_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;The<sp/>template<sp/>name<sp/>already<sp/>exists.<sp/>Please</highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>choose<sp/>another<sp/>name.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="105"><highlight class="normal">}</highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="133" refid="d2/ddc/group__tripal__bulk__loader__api_1ga464803a3de67130927912835e63a2d09" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1ga464803a3de67130927912835e63a2d09" kindref="member">tripal_insert_bulk_loader_template</ref>(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>,<sp/>&amp;$errors,<sp/>&amp;$warnings)<sp/>{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1ga5c15b798374e5a03a5eb10610146f13d" kindref="member">tripal_validate_bulk_loader_template</ref>(</highlight><highlight class="stringliteral">&apos;insert&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>,<sp/>$errors,<sp/>$warnings);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($errors<sp/>as<sp/>$field<sp/>=&gt;<sp/>$message)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_bulkldr&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$message);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>bulk<sp/>loader<sp/>template.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>$template_array<sp/>=<sp/>trim(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/>$template_name<sp/>=<sp/>trim(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;template_name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="146"><highlight class="normal"></highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Previous<sp/>version<sp/>of<sp/>Tripal<sp/>would<sp/>export<sp/>the<sp/>template<sp/>as<sp/>a<sp/>PHP<sp/>array.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>has<sp/>security<sp/>implications<sp/>and<sp/>is<sp/>deprecated.<sp/>This<sp/>support<sp/>should</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>be<sp/>reomved<sp/>in<sp/>future<sp/>versions<sp/>of<sp/>Tripal,<sp/>but<sp/>to<sp/>support<sp/>transfers<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>templates<sp/>between<sp/>v1.1<sp/>and<sp/>v2.x<sp/>sites<sp/>we<sp/>support<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^array/&apos;</highlight><highlight class="normal">,<sp/>$template_array))<sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/>$tarray<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/>eval(</highlight><highlight class="stringliteral">&quot;\$tarray<sp/>=<sp/>$template_array;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>$template_array<sp/>=<sp/>serialize($tarray);</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>a<sp/>brief<sp/>period,<sp/>the<sp/>bulk<sp/>loader<sp/>templates<sp/>were<sp/>exported<sp/>as<sp/>a<sp/>PHP</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>serialized<sp/>array.<sp/>We<sp/>have<sp/>moved<sp/>to<sp/>exporting<sp/>in<sp/>JSON<sp/>as<sp/>JSON<sp/>is<sp/>more</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>user<sp/>friendly.<sp/>But<sp/>we<sp/>must<sp/>support<sp/>the<sp/>serialized<sp/>PHP<sp/>array<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>backwards<sp/>compatibility<sp/>of<sp/>v2.0-rc1<sp/>sites<sp/>and<sp/>v2.x<sp/>sites.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/>elseif<sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^a:/&apos;</highlight><highlight class="normal">,<sp/>$template_array))<sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>nothing<sp/>it&apos;s<sp/>in<sp/>PHP<sp/>serialized<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>typical<sp/>format<sp/>is<sp/>JSON</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/>elseif<sp/>(json_decode($template_array))<sp/>{</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/>$template_array<sp/>=<sp/>serialize(json_decode($template_array,<sp/>TRUE));</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/>$errors[</highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal">]<sp/>=<sp/>t(</highlight><highlight class="stringliteral">&apos;Unrecognized<sp/>array<sp/>type.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$template_name,</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;template_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$template_array,</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;created&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>time(),</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;changed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>time()</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_bulk_loader_template&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>))<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="182"><highlight class="normal">}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"></highlight></codeline>
<codeline lineno="205" refid="d2/ddc/group__tripal__bulk__loader__api_1ga3a7a8521857c4de56936a3726276e7bd" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1ga3a7a8521857c4de56936a3726276e7bd" kindref="member">tripal_is_bulk_loader_record_name_unique</ref>($new_record_name,<sp/>$template_id,<sp/>$template_array<sp/>=<sp/>NULL,<sp/>$current_priority<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>template<sp/>array<sp/>if<sp/>it&apos;s<sp/>not<sp/>supplied</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($template_array))<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1aa3e9534005fd516d941f6a5569896e01" kindref="member">$template</ref><sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_bulk_loader_template}<sp/>WHERE<sp/>template_id=:template&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:template&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$template_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>$template_array<sp/>=<sp/>unserialize(<ref refid="d2/ded/tripal__bulk__loader__fields_8tpl_8php_1aa3e9534005fd516d941f6a5569896e01" kindref="member">$template</ref>-&gt;template_array);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($template_array))<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>new<sp/>record<sp/>name<sp/>is<sp/>not<sp/>empty</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($new_record_name))<sp/>{</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>the<sp/>new<sp/>record<sp/>name<sp/>is<sp/>unique</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($template_array<sp/>as<sp/>$priority<sp/>=&gt;<sp/>$t)<sp/>{</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($t[</highlight><highlight class="stringliteral">&apos;record_id&apos;</highlight><highlight class="normal">],<sp/>$new_record_name)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(($priority<sp/>!=<sp/>$current_priority)<sp/>AND<sp/>($current_priority<sp/>!==<sp/>NULL))<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="230"><highlight class="normal">}</highlight></codeline>
<codeline lineno="231"><highlight class="normal"></highlight></codeline>
<codeline lineno="245" refid="d2/ddc/group__tripal__bulk__loader__api_1ga1958eebb413afdd6b78b9bd0fa5de177" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1ga1958eebb413afdd6b78b9bd0fa5de177" kindref="member">tripal_delete_bulk_loader_record</ref>($delete_priority,<sp/>$template_array)<sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($template_array))<sp/>{</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Unable<sp/>to<sp/>delete<sp/>record<sp/>with<sp/>a<sp/>priority<sp/>of<sp/>$priority<sp/>since<sp/>the<sp/>template<sp/>was<sp/>not<sp/>supplied&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/>$new_template_array<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/>$i=0;</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($template_array<sp/>as<sp/>$priority<sp/>=&gt;<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>)<sp/>{</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($priority<sp/>!=<sp/>$delete_priority)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$new_template_array[$i]<sp/>=<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$new_template_array;</highlight></codeline>
<codeline lineno="262"><highlight class="normal">}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="279" refid="d2/ddc/group__tripal__bulk__loader__api_1gabee41f8eca69348430f6cfad27b22ce5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1gabee41f8eca69348430f6cfad27b22ce5" kindref="member">tripal_delete_bulk_loader_field</ref>($priority,<sp/>$delete_field_index,<sp/>$template_array)<sp/>{</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($template_array))<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Unable<sp/>to<sp/>delete<sp/>record<sp/>with<sp/>a<sp/>priority<sp/>of<sp/>$priority<sp/>since<sp/>the<sp/>template<sp/>was<sp/>not<sp/>supplied&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Re-order<sp/>the<sp/>remaining<sp/>fields<sp/>of<sp/>the<sp/>same<sp/>record<sp/>to<sp/>ensure<sp/>that<sp/>the<sp/>indicies<sp/>are</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>0<sp/>to<sp/>size<sp/>and.<sp/>If<sp/>this<sp/>is<sp/>not<sp/>done,<sp/>weird<sp/>behaviour<sp/>may<sp/>result</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>$new_template_array<sp/>=<sp/>$template_array;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/>$new_template_array[$priority][</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/>$i=0;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($template_array[$priority][</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$field_index<sp/>=&gt;<sp/>$field_details)<sp/>{</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($field_index<sp/>!=<sp/>$delete_field_index)<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$new_template_array[$priority][</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][$i]<sp/>=<sp/>$field_details;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>field<sp/>was<sp/>the<sp/>only<sp/>one<sp/>in<sp/>the<sp/>current<sp/>record,<sp/>also<sp/>delete<sp/>the<sp/>record</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($new_template_array[$priority][</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/>$new_template_array<sp/>=<sp/><ref refid="d2/ddc/group__tripal__bulk__loader__api_1ga1958eebb413afdd6b78b9bd0fa5de177" kindref="member">tripal_delete_bulk_loader_record</ref>($priority,<sp/>$new_template_array);</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="302"><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$new_template_array;</highlight></codeline>
<codeline lineno="304"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_bulk_loader/api/tripal_bulk_loader.api.templates.inc"/>
  </compounddef>
</doxygen>
