<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="dd/df1/tripal_8files_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal.files.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1gac1d4faf07d61e04ccfbfb58d468dfe6a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_create_files_dir</definition>
        <argsstring>($module_name, $path=FALSE)</argsstring>
        <name>tripal_create_files_dir</name>
        <param>
          <declname>$module_name</declname>
        </param>
        <param>
          <declname>$path</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Creates a directory for a module in the Drupal&apos;s public files directory.</para><para>Previously it was recommended that this function be called during installation of the module in the .install file. However this causes permission problems if the module is installed via drush with a user account that is not the same as the web user. Therefore, this function should not be called in a location accessiblve via a drush command. The <ref refid="d5/df3/group__tripal__files__api_1gaf679228ad38f8f75e70b89997382db8c" kindref="member">tripal_get_files_dir()</ref> and <ref refid="d5/df3/group__tripal__files__api_1ga33cd06a29579429f0e4ad5d59c2b085c" kindref="member">tripal_get_files_stream()</ref> will automatically create the directory if it doesn&apos;t exist so there is little need to call this function directly.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$module_name</parametername>
</parameternamelist>
<parameterdescription>
<para>the name of the module being installed </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$path</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional sub-path to create </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="37" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="37" bodyend="65"/>
      </memberdef>
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1ga958a192b7e34752767c7b9ff53e18ffa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_format_bytes</definition>
        <argsstring>($bytes, $precision=2)</argsstring>
        <name>tripal_format_bytes</name>
        <param>
          <declname>$bytes</declname>
        </param>
        <param>
          <declname>$precision</declname>
          <defval>2</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Formats a size (in bytes) in human readable format.</para><para>Function taken from php.net</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$bytes</parametername>
</parameternamelist>
<parameterdescription>
<para>The size of the file in bytes </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$precision</parametername>
</parameternamelist>
<parameterdescription>
<para>The number of decimal places to use in the final number if needed</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>string A formatted string indicating the size of the file </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="145" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="145" bodyend="157"/>
      </memberdef>
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1gaf679228ad38f8f75e70b89997382db8c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_files_dir</definition>
        <argsstring>($module_name=FALSE)</argsstring>
        <name>tripal_get_files_dir</name>
        <param>
          <declname>$module_name</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the Drupal relative directory for a Tripal module.</para><para>Each Tripal module has a unique data directory which was created using the tripal_create_files_dir function during installation. This function retrieves the directory path.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$module_name</parametername>
</parameternamelist>
<parameterdescription>
<para>(Optional) The name of the module.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The path within the Drupal installation where the data directory resides </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="82" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="82" bodyend="97"/>
      </memberdef>
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1ga33cd06a29579429f0e4ad5d59c2b085c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_files_stream</definition>
        <argsstring>($module_name=FALSE)</argsstring>
        <name>tripal_get_files_stream</name>
        <param>
          <declname>$module_name</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the Drupal stream (e.g. public://...) for a Tripal module.</para><para>Each Tripal module has a unique data directory which was created using the tripal_create_files_dir function during installation. This function retrieves the directory path.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$module_name</parametername>
</parameternamelist>
<parameterdescription>
<para>(Optional) The name of the module.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The path within the Drupal installation where the data directory resides </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="114" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="114" bodyend="127"/>
      </memberdef>
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1ga0d79c86d0c06c1be1d9369995df71f67" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_user_files_dir</definition>
        <argsstring>($user)</argsstring>
        <name>tripal_get_user_files_dir</name>
        <param>
          <declname>$user</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the URI for the dedicated directory for a user&apos;s files.</para><para>This directory is used by the file uploader and by data collections.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$user</parametername>
</parameternamelist>
<parameterdescription>
<para>A Drupal user object.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The URI of the directory. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="212" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="212" bodyend="217"/>
      </memberdef>
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1ga316a6a81ef03df302cf89ad195711ca5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_user_uploads</definition>
        <argsstring>($uid, $allowed_types=array(), $module=&apos;tripal&apos;)</argsstring>
        <name>tripal_get_user_uploads</name>
        <param>
          <declname>$uid</declname>
        </param>
        <param>
          <declname>$allowed_types</declname>
          <defval>array()</defval>
        </param>
        <param>
          <declname>$module</declname>
          <defval>&apos;tripal&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the list of files uploaded by a user.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$uid</parametername>
</parameternamelist>
<parameterdescription>
<para>The ID of the user whose files should be retrieved. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$allowed_types</parametername>
</parameternamelist>
<parameterdescription>
<para>A list of valid extensions to restrict the files to. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$module</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the module that is managing the file.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A list of file objects. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="174" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="174" bodyend="197"/>
      </memberdef>
      <memberdef kind="function" id="d5/df3/group__tripal__files__api_1gaf1746f1c5f793e8e26c517542aed4c28" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_is_user_files_dir_writeable</definition>
        <argsstring>($user)</argsstring>
        <name>tripal_is_user_files_dir_writeable</name>
        <param>
          <declname>$user</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Checks if the user&apos;s dedicated directory is accessible and writeable.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$user</parametername>
</parameternamelist>
<parameterdescription>
<para>A Drupal user object.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the user&apos;s directory is writeable. FALSE otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.files.api.inc" line="230" column="1" bodyfile="tripal/api/tripal.files.api.inc" bodystart="230" bodyend="248"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides an application programming interface (API) for managing files within the Tripal data directory structure. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="37" refid="d5/df3/group__tripal__files__api_1gac1d4faf07d61e04ccfbfb58d468dfe6a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1gac1d4faf07d61e04ccfbfb58d468dfe6a" kindref="member">tripal_create_files_dir</ref>($module_name,<sp/>$path<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>path<sp/>is<sp/>not<sp/>supplied<sp/>then<sp/>assume<sp/>they<sp/>want<sp/>to<sp/>create<sp/>the<sp/>base<sp/>files</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>directory<sp/>for<sp/>the<sp/>specified<sp/>module</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$path)<sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>the<sp/>data<sp/>directory<sp/>for<sp/>this<sp/>module</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>$data_dir<sp/>=<sp/><ref refid="d5/df3/group__tripal__files__api_1gaf679228ad38f8f75e70b89997382db8c" kindref="member">tripal_get_files_dir</ref>()<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;/$module_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file_prepare_directory($data_dir,<sp/>FILE_CREATE_DIRECTORY<sp/>|<sp/>FILE_MODIFY_PERMISSIONS))<sp/>{</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$message<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>create<sp/>directory<sp/>$data_dir.<sp/>This<sp/>module<sp/>may<sp/>not<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;behave<sp/>correctly<sp/>without<sp/>this<sp/>directory.<sp/><sp/>Please<sp/><sp/>create<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;the<sp/>directory<sp/>manually<sp/>or<sp/>fix<sp/>the<sp/>problem<sp/>and<sp/>reinstall.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(check_plain(t($message)),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$message,<sp/>array());</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>module<sp/>data<sp/>directory<sp/>exists,<sp/>we<sp/>make<sp/>a<sp/>recursive<sp/>call</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>without<sp/>the<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/df3/group__tripal__files__api_1gac1d4faf07d61e04ccfbfb58d468dfe6a" kindref="member">tripal_create_files_dir</ref>($module_name);</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>make<sp/>sure<sp/>the<sp/>sub<sp/>dir<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>$sub_dir<sp/>=<sp/><ref refid="d5/df3/group__tripal__files__api_1gaf679228ad38f8f75e70b89997382db8c" kindref="member">tripal_get_files_dir</ref>()<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$module_name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$path;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file_prepare_directory($sub_dir,<sp/>FILE_CREATE_DIRECTORY<sp/>|<sp/>FILE_MODIFY_PERMISSIONS))<sp/>{</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$message<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;Can<sp/>not<sp/>create<sp/>directory<sp/>$sub_dir.<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(check_plain(t($message)),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$message,<sp/>array());</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="65"><highlight class="normal">}</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="82" refid="d5/df3/group__tripal__files__api_1gaf679228ad38f8f75e70b89997382db8c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1gaf679228ad38f8f75e70b89997382db8c" kindref="member">tripal_get_files_dir</ref>($module_name<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>the<sp/>directory<sp/>path.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>$data_dir<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;file_public_path&apos;</highlight><highlight class="normal">,<sp/>conf_path()<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/files/tripal&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>module<sp/>name<sp/>is<sp/>provided<sp/>then<sp/>append<sp/>the<sp/>module<sp/>directory.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($module_name)<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>$data_dir<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;/$module_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>directory<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/df3/group__tripal__files__api_1gac1d4faf07d61e04ccfbfb58d468dfe6a" kindref="member">tripal_create_files_dir</ref>($module_name);</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$data_dir;</highlight></codeline>
<codeline lineno="97"><highlight class="normal">}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="114" refid="d5/df3/group__tripal__files__api_1ga33cd06a29579429f0e4ad5d59c2b085c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1ga33cd06a29579429f0e4ad5d59c2b085c" kindref="member">tripal_get_files_stream</ref>($module_name<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>the<sp/>directory<sp/>path.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>$stream<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&apos;public://tripal&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>module<sp/>name<sp/>is<sp/>provided<sp/>then<sp/>append<sp/>the<sp/>module<sp/>directory.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($module_name)<sp/>{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>$stream<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;/$module_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>directory<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/df3/group__tripal__files__api_1gac1d4faf07d61e04ccfbfb58d468dfe6a" kindref="member">tripal_create_files_dir</ref>($module_name);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$stream;</highlight></codeline>
<codeline lineno="127"><highlight class="normal">}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="145" refid="d5/df3/group__tripal__files__api_1ga958a192b7e34752767c7b9ff53e18ffa" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1ga958a192b7e34752767c7b9ff53e18ffa" kindref="member">tripal_format_bytes</ref>($bytes,<sp/>$precision<sp/>=<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/>$units<sp/>=<sp/>[</highlight><highlight class="charliteral">&apos;B&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;KB&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;MB&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;GB&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;TB&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>$bytes<sp/>=<sp/>max($bytes,<sp/>0);</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/>$pow<sp/>=<sp/>floor(($bytes<sp/>?<sp/>log($bytes)<sp/>:<sp/>0)<sp/>/<sp/>log(1024));</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/>$pow<sp/>=<sp/>min($pow,<sp/>count($units)<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Uncomment<sp/>one<sp/>of<sp/>the<sp/>following<sp/>alternatives</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/>$bytes<sp/>/=<sp/>pow(1000,<sp/>$pow);</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>$bytes<sp/>/=<sp/>(1<sp/>&lt;&lt;<sp/>(10<sp/>*<sp/>$pow));</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>round($bytes,<sp/>$precision)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$units[$pow];</highlight></codeline>
<codeline lineno="157"><highlight class="normal">}</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="174" refid="d5/df3/group__tripal__files__api_1ga316a6a81ef03df302cf89ad195711ca5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1ga316a6a81ef03df302cf89ad195711ca5" kindref="member">tripal_get_user_uploads</ref>($uid,<sp/><ref refid="d8/d02/tripal__organism__feature__browser_8tpl_8php_1a2e0df9e15179e2db66d161206842d6c0" kindref="member">$allowed_types</ref><sp/>=<sp/>array(),<sp/>$module<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/>$user<sp/>=<sp/>user_load($uid);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;file_managed&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;FM&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/>$query-&gt;fields(</highlight><highlight class="stringliteral">&apos;FM&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;fid&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/>$query-&gt;distinct();</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;FM.uid&apos;</highlight><highlight class="normal">,<sp/>$user-&gt;uid);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/>$query-&gt;innerJoin(</highlight><highlight class="stringliteral">&apos;file_usage&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;FU&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;FU.fid<sp/>=<sp/>FM.fid&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;FU.module&apos;</highlight><highlight class="normal">,<sp/>$module);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>$query-&gt;orderBy(</highlight><highlight class="stringliteral">&apos;FM.filename&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/>$files<sp/>=<sp/>$query-&gt;execute();</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/>$files_list<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($fid<sp/>=<sp/>$files-&gt;fetchField())<sp/>{</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>$file<sp/>=<sp/>file_load($fid);</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d8/d02/tripal__organism__feature__browser_8tpl_8php_1a2e0df9e15179e2db66d161206842d6c0" kindref="member">$allowed_types</ref><sp/>as<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/\.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$type<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;$/&apos;</highlight><highlight class="normal">,<sp/>$file-&gt;filename))<sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$files_list[$fid]<sp/>=<sp/>$file;</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$files_list;</highlight></codeline>
<codeline lineno="197"><highlight class="normal">}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="212" refid="d5/df3/group__tripal__files__api_1ga0d79c86d0c06c1be1d9369995df71f67" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1ga0d79c86d0c06c1be1d9369995df71f67" kindref="member">tripal_get_user_files_dir</ref>($user)<sp/>{</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/>$user_dir<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;public://tripal/users/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$user-&gt;uid;</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$user_dir;</highlight></codeline>
<codeline lineno="217"><highlight class="normal">}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="230" refid="d5/df3/group__tripal__files__api_1gaf1746f1c5f793e8e26c517542aed4c28" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d5/df3/group__tripal__files__api_1gaf1746f1c5f793e8e26c517542aed4c28" kindref="member">tripal_is_user_files_dir_writeable</ref>($user)<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/>$user_dir<sp/>=<sp/><ref refid="d5/df3/group__tripal__files__api_1ga0d79c86d0c06c1be1d9369995df71f67" kindref="member">tripal_get_user_files_dir</ref>($user);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>make<sp/>sure<sp/>the<sp/>directory<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!file_prepare_directory($user_dir,<sp/>FILE_CREATE_DIRECTORY))<sp/>{</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>It<sp/>has<sp/>been<sp/>reported<sp/>that<sp/>file_prepare_directory<sp/>is<sp/>not<sp/>properly</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>detecting<sp/>if<sp/>the<sp/>directory<sp/>is<sp/>writeable,<sp/>so<sp/>we&apos;ll<sp/>do<sp/>another</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>round<sp/>of<sp/>checks<sp/>to<sp/>be<sp/>sure.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_dir($user_dir))<sp/>{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_writeable($user_dir))<sp/>{</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="248"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/api/tripal.files.api.inc"/>
  </compounddef>
</doxygen>
