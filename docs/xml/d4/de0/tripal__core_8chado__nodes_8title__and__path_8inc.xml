<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc" kind="file" language="PHP">
    <compoundname>tripal_core.chado_nodes.title_and_path.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gae15385749a7549bd6a0265f3d438f151" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_admin_form_set_title</definition>
        <argsstring>(&amp;$form, &amp;$form_state, $details)</argsstring>
        <name>chado_add_admin_form_set_title</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generic &quot;Set Node Title&quot; sub-form for setting the title of any chado node</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal form array into which the property form elements will be added </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>The corresponding form_state array for the form </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para>An array defining details used by this form. Required keys that are always required: -module: the name of the module implementing the node. For example, for features the module is tripal_feature. -options: an array of quick-choice options to supply to the user. The key should be the token and the value should be a human-readable description of the option -content_type: the name of the content type. Defaults to module name. Optional keys include: -fieldset_title: the title to use for the fieldset. Defaults to &quot;Set Page Title&quot;. -default_option: the default format to use which matches one of those in $details[&apos;options&apos;] -custom_tokens: an array of custom tokens that follow the same format as those generated by <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens()</ref>. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="245" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="245" bodyend="354"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1aee62e3ee19fe65c01f181aa9f282ab33" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_admin_form_set_title_form_submit</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>chado_add_admin_form_set_title_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_form_submit(). SUBMIT: Actually add the format specified by <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gae15385749a7549bd6a0265f3d438f151" kindref="member">chado_add_admin_form_set_title()</ref> </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="378" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="378" bodyend="388"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a529ef05e91373ece2ed0bc6f6f4a3b72" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_admin_form_set_title_form_validate</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>chado_add_admin_form_set_title_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_form_validate(). VALIDATE: validate the format. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="360" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="360" bodyend="372"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga8bab59be7bf1fb6ea3fb0486fda79a8d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_admin_form_set_url</definition>
        <argsstring>(&amp;$form, &amp;$form_state, $details)</argsstring>
        <name>chado_add_admin_form_set_url</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <param>
          <declname>$details</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generic &quot;Set Node URL&quot; sub-form for setting the url of any chado node</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal form array into which the property form elements will be added </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>The corresponding form_state array for the form </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$details</parametername>
</parameternamelist>
<parameterdescription>
<para>An array defining details used by this form. Required keys that are always required: -module: the name of the module implementing the node. For example, for features the module is tripal_feature. -options: an array of quick-choice options to supply to the user. The key should be the token and the value should be a human-readable description of the option Optional keys include: -content_type: the name of the content type. Defaults to module name. -fieldset_title: the title to use for the fieldset. Defaults to &quot;Set Page url&quot;. -default_option: the default format to use which matches one of those in $details[&apos;options&apos;] -custom_tokens: an array of custom tokens that follow the same format as those generated by <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens()</ref>. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="771" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="771" bodyend="882"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ab76f7be077a22d5d0fc5777236905fdf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_admin_form_set_url_form_submit</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>chado_add_admin_form_set_url_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_form_submit(). SUBMIT: Actually add the format specified by <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gae15385749a7549bd6a0265f3d438f151" kindref="member">chado_add_admin_form_set_title()</ref> </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="906" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="906" bodyend="932"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1aa2cb2e9331598dde0ffc0d36f95063be" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_add_admin_form_set_url_form_validate</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>chado_add_admin_form_set_url_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_form_validate(). VALIDATE: validate the format. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="888" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="888" bodyend="900"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga6be2b3290e82364d934fbb30532a0868" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_node_title</definition>
        <argsstring>($node)</argsstring>
        <name>chado_get_node_title</name>
        <param>
          <declname>$node</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="196" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="196" bodyend="220"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga1d0ba1cce0cf57234a9e90607233b7c3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_node_url</definition>
        <argsstring>($node)</argsstring>
        <name>chado_get_node_url</name>
        <param>
          <declname>$node</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="534" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="534" bodyend="566"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga6afd60d9aa697351972c5b86575b8a03" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_token_value</definition>
        <argsstring>($token_info, $node, $options=array())</argsstring>
        <name>chado_get_token_value</name>
        <param>
          <declname>$token_info</declname>
        </param>
        <param>
          <declname>$node</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieve the value of the token from the node based on the $token_info[&apos;location&apos;]</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$token_info</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of information about the token including: -table: the name of the chado table -field: the name of the field in the above table -token: the token string (ie: [stock.stock_id]) -description: a very short description of the token (displayed when tokens are listed) -location: the location of the value in a chado node variable with each level separated by an arrow (&gt;) symbol. For example, the location for $node-&gt;feature-&gt;type_id-&gt;name is feature&gt;type_id&gt;name </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$node</parametername>
</parameternamelist>
<parameterdescription>
<para>The node to get the value of the token</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The value of the token </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1329" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1329" bodyend="1379"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_add_token_format</definition>
        <argsstring>($application, $content_type, $format, $tokens)</argsstring>
        <name>chado_node_add_token_format</name>
        <param>
          <declname>$application</declname>
        </param>
        <param>
          <declname>$content_type</declname>
        </param>
        <param>
          <declname>$format</declname>
        </param>
        <param>
          <declname>$tokens</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1093" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1093" bodyend="1115"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a6ef291862b2dc896b538b4e323e4c109" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_format_tokens</definition>
        <argsstring>($tokens)</argsstring>
        <name>chado_node_format_tokens</name>
        <param>
          <declname>$tokens</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Format a set of tokens for consistent display</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of tokens from <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens()</ref></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>HTML displaying the token list </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1391" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1391" bodyend="1418"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_generate_tokens</definition>
        <argsstring>($base_table, $token_prefix=FALSE, $location_prefix=FALSE)</argsstring>
        <name>chado_node_generate_tokens</name>
        <param>
          <declname>$base_table</declname>
        </param>
        <param>
          <declname>$token_prefix</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$location_prefix</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generate tokens for a particular base table</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$base_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the chado table you would like to generate tokens for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$token_prefix</parametername>
</parameternamelist>
<parameterdescription>
<para>RECURSIVE ARG: Used to determine the generic token based on previous interations. For example, when adding cvterm fields to a feature token, the token_prefix is &quot;feature.type_id&quot; so that resulting tokens can be &quot;feature.type_id&gt;cvterm.*&quot; (ie: [feature.type_id&gt;cvterm.name] ) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$location_prefix</parametername>
</parameternamelist>
<parameterdescription>
<para>RECURSIVE ARG: Used to keep track of the location of the value based on previous interations. For example, when adding cvterm fields to a feature token, the location_prefix is &quot;feature &gt; type_id&quot; so that resulting tokens can be &quot;feature &gt; type_id &gt; *&quot; (ie: feature &gt; type_id &gt; name) </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An array of available tokens where the key is the table.field and the value is an array with the following keys: -table: the name of the chado table -field: the name of the field in the above table -token: the token string (ie: [stock.stock_id]) -description: a very short description of the token (displayed when tokens are listed) -location: the location of the value in a chado node variable with each level separated by an arrow (-&gt;) symbol. For example, the location for $node-&gt;feature-&gt;type_id-&gt;name is feature&gt;type_id&gt;name </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1254" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1254" bodyend="1307"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gad50ca3f66cd8f6eabbc3be91320f6be1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_legacy_title_default</definition>
        <argsstring>($content_type)</argsstring>
        <name>chado_node_get_legacy_title_default</name>
        <param>
          <declname>$content_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Handles legacy title options</para><para>Features &amp; Stocks already had custom functionality to handle title setting before this API was created. That has since been removed but but to remain backwards compatible this function checks for those old settings and translates them into new defaults. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="482" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="482" bodyend="516"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga177274f316b8f44e25cc43a5d706b9a2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_legacy_url_default</definition>
        <argsstring>($content_type)</argsstring>
        <name>chado_node_get_legacy_url_default</name>
        <param>
          <declname>$content_type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Handles legacy URL options</para><para>Features, Projects &amp; Stocks already had custom functionality to handle URL setting before this API was created. That has since been removed but to remain backwards compatible this function checks for those old settings and translates them into new defaults. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1028" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1028" bodyend="1070"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ad9338d73eb91a465b34287273f8fba60" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_location_from_token</definition>
        <argsstring>($token)</argsstring>
        <name>chado_node_get_location_from_token</name>
        <param>
          <declname>$token</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns the &quot;location&quot; as specified in the token information based on the token. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1522" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1522" bodyend="1567"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a558b8a4e248c0b6b0d1b1a782023a1d0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_readable_format</definition>
        <argsstring>($token)</argsstring>
        <name>chado_node_get_readable_format</name>
        <param>
          <declname>$token</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generate a Readable but not necessarily unique format based on a given primary key token.</para><para>For example, given the token [feature.type_id&gt;cvterm.cvterm_id] you don&apos;t want the actual id indexed but instead would want the term name, [feature.type_id&gt;cvterm.name] </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1472" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1472" bodyend="1516"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga678469ec2f27a2354fa5c0176802cabf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_title_format</definition>
        <argsstring>($content_type, &amp;$tokens, $base_table=NULL)</argsstring>
        <name>chado_node_get_title_format</name>
        <param>
          <declname>$content_type</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$tokens</declname>
        </param>
        <param>
          <declname>$base_table</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the title format for a specific content type</para><para>If the title format has not yet been set then the following will be done 1) Check to see if there is a legacy title format set (features &amp; stocks) 2) Check if there is a defined default for this content type 3) Create a format using any name fields and the unique constraint for the base table associated with this content type</para><para>Define a default for a specific content type by implementing a function of the name [content type]_chado_node_default_title_format() that returns a string describing the default format.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$content_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the content (node) type you are interested in (ie: chado_feature) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>An array, passed by reference that is filled to include the tokens for this node type. Each token is an array with the following keys: -table: the name of the chado table -field: the name of the field in the above table -token: the token string (ie: [stock.stock_id]) -description: a very short description of the token (displayed when tokens are listed) -location: the location of the value in a chado node variable with each level separated by an arrow (-&gt;) symbol. For example, the location for $node-&gt;feature-&gt;type_id-&gt;name is feature&gt;type_id&gt;name</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A string containing tokens describing the default format for the title of nodes of the specified content type. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="422" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="422" bodyend="470"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gadac406c54ee6c9dd13e8ebc4deb8b40b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_token_format</definition>
        <argsstring>($application, $content_type, $options=array())</argsstring>
        <name>chado_node_get_token_format</name>
        <param>
          <declname>$application</declname>
        </param>
        <param>
          <declname>$content_type</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the format for the given application of a given content type (ie: the feature title)</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$application</parametername>
</parameternamelist>
<parameterdescription>
<para>What the format is to be applied to. For example &apos;title&apos; for generating node titles and &apos;path&apos; for generating node paths </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$content_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the content type this format applies to (ie: $node-&gt;type) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of any of the following options:<itemizedlist>
<listitem><para>return_record: if TRUE this will return the entire record rather than just the format string </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A string specifying the format </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1134" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1134" bodyend="1155"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gad00086a99a67b021e0d631c46ac5f110" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_unique_constraint_format</definition>
        <argsstring>($base_table, $format_type=&apos;title&apos;)</argsstring>
        <name>chado_node_get_unique_constraint_format</name>
        <param>
          <declname>$base_table</declname>
        </param>
        <param>
          <declname>$format_type</declname>
          <defval>&apos;<ref refid="d0/d42/tripal__feature__teaser_8tpl_8php_1ab5501754233ec6aec5f04ef03f3bfc28" kindref="member">title</ref>&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Generate the unique constraint for a given base table using the Chado Schema API definition</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$base_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The base table to generate the unique constraint format for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$format_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The type of format to return. This should be one of &apos;title&apos; or &apos;url&apos;. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A format string including tokens describing the unique constraint including all name fields </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1171" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1171" bodyend="1226"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga9470e29b313ec722a24f2d613c7f66aa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_node_get_url_format</definition>
        <argsstring>($content_type, &amp;$tokens, $base_table=NULL)</argsstring>
        <name>chado_node_get_url_format</name>
        <param>
          <declname>$content_type</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$tokens</declname>
        </param>
        <param>
          <declname>$base_table</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Get the url format for a specific content type</para><para>If the url format has not yet been set then the following will be done 1) Check to see if there is a legacy url format set (features &amp; stocks) 2) Check if there is a defined default for this content type 3) Create a format using any name fields and the unique constraint for the base table associated with this content type</para><para>Define a default for a specific content type by implementing a function of the name [content type]_chado_node_default_url_format() that returns a string describing the default format.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$content_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the content (node) type you are interested in (ie: chado_feature) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$tokens</parametername>
</parameternamelist>
<parameterdescription>
<para>An array, passed by reference that is filled to include the tokens for this node type. Each token is an array with the following keys: -table: the name of the chado table -field: the name of the field in the above table -token: the token string (ie: [stock.stock_id]) -description: a very short description of the token (displayed when tokens are listed) -location: the location of the value in a chado node variable with each level separated by an arrow (-&gt;) symbol. For example, the location for $node-&gt;feature-&gt;type_id-&gt;name is feature&gt;type_id&gt;name</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A string containing tokens describing the default format for the url of nodes of the specified content type. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="966" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="966" bodyend="1016"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1gaf604eef6001c517ea9e08b6609528b8f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_set_node_url</definition>
        <argsstring>($node)</argsstring>
        <name>chado_set_node_url</name>
        <param>
          <declname>$node</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Set the URL for a given node.</para><para>Note: This makes the old URL completely invalid which breaks bookmarks. Furthermore, if someone attempts to go to an old URL they will get a white screen PDO error which is not very user friendly ;-) <xrefsect id="dd/da0/todo_1_todo000015"><xreftitle>Todo</xreftitle><xrefdescription><para>handle re-directing for old URLs or at least ensure a page not found error is displayed.</para></xrefdescription></xrefsect></para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$node</parametername>
</parameternamelist>
<parameterdescription>
<para>The node to set the URL for. The node object must have at a minimum the &apos;nid&apos; and &apos;type&apos; properties, as well as the chado object (e.g. &apos;organism&apos; for chado_organism node type, and &apos;feature&apos; for chado_feature node type, etc.).</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The URL alias that was set. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="588" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="588" bodyend="651"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ad55c27960f57d40dffa26ef911b91dd2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_sort_tokens_by_location</definition>
        <argsstring>($tokenA, $tokenB)</argsstring>
        <name>chado_sort_tokens_by_location</name>
        <param>
          <declname>$tokenA</declname>
        </param>
        <param>
          <declname>$tokenB</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This sorts tokens first by depth (ie: stock.* is before stock.*&gt;subtable.*) and then alphabetically within a level (ie: stock.name comes before stock.type_id)</para><para>This is a usort callback and shouldn&apos;t be called directly. To use: usort($tokens, &apos;chado_sort_tokens_by_location&apos;); </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1427" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1427" bodyend="1444"/>
      </memberdef>
      <memberdef kind="function" id="d8/d43/group__tripal__legacy__chado__node__api_1ga108f6c0724c55abd98c967529835da28" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_update_existing_node_urls</definition>
        <argsstring>($content_type, $job_id=0)</argsstring>
        <name>chado_update_existing_node_urls</name>
        <param>
          <declname>$content_type</declname>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>0</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Tripal Job for updating all node URLs for a particular node type.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$content_type</parametername>
</parameternamelist>
<parameterdescription>
<para>The machine name of the node type to update URLs for. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The ID of the tripal job calling this function. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="663" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="663" bodyend="746"/>
      </memberdef>
      <memberdef kind="function" id="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ac1ac551674e28c76912a4b773f1d93f3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_sort_key_length_asc</definition>
        <argsstring>($a, $b)</argsstring>
        <name>tripal_sort_key_length_asc</name>
        <param>
          <declname>$a</declname>
        </param>
        <param>
          <declname>$b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Sorts an associative array by key length where sorter keys will be first</para><para>This is a uksort callback and shouldn&apos;t be called directly. To use; uksort($arr, &apos;tripal_sort_key_length_asc&apos;); </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" line="1452" column="1" bodyfile="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc" bodystart="1452" bodyend="1462"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Contains API functions to set titles and paths for all chado nodes</para><para><heading level="1">TITLES </heading>
</para><para>There are three steps to implement the ability to set custom titles for the node type: 1) Add the &apos;chado_node_api&apos; elements to the hook_node_info function(). These values define the name of the base table and how to refer to nodes in singular and plural. There are additional paramaters that can be added to the &apos;chado_node_api&apos; for syncing nodes (see documentation for the <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga753ddb12263511e4667c6081cb4aab2f" kindref="member">chado_node_sync_form()</ref> function for additional options. <programlisting><codeline><highlight class="normal">function<sp/>modulename_node_info()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;chado_example&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>t(&apos;example&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;base&apos;<sp/>=&gt;<sp/>&apos;chado_example&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;A<sp/>Chado<sp/>example<sp/>is<sp/>a<sp/>collection<sp/>of<sp/>material<sp/>that<sp/>can<sp/>be<sp/>sampled<sp/>and<sp/>have<sp/>experiments<sp/>performed<sp/>on<sp/>it.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;has_title&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;locked&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>this<sp/>is<sp/>what<sp/>differs<sp/>from<sp/>the<sp/>regular<sp/>Drupal-documented<sp/>hook_node_info()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;chado_node_api&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;base_table&apos;<sp/>=&gt;<sp/>&apos;example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>chado<sp/>base<sp/>table</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;hook_prefix&apos;<sp/>=&gt;<sp/>&apos;chado_example&apos;,<sp/><sp/><sp/><sp/><sp/>//<sp/>usually<sp/>the<sp/>name<sp/>of<sp/>the<sp/>node<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;record_type_title&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;singular&apos;<sp/>=&gt;<sp/>t(&apos;Example&apos;),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Singular<sp/>human-readable<sp/>title</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;plural&apos;<sp/>=&gt;<sp/>t(&apos;Examples&apos;)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Plural<sp/>human-readable<sp/>title</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting></para><para>2) Add the &quot;Set Page Titles&quot; Form to the admin settings form <programlisting><codeline><highlight class="normal">//<sp/>If<sp/>the<sp/>module<sp/>is<sp/>using<sp/>the<sp/>&quot;Chado<sp/>Node:<sp/>Title<sp/>&amp;<sp/>Path<sp/>API&quot;<sp/>to<sp/>allow<sp/>custom<sp/>titles</highlight></codeline>
<codeline><highlight class="normal">//<sp/>for<sp/>your<sp/>node<sp/>type<sp/>then<sp/>you<sp/>need<sp/>to<sp/>add<sp/>the<sp/>configuration<sp/>form<sp/>for<sp/>this<sp/>functionality.</highlight></codeline>
<codeline><highlight class="normal">$details<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;module&apos;<sp/>=&gt;<sp/>&apos;tripal_example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>MODULE<sp/>implementing<sp/>the<sp/>content<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;content_type&apos;<sp/>=&gt;<sp/>&apos;chado_example&apos;,<sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>content<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>An<sp/>array<sp/>of<sp/>options<sp/>to<sp/>use<sp/>under<sp/>&quot;Page<sp/>Titles&quot;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>the<sp/>key<sp/>should<sp/>be<sp/>the<sp/>token<sp/>and<sp/>the<sp/>value<sp/>should<sp/>be<sp/>the<sp/>human-readable<sp/>option</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;options&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;[example.name]&apos;<sp/>=&gt;<sp/>&apos;Germplasm<sp/>Name<sp/>Only&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;[example.uniquename]&apos;<sp/>=&gt;<sp/>&apos;Germplasm<sp/>Unique<sp/>Name<sp/>Only&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>there<sp/>should<sp/>always<sp/>be<sp/>one<sp/>options<sp/>matching<sp/>the<sp/>unique<sp/>constraint.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>you<sp/>have<sp/>a<sp/>more<sp/>human-readable<sp/>constraint,<sp/>then<sp/>that<sp/>is<sp/>preferrable.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>See<sp/>the<sp/>tripal<sp/>feature<sp/>module<sp/>for<sp/>a<sp/>good<sp/>example<sp/>of<sp/>this.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;[example.example_id]&apos;<sp/>=&gt;<sp/>&apos;Unique<sp/>Contraint:<sp/>The<sp/>Chado<sp/>ID<sp/>for<sp/>Examples&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>the<sp/>token<sp/>indicating<sp/>the<sp/>unique<sp/>constraint<sp/>in<sp/>the<sp/>options<sp/>array</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;unique_option&apos;<sp/>=&gt;<sp/>&apos;[example.example_id]&apos;</highlight></codeline>
<codeline><highlight class="normal">);</highlight></codeline>
<codeline><highlight class="normal">//<sp/>This<sp/>call<sp/>adds<sp/>the<sp/>configuration<sp/>form<sp/>to<sp/>your<sp/>current<sp/>form</highlight></codeline>
<codeline><highlight class="normal">//<sp/>This<sp/>sub-form<sp/>handles<sp/>it&apos;s<sp/>own<sp/>validation<sp/>&amp;<sp/>submit</highlight></codeline>
<codeline><highlight class="normal">chado_add_admin_form_set_title($form,<sp/>$form_state,<sp/>$details);</highlight></codeline>
</programlisting></para><para>3) Use chado_get_node_title($node) where ever you want the title for your node. This should be done in hook_load(), hook_node_insert(), hook_node_update(). The reason you set the title in the node_action hooks, which act on all nodes, is because at that point you have the generic loaded node. <programlisting><codeline><highlight class="normal">function<sp/>tripal_example_load($nodes)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>foreach<sp/>($nodes<sp/>as<sp/>$nid<sp/>=&gt;<sp/>$node)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Add<sp/>all<sp/>of<sp/>the<sp/>custom<sp/>content<sp/>for<sp/>your<sp/>node<sp/>type.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>See<sp/>tripal_example.chado_node.api:<sp/>chado_example_load()</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>Now<sp/>get<sp/>the<sp/>title</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$node-&gt;title<sp/>=<sp/>chado_get_node_title($node);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>$nodes[$nid]<sp/>=<sp/>$node;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting></para><para>Optionally define a default for a specific content type by implementing a function of the name [content type]_chado_node_default_title_format() that returns a string describing the default format. <programlisting><codeline><highlight class="normal">function<sp/>chado_example_chado_node_default_title_format()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>&apos;[example.example_id]&apos;;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting> If you don&apos;t implement this then a default format based on the unique constraint for the base table of the content type will be generated.</para><para><heading level="1">NODE URL/PATHS </heading>
</para><para>There are three steps to implement the ability to set custom URLs for the node type: 1) Add the &apos;chado_node_api&apos; elements to the hook_node_info function(). These values define the name of the base table and how to refer to nodes in singular and plural. There are additional paramaters that can be added to the &apos;chado_node_api&apos; for syncing nodes (see documentation for the <ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga753ddb12263511e4667c6081cb4aab2f" kindref="member">chado_node_sync_form()</ref> function for additional options. <programlisting><codeline><highlight class="normal">function<sp/>modulename_node_info()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;chado_example&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>t(&apos;example&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;base&apos;<sp/>=&gt;<sp/>&apos;chado_example&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>t(&apos;A<sp/>Chado<sp/>example<sp/>is<sp/>a<sp/>collection<sp/>of<sp/>material<sp/>that<sp/>can<sp/>be<sp/>sampled<sp/>and<sp/>have<sp/>experiments<sp/>performed<sp/>on<sp/>it.&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;has_title&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;locked&apos;<sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>this<sp/>is<sp/>what<sp/>differs<sp/>from<sp/>the<sp/>regular<sp/>Drupal-documented<sp/>hook_node_info()</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;chado_node_api&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;base_table&apos;<sp/>=&gt;<sp/>&apos;example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>chado<sp/>base<sp/>table</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;hook_prefix&apos;<sp/>=&gt;<sp/>&apos;chado_example&apos;,<sp/><sp/><sp/><sp/><sp/>//<sp/>usually<sp/>the<sp/>name<sp/>of<sp/>the<sp/>node<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;record_type_title&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;singular&apos;<sp/>=&gt;<sp/>t(&apos;Example&apos;),<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Singular<sp/>human-readable<sp/>title</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;plural&apos;<sp/>=&gt;<sp/>t(&apos;Examples&apos;)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Plural<sp/>human-readable<sp/>title</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting></para><para>2) Add the &quot;Set Page URLs&quot; Form to the admin settings form <programlisting><codeline><highlight class="normal">//<sp/>If<sp/>the<sp/>module<sp/>is<sp/>using<sp/>the<sp/>&quot;Chado<sp/>Node:<sp/>Title<sp/>&amp;<sp/>Path<sp/>API&quot;<sp/>to<sp/>allow<sp/>custom<sp/>URLs</highlight></codeline>
<codeline><highlight class="normal">//<sp/>for<sp/>your<sp/>node<sp/>type<sp/>then<sp/>you<sp/>need<sp/>to<sp/>add<sp/>the<sp/>configuration<sp/>form<sp/>for<sp/>this<sp/>functionality.</highlight></codeline>
<codeline><highlight class="normal">$details<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;module&apos;<sp/>=&gt;<sp/>&apos;tripal_example&apos;,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>MODULE<sp/>implementing<sp/>the<sp/>content<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;content_type&apos;<sp/>=&gt;<sp/>&apos;chado_example&apos;,<sp/><sp/><sp/>//<sp/>the<sp/>name<sp/>of<sp/>the<sp/>content<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>An<sp/>array<sp/>of<sp/>options<sp/>to<sp/>use<sp/>under<sp/>&quot;Page<sp/>URLs&quot;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//<sp/>the<sp/>key<sp/>should<sp/>be<sp/>the<sp/>token<sp/>and<sp/>the<sp/>value<sp/>should<sp/>be<sp/>the<sp/>human-readable<sp/>option</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;options&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;/example/[example.type_id&gt;cvterm.name]/[example.example_id]&apos;<sp/>=&gt;<sp/>&apos;Examples<sp/>separated<sp/>by<sp/>Type&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>there<sp/>should<sp/>always<sp/>be<sp/>one<sp/>options<sp/>matching<sp/>the<sp/>unique<sp/>constraint.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>you<sp/>have<sp/>a<sp/>more<sp/>human-readable<sp/>constraint,<sp/>then<sp/>that<sp/>is<sp/>preferrable.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>See<sp/>the<sp/>tripal<sp/>feature<sp/>module<sp/>for<sp/>a<sp/>good<sp/>example<sp/>of<sp/>this.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;/example/[example.example_id]&apos;<sp/>=&gt;<sp/>&apos;Unique<sp/>Contraint:<sp/>The<sp/>Chado<sp/>ID<sp/>for<sp/>Examples&apos;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal">);</highlight></codeline>
<codeline><highlight class="normal">//<sp/>This<sp/>call<sp/>adds<sp/>the<sp/>configuration<sp/>form<sp/>to<sp/>your<sp/>current<sp/>form</highlight></codeline>
<codeline><highlight class="normal">//<sp/>This<sp/>sub-form<sp/>handles<sp/>it&apos;s<sp/>own<sp/>validation<sp/>&amp;<sp/>submit</highlight></codeline>
<codeline><highlight class="normal">chado_add_admin_form_set_url($form,<sp/>$form_state,<sp/>$details);</highlight></codeline>
</programlisting></para><para>3) Use chado_set_node_url($node) where ever you want to reset the URL of the node. This should be done in hook_node_insert(), hook_node_update(). The reason you set the title in the node_action hooks, which act on all nodes, is because at that point you have the generic loaded node. <programlisting><codeline><highlight class="normal">function<sp/>tripal_example_node_insert($node)<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>Set<sp/>the<sp/>URL<sp/>path<sp/>after<sp/>inserting.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>switch<sp/>($node-&gt;type)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>case<sp/>&apos;chado_example&apos;:</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Now<sp/>use<sp/>the<sp/>API<sp/>to<sp/>set<sp/>the<sp/>path.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>chado_set_node_url($node);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>break;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting></para><para>Optionally define a default for a specific content type by implementing a function of the name [content type]_chado_node_default_url_format() that returns a string describing the default format. <programlisting><codeline><highlight class="normal">function<sp/>chado_example_chado_node_default_url_format()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>return<sp/>&apos;/example/[example.example_id]&apos;;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting> If you don&apos;t implement this then a default format based on the unique constraint for the base table of the content type will be generated. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="196" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6be2b3290e82364d934fbb30532a0868" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6be2b3290e82364d934fbb30532a0868" kindref="member">chado_get_node_title</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/>$content_type<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;type;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>tokens<sp/>and<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();<sp/></highlight><highlight class="comment">//<sp/>this<sp/>will<sp/>be<sp/>set<sp/>by<sp/>chado_node_get_title_format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/>$title<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga678469ec2f27a2354fa5c0176802cabf" kindref="member">chado_node_get_title_format</ref>($content_type,<sp/>$tokens);</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>which<sp/>tokens<sp/>were<sp/>used<sp/>in<sp/>the<sp/>format<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/\[[^]]+\]/&apos;</highlight><highlight class="normal">,<sp/>$title,<sp/>$used_tokens))<sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>value<sp/>for<sp/>each<sp/>token<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($used_tokens[0]<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$token_info<sp/>=<sp/>$tokens[$token];</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($token_info))<sp/>{</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6afd60d9aa697351972c5b86575b8a03" kindref="member">chado_get_token_value</ref>($token_info,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$title<sp/>=<sp/>str_replace($token,<sp/>$value,<sp/>$title);</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$title;</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$title;</highlight></codeline>
<codeline lineno="220"><highlight class="normal">}</highlight></codeline>
<codeline lineno="221"><highlight class="normal"></highlight></codeline>
<codeline lineno="245" refid="d8/d43/group__tripal__legacy__chado__node__api_1gae15385749a7549bd6a0265f3d438f151" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gae15385749a7549bd6a0265f3d438f151" kindref="member">chado_add_admin_form_set_title</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state,<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>Node<sp/>Info</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_info<sp/>=<sp/>call_user_func($details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_node_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>$chado_node_api<sp/>=<sp/>$node_info[<sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>][</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Set<sp/>Titles<sp/>API:<sp/>When<sp/>calling<sp/>chado_add_admin_form_set_title,<sp/>you<sp/>\$details<sp/>array<sp/>must<sp/>include<sp/>&apos;module&apos;<sp/>=&gt;<sp/>[name<sp/>of<sp/>your<sp/>module]<sp/>in<sp/>order<sp/>to<sp/>pull<sp/>out<sp/>all<sp/>the<sp/>information<sp/>provided<sp/>in<sp/>your<sp/>implementation<sp/>of<sp/>hook_node_info&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Defaults</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;Set<sp/>Page<sp/>Titles&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]<sp/>:<sp/>array();</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($tokens))<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens</ref>($chado_node_api[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array_merge($tokens,<sp/>$details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/>$token_list<sp/>=<sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a6ef291862b2dc896b538b4e323e4c109" kindref="member">chado_node_format_tokens</ref>($tokens);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]<sp/>:<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga678469ec2f27a2354fa5c0176802cabf" kindref="member">chado_node_get_title_format</ref>($details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">],<sp/>$tokens);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>FORM<sp/>PROPER</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/>$msg<sp/>=<sp/>t(</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Each<sp/>synced<sp/>%singular<sp/>must<sp/>have<sp/>a<sp/>unique<sp/>page<sp/>title,<sp/>however,<sp/>%plural<sp/>may<sp/>have<sp/>the</highlight></codeline>
<codeline lineno="277"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>same<sp/>name<sp/>if<sp/>they<sp/>are<sp/>of<sp/>different<sp/>types<sp/>or<sp/>from<sp/>different<sp/>organisms.<sp/>Therefore,</highlight></codeline>
<codeline lineno="278"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>we<sp/>must<sp/>be<sp/>sure<sp/>that<sp/>the<sp/>page<sp/>titles<sp/>can<sp/>uniquely<sp/>identify<sp/>the<sp/>%singular<sp/>being<sp/>viewed.</highlight></codeline>
<codeline lineno="279"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>Select<sp/>an<sp/>option<sp/>below<sp/>that<sp/>will<sp/>uniquely<sp/>identify<sp/>all<sp/>%plural<sp/>on<sp/>your<sp/>site.&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$msg,</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;&lt;div<sp/>id=&apos;set_titles-fieldset&apos;&gt;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_info[<sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>][</highlight><highlight class="stringliteral">&apos;base&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Custom:<sp/>See<sp/>the<sp/>text<sp/>field<sp/>below.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_option&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;%singular<sp/>Page<sp/>Titles&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">])),</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;radios&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;Choose<sp/>a<sp/>title<sp/>type<sp/>from<sp/>the<sp/>list<sp/>above<sp/>that<sp/>is</highlight></codeline>
<codeline lineno="304"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>guaranteed<sp/>to<sp/>be<sp/>unique<sp/>for<sp/>all<sp/>%plural.<sp/>If<sp/>in<sp/>doubt<sp/>it<sp/>is<sp/>safest<sp/>to<sp/>choose</highlight></codeline>
<codeline lineno="305"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>&apos;Unique<sp/>Constaint&apos;<sp/>option<sp/>as<sp/>that<sp/>guarantees<sp/>uniqueness.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])),</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">][$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;custom&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_format_variable&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_title_format&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom_title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Custom<sp/>Page<sp/>Title&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;You<sp/>may<sp/>rearrange<sp/>elements<sp/>in<sp/>this<sp/>text<sp/>box<sp/>to<sp/>customize<sp/>the<sp/>page</highlight></codeline>
<codeline lineno="321"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>titles.<sp/>The<sp/>available<sp/>tokens<sp/>are<sp/>listed<sp/>below.<sp/>You<sp/>can<sp/>separate<sp/>or<sp/>include<sp/>any<sp/>text</highlight></codeline>
<codeline lineno="322"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>between<sp/>the<sp/>tokens.<sp/>&lt;strong&gt;Important:<sp/>be<sp/>sure<sp/>that<sp/>whatever<sp/>you<sp/>choose</highlight></codeline>
<codeline lineno="323"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>will<sp/>always<sp/>be<sp/>unique<sp/>even<sp/>considering<sp/>future<sp/>data<sp/>that<sp/>may<sp/>be<sp/>added.<sp/>If<sp/>in<sp/>doubt,</highlight></codeline>
<codeline lineno="324"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>please<sp/>select<sp/>the<sp/>unique<sp/>constraint<sp/>title<sp/>option<sp/>above.&lt;/strong&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Available<sp/>Tokens&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Copy<sp/>the<sp/>token<sp/>and<sp/>paste<sp/>it<sp/>into<sp/>the<sp/>&quot;Custom<sp/>Page<sp/>Title&quot;<sp/>text<sp/>field<sp/>above.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token_list</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($tokens)</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="346"><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_titles&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Set<sp/>Titles&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_admin_form_set_title_form_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_admin_form_set_title_form_submit&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal">}</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="360" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a529ef05e91373ece2ed0bc6f6f4a3b72" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a529ef05e91373ece2ed0bc6f6f4a3b72" kindref="member">chado_add_admin_form_set_title_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>that<sp/>all<sp/>tokens<sp/>used<sp/>in<sp/>the<sp/>format<sp/>are<sp/>in<sp/>the<sp/>tokens<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/\[[^]]+\]/&apos;</highlight><highlight class="normal">,$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom_title&apos;</highlight><highlight class="normal">],$used_tokens))<sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>$token_list<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($used_tokens[0]<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($token,$token_list))<sp/>{</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;custom_title&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;All<sp/>tokens<sp/>used<sp/>must<sp/>be<sp/>in<sp/>the<sp/>&quot;Available<sp/>Tokens&quot;<sp/>list.<sp/>Please<sp/>make<sp/>sure<sp/>not<sp/>to<sp/>use<sp/>[<sp/>or<sp/>]<sp/>unless<sp/>it\&apos;s<sp/>denoting<sp/>a<sp/>token&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal">}</highlight></codeline>
<codeline lineno="373"><highlight class="normal"></highlight></codeline>
<codeline lineno="378" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1aee62e3ee19fe65c01f181aa9f282ab33" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1aee62e3ee19fe65c01f181aa9f282ab33" kindref="member">chado_add_admin_form_set_title_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_option&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;custom&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom_title&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;title_option&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" kindref="member">chado_node_add_token_format</ref>(</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">],<sp/>$format,<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="388"><highlight class="normal">}</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="422" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga678469ec2f27a2354fa5c0176802cabf" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga678469ec2f27a2354fa5c0176802cabf" kindref="member">chado_node_get_title_format</ref>($content_type,<sp/>&amp;$tokens,<sp/>$base_table<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/>$format_record_format<sp/>=<sp/>$format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/>$format_record_tokens<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Is<sp/>there<sp/>a<sp/>title<sp/>format<sp/>set?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/>$format_record<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gadac406c54ee6c9dd13e8ebc4deb8b40b" kindref="member">chado_node_get_token_format</ref>(</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">,<sp/>$content_type,<sp/>array(</highlight><highlight class="stringliteral">&apos;return_record&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE));</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($format_record))<sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>$format_record_format<sp/>=<sp/>$format<sp/>=<sp/>$format_record-&gt;format;</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/>$format_record_tokens<sp/>=<sp/>$tokens<sp/>=<sp/>$format_record-&gt;tokens;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>All<sp/>three<sp/>options<sp/>below<sp/>need<sp/>the<sp/>tokens<sp/>to<sp/>be<sp/>generated<sp/>so<sp/>do<sp/>that<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($base_table))<sp/>{</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" kindref="member">chado_node_get_base_table</ref>($content_type);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens</ref>($base_table);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>1)<sp/>Check<sp/>for<sp/>legacy<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad50ca3f66cd8f6eabbc3be91320f6be1" kindref="member">chado_node_get_legacy_title_default</ref>($content_type);</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>2)<sp/>Module-defined<sp/>default<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>$hook<sp/>=<sp/>$content_type<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_default_title_format&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook))<sp/>{</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>call_user_func($hook);</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>3)<sp/>Create<sp/>unique<sp/>constraint<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($base_table))<sp/>{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" kindref="member">chado_node_get_base_table</ref>($content_type);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad00086a99a67b021e0d631c46ac5f110" kindref="member">chado_node_get_unique_constraint_format</ref>($base_table);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>format<sp/>to<sp/>table<sp/>so<sp/>we<sp/>can<sp/>use<sp/>it<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>(optimization:<sp/>to<sp/>speed<sp/>up<sp/>bulk<sp/>updates,<sp/>don&apos;t<sp/>update<sp/>the<sp/>record<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>format<sp/>and<sp/>tokens<sp/>are<sp/>unchanged)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($format<sp/>!=<sp/>$format_record_format<sp/>||<sp/>$tokens<sp/>!=<sp/>$format_record_tokens)<sp/>{</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" kindref="member">chado_node_add_token_format</ref>(</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">,<sp/>$content_type,<sp/>$format,<sp/>$tokens);</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="470"><highlight class="normal">}</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="482" refid="d8/d43/group__tripal__legacy__chado__node__api_1gad50ca3f66cd8f6eabbc3be91320f6be1" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad50ca3f66cd8f6eabbc3be91320f6be1" kindref="member">chado_node_get_legacy_title_default</ref>($content_type)<sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($content_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;chado_feature&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_option<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;chado_feature_title&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;unique_constraint&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>($legacy_option)<sp/>{</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;feature_unique_name&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default_title_format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[feature.uniquename]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;feature_name&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default_title_format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[feature.name]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;unique_constraint&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default_title_format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[feature.name],<sp/>[feature.uniquename]<sp/>([feature.type_id&gt;cvterm.name])<sp/>[feature.organism_id&gt;organism.genus]<sp/>[feature.organism_id&gt;organism.species]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$default_title_format;</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/>elseif<sp/>($content_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;chado_stock&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_option<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;chado_stock_title&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;unique_constraint&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>($legacy_option)<sp/>{</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;stock_unique_name&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default_title_format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[stock.uniquename]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;stock_name&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default_title_format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[stock.name]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;unique_constraint&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$default_title_format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;[stock.name],<sp/>[stock.uniquename]<sp/>([stock.type_id&gt;cvterm.name])<sp/>[stock.organism_id&gt;organism.genus]<sp/>[stock.organism_id&gt;organism.species]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$default_title_format;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal">}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="534" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga1d0ba1cce0cf57234a9e90607233b7c3" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga1d0ba1cce0cf57234a9e90607233b7c3" kindref="member">chado_get_node_url</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/>$content_type<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;type;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>tokens<sp/>and<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();<sp/></highlight><highlight class="comment">//<sp/>this<sp/>will<sp/>be<sp/>set<sp/>by<sp/>chado_node_get_url_format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/>$url<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga9470e29b313ec722a24f2d613c7f66aa" kindref="member">chado_node_get_url_format</ref>($content_type,<sp/>$tokens);</highlight></codeline>
<codeline lineno="540"><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Determine<sp/>which<sp/>tokens<sp/>were<sp/>used<sp/>in<sp/>the<sp/>format<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/\[[^]]+\]/&apos;</highlight><highlight class="normal">,<sp/>$url,<sp/>$used_tokens))<sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>value<sp/>for<sp/>each<sp/>token<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($used_tokens[0]<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$token_info<sp/>=<sp/>$tokens[$token];</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($token_info))<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$value<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6afd60d9aa697351972c5b86575b8a03" kindref="member">chado_get_token_value</ref>($token_info,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_string($value))<sp/>{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$url<sp/>=<sp/>str_replace($token,<sp/>$value,<sp/>$url);</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,<ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>replace<sp/>%token.<sp/>The<sp/>value<sp/>in<sp/>the<sp/>node<sp/>should<sp/>be<sp/>a<sp/>string<sp/>but<sp/>is<sp/>instead:<sp/>\&apos;%value\&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,<sp/></highlight><highlight class="stringliteral">&apos;%value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($value,<sp/>TRUE))</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$url;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$url;</highlight></codeline>
<codeline lineno="566"><highlight class="normal">}</highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight></codeline>
<codeline lineno="588" refid="d8/d43/group__tripal__legacy__chado__node__api_1gaf604eef6001c517ea9e08b6609528b8f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gaf604eef6001c517ea9e08b6609528b8f" kindref="member">chado_set_node_url</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>)<sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>global<sp/>variable<sp/>determining<sp/>the<sp/>language<sp/>of<sp/>the<sp/>current<sp/>content.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/>global<sp/>$language_content;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>we<sp/>need<sp/>to<sp/>get<sp/>the<sp/>URL<sp/>alias.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/>$url_alias<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga1d0ba1cce0cf57234a9e90607233b7c3" kindref="member">chado_get_node_url</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="595"><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>And<sp/>remove<sp/>any<sp/>forward<sp/>slashes<sp/>since<sp/>those<sp/>wreak<sp/>havok.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/>$url_alias<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/^\//&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$url_alias);</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Use<sp/>the<sp/>node<sp/>to<sp/>determine<sp/>the<sp/>source/original<sp/>URL.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/>$source_url<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;node/&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid;</highlight></codeline>
<codeline lineno="601"><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>that<sp/>there<sp/>are<sp/>no<sp/>spaces<sp/>and<sp/>other<sp/>non-friendly<sp/>characters<sp/>are</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>sanitized.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/>$url_alias<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/\s+/&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;-&apos;</highlight><highlight class="normal">,$url_alias);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Only<sp/>bother<sp/>setting<sp/>the<sp/>alias<sp/>if<sp/>there<sp/>is<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($url_alias)<sp/>AND<sp/>$source_url<sp/>!=<sp/>$url_alias)<sp/>{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>we<sp/>need<sp/>to<sp/>check<sp/>if<sp/>the<sp/>alias<sp/>already<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/>$path<sp/>=<sp/>path_load(array(</highlight><highlight class="stringliteral">&apos;source&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$source_url,<sp/></highlight><highlight class="stringliteral">&apos;alias&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url_alias));</highlight></codeline>
<codeline lineno="611"><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Etierh<sp/>there<sp/>isn&apos;t<sp/>an<sp/>alias<sp/>yet<sp/>so<sp/>we<sp/>just<sp/>create<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($path))<sp/>{</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$path<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;source&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$source_url,</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;alias&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url_alias</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>path_save($path);</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Or<sp/>an<sp/>Alias<sp/>already<sp/>exists<sp/>but<sp/>we<sp/>would<sp/>like<sp/>to<sp/>add<sp/>a<sp/>new<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($path[</highlight><highlight class="stringliteral">&apos;alias&apos;</highlight><highlight class="normal">]<sp/>!=<sp/>$url_alias)<sp/>{</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$path<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;source&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$source_url,</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;alias&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url_alias</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>path_save($path);</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>Alias<sp/>already<sp/>exists<sp/>we<sp/>want<sp/>to<sp/>double<sp/>check<sp/>that<sp/>it&apos;s<sp/>for<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>current<sp/>node.<sp/>Otherwise<sp/>we<sp/>should<sp/>warn<sp/>the<sp/>administrator<sp/>that<sp/>the<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>format<sp/>they<sp/>chose<sp/>isn&apos;t<sp/>unique.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$num_aliases<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&apos;SELECT<sp/>count(*)<sp/>as<sp/>num_alias<sp/>FROM<sp/>{url_alias}<sp/>WHERE<sp/>alias=:alias<sp/>AND<sp/>source!=:source&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:alias&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url_alias,<sp/></highlight><highlight class="stringliteral">&apos;:source&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$source_url))-&gt;fetchField();</highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>is<sp/>an<sp/>alias<sp/>with<sp/>a<sp/>different<sp/>source<sp/>than<sp/>warn<sp/>the<sp/>admin.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_aliases<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;URL<sp/>Alias:<sp/>The<sp/>URL<sp/>format<sp/>for<sp/>%content-type<sp/>is<sp/>not<sp/>unique.<sp/>Specifically,<sp/>%alias<sp/>was<sp/>almost<sp/>added<sp/>multiple<sp/>times.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%content-type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;type,</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%alias&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$url_alias,</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="647"><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$url_alias;</highlight></codeline>
<codeline lineno="651"><highlight class="normal">}</highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight></codeline>
<codeline lineno="663" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga108f6c0724c55abd98c967529835da28" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga108f6c0724c55abd98c967529835da28" kindref="member">chado_update_existing_node_urls</ref>($content_type,<sp/>$job_id<sp/>=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nNOTE:<sp/>Setting<sp/>of<sp/>URLs<sp/>is<sp/>performed<sp/>using<sp/>a<sp/>database<sp/>transaction.<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;If<sp/>the<sp/>load<sp/>fails<sp/>or<sp/>is<sp/>terminated<sp/>prematurely<sp/>then<sp/>the<sp/>entire<sp/>set<sp/>of<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;new<sp/>URLs<sp/>will<sp/>be<sp/>rolled<sp/>back<sp/>and<sp/>no<sp/>changes<sp/>will<sp/>be<sp/>made.\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>number<sp/>of<sp/>records<sp/>we<sp/>need<sp/>to<sp/>set<sp/>URLs<sp/>for.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_nodes<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&apos;SELECT<sp/>count(*)<sp/>FROM<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/>$content_type<sp/>.<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">)-&gt;fetchField();</highlight></codeline>
<codeline lineno="673"><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculate<sp/>the<sp/>interval<sp/>at<sp/>which<sp/>we<sp/>will<sp/>print<sp/>an<sp/>update<sp/>on<sp/>the<sp/>screen.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_set<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_per_interval<sp/>=<sp/>100;</highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_nodes<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;There<sp/>are<sp/>$num_nodes<sp/>nodes<sp/>to<sp/>update<sp/>URLs<sp/>for.<sp/>You<sp/>will<sp/>be<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;updated<sp/>on<sp/>the<sp/>progress<sp/>every<sp/>100<sp/>nodes.\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>list<sp/>of<sp/>nodes<sp/>of<sp/>this<sp/>particular<sp/>content<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>EntityFieldQuery();</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>$query-&gt;entityCondition(</highlight><highlight class="stringliteral">&apos;entity_type&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;entityCondition(</highlight><highlight class="stringliteral">&apos;bundle&apos;</highlight><highlight class="normal">,<sp/>$content_type)</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="688"><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($result[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$nids<sp/>=<sp/>array_keys($result[</highlight><highlight class="stringliteral">&apos;node&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="691"><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($nids<sp/>as<sp/>$nid)<sp/>{</highlight></codeline>
<codeline lineno="693"><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Load<sp/>the<sp/>current<sp/>node.<sp/>Normally<sp/>here<sp/>we<sp/>would<sp/>use<sp/>the<sp/>node_load()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>function<sp/>that<sp/>is<sp/>part<sp/>of<sp/>the<sp/>Drupal<sp/>API.<sp/><sp/>However,<sp/>this<sp/>seems</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>have<sp/>memory<sp/>leaks<sp/>that<sp/>have<sp/>not<sp/>yet<sp/>been<sp/>identified,<sp/>so</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we&apos;ll<sp/>create<sp/>the<sp/>object<sp/>by<sp/>hand:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid<sp/>=<sp/>$nid;</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;type<sp/>=<sp/>$content_type;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/chado_/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/>$content_type);</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$id<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga4b1cdb30165d8a7fa2b2b788d651475f" kindref="member">chado_get_id_from_nid</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$nid);</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;$table<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>array(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;_id&quot;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$id));</highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>set<sp/>the<sp/>URL<sp/>for<sp/>the<sp/>current<sp/>node.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$alias<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gaf604eef6001c517ea9e08b6609528b8f" kindref="member">chado_set_node_url</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>);</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>update<sp/>the<sp/>job<sp/>status<sp/>every<sp/>1%<sp/>nodes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($num_set<sp/>%<sp/>$num_per_interval<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>($num_set<sp/>/<sp/>$num_nodes)<sp/>*<sp/>100;</highlight></codeline>
<codeline lineno="711"><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>user<sp/>on<sp/>progress.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>$percent);</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Setting<sp/>URLs<sp/>(&quot;</highlight><highlight class="normal"><sp/>.<sp/>$percent<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;%).<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\r&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="715"><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>tripal<sp/>job.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job_id)<sp/>{</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval($percent));</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$num_set++;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>($num_set<sp/>/<sp/>$num_nodes)<sp/>*<sp/>100;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>intval($percent));</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$percent<sp/>=<sp/>sprintf(</highlight><highlight class="stringliteral">&quot;%.2f&quot;</highlight><highlight class="normal">,<sp/>$percent);</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Setting<sp/>URLs<sp/>(&quot;</highlight><highlight class="normal"><sp/>.<sp/>$percent<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;%).<sp/>Memory:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes.\r&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nDone.<sp/>Set<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format($num_set)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>URLs\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nThere<sp/>are<sp/>no<sp/>$content_type<sp/>nodes<sp/>to<sp/>update.<sp/>If<sp/>you<sp/>know<sp/>there\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;are<sp/>records<sp/>of<sp/>this<sp/>type<sp/>in<sp/>chado,<sp/>try<sp/>sync&apos;ing<sp/>them<sp/>to<sp/>Drupal.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>we<sp/>start<sp/>errors<sp/>on<sp/>new<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog_exception(</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,<sp/>$e);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>update<sp/>URLs<sp/>for<sp/>the<sp/>:content-type<sp/>Node<sp/>Type.<sp/>Specifically,<sp/>the<sp/>last<sp/>URL<sp/>attempted<sp/>was<sp/>NID=:nid<sp/>and<sp/>Alias=:alias&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:content-type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$content_type,<sp/></highlight><highlight class="stringliteral">&apos;:nid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>-&gt;nid,<sp/></highlight><highlight class="stringliteral">&apos;:alias&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$alias)</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="746"><highlight class="normal">}</highlight></codeline>
<codeline lineno="747"><highlight class="normal"></highlight></codeline>
<codeline lineno="771" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga8bab59be7bf1fb6ea3fb0486fda79a8d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga8bab59be7bf1fb6ea3fb0486fda79a8d" kindref="member">chado_add_admin_form_set_url</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state,<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>Node<sp/>Info</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/>$node_info<sp/>=<sp/>call_user_func($details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_node_info&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/>$chado_node_api<sp/>=<sp/>$node_info[<sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>][</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Set<sp/>URL<sp/>API:<sp/>When<sp/>calling<sp/>chado_add_admin_form_set_url,<sp/>you<sp/>\$details<sp/>array<sp/>must<sp/>include<sp/>&apos;module&apos;<sp/>=&gt;<sp/>[name<sp/>of<sp/>your<sp/>module]<sp/>in<sp/>order<sp/>to<sp/>pull<sp/>out<sp/>all<sp/>the<sp/>information<sp/>provided<sp/>in<sp/>your<sp/>implementation<sp/>of<sp/>hook_node_info&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Defaults</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;Set<sp/>Page<sp/>URLs&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]<sp/>:<sp/>array();</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($tokens))<sp/>{</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens</ref>($chado_node_api[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array_merge($tokens,<sp/>$details[</highlight><highlight class="stringliteral">&apos;custom_tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/>$token_list<sp/>=<sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a6ef291862b2dc896b538b4e323e4c109" kindref="member">chado_node_format_tokens</ref>($tokens);</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/>$current_format<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga9470e29b313ec722a24f2d613c7f66aa" kindref="member">chado_node_get_url_format</ref>($details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">],<sp/>$tokens);</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$current_format;</highlight></codeline>
<codeline lineno="800"><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>FORM<sp/>PROPER</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/>$msg<sp/>=<sp/>t(</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Each<sp/>synced<sp/>%singular<sp/>must<sp/>have<sp/>a<sp/>unique<sp/>page<sp/>URL,<sp/>however,<sp/>%plural<sp/>may<sp/>have<sp/>the</highlight></codeline>
<codeline lineno="804"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>same<sp/>name<sp/>if<sp/>they<sp/>are<sp/>of<sp/>different<sp/>types<sp/>or<sp/>from<sp/>different<sp/>organisms.<sp/>Therefore,</highlight></codeline>
<codeline lineno="805"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>we<sp/>must<sp/>be<sp/>sure<sp/>that<sp/>the<sp/>page<sp/>URLs<sp/>can<sp/>uniquely<sp/>identify<sp/>the<sp/>%singular<sp/>being<sp/>viewed.</highlight></codeline>
<codeline lineno="806"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>Select<sp/>an<sp/>option<sp/>below<sp/>that<sp/>will<sp/>uniquely<sp/>identify<sp/>all<sp/>%plural<sp/>on<sp/>your<sp/>site.&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>.<sp/>$details[</highlight><highlight class="stringliteral">&apos;additional_instructions&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t($details[</highlight><highlight class="stringliteral">&apos;fieldset_title&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$msg,</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;&lt;div<sp/>id=&apos;set_url-fieldset&apos;&gt;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="820"><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$node_info[<sp/>$details[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>][</highlight><highlight class="stringliteral">&apos;base&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="825"><highlight class="normal"></highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/>$details[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Custom:<sp/>See<sp/>the<sp/>text<sp/>field<sp/>below.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_option&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;%singular<sp/>Page<sp/>URL&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%singular&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;singular&apos;</highlight><highlight class="normal">])),</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;radios&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&quot;Choose<sp/>a<sp/>URL<sp/>type<sp/>from<sp/>the<sp/>list<sp/>above<sp/>that<sp/>is</highlight></codeline>
<codeline lineno="832"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>guaranteed<sp/>to<sp/>be<sp/>unique<sp/>for<sp/>all<sp/>%plural.<sp/>If<sp/>in<sp/>doubt<sp/>it<sp/>is<sp/>safest<sp/>to<sp/>choose</highlight></codeline>
<codeline lineno="833"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>&apos;Unique<sp/>Constaint&apos;<sp/>option<sp/>as<sp/>that<sp/>guarantees<sp/>uniqueness.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%plural&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$chado_node_api[</highlight><highlight class="stringliteral">&apos;record_type_title&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;plural&apos;</highlight><highlight class="normal">])),</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>(isset($details[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">][$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]]))<sp/>?<sp/>$details[</highlight><highlight class="stringliteral">&apos;default_option&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;custom&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="839"><highlight class="normal"></highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_format_variable&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$details[</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_url_format&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="844"><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom_url&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textarea&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Custom<sp/>Page<sp/>URL&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;You<sp/>may<sp/>rearrange<sp/>elements<sp/>in<sp/>this<sp/>text<sp/>box<sp/>to<sp/>customize<sp/>the<sp/>page</highlight></codeline>
<codeline lineno="849"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>URLs.<sp/>The<sp/>available<sp/>tokens<sp/>are<sp/>listed<sp/>below.<sp/>You<sp/>can<sp/>separate<sp/>or<sp/>include<sp/>any<sp/>text</highlight></codeline>
<codeline lineno="850"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>between<sp/>the<sp/>tokens.<sp/>&lt;strong&gt;Important:<sp/>be<sp/>sure<sp/>that<sp/>whatever<sp/>you<sp/>choose</highlight></codeline>
<codeline lineno="851"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>will<sp/>always<sp/>be<sp/>unique<sp/>even<sp/>considering<sp/>future<sp/>data<sp/>that<sp/>may<sp/>be<sp/>added.<sp/>If<sp/>in<sp/>doubt,</highlight></codeline>
<codeline lineno="852"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>please<sp/>select<sp/>the<sp/>unique<sp/>constraint<sp/>title<sp/>option<sp/>above.&lt;/strong&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$current_format,</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="856"><highlight class="normal"></highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fieldset&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Available<sp/>Tokens&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Copy<sp/>the<sp/>token<sp/>and<sp/>paste<sp/>it<sp/>into<sp/>the<sp/>&quot;Custom<sp/>Page<sp/>URL&quot;<sp/>text<sp/>field<sp/>above.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsible&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#collapsed&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="864"><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;token_display&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;item&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token_list</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="869"><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;hidden&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($tokens)</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="874"><highlight class="normal"></highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;set_url&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Set<sp/>URLs&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_admin_form_set_url_form_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;chado_add_admin_form_set_url_form_submit&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="881"><highlight class="normal"></highlight></codeline>
<codeline lineno="882"><highlight class="normal">}</highlight></codeline>
<codeline lineno="883"><highlight class="normal"></highlight></codeline>
<codeline lineno="888" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1aa2cb2e9331598dde0ffc0d36f95063be" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1aa2cb2e9331598dde0ffc0d36f95063be" kindref="member">chado_add_admin_form_set_url_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="889"><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>that<sp/>all<sp/>tokens<sp/>used<sp/>in<sp/>the<sp/>format<sp/>are<sp/>in<sp/>the<sp/>tokens<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match_all(</highlight><highlight class="stringliteral">&apos;/\[[^]]+\]/&apos;</highlight><highlight class="normal">,$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom_url&apos;</highlight><highlight class="normal">],$used_tokens))<sp/>{</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/>$token_list<sp/>=<sp/>unserialize($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($used_tokens[0]<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists($token,$token_list))<sp/>{</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&apos;custom_url&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;All<sp/>tokens<sp/>used<sp/>must<sp/>be<sp/>in<sp/>the<sp/>&quot;Available<sp/>Tokens&quot;<sp/>list.<sp/>Please<sp/>make<sp/>sure<sp/>not<sp/>to<sp/>use<sp/>[<sp/>or<sp/>]<sp/>unless<sp/>it\&apos;s<sp/>denoting<sp/>a<sp/>token&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="899"><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal">}</highlight></codeline>
<codeline lineno="901"><highlight class="normal"></highlight></codeline>
<codeline lineno="906" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ab76f7be077a22d5d0fc5777236905fdf" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ab76f7be077a22d5d0fc5777236905fdf" kindref="member">chado_add_admin_form_set_url_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="907"><highlight class="normal"></highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_option&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;custom&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;custom_url&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;url_option&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="914"><highlight class="normal"></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>format<sp/>to<sp/>the<sp/>table<sp/>for<sp/>all<sp/>new<sp/>nodes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" kindref="member">chado_node_add_token_format</ref>(</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/>$format,</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="922"><highlight class="normal"></highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>a<sp/>job<sp/>to<sp/>Update<sp/>all<sp/>existing<sp/>nodes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Set<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>URLs<sp/>for<sp/>all<sp/>existing<sp/>nodes.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;chado_update_existing_node_urls&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/>$user-&gt;uid</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="932"><highlight class="normal">}</highlight></codeline>
<codeline lineno="933"><highlight class="normal"></highlight></codeline>
<codeline lineno="966" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga9470e29b313ec722a24f2d613c7f66aa" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga9470e29b313ec722a24f2d613c7f66aa" kindref="member">chado_node_get_url_format</ref>($content_type,<sp/>&amp;$tokens,<sp/>$base_table<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/>$format_record_format<sp/>=<sp/>$format<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/>$format_record_tokens<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="969"><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Is<sp/>there<sp/>a<sp/>url<sp/>format<sp/>set?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/>$format_record<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gadac406c54ee6c9dd13e8ebc4deb8b40b" kindref="member">chado_node_get_token_format</ref>(</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">,<sp/>$content_type,<sp/>array(</highlight><highlight class="stringliteral">&apos;return_record&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE));</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($format_record))<sp/>{</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/>$format_record_format<sp/>=<sp/>$format<sp/>=<sp/>$format_record-&gt;format;</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/>$format_record_tokens<sp/>=<sp/>$tokens<sp/>=<sp/>$format_record-&gt;tokens;</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="976"><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>All<sp/>three<sp/>options<sp/>below<sp/>need<sp/>the<sp/>tokens<sp/>to<sp/>be<sp/>generated<sp/>so<sp/>do<sp/>that<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($base_table))<sp/>{</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" kindref="member">chado_node_get_base_table</ref>($content_type);</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($tokens))<sp/>{</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tokens<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens</ref>($base_table);</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="986"><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>1)<sp/>Check<sp/>for<sp/>legacy<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga177274f316b8f44e25cc43a5d706b9a2" kindref="member">chado_node_get_legacy_url_default</ref>($content_type);</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="991"><highlight class="normal"></highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>2)<sp/>Module-defined<sp/>default<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/>$hook<sp/>=<sp/>$content_type<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_chado_node_default_url_format&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($hook))<sp/>{</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>call_user_func($hook);</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="999"><highlight class="normal"></highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>3)<sp/>Create<sp/>unique<sp/>constraint<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($base_table))<sp/>{</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$base_table<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gac4b140c01ccd507d686cdefc31f365ae" kindref="member">chado_node_get_base_table</ref>($content_type);</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad00086a99a67b021e0d631c46ac5f110" kindref="member">chado_node_get_unique_constraint_format</ref>($base_table,<sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>format<sp/>to<sp/>table<sp/>so<sp/>we<sp/>can<sp/>use<sp/>it<sp/>later</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>(optimization:<sp/>to<sp/>speed<sp/>up<sp/>bulk<sp/>updates,<sp/>don&apos;t<sp/>update<sp/>the<sp/>record<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>format<sp/>and<sp/>tokens<sp/>are<sp/>unchanged)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($format<sp/>!=<sp/>$format_record_format<sp/>||<sp/>$tokens<sp/>!=<sp/>$format_record_tokens)<sp/>{</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" kindref="member">chado_node_add_token_format</ref>(</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">,<sp/>$content_type,<sp/>$format,<sp/>$tokens);</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="1016"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"></highlight></codeline>
<codeline lineno="1028" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga177274f316b8f44e25cc43a5d706b9a2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga177274f316b8f44e25cc43a5d706b9a2" kindref="member">chado_node_get_legacy_url_default</ref>($content_type)<sp/>{</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"></highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($content_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;chado_feature&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_format<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;chado_feature_url_string&apos;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_tokens<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[id]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[feature.feature_id]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[genus]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[feature.organism_id&gt;organism.genus]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[species]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[feature.organism_id&gt;organism.species]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[type]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[feature.type_id&gt;cvterm.name]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[uniquename]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[feature.uniquename]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[name]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[feature.name]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($legacy_format)<sp/>{</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>str_replace(array_keys($legacy_tokens),$legacy_tokens,<sp/>$legacy_format);</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/>elseif<sp/>($content_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;chado_stock&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_format<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;chado_stock_url_string&apos;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_tokens<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[id]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[stock.stock_id]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[genus]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[stock.organism_id&gt;organism.genus]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[species]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[stock.organism_id&gt;organism.species]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[type]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[stock.type_id&gt;cvterm.name]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[uniquename]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[stock.uniquename]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[name]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[stock.name]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($legacy_format)<sp/>{</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>str_replace(array_keys($legacy_tokens),$legacy_tokens,<sp/>$legacy_format);</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/>elseif<sp/>($content_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;chado_project&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_format<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;chado_project_url_string&apos;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/>$legacy_tokens<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[id]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[project.project_id]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;[name]&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;[project.name]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($legacy_format)<sp/>{</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>str_replace(array_keys($legacy_tokens),$legacy_tokens,<sp/>$legacy_format);</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"></highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1070"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"></highlight></codeline>
<codeline lineno="1093" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6c4b7a2c91e0968cf7693432ccf17992" kindref="member">chado_node_add_token_format</ref>($application,<sp/>$content_type,<sp/>$format,<sp/>$tokens)<sp/>{</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"></highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($tokens))<sp/>{</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens<sp/>=<sp/>serialize($tokens);</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$content_type,</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;application&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$application,</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;format&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$format,</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tokens&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$tokens</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>if<sp/>it<sp/>already<sp/>exists</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/>$id<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&apos;SELECT<sp/>tripal_format_id<sp/>FROM<sp/>{tripal_token_formats}<sp/>WHERE<sp/>content_type=:type<sp/>AND<sp/>application=:application&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:type&apos;</highlight><highlight class="normal">=&gt;<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;:application&apos;</highlight><highlight class="normal">=&gt;<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;application&apos;</highlight><highlight class="normal">]))-&gt;fetchField();</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($id)<sp/>{</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_token_formats&apos;</highlight><highlight class="normal">,<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>,array(</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;application&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_token_formats&apos;</highlight><highlight class="normal">,<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>);</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"></highlight></codeline>
<codeline lineno="1115"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"></highlight></codeline>
<codeline lineno="1134" refid="d8/d43/group__tripal__legacy__chado__node__api_1gadac406c54ee6c9dd13e8ebc4deb8b40b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gadac406c54ee6c9dd13e8ebc4deb8b40b" kindref="member">chado_node_get_token_format</ref>($application,<sp/>$content_type,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/>$format_record<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_token_formats&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;t&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="charliteral">&apos;t&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;content_type&apos;</highlight><highlight class="normal">,<sp/>$content_type,</highlight><highlight class="charliteral">&apos;=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;application&apos;</highlight><highlight class="normal">,<sp/>$application,</highlight><highlight class="charliteral">&apos;=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"></highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_object($format_record))<sp/>{</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;return_record&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$format_record-&gt;tokens<sp/>=<sp/>unserialize($format_record-&gt;tokens);</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format_record;</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format_record-&gt;format;</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1155"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"></highlight></codeline>
<codeline lineno="1171" refid="d8/d43/group__tripal__legacy__chado__node__api_1gad00086a99a67b021e0d631c46ac5f110" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1gad00086a99a67b021e0d631c46ac5f110" kindref="member">chado_node_get_unique_constraint_format</ref>($base_table,<sp/>$format_type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"></highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/>$table_descrip<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>($base_table);</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"></highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>the<sp/>name/uniquename<sp/>from<sp/>the<sp/>base<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/>$names<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal">($table_descrip[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$field)<sp/>{</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/name/&apos;</highlight><highlight class="normal">,$field_name))<sp/>{</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$names[$field_name]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;[$base_table.$field_name]&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"></highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/>uksort($names,<sp/></highlight><highlight class="stringliteral">&apos;tripal_sort_key_length_asc&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"></highlight></codeline>
<codeline lineno="1185"><highlight class="normal"></highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>tokens<sp/>to<sp/>match<sp/>the<sp/>unique<sp/>key</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($table_descrip[</highlight><highlight class="stringliteral">&apos;unique<sp/>keys&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$keyset)<sp/>{</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($keyset<sp/>as<sp/>$key)<sp/>{</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($names[$key]))<sp/>{</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Do<sp/>not<sp/>add<sp/>it<sp/>into<sp/>the<sp/>tokens<sp/>if<sp/>it&apos;s<sp/>already<sp/>in<sp/>the<sp/>names</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>since<sp/>we<sp/>don&apos;t<sp/>want<sp/>it<sp/>repeated<sp/>2X</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>($key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tokens[$key]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;[$base_table.type_id&gt;cvterm.name]&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>($key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;organism_id&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tokens[$key]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;[$base_table.organism_id&gt;organism.abbreviation]&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tokens[$key]<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;[$base_table.$key]&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"></highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($format_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,$names)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,$tokens)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/>elseif<sp/>($format_type<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>don&apos;t<sp/>want<sp/>to<sp/>put<sp/>more<sp/>than<sp/>one<sp/>name<sp/>in<sp/>the<sp/>URL.<sp/>Thus<sp/>we<sp/>are</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>arbitrarily<sp/>grabbing<sp/>the<sp/>longest<sp/>name<sp/>token<sp/>since<sp/>it<sp/>it<sp/>likely<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>uniquename.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>implode(</highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal">,$tokens)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>array_pop($names);</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_node_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>determine<sp/>the<sp/>format<sp/>for<sp/>the<sp/>unique<sp/>constraint<sp/>since<sp/>the<sp/>format<sp/>type<sp/>(%format-type)<sp/>is<sp/>not<sp/>supported<sp/>(only<sp/>&quot;title&quot;<sp/>and<sp/>&quot;url&quot;<sp/>are<sp/>at<sp/>this<sp/>time).&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%format-type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$format_type)</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"></highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="1226"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"></highlight></codeline>
<codeline lineno="1254" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens</ref>($base_table,<sp/>$token_prefix<sp/>=<sp/>FALSE,<sp/>$location_prefix<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"></highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/>$tokens<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/>$table_descrip<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>($base_table);</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($table_descrip[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$field_details)<sp/>{</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"></highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($token_prefix))<sp/>{</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$token<sp/>=<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field_name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$location<sp/>=<sp/>implode(</highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal">,array($base_table,<sp/>$field_name));</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$token<sp/>=<sp/></highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal"><sp/>.<sp/>$token_prefix<sp/>.<sp/></highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field_name<sp/>.<sp/></highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$location<sp/>=<sp/>$location_prefix<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$field_name;</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"></highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/>$tokens[$token]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>ucwords(str_replace(</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,$base_table))<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;:<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>ucwords(str_replace(</highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">,$field_name)),</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$base_table,</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field_name,</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$field_details)<sp/>?<sp/>$field_details[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$location</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1278"><highlight class="normal"></highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!array_key_exists(</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">,<sp/>$field_details)<sp/>or<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/TODO/&apos;</highlight><highlight class="normal">,$field_details[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tokens[$token][</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;The<sp/>&apos;</highlight><highlight class="normal">.$field_name.</highlight><highlight class="stringliteral">&apos;<sp/>field<sp/>of<sp/>the<sp/>&apos;</highlight><highlight class="normal">.$base_table.</highlight><highlight class="stringliteral">&apos;<sp/>table.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"></highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>RECURSION:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Follow<sp/>the<sp/>foreign<sp/>key<sp/>relationships<sp/>recursively</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;foreign<sp/>keys&apos;</highlight><highlight class="normal">,<sp/>$table_descrip))<sp/>{</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($table_descrip[</highlight><highlight class="stringliteral">&apos;foreign<sp/>keys&apos;</highlight><highlight class="normal">]<sp/>as<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($details[</highlight><highlight class="stringliteral">&apos;columns&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$left_field<sp/>=&gt;<sp/>$right_field)<sp/>{</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($token_prefix))<sp/>{</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sub_token_prefix<sp/>=<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>.<sp/>$left_field;</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sub_location_prefix<sp/>=<sp/>implode(</highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal">,array($base_table,<sp/>$left_field));</highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sub_token_prefix<sp/>=<sp/>$token_prefix<sp/>.<sp/></highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$base_table<sp/>.<sp/></highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal"><sp/>.<sp/>$left_field;</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sub_location_prefix<sp/>=<sp/>$location_prefix<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal">,array($base_table,<sp/>$left_field));</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"></highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sub_tokens<sp/>=<sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga5588879f647bb4ea65f592261a86f2ae" kindref="member">chado_node_generate_tokens</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$sub_token_prefix,<sp/>$sub_location_prefix);</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($sub_tokens))<sp/>{</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$tokens<sp/>=<sp/>array_merge($tokens,<sp/>$sub_tokens);</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"></highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$tokens;</highlight></codeline>
<codeline lineno="1307"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"></highlight></codeline>
<codeline lineno="1329" refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6afd60d9aa697351972c5b86575b8a03" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga6afd60d9aa697351972c5b86575b8a03" kindref="member">chado_get_token_value</ref>($token_info,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"></highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/>$token<sp/>=<sp/>$token_info[</highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>$token_info[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/>$var<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a15955933e72700564e1a76d7f97c1ac7" kindref="member">$node</ref>;</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"></highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/>$supress_errors<sp/>=<sp/>(isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;supress_errors&apos;</highlight><highlight class="normal">]))<sp/>?<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;supress_errors&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"></highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>each<sp/>portion<sp/>of<sp/>the<sp/>location<sp/>string.<sp/>An<sp/>example<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>might<sp/>be:<sp/><sp/>stock<sp/>&gt;<sp/>type_id<sp/>&gt;<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/>$location<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal">,<sp/>$token_info[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($location<sp/>as<sp/>$index)<sp/>{</highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/><sp/><sp/>$index<sp/>=<sp/>trim($index);</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"></highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>$var<sp/>is<sp/>an<sp/>object<sp/>then<sp/>it<sp/>is<sp/>the<sp/>$node<sp/>object<sp/>or<sp/>a<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>that<sp/>has<sp/>been<sp/>expanded.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_object($var))<sp/>{</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>index<sp/>is<sp/>a<sp/>member<sp/>of<sp/>the<sp/>object.<sp/>If<sp/>so,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>reset<sp/>the<sp/>$var<sp/>to<sp/>this<sp/>value.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(property_exists($var,<sp/>$index))<sp/>{</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$var<sp/>=<sp/>$var-&gt;$index;</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$supress_errors)<sp/>{</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Tokens:<sp/>Unable<sp/>to<sp/>determine<sp/>the<sp/>value<sp/>of<sp/>%token.<sp/>Things<sp/>went<sp/>awry<sp/>when<sp/>trying<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;to<sp/>access<sp/>\&apos;%index\&apos;<sp/>for<sp/>the<sp/>following:<sp/>\&apos;%var\&apos;.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,<sp/></highlight><highlight class="stringliteral">&apos;%index&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$index,<sp/></highlight><highlight class="stringliteral">&apos;%var&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($var,TRUE))</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>$var<sp/>is<sp/>an<sp/>array<sp/>then<sp/>there<sp/>are<sp/>multiple<sp/>instances<sp/>of<sp/>the<sp/>same</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>table<sp/>in<sp/>a<sp/>FK<sp/>relationship<sp/>(e.g.<sp/>relationship<sp/>tables)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(is_array($var))<sp/>{</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$var<sp/>=<sp/>$var[$index];</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$supress_errors)<sp/>{</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;chado_node_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Tokens:<sp/>Unable<sp/>to<sp/>determine<sp/>the<sp/>value<sp/>of<sp/>%token.<sp/>Things<sp/>went<sp/>awry<sp/>when<sp/>trying<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;to<sp/>access<sp/>\&apos;%index\&apos;<sp/>for<sp/>the<sp/>following:<sp/>\&apos;%var\&apos;.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token,<sp/></highlight><highlight class="stringliteral">&apos;%index&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$index,<sp/></highlight><highlight class="stringliteral">&apos;%var&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($var,TRUE))</highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$var;</highlight></codeline>
<codeline lineno="1379"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1380"><highlight class="normal"></highlight></codeline>
<codeline lineno="1391" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a6ef291862b2dc896b538b4e323e4c109" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a6ef291862b2dc896b538b4e323e4c109" kindref="member">chado_node_format_tokens</ref>($tokens)<sp/>{</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"></highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Name&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Token&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Description&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"></highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/>usort($tokens,<sp/></highlight><highlight class="stringliteral">&apos;chado_sort_tokens_by_location&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($tokens<sp/>as<sp/>$token)<sp/>{</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token[</highlight><highlight class="stringliteral">&apos;token&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$token[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1404"><highlight class="normal"></highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1a4f44601f2b9dc8a1644bce53c94ce622" kindref="member">$header</ref>,</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_tokens&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-data-table&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sticky&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;caption&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colgroups&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="1415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;empty&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>theme_table(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="1418"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"></highlight></codeline>
<codeline lineno="1427" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ad55c27960f57d40dffa26ef911b91dd2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ad55c27960f57d40dffa26ef911b91dd2" kindref="member">chado_sort_tokens_by_location</ref>($tokenA,<sp/>$tokenB)<sp/>{</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"></highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>check<sp/>if<sp/>they&apos;re<sp/>the<sp/>same</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tokenA[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">]<sp/>==<sp/>$tokenB[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1433"><highlight class="normal"></highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>check<sp/>if<sp/>there&apos;s<sp/>a<sp/>difference<sp/>in<sp/>depth</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>example,<sp/>&quot;stock<sp/>&gt;<sp/>type_id&quot;<sp/>comes<sp/>before<sp/>&quot;stock<sp/>&gt;<sp/>type_id<sp/>&gt;<sp/>name&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/>$tokenA_depth<sp/>=<sp/>substr_count($tokenA[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">],</highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/>$tokenB_depth<sp/>=<sp/>substr_count($tokenB[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">],</highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($tokenA_depth<sp/>!=<sp/>$tokenB_depth)<sp/>{</highlight></codeline>
<codeline lineno="1439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>($tokenA_depth<sp/>&lt;<sp/>$tokenB_depth)<sp/>?<sp/>-1<sp/>:<sp/>1;</highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"></highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>depth<sp/>is<sp/>equal<sp/>then<sp/>just<sp/>use<sp/>alphabetical<sp/>basic<sp/>string<sp/>compare</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>($tokenA[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">]<sp/>&lt;<sp/>$tokenB[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">])<sp/>?<sp/>-1<sp/>:<sp/>1;</highlight></codeline>
<codeline lineno="1444"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"></highlight></codeline>
<codeline lineno="1452" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ac1ac551674e28c76912a4b773f1d93f3" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ac1ac551674e28c76912a4b773f1d93f3" kindref="member">tripal_sort_key_length_asc</ref>($a,<sp/>$b)<sp/>{</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strlen($a)<sp/>==<sp/>strlen($b))<sp/>{</highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/>elseif<sp/>(strlen($a)<sp/>&gt;<sp/>strlen($b))<sp/>{</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1462"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"></highlight></codeline>
<codeline lineno="1472" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a558b8a4e248c0b6b0d1b1a782023a1d0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1a558b8a4e248c0b6b0d1b1a782023a1d0" kindref="member">chado_node_get_readable_format</ref>($token)<sp/>{</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"></highlight></codeline>
<codeline lineno="1474"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>lets<sp/>break<sp/>down<sp/>the<sp/>token<sp/>into<sp/>it&apos;s<sp/>parts.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Remove<sp/>containing<sp/>brackets.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/>$parts<sp/>=<sp/>str_replace(array(</highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">),</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,$token);</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Break<sp/>into<sp/>table<sp/>clauses.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/>$parts<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal">,$parts);</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Break<sp/>each<sp/>table<sp/>clause<sp/>into<sp/>table<sp/>&amp;<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($parts<sp/>as<sp/>$k<sp/>=&gt;<sp/>$v)<sp/>{</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/>$parts[$k]<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal">,<sp/>$v);</highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($parts[$k])<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$parts[$k]<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/>$v);</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/>$last_k<sp/>=<sp/>$k;</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"></highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now,<sp/>we<sp/>want<sp/>to<sp/>find<sp/>readable<sp/>fields<sp/>for<sp/>the<sp/>last<sp/>table<sp/>specified<sp/>in<sp/>the<sp/>token.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>(ie:<sp/>for<sp/>cvterm<sp/>in<sp/>[feature.type_id&gt;cvterm.cvterm_id])</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>$parts[$last_k][0];</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/>$format<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>==<sp/></highlight><highlight class="stringliteral">&apos;organism&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/(\w+)\]$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;genus]&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/(\w+)\]$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;species]&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/(\w+)\]$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;common_name]&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>$format[0]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$format[1]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/>$format[2]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/>elseif<sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>==<sp/></highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/(\w+)\]$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;accession]&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/(\w+)\]$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;db_id&gt;db.name]&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>$format[0]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/>$format[1]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;)&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$schema<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga4b5ac309e4f88af0e2454099336ac1d8" kindref="member">chado_get_schema</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($schema[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$field_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/name/&apos;</highlight><highlight class="normal">,$field_name))<sp/>{</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$format[]<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/(\w+)\]$/&apos;</highlight><highlight class="normal">,<sp/>$field_name.</highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">,<sp/>$token);</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$format<sp/>=<sp/>implode(</highlight><highlight class="stringliteral">&apos;,<sp/>&apos;</highlight><highlight class="normal">,$format);</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($format))<sp/>{</highlight></codeline>
<codeline lineno="1513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1514"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1515"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$format;</highlight></codeline>
<codeline lineno="1516"><highlight class="normal"><sp/>}</highlight></codeline>
<codeline lineno="1517"><highlight class="normal"></highlight></codeline>
<codeline lineno="1522" refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ad9338d73eb91a465b34287273f8fba60" refkind="member"><highlight class="normal"><sp/></highlight><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/de0/tripal__core_8chado__nodes_8title__and__path_8inc_1ad9338d73eb91a465b34287273f8fba60" kindref="member">chado_node_get_location_from_token</ref>($token)<sp/>{</highlight></codeline>
<codeline lineno="1523"><highlight class="normal"></highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($token)<sp/>and<sp/>isset($token[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$token[</highlight><highlight class="stringliteral">&apos;location&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>we<sp/>have<sp/>been<sp/>given<sp/>the<sp/>token<sp/>as<sp/>a<sp/>string,<sp/>we<sp/>can<sp/>still<sp/>determine<sp/>the<sp/>location</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>it<sp/>takes<sp/>more<sp/>work...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>lets<sp/>clarify<sp/>what<sp/>the<sp/>location<sp/>is:<sp/>the<sp/>location<sp/>shows<sp/>which<sp/>keys<sp/>in<sp/>which</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>order<sp/>need<sp/>to<sp/>be<sp/>travelled<sp/>in<sp/>order<sp/>to<sp/>access<sp/>the<sp/>value.<sp/>For<sp/>example,<sp/>the<sp/>token</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1531"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>[feature.organism_id&gt;organism.genus]<sp/>would<sp/>have<sp/>a<sp/>location<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1532"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>feature<sp/>&gt;<sp/>organism_id<sp/>&gt;<sp/>genus<sp/>to<sp/>show<sp/>that<sp/>the<sp/>value<sp/>is<sp/>at</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1533"><highlight class="normal"><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>$node-&gt;feature-&gt;organism-&gt;genus.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/><sp/>elseif<sp/>(is_string($token))<sp/>{</highlight></codeline>
<codeline lineno="1535"><highlight class="normal"></highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>lets<sp/>break<sp/>down<sp/>the<sp/>token<sp/>into<sp/>it&apos;s<sp/>parts.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>1.<sp/>Remove<sp/>containing<sp/>brackets.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$parts<sp/>=<sp/>str_replace(array(</highlight><highlight class="charliteral">&apos;[&apos;</highlight><highlight class="normal">,</highlight><highlight class="charliteral">&apos;]&apos;</highlight><highlight class="normal">),</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,$token);</highlight></codeline>
<codeline lineno="1539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2.<sp/>Break<sp/>into<sp/>table<sp/>clauses.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>$parts<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;&gt;&apos;</highlight><highlight class="normal">,$parts);</highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>3.<sp/>Break<sp/>each<sp/>table<sp/>clause<sp/>into<sp/>table<sp/>&amp;<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($parts<sp/>as<sp/>$k<sp/>=&gt;<sp/>$v)<sp/>{</highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parts[$k]<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal">,<sp/>$v);</highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($parts[$k])<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$parts[$k]<sp/>=<sp/>explode(</highlight><highlight class="charliteral">&apos;:&apos;</highlight><highlight class="normal">,<sp/>$v);</highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1548"><highlight class="normal"></highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>a<sp/>base<sp/>level<sp/>field<sp/>that<sp/>is<sp/>not<sp/>a<sp/>foreign<sp/>key.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($parts)<sp/>==<sp/>1<sp/>AND<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($parts[0])<sp/>==<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$parts[0][0]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$parts[0][1];</highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Darn,<sp/>we<sp/>have<sp/>at<sp/>least<sp/>one<sp/>foreign<sp/>key...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>elseif<sp/>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($parts)<sp/>&gt;<sp/>1<sp/>AND<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">($parts[0])<sp/>==<sp/>2)<sp/>{</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$location<sp/>=<sp/>$parts[0][0]<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$parts[0][1];</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($parts<sp/>as<sp/>$k<sp/>=&gt;<sp/>$p)<sp/>{</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($k<sp/>!=<sp/>0<sp/>AND<sp/>isset($p[1]))<sp/>{</highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$location<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/>&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$p[1];</highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$location;</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"><sp/>}</highlight></codeline>
    </programlisting>
    <location file="legacy/tripal_core/api/tripal_core.chado_nodes.title_and_path.inc"/>
  </compounddef>
</doxygen>
