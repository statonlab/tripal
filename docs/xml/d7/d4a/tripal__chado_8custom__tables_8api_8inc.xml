<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d7/d4a/tripal__chado_8custom__tables_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_chado.custom_tables.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d4/d3f/group__tripal__custom__tables__api_1ga1f231a83ef5b725d87965df25ec42283" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_create_custom_table</definition>
        <argsstring>($table, $schema, $skip_if_exists=TRUE, $mview_id=NULL, $redirect=TRUE)</argsstring>
        <name>chado_create_custom_table</name>
        <param>
          <declname>$table</declname>
        </param>
        <param>
          <declname>$schema</declname>
        </param>
        <param>
          <declname>$skip_if_exists</declname>
          <defval>TRUE</defval>
        </param>
        <param>
          <declname>$mview_id</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$redirect</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add a new table to the Chado schema.</para><para>This function is simply a wrapper for the db_create_table() function of Drupal, but ensures the table is created inside the Chado schema rather than the Drupal schema. If the table already exists then it will be dropped and recreated using the schema provided. However, it will only drop a table if it exsits in the tripal_custom_tables table. This way the function cannot be used to accidentally alter existing non custom tables. If $skip_if_exists is set then the table is simply added to the tripal_custom_tables and no table is created in Chado.</para><para>If you are creating a materialized view do not use this function, but rather use the <ref refid="d0/de5/group__tripal__mviews__api_1ga6df34f1c008e4269f179d8d2e51ef650" kindref="member">chado_add_mview()</ref>. A materialized view is also considered a custom table and an entry for it will be added to both the tripal_mviews and tripal_custom_tables tables, but only if the <ref refid="d0/de5/group__tripal__mviews__api_1ga6df34f1c008e4269f179d8d2e51ef650" kindref="member">chado_add_mview()</ref> function is used. The optional $mview_id parameters in this function is intended for use by the <ref refid="d0/de5/group__tripal__mviews__api_1ga6df34f1c008e4269f179d8d2e51ef650" kindref="member">chado_add_mview()</ref> function when it calls this function to create the table.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to create. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$schema</parametername>
</parameternamelist>
<parameterdescription>
<para>A Drupal-style Schema API definition of the table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$skip_if_exists</parametername>
</parameternamelist>
<parameterdescription>
<para>Set as TRUE to skip dropping and re-creation of the table if it already exists. This is useful if the table was already created through another means and you simply want to make Tripal aware of the table schema. If the table does not exist it will be created. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$mview_id</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. If this custom table is also a materialized view then provide it&apos;s mview_id. This paramter is intended only when this function is called by the <ref refid="d0/de5/group__tripal__mviews__api_1ga6df34f1c008e4269f179d8d2e51ef650" kindref="member">chado_add_mview()</ref> function. When creating a custom table you shouldn&apos;t need to use this parameter. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$redirect</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional (default: TRUE). By default this function redirects back to admin pages. However, when called by Drush we don&apos;t want to redirect. This parameter allows this to be used as a true API function. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE on success, FALSE on failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc" line="131" column="1" bodyfile="tripal_chado/api/tripal_chado.custom_tables.api.inc" bodystart="131" bodyend="259"/>
      </memberdef>
      <memberdef kind="function" id="d4/d3f/group__tripal__custom__tables__api_1ga968315cb28d649c528d119be70007db9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_delete_custom_table</definition>
        <argsstring>($table_id)</argsstring>
        <name>chado_delete_custom_table</name>
        <param>
          <declname>$table_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Deletes the specified custom table.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The unique ID of the custom table for the action to be performed on. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc" line="367" column="1" bodyfile="tripal_chado/api/tripal_chado.custom_tables.api.inc" bodystart="367" bodyend="405"/>
      </memberdef>
      <memberdef kind="function" id="d4/d3f/group__tripal__custom__tables__api_1ga1a3720b14caf1348cbb817b08042dd53" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_edit_custom_table</definition>
        <argsstring>($table_id, $table_name, $schema, $skip_if_exists=1)</argsstring>
        <name>chado_edit_custom_table</name>
        <param>
          <declname>$table_id</declname>
        </param>
        <param>
          <declname>$table_name</declname>
        </param>
        <param>
          <declname>$schema</declname>
        </param>
        <param>
          <declname>$skip_if_exists</declname>
          <defval>1</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Edits a custom table in the chado database. It supports using the Drupal Schema API array.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The table_id of the table to edit. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the custom table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$schema</parametername>
</parameternamelist>
<parameterdescription>
<para>Use the Schema API array to define the custom table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$skip_if_exists</parametername>
</parameternamelist>
<parameterdescription>
<para>Set as TRUE to skip dropping and re-creation of the table. This is useful if the table was already created through another means and you simply want to make Tripal aware of the table schema. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc" line="32" column="1" bodyfile="tripal_chado/api/tripal_chado.custom_tables.api.inc" bodystart="32" bodyend="86"/>
      </memberdef>
      <memberdef kind="function" id="d4/d3f/group__tripal__custom__tables__api_1ga7d64808990d026c8850c9178b1ce653f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_custom_table_id</definition>
        <argsstring>($table_name)</argsstring>
        <name>chado_get_custom_table_id</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieve the custom table id given the name.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the custom table.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The unique identifier for the given table. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc" line="323" column="1" bodyfile="tripal_chado/api/tripal_chado.custom_tables.api.inc" bodystart="323" bodyend="334"/>
      </memberdef>
      <memberdef kind="function" id="d4/d3f/group__tripal__custom__tables__api_1gabeba1e119039c237a341e665fa8f9304" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_custom_table_names</definition>
        <argsstring>($include_mview=TRUE)</argsstring>
        <name>chado_get_custom_table_names</name>
        <param>
          <declname>$include_mview</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the list of custom tables in this site.</para><para><simplesect kind="return"><para>An associative array where the key and value pairs are the table names. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc" line="344" column="1" bodyfile="tripal_chado/api/tripal_chado.custom_tables.api.inc" bodystart="344" bodyend="358"/>
      </memberdef>
      <memberdef kind="function" id="d4/d3f/group__tripal__custom__tables__api_1ga62d7d4f7a7285fd7ab92eabd907fd1a8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_validate_custom_table_schema</definition>
        <argsstring>($schema_array)</argsstring>
        <name>chado_validate_custom_table_schema</name>
        <param>
          <declname>$schema_array</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used to validate a Drupal Schema API array prior to passing it ot the chado_create_custom_table_schema(). This function can be used in a form validate function or whenver a schema is provided by a user and needs validation.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$schema_array</parametername>
</parameternamelist>
<parameterdescription>
<para>the Drupal Schema API compatible array.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An empty string for success or a message string for failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc" line="275" column="1" bodyfile="tripal_chado/api/tripal_chado.custom_tables.api.inc" bodystart="275" bodyend="311"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides an API to manage custom tables in Chado. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="32" refid="d4/d3f/group__tripal__custom__tables__api_1ga1a3720b14caf1348cbb817b08042dd53" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1ga1a3720b14caf1348cbb817b08042dd53" kindref="member">chado_edit_custom_table</ref>($table_id,<sp/>$table_name,<sp/>$schema,<sp/>$skip_if_exists<sp/>=<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>a<sp/>new<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;table_id<sp/>=<sp/>$table_id;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;table_name<sp/>=<sp/>$table_name;</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;schema<sp/>=<sp/>serialize($schema);</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>current<sp/>custom<sp/>table<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_id<sp/>=<sp/>:table_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_id));</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>$custom_table<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>is<sp/>a<sp/>materialized<sp/>view<sp/>then<sp/>don&apos;t<sp/>allow<sp/>editing<sp/>with<sp/>this<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($custom_table-&gt;mview_id)<sp/>{</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>use<sp/>the<sp/>chado_edit_mview()<sp/>function<sp/>to<sp/>edit<sp/>this<sp/>custom<sp/>table<sp/>as<sp/>it<sp/>is<sp/>a<sp/>materialized<sp/>view.&quot;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;This<sp/>custom<sp/>table<sp/>is<sp/>a<sp/>materialized<sp/>view.<sp/>Please<sp/>use<sp/>the<sp/>&quot;</highlight><highlight class="normal"><sp/><sp/>.<sp/>l(</highlight><highlight class="stringliteral">&apos;Materialized<sp/>View&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/storage/chado/mviews&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>interface<sp/>to<sp/>edit<sp/>it.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>user<sp/>changed<sp/>the<sp/>table<sp/>name,<sp/>we<sp/>want<sp/>to<sp/>drop<sp/>the<sp/>old<sp/>one<sp/>and<sp/>force</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>creation<sp/>of<sp/>the<sp/>new<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($custom_table-&gt;table_name<sp/>!=<sp/>$table_name)<sp/>{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>(</highlight><highlight class="stringliteral">&quot;DROP<sp/>TABLE<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>$custom_table-&gt;table_name);</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$skip_if_exists<sp/>=<sp/>0;<sp/></highlight><highlight class="comment">//<sp/>we<sp/>want<sp/>to<sp/>create<sp/>the<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>skip<sp/>creation<sp/>is<sp/>not<sp/>set,<sp/>then<sp/>drop<sp/>the<sp/>table<sp/>from<sp/>chado<sp/>if<sp/>it<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$skip_if_exists)<sp/>{</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(db_table_exists($custom_table-&gt;table_name))<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>(</highlight><highlight class="stringliteral">&quot;DROP<sp/>TABLE<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>$custom_table-&gt;table_name);</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Custom<sp/>Table<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$custom_table-&gt;table_name<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>dropped&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>custom<sp/>table<sp/>record<sp/>and<sp/>run<sp/>the<sp/>create<sp/>custom<sp/>table<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_custom_tables&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>,<sp/></highlight><highlight class="stringliteral">&apos;table_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1ga1f231a83ef5b725d87965df25ec42283" kindref="member">chado_create_custom_table</ref><sp/>($table_name,<sp/>$schema,<sp/>$skip_if_exists);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Re-add<sp/>the<sp/>custom<sp/>table<sp/>to<sp/>the<sp/>semantic<sp/>web<sp/>interface<sp/>to<sp/>pick<sp/>up<sp/>any</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>changes<sp/>in<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/dc9/group__tripal__chado__semweb__api_1ga0ac94bd34b4d54f22d1c03263f7165a2" kindref="member">chado_add_semweb_table</ref>($table_name);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog_exception(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/>$e);</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>$error<sp/>=<sp/>_drupal_decode_exception($e);</highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>update<sp/>custom<sp/>table<sp/>&apos;%table_name&apos;:<sp/>%message.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/></highlight><highlight class="stringliteral">&apos;%message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$error[</highlight><highlight class="stringliteral">&apos;!message&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="86"><highlight class="normal">}</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="131" refid="d4/d3f/group__tripal__custom__tables__api_1ga1f231a83ef5b725d87965df25ec42283" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1ga1f231a83ef5b725d87965df25ec42283" kindref="member">chado_create_custom_table</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$schema,<sp/>$skip_if_exists<sp/>=<sp/>TRUE,</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>$mview_id<sp/>=<sp/>NULL,<sp/>$redirect<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>)<sp/>{</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;trp_ctables&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>provide<sp/>a<sp/>value<sp/>for<sp/>the<sp/>$table<sp/>argument<sp/>to<sp/>the<sp/>chado_create_custom_table()<sp/>function&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$schema)<sp/>{</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;trp_ctables&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>provide<sp/>a<sp/>value<sp/>for<sp/>the<sp/>$schema<sp/>argument<sp/>to<sp/>the<sp/>chado_create_custom_table()<sp/>function&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($schema<sp/>and<sp/>!is_array($schema))<sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;trp_ctables&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Please<sp/>provide<sp/>an<sp/>array<sp/>for<sp/>the<sp/>$schema<sp/>argument<sp/>to<sp/>the<sp/>chado_create_custom_table()<sp/>function&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>make<sp/>sure<sp/>the<sp/>schema<sp/>is<sp/>valid<sp/>by<sp/>adding<sp/>extra<sp/>checks.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="151"><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/>global<sp/>$databases;</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/>$created<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/>$recreated<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/>$chado_schema<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga6e68ea2778dcfe74d6bb672dc00158d8" kindref="member">chado_get_schema_name</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/>$chado_dot<sp/>=<sp/>$chado_schema<sp/>.<sp/></highlight><highlight class="charliteral">&apos;.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>if<sp/>the<sp/>table<sp/>entry<sp/>already<sp/>exists<sp/>in<sp/>the<sp/>tripal_custom_tables<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_name<sp/>=<sp/>:table_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>));</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/>$centry<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>table<sp/>already<sp/>exists<sp/>in<sp/>the<sp/>chado<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/>$exists<sp/>=<sp/><ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>table<sp/>does<sp/>not<sp/>exist<sp/>then<sp/>create<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$exists)<sp/>{</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$ret<sp/>=<sp/>db_create_table($chado_dot<sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$schema);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$created<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>table<sp/>exists<sp/>in<sp/>Chado<sp/>and<sp/>in<sp/>our<sp/>custom<sp/>table<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>creation<sp/>is<sp/>turned<sp/>off<sp/>then<sp/>drop<sp/>and<sp/>re-create<sp/>the<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($exists<sp/>and<sp/>is_object($centry)<sp/>and<sp/>!$skip_if_exists)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Drop<sp/>the<sp/>table<sp/>we&apos;ll<sp/>recreate<sp/>it<sp/>with<sp/>the<sp/>new<sp/>schema.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>(</highlight><highlight class="stringliteral">&apos;DROP<sp/>TABLE<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="charliteral">&apos;}&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>any<sp/>&apos;referring_tables&apos;<sp/>from<sp/>the<sp/>array<sp/>as<sp/>the<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>db_create_table<sp/>doesn&apos;t<sp/>use<sp/>that.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$new_schema<sp/>=<sp/>$schema;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;referring_tables&apos;</highlight><highlight class="normal">,<sp/>$new_schema))<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($new_schema[</highlight><highlight class="stringliteral">&apos;referring_tables&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>db_create_table($chado_dot<sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/>$new_schema);</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$recreated<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>an<sp/>entry<sp/>in<sp/>the<sp/>tripal_custom_table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;table_name<sp/>=<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>;</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;schema<sp/>=<sp/>serialize($schema);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($mview_id)<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;mview_id<sp/>=<sp/>$mview_id;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>an<sp/>entry<sp/>already<sp/>exists<sp/>then<sp/>remove<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($centry)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_name<sp/>=<sp/>:table_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>));</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_custom_tables&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>add<sp/>any<sp/>foreign<sp/>key<sp/>constraints.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(($created<sp/>or<sp/>!$skip_if_exists)<sp/>and<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;foreign<sp/>keys&apos;</highlight><highlight class="normal">,<sp/>$schema))<sp/>{</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>the<sp/>foreign<sp/>keys<sp/>and<sp/>add<sp/>each<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$fkeys<sp/>=<sp/>$schema[</highlight><highlight class="stringliteral">&apos;foreign<sp/>keys&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($fkeys<sp/>as<sp/>$fktable<sp/>=&gt;<sp/>$fkdetails)<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$relations<sp/>=<sp/>$fkdetails[</highlight><highlight class="stringliteral">&apos;columns&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($relations<sp/>as<sp/><ref refid="d6/d7e/tripal-ds-feature_8tpl_8php_1a4ea0e3306cdd2c545baf22ffe69a2242" kindref="member">$left</ref><sp/>=&gt;<sp/><ref refid="d6/d7e/tripal-ds-feature_8tpl_8php_1a2fe782b5e63e6e637d5a14fbb1df8d09" kindref="member">$right</ref>)<sp/>{</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;</highlight></codeline>
<codeline lineno="215"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ALTER<sp/>TABLE<sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}</highlight></codeline>
<codeline lineno="216"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADD<sp/>CONSTRAINT<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="d6/d7e/tripal-ds-feature_8tpl_8php_1a4ea0e3306cdd2c545baf22ffe69a2242" kindref="member">$left</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_fkey<sp/>FOREIGN<sp/>KEY<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="d6/d7e/tripal-ds-feature_8tpl_8php_1a4ea0e3306cdd2c545baf22ffe69a2242" kindref="member">$left</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;)</highlight></codeline>
<codeline lineno="217"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>REFERENCES<sp/><sp/>{&apos;</highlight><highlight class="normal"><sp/>.<sp/>$fktable<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;}<sp/>(&apos;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="d6/d7e/tripal-ds-feature_8tpl_8php_1a2fe782b5e63e6e637d5a14fbb1df8d09" kindref="member">$right</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&apos;)</highlight></codeline>
<codeline lineno="218"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ON<sp/>DELETE<sp/>CASCADE<sp/>DEFERRABLE<sp/>INITIALLY<sp/>DEFERRED</highlight></codeline>
<codeline lineno="219"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql);</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>custom<sp/>table<sp/>to<sp/>the<sp/>semantic<sp/>web<sp/>interface.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/dc9/group__tripal__chado__semweb__api_1ga0ac94bd34b4d54f22d1c03263f7165a2" kindref="member">chado_add_semweb_table</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/>$error<sp/>=<sp/>$e-&gt;getMessage();</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog_exception(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/>$e);</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>add<sp/>custom<sp/>table<sp/>&apos;%table_name&apos;:<sp/>%message.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>,<sp/></highlight><highlight class="stringliteral">&apos;%message&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$error)),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($created)<sp/>{</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Custom<sp/>table,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;<sp/>,<sp/><sp/>created<sp/>successfully.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;status&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>elseif<sp/>($recreated)<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Custom<sp/>table,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;<sp/>,<sp/><sp/>re-created<sp/>successfully.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;status&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Custom<sp/>table,<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;<sp/>,<sp/>already<sp/>exists.<sp/>Table<sp/>structure<sp/>not<sp/>changed,<sp/>but<sp/>definition<sp/>array<sp/>has<sp/>been<sp/>saved.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;status&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Only<sp/>redirect<sp/>if<sp/>asked<sp/>to.<sp/>This<sp/>allows<sp/>us<sp/>to<sp/>not<sp/>try<sp/>to<sp/>redirect<sp/>when<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>function<sp/>is<sp/>called<sp/>by<sp/>Drush.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($redirect)<sp/>{</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($mview_id)<sp/>{</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/storage/chado/mviews/&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/storage/chado/custom_tables&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="259"><highlight class="normal">}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="275" refid="d4/d3f/group__tripal__custom__tables__api_1ga62d7d4f7a7285fd7ab92eabd907fd1a8" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1ga62d7d4f7a7285fd7ab92eabd907fd1a8" kindref="member">chado_validate_custom_table_schema</ref>($schema_array)<sp/>{</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($schema_array)<sp/>and<sp/>!array_key_exists(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">,<sp/>$schema_array))<sp/>{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;The<sp/>schema<sp/>array<sp/>must<sp/>have<sp/>key<sp/>named<sp/>&apos;table&apos;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/[ABCDEFGHIJKLMNOPQRSTUVWXYZ]/&apos;</highlight><highlight class="normal">,<sp/>$schema_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Postgres<sp/>will<sp/>automatically<sp/>change<sp/>the<sp/>table<sp/>name<sp/>to<sp/>lower-case.<sp/>To<sp/>prevent<sp/>unwanted<sp/>side-effects,<sp/>please<sp/>rename<sp/>the<sp/>table<sp/>with<sp/>all<sp/>lower-case<sp/>characters.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>index<sp/>length.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;indexes&apos;</highlight><highlight class="normal">,<sp/>$schema_array))<sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($schema_array[</highlight><highlight class="stringliteral">&apos;indexes&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$index_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strlen($schema_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$index_name)<sp/>&gt;<sp/>60)<sp/>{</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;One<sp/>ore<sp/>more<sp/>index<sp/>names<sp/>appear<sp/>to<sp/>be<sp/>too<sp/>long.<sp/>For<sp/>example:<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.<sp/><sp/>$schema_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$index_name<sp/>.</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;.&apos;<sp/><sp/>Index<sp/>names<sp/>are<sp/>created<sp/>by<sp/>concatenating<sp/>the<sp/>table<sp/>name<sp/>with<sp/>the<sp/>index<sp/>name<sp/>provided<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;in<sp/>the<sp/>&apos;indexes&apos;<sp/>array<sp/>of<sp/>the<sp/>schema.<sp/>Please<sp/>alter<sp/>any<sp/>indexes<sp/>that<sp/>when<sp/>combined<sp/>with<sp/>the<sp/>table<sp/>name<sp/>are<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;longer<sp/>than<sp/>60<sp/>characters.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>unique<sp/>key<sp/>length.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;unique<sp/>keys&apos;</highlight><highlight class="normal">,<sp/>$schema_array))<sp/>{</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($schema_array[</highlight><highlight class="stringliteral">&apos;unique<sp/>keys&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$index_name<sp/>=&gt;<sp/>$details)<sp/>{</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strlen($schema_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$index_name)<sp/>&gt;<sp/>60)<sp/>{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;One<sp/>ore<sp/>more<sp/>unique<sp/>key<sp/>names<sp/>appear<sp/>to<sp/>be<sp/>too<sp/>long.<sp/>For<sp/>example:<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.<sp/><sp/>$schema_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>.<sp/></highlight><highlight class="charliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>.<sp/>$index_name<sp/>.</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;.&apos;<sp/><sp/>Unique<sp/>key<sp/>names<sp/>are<sp/>created<sp/>by<sp/>concatenating<sp/>the<sp/>table<sp/>name<sp/>with<sp/>the<sp/>key<sp/>name<sp/>provided<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;in<sp/>the<sp/>&apos;unique<sp/>keys&apos;<sp/>array<sp/>of<sp/>the<sp/>schema.<sp/>Please<sp/>alter<sp/>any<sp/>unique<sp/>keys<sp/>that<sp/>when<sp/>combined<sp/>with<sp/>the<sp/>table<sp/>name<sp/>are<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;longer<sp/>than<sp/>60<sp/>characters.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="310"><highlight class="normal"></highlight></codeline>
<codeline lineno="311"><highlight class="normal">}</highlight></codeline>
<codeline lineno="323" refid="d4/d3f/group__tripal__custom__tables__api_1ga7d64808990d026c8850c9178b1ce653f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1ga7d64808990d026c8850c9178b1ce653f" kindref="member">chado_get_custom_table_id</ref>($table_name)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(db_table_exists(</highlight><highlight class="stringliteral">&apos;tripal_custom_tables&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_name<sp/>=<sp/>:table_name&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name));</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>$custom_table<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($custom_table)<sp/>{</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$custom_table-&gt;table_id;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="334"><highlight class="normal">}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="344" refid="d4/d3f/group__tripal__custom__tables__api_1gabeba1e119039c237a341e665fa8f9304" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1gabeba1e119039c237a341e665fa8f9304" kindref="member">chado_get_custom_table_names</ref>($include_mview<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>table_name<sp/>FROM<sp/>{tripal_custom_tables}&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$include_mview)<sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;<sp/>WHERE<sp/>mview_id<sp/>IS<sp/>NULL&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/>$resource<sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($resource<sp/>as<sp/>$r)<sp/>{</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/>$tables[$r-&gt;table_name]<sp/>=<sp/>$r-&gt;table_name;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/>asort($tables);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$tables;</highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="367" refid="d4/d3f/group__tripal__custom__tables__api_1ga968315cb28d649c528d119be70007db9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d4/d3f/group__tripal__custom__tables__api_1ga968315cb28d649c528d119be70007db9" kindref="member">chado_delete_custom_table</ref>($table_id)<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&quot;$table_id&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$table_id)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>this<sp/>table<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_id<sp/>=<sp/>:table_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_id));</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/>$custom_table<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>is<sp/>a<sp/>materialized<sp/>view<sp/>then<sp/>don&apos;t<sp/>allow<sp/>deletion<sp/>with<sp/>this<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($custom_table-&gt;mview_id)<sp/>{</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>use<sp/>the<sp/>chado_delete_mview()<sp/>function<sp/>to<sp/>delete<sp/>this<sp/>custom<sp/>table<sp/>as<sp/>it<sp/>is<sp/>a<sp/>materialized<sp/>view.<sp/>Table<sp/>not<sp/>deleted.&quot;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;This<sp/>custom<sp/>table<sp/>is<sp/>a<sp/>materialized<sp/>view.<sp/>Please<sp/>use<sp/>the<sp/>&quot;</highlight><highlight class="normal"><sp/><sp/>.<sp/>l(</highlight><highlight class="stringliteral">&apos;Materialized<sp/>View&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/storage/chado/mviews&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>interface<sp/>to<sp/>delete<sp/>it.&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="386"><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>entry<sp/>from<sp/>the<sp/>tripal_custom<sp/>tables<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_custom_tables}<sp/>WHERE<sp/>table_id<sp/>=<sp/>$table_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Custom<sp/>Table<sp/>&apos;%name&apos;<sp/>removed&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$custom_table-&gt;table_name)));</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Drop<sp/>the<sp/>table<sp/>from<sp/>chado<sp/>if<sp/>it<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d4/d51/group__tripal__chado__schema__api_1ga432ffbbb35405f7ca897c9985e9d1bed" kindref="member">chado_table_exists</ref>($custom_table-&gt;table_name))<sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>(</highlight><highlight class="stringliteral">&quot;DROP<sp/>TABLE<sp/>{&quot;</highlight><highlight class="normal"><sp/>.<sp/><sp/>$custom_table-&gt;table_name<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;}&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Custom<sp/>Table<sp/>&apos;%name&apos;<sp/>dropped&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$custom_table-&gt;table_name)));</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>drop<sp/>the<sp/>custom<sp/>table:<sp/>%name&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$custom_table-&gt;table_name));</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Cannot<sp/>drop<sp/>the<sp/>custom<sp/>table:<sp/>&apos;%name&apos;&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$custom_table-&gt;table_name)));</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="405"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado/api/tripal_chado.custom_tables.api.inc"/>
  </compounddef>
</doxygen>
