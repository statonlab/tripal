<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d8/d4a/tripal__chado_8pub__importers_8inc" kind="file" language="PHP">
    <compoundname>tripal_chado.pub_importers.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a4f93a11d1fea6aa4e5cfba6401951b8b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>theme_tripal_pub_importer_setup_form_elements</definition>
        <argsstring>($variables)</argsstring>
        <name>theme_tripal_pub_importer_setup_form_elements</name>
        <param>
          <declname>$variables</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Theme the tripal_pub_importer_setup_form form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="778" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="778" bodyend="830"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1aee53e48d592f16499640a81586a6f890" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_execute_pub_importer</definition>
        <argsstring>($import_id, $job_id=NULL)</argsstring>
        <name>tripal_execute_pub_importer</name>
        <param>
          <declname>$import_id</declname>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Imports all publications for a given publication import setup.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$import_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The ID of the import setup to use </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The jobs management job_id for the job if this function is run as a job. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1496" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1496" bodyend="1564"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ab1fdb1323b4f4579e3110c9eb3f152e1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_remote_pub</definition>
        <argsstring>($dbxref)</argsstring>
        <name>tripal_get_remote_pub</name>
        <param>
          <declname>$dbxref</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used to perfom a query using one of the supported databases and return the raw query results. This may be XML or some other format as provided by the database.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$dbxref</parametername>
</parameternamelist>
<parameterdescription>
<para>The unique database ID for the record to retrieve. This value must be of the format DB_NAME:ACCESSION where DB_NAME is the name of the database (e.g. PMID or AGL) and the ACCESSION is the unique identifier for the record in the database.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Returns the publication array or FALSE if a problem occurs </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1582" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1582" bodyend="1611"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ab011e8f4869f0aae80b258deb1d9c821" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_remote_pubs</definition>
        <argsstring>($remote_db, $search_array, $num_to_retrieve, $page=0)</argsstring>
        <name>tripal_get_remote_pubs</name>
        <param>
          <declname>$remote_db</declname>
        </param>
        <param>
          <declname>$search_array</declname>
        </param>
        <param>
          <declname>$num_to_retrieve</declname>
        </param>
        <param>
          <declname>$page</declname>
          <defval>0</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a list of publications as an associated array where keys correspond directly with Tripal Pub CV terms.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>remote_db</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the remote publication database to query. These names should match the name of the databases in the Chado &apos;db&apos; table. Currently supported databass include &apos;PMID&apos;: PubMed</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>search_array</parametername>
</parameternamelist>
<parameterdescription>
<para>An associate array containing the search criteria. The following key are expected &apos;remote_db&apos;: Specifies the name of the remote publication database &apos;num_criteria&apos;: Specifies the number of criteria present in the search array &apos;days&apos;: The number of days to include in the search starting from today &apos;criteria&apos;: An associate array containing the search critiera. There should be no less than &apos;num_criteria&apos; elements in this array.</para></parameterdescription>
</parameteritem>
</parameterlist>
The following keys are expected in the &apos;criteria&apos; array &apos;search_terms&apos;: A list of terms to search on, separated by spaces. &apos;scope&apos;: The fields to search in the remote database. Valid values include: &apos;title&apos;, &apos;abstract&apos;, &apos;author&apos; and &apos;any&apos; &apos;operation&apos;: The logical operation to use for this criteria. Valid values include: &apos;AND&apos;, &apos;OR&apos; and &apos;NOT&apos;. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$num_to_retrieve</parametername>
</parameternamelist>
<parameterdescription>
<para>The number of records to retrieve. In cases with large numbers of records to retrieve, the remote database may limit the size of each retrieval. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$page</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. If this function is called where the page for the pager cannot be set using the $_GET variable, use this argument to specify the page to retrieve.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Returns an array of pubs where each element is an associative array where the keys are Tripal Pub CV terms. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1653" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1653" bodyend="1666"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a985b51587a6dd159c9b7917d501b5d02" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_add_authors</definition>
        <argsstring>($pub_id, $authors, $do_contact)</argsstring>
        <name>tripal_pub_add_authors</name>
        <param>
          <declname>$pub_id</declname>
        </param>
        <param>
          <declname>$authors</declname>
        </param>
        <param>
          <declname>$do_contact</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add one or more authors to a publication</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$pub_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The publication ID of the pub in Chado. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$authors</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of authors. Each author should have a set of keys/value pairs describing the author. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$do_contact</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. Set to TRUE if a contact entry should be added to the Chado contact table for authors of the publication. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1214" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1214" bodyend="1292"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ab8b167bb39baff9e3ab81c2c888137dc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_add_publication</definition>
        <argsstring>($pub_details, &amp;$action, $do_contact=FALSE, $update_if_exists=FALSE)</argsstring>
        <name>tripal_pub_add_publication</name>
        <param>
          <declname>$pub_details</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$action</declname>
        </param>
        <param>
          <declname>$do_contact</declname>
          <defval>FALSE</defval>
        </param>
        <param>
          <declname>$update_if_exists</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Adds a new publication to the Chado, along with all properties and database cross-references. If the publication does not already exist in Chado then it is added. If it does exist nothing is done. If the $update parameter is TRUE then the publication is updated if it exists.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$pub_details</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array containing all of the details about the publication. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$action</parametername>
</parameternamelist>
<parameterdescription>
<para>This variable will get set to a text value indicating the action that was performed. The values include &apos;skipped&apos;, &apos;inserted&apos;, &apos;updated&apos; or &apos;error&apos;. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$do_contact</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. Set to TRUE if a contact entry should be added to the Chado contact table for authors of the publication. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$update_if_exists</parametername>
</parameternamelist>
<parameterdescription>
<para>Optional. If the publication already exists then this function will return without adding a new publication. However, set this value to TRUE to force the function to pudate the publication using the $pub_details that are provided.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>If the publication already exists, is inserted or updated then the publication ID is returned, otherwise FALSE is returned. If the publication already exists and $update_if_exists is not TRUE then the $action variable is set to &apos;skipped&apos;. If the publication already exists and $update_if_exists is TRUE and if the update was successful then $action is set to &apos;updated&apos;. Otherwise on successful insert the $action variable is set to &apos;inserted&apos;. If the function failes then the $action variable is set to &apos;error&apos; </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="980" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="980" bodyend="1197"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ac254868fc8671a88a9ae8e294b716d83" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_add_publications</definition>
        <argsstring>($pubs, $do_contact, $update=FALSE)</argsstring>
        <name>tripal_pub_add_publications</name>
        <param>
          <declname>$pubs</declname>
        </param>
        <param>
          <declname>$do_contact</declname>
        </param>
        <param>
          <declname>$update</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Adds publications that have been retrieved from a remote database and consolidated into an array of details.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$pubs</parametername>
</parameternamelist>
<parameterdescription>
<para>An array containing a list of publications to add to Chado. The array contains a set of details for the publication. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$do_contact</parametername>
</parameternamelist>
<parameterdescription>
<para>Set to TRUE if authors should automatically have a contact record added to Chado. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$update</parametername>
</parameternamelist>
<parameterdescription>
<para>If set to TRUE then publications that already exist in the Chado database will be updated, whereas if FALSE only new publications will be added</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Returns an array containing the number of publications that were inserted, updated, skipped and which had an error during import. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="893" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="893" bodyend="948"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ae3fda00e5499feec81d5554cfd187b81" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_citation_form</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_pub_citation_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The admin form for submitting job to create citations</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1675" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1675" bodyend="1701"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1adba635c3908240c6a3e5ff6f0454d290" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_citation_form_submit</definition>
        <argsstring>(&amp;$form_state)</argsstring>
        <name>tripal_pub_citation_form_submit</name>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Submit form. Create Tripal job for citations</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1710" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1710" bodyend="1713"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a2f6872d87c67a2df0309a01647818e6b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_get_publication_array</definition>
        <argsstring>($pub_id, $skip_existing=TRUE)</argsstring>
        <name>tripal_pub_get_publication_array</name>
        <param>
          <declname>$pub_id</declname>
        </param>
        <param>
          <declname>$skip_existing</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function generates an array suitable for use with the tripal_pub_create_citation function for any publication already stored in the Chado tables.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$pub_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The publication ID </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$skip_existing</parametername>
</parameternamelist>
<parameterdescription>
<para>Set to TRUE to skip publications that already have a citation in the pubprop table. Set to FALSE to generate a citation regardless if the citation already exists.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An array suitable for the trpial_pub_create_citation function. On failure returns FALSE. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="1312" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="1312" bodyend="1482"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a9988c0ba065b9e32b8dab6ed96a73cee" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_delete</definition>
        <argsstring>($import_id)</argsstring>
        <name>tripal_pub_importer_delete</name>
        <param>
          <declname>$import_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Deletes a publication importer. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="859" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="859" bodyend="872"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a6e0de49f84a548403dd36d67b0864e32" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_setup_add_criteria_fields</definition>
        <argsstring>(&amp;$form, &amp;$form_state, $num_criteria, $criteria)</argsstring>
        <name>tripal_pub_importer_setup_add_criteria_fields</name>
        <param>
          <type>&amp;</type>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <param>
          <declname>$num_criteria</declname>
        </param>
        <param>
          <declname>$criteria</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A helper function for the importer setup form that adds the criteria to the form that belong to the importer.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The form </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>The form state </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$num_criteria</parametername>
</parameternamelist>
<parameterdescription>
<para>The number of criteria that exist for the importer </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$criteria</parametername>
</parameternamelist>
<parameterdescription>
<para>An array containing the criteria</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A form array </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="464" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="464" bodyend="603"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ac62ff22784631e6c07c3cb90afcfad0f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_setup_form</definition>
        <argsstring>($form, &amp;$form_state=NULL, $pub_import_id=NULL, $action=&apos;new&apos;)</argsstring>
        <name>tripal_pub_importer_setup_form</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$pub_import_id</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$action</declname>
          <defval>&apos;new&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The form used for creating publication importers.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$form</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal form </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$form_state</parametername>
</parameternamelist>
<parameterdescription>
<para>The form state </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$pub_import_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The publication importer ID </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$action</parametername>
</parameternamelist>
<parameterdescription>
<para>The action to perform</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A form array </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
<para>Removing AGL option until we get it fixed spf 6/22/2018</para>        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="255" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="255" bodyend="444"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a12275edea64a68e5cb0593cfb486577a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_setup_form_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_pub_importer_setup_form_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Submit the tripal_pub_importer_setup_form form </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="670" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="670" bodyend="762"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a685e9dccbc99e85133be3a744014ffe1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_setup_form_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_pub_importer_setup_form_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Validate the tripal_pub_importer_setup_form form </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="631" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="631" bodyend="663"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a93b8a65fe3932439cfa3608323e0e230" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_setup_page</definition>
        <argsstring>($action=&apos;new&apos;, $pub_import_id=NULL)</argsstring>
        <name>tripal_pub_importer_setup_page</name>
        <param>
          <declname>$action</declname>
          <defval>&apos;new&apos;</defval>
        </param>
        <param>
          <declname>$pub_import_id</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Creates the page that contains the publication importer setup form and test results.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$action</parametername>
</parameternamelist>
<parameterdescription>
<para>The action to perform </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$pub_import_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The importer ID</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The HTML for the importer setup page </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
<para><linebreak/>
 Commenting the AGL message out until we get AGL working again. spf 6/22/2018 if(!extension_loaded (&apos;yaz&apos;)){ drupal_set_message(t(&apos;<bold>Note:</bold> In order to create an importer using the USDA National Agricultural Library (AGL) you must install the yaz libraries. See the &apos;) . l(t(&apos;Pub Module help page&apos;), &apos;admin/tripal/legacy/tripal_pub/help&apos;) . &apos; for assistance. If you do not want to use AGL you can ignore this warning.&apos;, &apos;warning&apos;); }</para>        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="111" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="111" bodyend="236"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a878ade2b95f89cb4a07b067db76c5372" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importer_submit_job</definition>
        <argsstring>($import_id)</argsstring>
        <name>tripal_pub_importer_submit_job</name>
        <param>
          <declname>$import_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add a job to import publications</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$pub_importer_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The id of the importer to submit a job to update </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="840" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="840" bodyend="854"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a3d4444eb43c639ce55bc4785f55f1f81" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_importers_list</definition>
        <argsstring>()</argsstring>
        <name>tripal_pub_importers_list</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A function to generate a table containing the list of publication importers </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="16" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="16" bodyend="95"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1a4ead04358c6aafe3524f97918ff2b813" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_setup_form_ajax_button_submit</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_pub_setup_form_ajax_button_submit</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is just a dummy to override the default form submit on ajax calls for buttons </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="622" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="622" bodyend="624"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1aef6b40fde57330b6ed390865de2fc08d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pub_setup_form_ajax_button_validate</definition>
        <argsstring>($form, &amp;$form_state)</argsstring>
        <name>tripal_pub_setup_form_ajax_button_validate</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is used to rebuild the form if an ajax call is made vai a button. The button causes the form to be submitted. We don&apos;t want this so we override the validate and submit routines on the form button. Therefore, this function only needs to tell Drupal to rebuild the form </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="613" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="613" bodyend="615"/>
      </memberdef>
      <memberdef kind="function" id="d8/d4a/tripal__chado_8pub__importers_8inc_1ae8d054a2f6e09458fbc5a66697cbbfca" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_pubs_setup_form_ajax_update</definition>
        <argsstring>($form, $form_state)</argsstring>
        <name>tripal_pubs_setup_form_ajax_update</name>
        <param>
          <declname>$form</declname>
        </param>
        <param>
          <declname>$form_state</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>AJAX callback for updating the form. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" line="769" column="1" bodyfile="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc" bodystart="769" bodyend="771"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Management of importers </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="7"><highlight class="normal">require_once(</highlight><highlight class="stringliteral">&apos;tripal_chado.pub_importer_AGL.inc&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="8"><highlight class="normal">require_once(</highlight><highlight class="stringliteral">&apos;tripal_chado.pub_importer_PMID.inc&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="16" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a3d4444eb43c639ce55bc4785f55f1f81" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a3d4444eb43c639ce55bc4785f55f1f81" kindref="member">tripal_pub_importers_list</ref>()<sp/>{</highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>make<sp/>sure<sp/>that<sp/>the<sp/>tripal_pub<sp/>vocabulary<sp/>is<sp/>loaded.<sp/>If<sp/>not,<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>warn<sp/>the<sp/>user<sp/>that<sp/>they<sp/>should<sp/>load<sp/>it<sp/>before<sp/>continuing.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/>$pub_cv<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">),<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($pub_cv)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;The<sp/>Tripal<sp/>Pub<sp/>vocabulary<sp/>is<sp/>currently<sp/>not<sp/>loaded.<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;This<sp/>vocabulary<sp/>is<sp/>required<sp/>to<sp/>be<sp/>loaded<sp/>before<sp/>importing<sp/>of<sp/>&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;publications.<sp/><sp/>&lt;br&gt;Please<sp/>!import&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;!import&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>l(</highlight><highlight class="stringliteral">&apos;load<sp/>the<sp/>Tripal<sp/>Publication<sp/>vocabulary&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;aadmin/tripal/loaders/chado_vocabs/obo_loader&apos;</highlight><highlight class="normal">))),<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>clear<sp/>out<sp/>the<sp/>session<sp/>variable<sp/>when<sp/>we<sp/>view<sp/>the<sp/>list.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"><sp/><sp/>unset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a52500036ee807241b8b4b7e2367c49ef" kindref="member">$headers</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Importer<sp/>Name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Database&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Search<sp/>String&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Disabled&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Create<sp/>Contact&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="32"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="33"><highlight class="normal"><sp/><sp/>$importers<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_pub_import}<sp/>ORDER<sp/>BY<sp/>name&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($importer<sp/>=<sp/>$importers-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="36"><highlight class="normal"><sp/><sp/><sp/><sp/>$criteria<sp/>=<sp/>unserialize($importer-&gt;criteria);</highlight></codeline>
<codeline lineno="37"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/><sp/><sp/>$criteria_str<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>($i<sp/>=<sp/>1;<sp/>$i<sp/>&lt;=<sp/>$num_criteria;<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$scope<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is_phrase<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$operation<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$criteria_str<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;$operation<sp/>($scope:<sp/>$search_terms)<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>l(t(</highlight><highlight class="stringliteral">&apos;Edit/Test&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&quot;admin/tripal/loaders/pub/edit/$importer-&gt;pub_import_id&quot;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&apos;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l(t(</highlight><highlight class="stringliteral">&apos;Import<sp/>Pubs&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&quot;admin/tripal/loaders/pub/submit/$importer-&gt;pub_import_id&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;nowrap&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;nowrap&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$importer-&gt;name,</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$criteria[</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$criteria_str,</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$importer-&gt;disabled<sp/>?<sp/></highlight><highlight class="stringliteral">&apos;Yes&apos;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&apos;No&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$importer-&gt;do_contact<sp/>?<sp/></highlight><highlight class="stringliteral">&apos;Yes&apos;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&apos;No&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>l(t(</highlight><highlight class="stringliteral">&apos;Delete&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&quot;admin/tripal/loaders/pub/delete/$importer-&gt;pub_import_id&quot;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/>$page<sp/><sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&lt;ul<sp/>class=&apos;action-links&apos;&gt;&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/>$page<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/>&lt;li&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>l(</highlight><highlight class="stringliteral">&apos;New<sp/>Importer&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub/new&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/li&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/>$page<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/ul&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>$page<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;p&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>t(</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;A<sp/>publication<sp/>importer<sp/>is<sp/>used<sp/>to<sp/>create<sp/>a<sp/>set<sp/>of<sp/>search<sp/>criteria<sp/>that<sp/>can<sp/>be<sp/>used</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>to<sp/>query<sp/>a<sp/>remote<sp/>database,<sp/>find<sp/>publications<sp/>that<sp/>match<sp/>the<sp/>specified<sp/>criteria</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>and<sp/>then<sp/>import<sp/>those<sp/>publications<sp/>into<sp/>the<sp/>Chado<sp/>database.<sp/>An<sp/>example<sp/>use<sp/>case<sp/>would</highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>be<sp/>to<sp/>peridocially<sp/>add<sp/>new<sp/>publications<sp/>to<sp/>this<sp/>Tripal<sp/>site<sp/>that<sp/>have<sp/>appeared<sp/>in<sp/>PubMed</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>in<sp/>the<sp/>last<sp/>30<sp/>days.<sp/><sp/>You<sp/>can<sp/>import<sp/>publications<sp/>in<sp/>one<sp/>of<sp/>two<sp/>ways:</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>&lt;ol&gt;</highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;li&gt;Create<sp/>a<sp/>new<sp/>importer<sp/>by<sp/>clicking<sp/>the<sp/>&apos;New<sp/>Importer&apos;<sp/>link<sp/>above,<sp/>and<sp/>after<sp/>saving<sp/>it<sp/>should<sp/>appear<sp/>in<sp/>the<sp/>list<sp/>below.<sp/><sp/>Click<sp/>the</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>link<sp/>labeled<sp/>&apos;Import<sp/>Pubs&apos;<sp/>to<sp/>schedule<sp/>a<sp/>job<sp/>to<sp/>import<sp/>the<sp/>publications&lt;/li&gt;</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&lt;li&gt;The<sp/>first<sp/>method<sp/>only<sp/>performs<sp/>the<sp/>import<sp/>once.<sp/><sp/>However,<sp/>you<sp/>can<sp/>schedule<sp/>the</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>importer<sp/>to<sp/>run<sp/>peridically<sp/>by<sp/>adding<sp/>a<sp/>cron<sp/>job.<sp/>&lt;/li&gt;<sp/></highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>&lt;/ol&gt;&lt;br&gt;&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a52500036ee807241b8b4b7e2367c49ef" kindref="member">$headers</ref>,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;caption&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sticky&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colgroups&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;empty&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;There<sp/>are<sp/>no<sp/>currently<sp/>importers&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/>$page<sp/>.=<sp/>theme_table(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$page;</highlight></codeline>
<codeline lineno="95"><highlight class="normal">}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight></codeline>
<codeline lineno="111" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a93b8a65fe3932439cfa3608323e0e230" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a93b8a65fe3932439cfa3608323e0e230" kindref="member">tripal_pub_importer_setup_page</ref>($action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">,<sp/>$pub_import_id<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/>global<sp/>$base_path;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>the<sp/>tripal_pub<sp/>and<sp/>tripal_contact<sp/>ontologies<sp/>are<sp/>loaded</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>$tpub_cv<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($tpub_cv)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Before<sp/>importing<sp/>publications<sp/>you<sp/>must<sp/>first<sp/>&apos;</highlight><highlight class="normal">)<sp/>.<sp/>l(t(</highlight><highlight class="stringliteral">&apos;load<sp/>the<sp/>Tripal<sp/>Pub<sp/>Ontology&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/chado_vocabs/obo_loader&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_contact&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/>$tpub_cv<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($tpub_cv)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;If<sp/>you<sp/>want<sp/>to<sp/>create<sp/>contact<sp/>pages<sp/>for<sp/>authors,<sp/>you<sp/>must<sp/>first<sp/>&apos;</highlight><highlight class="normal">)<sp/>.<sp/>l(t(</highlight><highlight class="stringliteral">&apos;load<sp/>the<sp/>Tripal<sp/>Contact<sp/>Ontology&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/chado_vocabs/obo_loader&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>generate<sp/>the<sp/>search<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>drupal_get_form(</highlight><highlight class="stringliteral">&apos;tripal_pub_importer_setup_form&apos;</highlight><highlight class="normal">,<sp/><sp/>$pub_import_id,<sp/>$action);</highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/>$output<sp/>=<sp/>l(</highlight><highlight class="stringliteral">&quot;Return<sp/>to<sp/>publication<sp/>importers<sp/>list&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;admin/tripal/loaders/pub&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/>$output<sp/>.=<sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>);</highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>retrieve<sp/>any<sp/>results</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">,<sp/>$_SESSION))<sp/>{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">,<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">])<sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">,<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">])<sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>$days<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">,<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">])<sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_array<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$remote_db;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$num_criteria;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$days;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>($i<sp/>=<sp/>1;<sp/>$i<sp/>&lt;=<sp/>$num_criteria;<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_array[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="156"><highlight class="normal"></highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>form<sp/>has<sp/>been<sp/>submitted<sp/>with<sp/>the<sp/>&apos;test&apos;<sp/>button<sp/>then<sp/>get<sp/>the<sp/>results</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;perform_search&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$limit<sp/>=<sp/>25;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>list<sp/>of<sp/>publications<sp/>from<sp/>the<sp/>remote<sp/>database<sp/>using<sp/>the<sp/>search<sp/>criteria.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$page<sp/>=<sp/>isset($_GET[</highlight><highlight class="stringliteral">&apos;page&apos;</highlight><highlight class="normal">])<sp/>?<sp/>$_GET[</highlight><highlight class="stringliteral">&apos;page&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab011e8f4869f0aae80b258deb1d9c821" kindref="member">tripal_get_remote_pubs</ref>($remote_db,<sp/>$search_array,<sp/>$limit,<sp/>$page);</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d2/d38/tripal__organism__stocks_8tpl_8php_1a98645aa3e311d4e0aab0aa9d65d42708" kindref="member">$total_records</ref><sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>[</highlight><highlight class="stringliteral">&apos;total_records&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_str<sp/><sp/><sp/><sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>[</highlight><highlight class="stringliteral">&apos;search_str&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pubs<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>[</highlight><highlight class="stringliteral">&apos;pubs&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>results<sp/>and<sp/>construct<sp/>the<sp/>table<sp/>displaying<sp/>the<sp/>publications</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$i<sp/>=<sp/>$page<sp/>*<sp/>$limit<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($pubs)<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($pubs<sp/>as<sp/>$pub)<sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$citation<sp/>=<sp/>array_key_exists(</highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">,<sp/>$pub)<sp/>?<sp/>htmlspecialchars($pub[</highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">])<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>generate<sp/>citation&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$raw_link<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(array_key_exists(</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">,<sp/>$pub)<sp/>and<sp/>$pub[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$raw_link<sp/>=<sp/>l(</highlight><highlight class="stringliteral">&apos;raw&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub/raw/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$pub[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">],<sp/>array(</highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;target&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;_blank&apos;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>number_format($i),</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$citation,</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$raw_link,</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;data&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;No<sp/>results<sp/>found&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colspan&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>3,</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a52500036ee807241b8b4b7e2367c49ef" kindref="member">$headers</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Publication&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Raw<sp/>Results&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a52500036ee807241b8b4b7e2367c49ef" kindref="member">$headers</ref>,</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub-importer-test&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-data-table&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sticky&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;caption&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colgroups&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;empty&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>once<sp/>we<sp/>have<sp/>our<sp/>table<sp/>array<sp/>structure<sp/>defined,<sp/>we<sp/>call<sp/>Drupal&apos;s<sp/>theme_table()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>function<sp/>to<sp/>generate<sp/>the<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>theme_table(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>generate<sp/>the<sp/>pager</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>pager_default_initialize(<ref refid="d2/d38/tripal__organism__stocks_8tpl_8php_1a98645aa3e311d4e0aab0aa9d65d42708" kindref="member">$total_records</ref>,<sp/>$limit);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pager<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tags&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;element&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>0,</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;parameters&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;quantity&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$limit,</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pager<sp/>=<sp/>theme_pager($pager);</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>because<sp/>this<sp/>is<sp/>an<sp/>ajax<sp/>callback,<sp/>the<sp/>theme_pager<sp/>will<sp/>set<sp/>the<sp/>URL<sp/>to<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>&quot;system/ajax&quot;,<sp/>so<sp/>we<sp/>need<sp/>to<sp/>reset<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pager<sp/>=<sp/>str_replace($base_path<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;system/ajax&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">,<sp/>$pager)<sp/>;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>join<sp/>all<sp/>to<sp/>form<sp/>the<sp/>results</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$total_pages<sp/>=<sp/>(int)<sp/>(<ref refid="d2/d38/tripal__organism__stocks_8tpl_8php_1a98645aa3e311d4e0aab0aa9d65d42708" kindref="member">$total_records</ref><sp/>/<sp/>$limit)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$page<sp/>=<sp/>isset($_GET[</highlight><highlight class="stringliteral">&apos;page&apos;</highlight><highlight class="normal">])<sp/>?<sp/>$_GET[</highlight><highlight class="stringliteral">&apos;page&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="charliteral">&apos;0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$output<sp/>.=<sp/></highlight><highlight class="stringliteral">&quot;$pager&lt;br&gt;&lt;b&gt;Found<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>number_format(<ref refid="d2/d38/tripal__organism__stocks_8tpl_8php_1a98645aa3e311d4e0aab0aa9d65d42708" kindref="member">$total_records</ref>)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>publications.<sp/>Page<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>($page<sp/>+<sp/>1)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>of<sp/>$total_pages.&lt;/b&gt;<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&lt;br&gt;$remote_db<sp/>Search<sp/>String:<sp/>$search_str<sp/>$table&lt;br&gt;$pager&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$output;</highlight></codeline>
<codeline lineno="236"><highlight class="normal">}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="255" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ac62ff22784631e6c07c3cb90afcfad0f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ac62ff22784631e6c07c3cb90afcfad0f" kindref="member">tripal_pub_importer_setup_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state<sp/>=<sp/>NULL,<sp/>$pub_import_id<sp/>=<sp/>NULL,<sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Default<sp/>values<sp/>can<sp/>come<sp/>in<sp/>the<sp/>following<sp/>ways:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>1)<sp/>as<sp/>elements<sp/>of<sp/>the<sp/>$pub_importer<sp/>object.<sp/><sp/>This<sp/>occurs<sp/>when<sp/>editing<sp/>an<sp/>existing<sp/>importer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>2)<sp/>in<sp/>the<sp/>$form_state[&apos;values&apos;]<sp/>array<sp/>which<sp/>occurs<sp/>on<sp/>a<sp/>failed<sp/>validation<sp/>or</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>ajax<sp/>callbacks<sp/>from<sp/>non<sp/>submit<sp/>form<sp/>elements</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>3)<sp/>in<sp/>the<sp/>$form_state[&apos;input&apos;]<sp/>array<sp/>which<sp/>occurs<sp/>on<sp/>ajax<sp/>callbacks<sp/>from<sp/>submit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>form<sp/>elements<sp/>and<sp/>the<sp/>form<sp/>is<sp/>being<sp/>rebuilt</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>form<sp/>field<sp/>defaults</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>the<sp/>default<sp/>values.<sp/>If<sp/>the<sp/>pub_import_id<sp/>isn&apos;t<sp/>already<sp/>defined<sp/>by<sp/>the<sp/>form<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>one<sp/>is<sp/>provided<sp/>then<sp/>look<sp/>it<sp/>up<sp/>in<sp/>the<sp/>database</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/>$criteria<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>$remote_db<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/>$days<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/>$disabled<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/>$do_contact<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>$num_criteria<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/>$loader_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>this<sp/>is<sp/>an<sp/>edit<sp/>the<sp/>we<sp/>are<sp/>pulling<sp/>an<sp/>import<sp/>object<sp/>from<sp/>the<sp/>database</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($action<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;edit&quot;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_pub_import}<sp/>WHERE<sp/>pub_import_id<sp/>=<sp/>:pub_import_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>$importer<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:pub_import_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_import_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/>$criteria<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>unserialize($importer-&gt;criteria);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>$days<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/>$disabled<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>$do_contact<sp/><sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria<sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader_name<sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>there<sp/>are<sp/>any<sp/>session<sp/>variables<sp/>then<sp/>use<sp/>those</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">,<sp/>$_SESSION))<sp/>{</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/><sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>$days<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/>$disabled<sp/><sp/><sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>$do_contact<sp/><sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria<sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader_name<sp/><sp/>=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="299"><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>if<sp/>the<sp/>pub_import_id<sp/>in<sp/>the<sp/>session<sp/>variable<sp/>is<sp/>not<sp/>the<sp/>same<sp/>as<sp/>the<sp/>one<sp/>we&apos;ve<sp/>been<sp/>provided</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>so,<sp/>then<sp/>clear<sp/>the<sp/>session<sp/>variable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($pub_import_id<sp/>and<sp/>$pub_import_id<sp/>!=<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>unset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="306"><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>are<sp/>re<sp/>constructing<sp/>the<sp/>form<sp/>from<sp/>a<sp/>failed<sp/>validation<sp/>or<sp/>ajax<sp/>callback</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>use<sp/>the<sp/>$form_state[&apos;values&apos;]<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state))<sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>$days<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>$disabled<sp/><sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/>$do_contact<sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader_name<sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>are<sp/>re<sp/>building<sp/>the<sp/>form<sp/>from<sp/>after<sp/>submission<sp/>(from<sp/>ajax<sp/>call)<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>values<sp/>are<sp/>in<sp/>the<sp/>$form_state[&apos;input&apos;]<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and<sp/>!empty($form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/>$days<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/>$disabled<sp/><sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/>$do_contact<sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader_name<sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;input&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>because<sp/>the<sp/>num_criteria<sp/>is<sp/>a<sp/>value<sp/>and<sp/>not<sp/>a<sp/>visible<sp/>or<sp/>hidden<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>element<sp/>it<sp/>is<sp/>not<sp/>part<sp/>of<sp/>the<sp/>[&apos;input&apos;]<sp/>array,<sp/>so<sp/>we<sp/>need<sp/>to<sp/>get<sp/>it<sp/>from<sp/>the<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;complete<sp/>form&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;add&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria++;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">,<sp/>$form_state)<sp/>and</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;triggering_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;remove&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_criteria--;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="339"><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>values<sp/>we<sp/>need<sp/>for<sp/>later<sp/>but<sp/>that<sp/>should<sp/>not<sp/>be<sp/>shown<sp/>on<sp/>the<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">]=<sp/>array(</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$num_criteria,</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_import_id,</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;action&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$action,</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>in<sp/>the<sp/>elements<sp/>that<sp/>will<sp/>be<sp/>organized<sp/>via<sp/>a<sp/>theme<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Loader<sp/>Name&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Please<sp/>provide<sp/>a<sp/>name<sp/>for<sp/>this<sp/>loader<sp/>setup.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$loader_name,</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/>$supported_dbs<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;tripal_pub_supported_dbs&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;PMID&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/>$remote_dbs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$supported_dbs,</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/>$dbs<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($dbs<sp/>as<sp/>$index<sp/>=&gt;<sp/>$db)<sp/>{</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_dbs[$db-&gt;name]<sp/>=<sp/>$db-&gt;description;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>use<sp/>PubMed<sp/>as<sp/>the<sp/>default</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$remote_db)<sp/>{</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;PMID&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>unset($remote_dbs[</highlight><highlight class="stringliteral">&apos;AGL&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Remote<sp/>Database&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$remote_dbs,</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$remote_db,</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_pubs_setup_form_ajax_update&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-pubs-importer-setup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Days<sp/>since<sp/>record<sp/>modified&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Limit<sp/>the<sp/>search<sp/>to<sp/>include<sp/>pubs<sp/>that<sp/>have<sp/>been<sp/>added<sp/>no<sp/>more<sp/>than<sp/>this<sp/>many<sp/>days<sp/>before<sp/>today.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$days,</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#size&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>5,</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Disabled&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Check<sp/>to<sp/>disable<sp/>this<sp/>importer.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$disabled,</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Create<sp/>Contact&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Check<sp/>to<sp/>create<sp/>an<sp/>entry<sp/>in<sp/>the<sp/>contact<sp/>table<sp/>for<sp/>each<sp/>author<sp/>of<sp/>a<sp/>matching<sp/>publication<sp/>during<sp/>import.<sp/>This<sp/>allows<sp/>storage<sp/>of</highlight></codeline>
<codeline lineno="410"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>additional<sp/>information<sp/>such<sp/>as<sp/>affilation,<sp/>etc.<sp/>Otherwise,<sp/>only<sp/>authors<sp/>names<sp/>are<sp/>retrieved.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$do_contact,</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="413"><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>in<sp/>the<sp/>form<sp/>for<sp/>the<sp/>criteria</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a6e0de49f84a548403dd36d67b0864e32" kindref="member">tripal_pub_importer_setup_add_criteria_fields</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state,<sp/>$num_criteria,<sp/>$criteria);</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>in<sp/>the<sp/>buttons</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;save&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Save<sp/>Importer&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;test&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Test<sp/>Importer&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;delete&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Delete<sp/>Importer&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#attributes&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;style&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;float:<sp/>right;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>in<sp/>the<sp/>section<sp/>where<sp/>the<sp/>test<sp/>results<sp/>will<sp/>appear</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;results&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;tripal-pub-importer-test-section&quot;&gt;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>allow<sp/>the<sp/>selected<sp/>remote<sp/>database<sp/>to<sp/>make<sp/>changes<sp/>to<sp/>the<sp/>form<sp/>if<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/>$callback<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;tripal_pub_remote_alter_form_$remote_db&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>call_user_func($callback,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state,<sp/>$num_criteria);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#theme&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub_importer_setup_form_elements&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="444"><highlight class="normal">}</highlight></codeline>
<codeline lineno="445"><highlight class="normal"></highlight></codeline>
<codeline lineno="464" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a6e0de49f84a548403dd36d67b0864e32" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a6e0de49f84a548403dd36d67b0864e32" kindref="member">tripal_pub_importer_setup_add_criteria_fields</ref>(&amp;<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state,<sp/>$num_criteria,<sp/>$criteria){</highlight></codeline>
<codeline lineno="465"><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>choices<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/>$scope_choices<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;any&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Any<sp/>Field&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;abstract&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Abstract&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;author&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Author&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Accession&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Title&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;journal&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Journal<sp/>Name&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="475"><highlight class="normal"></highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/>$first_op_choices<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;NOT&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;NOT&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/>$op_choices<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;AND&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;AND&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;OR&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;OR&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;NOT&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;NOT&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">($i<sp/>=<sp/>1;<sp/>$i<sp/>&lt;=<sp/>$num_criteria;<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_phrase<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="488"><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>$scope<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_phrase<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/>$operation<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>have<sp/>criteria<sp/>supplied<sp/>from<sp/>the<sp/>database<sp/>then<sp/>use<sp/>that<sp/>as<sp/>the<sp/>initial<sp/>defaults</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($criteria)<sp/>{</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$scope<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is_phrase<sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$operation<sp/><sp/><sp/><sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>criteria<sp/>comes<sp/>the<sp/>session</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">,<sp/>$_SESSION))<sp/>{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/>isset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal">])<sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$search_terms;</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$scope<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>isset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>:<sp/>$scope;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is_phrase<sp/><sp/><sp/><sp/>=<sp/>isset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/>:<sp/>$is_phrase;</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$operation<sp/><sp/><sp/><sp/>=<sp/>isset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal">])<sp/><sp/><sp/><sp/>?<sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/>:<sp/>$operation;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>form_state<sp/>has<sp/>variables<sp/>then<sp/>use<sp/>those.<sp/><sp/>This<sp/>happens<sp/>when<sp/>an<sp/>error<sp/>occurs<sp/>on<sp/>the<sp/>form<sp/>or<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>form<sp/>is<sp/>resbumitted<sp/>using<sp/>AJAX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">,<sp/>$form_state))<sp/>{</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;search_terms-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$scope<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;scope-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is_phrase<sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;is_phrase-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$operation<sp/><sp/><sp/><sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;operation-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&quot;scope-$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Please<sp/>select<sp/>the<sp/>fields<sp/>to<sp/>search<sp/>for<sp/>this<sp/>term.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$scope_choices,</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$scope,</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&quot;search_terms-$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;textfield&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#description&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;&lt;span<sp/>style=&quot;white-space:<sp/>normal&quot;&gt;Please<sp/>provide<sp/>a<sp/>list<sp/>of<sp/>words<sp/>for<sp/>searching.<sp/>You<sp/>may<sp/>use</highlight></codeline>
<codeline lineno="527"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conjunctions<sp/>such<sp/>as<sp/>&quot;AND&quot;<sp/>or<sp/>&quot;OR&quot;<sp/>to<sp/>separate<sp/>words<sp/>if<sp/>they<sp/>are<sp/>expected<sp/>in</highlight></codeline>
<codeline lineno="528"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>same<sp/>scope,<sp/>but<sp/>do<sp/>not<sp/>mix<sp/>ANDs<sp/>and<sp/>ORs.<sp/><sp/>Check<sp/>the<sp/>&quot;Is<sp/>Phrase&quot;<sp/>checkbox<sp/>to<sp/>use<sp/>conjunctions<sp/>as<sp/>part<sp/>of<sp/>the<sp/>text<sp/>to<sp/>search&lt;/span&gt;&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$search_terms,</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#required&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#maxlength&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>2048,</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&quot;is_phrase-$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;checkbox&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Is<sp/>Phrase?&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$is_phrase,</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="538"><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($i<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="541"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$form[&apos;criteria&apos;][$i][&quot;operation-$i&quot;]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="542"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#type&apos;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>&apos;select&apos;,</highlight></codeline>
<codeline lineno="543"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#options&apos;<sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$first_op_choices,</highlight></codeline>
<codeline lineno="544"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;#default_value&apos;<sp/>=&gt;<sp/>$operation,</highlight></codeline>
<codeline lineno="545"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($i<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&quot;operation-$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;select&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$op_choices,</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$operation,</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($i<sp/>==<sp/>$num_criteria)<sp/>{</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($i<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&quot;remove-$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;button&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;remove&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Remove&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_pubs_setup_form_ajax_update&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-pubs-importer-setup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;prevent&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;click&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>When<sp/>this<sp/>button<sp/>is<sp/>clicked,<sp/>the<sp/>form<sp/>will<sp/>be<sp/>validated<sp/>and<sp/>submitted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore,<sp/>we<sp/>set<sp/>custom<sp/>submit<sp/>and<sp/>validate<sp/>functions<sp/>to<sp/>override<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>form<sp/>submit.<sp/><sp/>In<sp/>the<sp/>validate<sp/>function<sp/>we<sp/>set<sp/>the<sp/>form_state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>rebuild<sp/>the<sp/>form<sp/>so<sp/>the<sp/>submit<sp/>function<sp/>never<sp/>actually<sp/>gets<sp/>called,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>we<sp/>need<sp/>it<sp/>or<sp/>Drupal<sp/>will<sp/>run<sp/>the<sp/>default<sp/>validate<sp/>anyway.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>also<sp/>set<sp/>#limit_validation_errors<sp/>to<sp/>empty<sp/>so<sp/>fields<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>are<sp/>required<sp/>that<sp/>don&apos;t<sp/>have<sp/>values<sp/>won&apos;t<sp/>generate<sp/>warnings.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_pub_setup_form_ajax_button_submit&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_pub_setup_form_ajax_button_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#limit_validation_errors&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i][</highlight><highlight class="stringliteral">&quot;add-$i&quot;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;button&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#name&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;add&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Add&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#ajax&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;tripal_pubs_setup_form_ajax_update&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;wrapper&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal-pubs-importer-setup&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;effect&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;fade&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;method&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;replace&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;prevent&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;click&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>When<sp/>this<sp/>button<sp/>is<sp/>clicked,<sp/>the<sp/>form<sp/>will<sp/>be<sp/>validated<sp/>and<sp/>submitted.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Therefore,<sp/>we<sp/>set<sp/>custom<sp/>submit<sp/>and<sp/>validate<sp/>functions<sp/>to<sp/>override<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>form<sp/>submit.<sp/><sp/>In<sp/>the<sp/>validate<sp/>function<sp/>we<sp/>set<sp/>the<sp/>form_state</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>rebuild<sp/>the<sp/>form<sp/>so<sp/>the<sp/>submit<sp/>function<sp/>never<sp/>actually<sp/>gets<sp/>called,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>we<sp/>need<sp/>it<sp/>or<sp/>Drupal<sp/>will<sp/>run<sp/>the<sp/>default<sp/>validate<sp/>anyway.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>also<sp/>set<sp/>#limit_validation_errors<sp/>to<sp/>empty<sp/>so<sp/>fields<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>are<sp/>required<sp/>that<sp/>don&apos;t<sp/>have<sp/>values<sp/>won&apos;t<sp/>generate<sp/>warnings.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#submit&apos;</highlight><highlight class="normal"><sp/><sp/><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_pub_setup_form_ajax_button_submit&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#validate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal_pub_setup_form_ajax_button_validate&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#limit_validation_errors&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="603"><highlight class="normal">}</highlight></codeline>
<codeline lineno="604"><highlight class="normal"></highlight></codeline>
<codeline lineno="613" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1aef6b40fde57330b6ed390865de2fc08d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1aef6b40fde57330b6ed390865de2fc08d" kindref="member">tripal_pub_setup_form_ajax_button_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state){</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;rebuild&apos;</highlight><highlight class="normal">]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="615"><highlight class="normal">}</highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="622" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a4ead04358c6aafe3524f97918ff2b813" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a4ead04358c6aafe3524f97918ff2b813" kindref="member">tripal_pub_setup_form_ajax_button_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state){</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>nothing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal">}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight></codeline>
<codeline lineno="631" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a685e9dccbc99e85133be3a744014ffe1" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a685e9dccbc99e85133be3a744014ffe1" kindref="member">tripal_pub_importer_setup_form_validate</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/>$num_criteria<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/>$remote_db<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;remote_db&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/>$days<sp/>=<sp/><sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;days&quot;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/>$disabled<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;disabled&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/>$do_contact<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;do_contact&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/>$loader_name<sp/>=<sp/><sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;loader_name&quot;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="638"><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>($i<sp/>=<sp/>1;<sp/>$i<sp/>&lt;=<sp/>$num_criteria;<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/><sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;search_terms-$i&quot;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/>$scope<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;scope-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_phrase<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;is_phrase-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/>$operation<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($i<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$operation<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;operation-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="647"><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_phrase)<sp/>{</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/\sand\s/i&apos;</highlight><highlight class="normal">,<sp/>$search_terms)<sp/>and<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/\sor\s/i&apos;</highlight><highlight class="normal">,<sp/>$search_terms))<sp/>{</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&quot;search_terms-$i&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;You<sp/>may<sp/>use<sp/>&apos;AND&apos;<sp/>or<sp/>&apos;OR&apos;<sp/>but<sp/>cannot<sp/>use<sp/>both.<sp/>Add<sp/>a<sp/>new<sp/>entry<sp/>below<sp/>with<sp/>the<sp/>same<sp/>scope<sp/>for<sp/>the<sp/>other<sp/>conunction.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;perform_search&apos;</highlight><highlight class="normal">]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="655"><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($days<sp/>and<sp/>!is_numeric($days)<sp/>or<sp/>preg_match(</highlight><highlight class="stringliteral">&apos;/\./&apos;</highlight><highlight class="normal">,<sp/>$days))<sp/>{</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/>form_set_error(</highlight><highlight class="stringliteral">&quot;days&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Please<sp/>enter<sp/>a<sp/>numeric,<sp/>non<sp/>decimal<sp/>value,<sp/>for<sp/>the<sp/>number<sp/>of<sp/>days.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;perform_search&apos;</highlight><highlight class="normal">]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>allow<sp/>the<sp/>selected<sp/>remote<sp/>database<sp/>to<sp/>validate<sp/>any<sp/>changes<sp/>to<sp/>the<sp/>form<sp/>if<sp/>needed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/>$callback<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;tripal_pub_remote_validate_form_$remote_db&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>call_user_func($callback,<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state);</highlight></codeline>
<codeline lineno="663"><highlight class="normal">}</highlight></codeline>
<codeline lineno="664"><highlight class="normal"></highlight></codeline>
<codeline lineno="670" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a12275edea64a68e5cb0593cfb486577a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a12275edea64a68e5cb0593cfb486577a" kindref="member">tripal_pub_importer_setup_form_submit</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="671"><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/>$pub_import_id<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/>$num_criteria<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/>$remote_db<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;remote_db&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/>$days<sp/>=<sp/><sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;days&quot;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/>$loader_name<sp/>=<sp/><sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;loader_name&quot;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/>$disabled<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;disabled&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/>$do_contact<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;do_contact&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="679"><highlight class="normal"></highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>session<sp/>variables</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$remote_db;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$days;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$num_criteria;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$loader_name;</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$disabled;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$do_contact;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub_import_id;</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/>unset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>($i<sp/>=<sp/>1;<sp/>$i<sp/>&lt;=<sp/>$num_criteria;<sp/>$i++)<sp/>{</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>$search_terms<sp/>=<sp/><sp/>trim($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;search_terms-$i&quot;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/>$scope<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;scope-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_phrase<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;is_phrase-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>$operation<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($i<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$operation<sp/>=<sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&quot;operation-$i&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="697"><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">][$i]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$search_terms,</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$scope,</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$is_phrase,</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$operation</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="705"><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>perform<sp/>the<sp/>appropriate<sp/>action<sp/>for<sp/>the<sp/>button<sp/>clicked</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Test<sp/>Importer&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>$_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;perform_search&apos;</highlight><highlight class="normal">]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Save<sp/>Importer&apos;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/>$form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Save<sp/>&amp;<sp/>Import<sp/>Now&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$loader_name,</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$disabled,</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$do_contact</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>check<sp/>to<sp/>see<sp/>if<sp/>this<sp/>pub_import_id<sp/>is<sp/>already<sp/>present.<sp/>If<sp/>so,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>an<sp/>update<sp/>rather<sp/>than<sp/>an<sp/>insert</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_pub_import}<sp/>WHERE<sp/>pub_import_id<sp/>=<sp/>:pub_import_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>$importer<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:pub_import_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_import_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($importer)<sp/>{</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>the<sp/>update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub_import_id;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>,<sp/></highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Publication<sp/>import<sp/>settings<sp/>updated.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>update<sp/>publication<sp/>import<sp/>settings.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>the<sp/>insert</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>)){</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($_SESSION[</highlight><highlight class="stringliteral">&apos;tripal_pub_import&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Publication<sp/>import<sp/>settings<sp/>saved.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>user<sp/>wants<sp/>to<sp/>do<sp/>the<sp/>import<sp/>now<sp/>then<sp/>do<sp/>it<sp/>(may<sp/>time<sp/>out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>for<sp/>long<sp/>jobs)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Save<sp/>&amp;<sp/>Import<sp/>Now&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1aee53e48d592f16499640a81586a6f890" kindref="member">tripal_execute_pub_importer</ref>(<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>[</highlight><highlight class="stringliteral">&apos;pub_import_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>save<sp/>publication<sp/>import<sp/>settings.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($form_state[</highlight><highlight class="stringliteral">&apos;values&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;op&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Delete<sp/>Importer&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_pub_import}<sp/>WHERE<sp/>pub_import_id<sp/>=<sp/>:pub_import_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:pub_import_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_import_id));</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Publication<sp/>importer<sp/>deleted.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>delete<sp/>publication<sp/>importer.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="762"><highlight class="normal">}</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="769" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ae8d054a2f6e09458fbc5a66697cbbfca" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ae8d054a2f6e09458fbc5a66697cbbfca" kindref="member">tripal_pubs_setup_form_ajax_update</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>$form_state)<sp/>{</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;themed_element&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="771"><highlight class="normal">}</highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="778" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a4f93a11d1fea6aa4e5cfba6401951b8b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a4f93a11d1fea6aa4e5cfba6401951b8b" kindref="member">theme_tripal_pub_importer_setup_form_elements</ref>($variables)<sp/>{</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>$variables[</highlight><highlight class="stringliteral">&apos;form&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>render<sp/>the<sp/>fields<sp/>at<sp/>the<sp/>top<sp/>of<sp/>the<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/>$markup<sp/><sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;pub-search-form-row0&quot;&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/>&lt;div<sp/>id=&quot;pub-search-form-row0-col1&quot;<sp/>style=&quot;float:<sp/>left&quot;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/>&lt;div<sp/>id=&quot;pub-search-form-row0-col2&quot;<sp/>style=&quot;float:<sp/>left;<sp/>margin-left:<sp/>10px&quot;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;loader_name&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;pub-search-form-row1&quot;<sp/>style=&quot;clear:both&quot;&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/>&lt;div<sp/>id=&quot;pub-search-form-row1-col1&quot;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;days&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;pub-search-form-row2&quot;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;disabled&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;pub-search-form-row3&quot;&gt;&apos;</highlight><highlight class="normal"><sp/>.<sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;do_contact&apos;</highlight><highlight class="normal">])<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>next<sp/>render<sp/>the<sp/>criteria<sp/>fields<sp/>into<sp/>a<sp/>table<sp/>format</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$i<sp/>=&gt;<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>)<sp/>{</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(is_numeric($i))<sp/>{</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>[]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&quot;operation-$i&quot;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&quot;scope-$i&quot;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&quot;search_terms-$i&quot;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&quot;is_phrase-$i&quot;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&quot;add-$i&quot;</highlight><highlight class="normal">])<sp/>.<sp/>drupal_render(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a479e9a5e4ded6cebc5be769c29e95893" kindref="member">$element</ref>[</highlight><highlight class="stringliteral">&quot;remove-$i&quot;</highlight><highlight class="normal">]),</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="806"><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a52500036ee807241b8b4b7e2367c49ef" kindref="member">$headers</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;Operation&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;Scope&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Search<sp/>Terms&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;header&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a52500036ee807241b8b4b7e2367c49ef" kindref="member">$headers</ref>,</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rows&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref>,</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;attributes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;class&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;tripal-data-table&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sticky&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE,</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;caption&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;colgroups&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;empty&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/>$criteria_table<sp/>=<sp/>theme_table(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1aaa4465d9cb3f23c8fc7902e11c65437c" kindref="member">$table</ref>);</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/>$markup<sp/>.=<sp/>$criteria_table;</highlight></codeline>
<codeline lineno="821"><highlight class="normal"></highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>rendered<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$markup,</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#prefix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;tripal-pubs-importer-setup&quot;&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#suffix&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="828"><highlight class="normal"></highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>drupal_render(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>);</highlight></codeline>
<codeline lineno="830"><highlight class="normal">}</highlight></codeline>
<codeline lineno="831"><highlight class="normal"></highlight></codeline>
<codeline lineno="840" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a878ade2b95f89cb4a07b067db76c5372" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a878ade2b95f89cb4a07b067db76c5372" kindref="member">tripal_pub_importer_submit_job</ref>($import_id)<sp/>{</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>all<sp/>of<sp/>the<sp/>loaders</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;:import_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$import_id);</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_pub_import}<sp/>WHERE<sp/>pub_import_id<sp/>=<sp/>:import_id<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/>$import<sp/>=<sp/>db_query($sql,<sp/>$args)-&gt;fetchObject();</highlight></codeline>
<codeline lineno="846"><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array($import_id);</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/>$includes<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/>$includes[]<sp/>=<sp/>module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;includes/loaders/tripal_chado.pub_importers&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="850"><highlight class="normal"><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&quot;Import<sp/>publications<sp/>$import-&gt;name&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="851"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_execute_pub_importer&apos;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="854"><highlight class="normal">}</highlight></codeline>
<codeline lineno="859" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a9988c0ba065b9e32b8dab6ed96a73cee" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a9988c0ba065b9e32b8dab6ed96a73cee" kindref="member">tripal_pub_importer_delete</ref>($import_id)<sp/>{</highlight></codeline>
<codeline lineno="860"><highlight class="normal"></highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/>$args<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;:import_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$import_id);</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_pub_import}<sp/>WHERE<sp/>pub_import_id<sp/>=<sp/>:import_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/>$success<sp/>=<sp/>db_query($sql,<sp/>$args);</highlight></codeline>
<codeline lineno="864"><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($success)<sp/>{</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Publication<sp/>importer<sp/>deleted.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&apos;admin/tripal/loaders/pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Could<sp/>not<sp/>delete<sp/>publication<sp/>importer.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="872"><highlight class="normal">}</highlight></codeline>
<codeline lineno="893" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ac254868fc8671a88a9ae8e294b716d83" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ac254868fc8671a88a9ae8e294b716d83" kindref="member">tripal_pub_add_publications</ref>($pubs,<sp/>$do_contact,<sp/>$update<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/>$report<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;inserted&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;skipped&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/>$total_pubs<sp/>=<sp/>count($pubs);</highlight></codeline>
<codeline lineno="899"><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>publications<sp/>and<sp/>add<sp/>each<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/>$i<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($pubs<sp/>as<sp/>$pub)<sp/>{</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/>$memory<sp/>=<sp/>number_format(memory_get_usage())<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>bytes&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Processing<sp/>$i<sp/>of<sp/>$total_pubs.<sp/>Memory<sp/>usage:<sp/>$memory.\r&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="905"><highlight class="normal"></highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>publication<sp/>to<sp/>Chado</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="908"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_id<sp/>=<sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab8b167bb39baff9e3ab81c2c888137dc" kindref="member">tripal_pub_add_publication</ref>($pub,<sp/>$action,<sp/>$do_contact,<sp/>$update);</highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($pub_id){</highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>the<sp/>publication<sp/>cross<sp/>reference<sp/>(e.g.<sp/>to<sp/>PubMed)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($pub_id<sp/>and<sp/>$pub[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dbxref<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^(.*?):(.*?)$/&apos;</highlight><highlight class="normal">,<sp/>trim($pub[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">]),<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dbxref[</highlight><highlight class="stringliteral">&apos;db_name&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dbxref[</highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$matches[2];</highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>extract<sp/>the<sp/>dbxref<sp/>to<sp/>be<sp/>associated<sp/>with<sp/>the<sp/>publication<sp/>(pub<sp/>ID=@pub_id)<sp/>from<sp/>@dbxref.<sp/>This<sp/>reference<sp/>should<sp/>be<sp/>[database-name]:[accession]&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;@pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id,<sp/></highlight><highlight class="stringliteral">&apos;@dbxref&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$pub_dbxref<sp/>=<sp/><ref refid="d1/d3c/group__tripal__chado__module__DEPRECATED__api_1ga70577489cc8d7310a2513978766ad89a" kindref="member">tripal_associate_dbxref</ref>(</highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/>$pub_id,<sp/>$dbxref);</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pub[</highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub_id;</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="929"><highlight class="normal"></highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>($action)<sp/>{</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">]++;</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;inserted&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;inserted&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$pub;</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;updated&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;updated&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$pub;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;skipped&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$report[</highlight><highlight class="stringliteral">&apos;skipped&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$pub;</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/>$i++;</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$report;</highlight></codeline>
<codeline lineno="948"><highlight class="normal">}</highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight></codeline>
<codeline lineno="980" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab8b167bb39baff9e3ab81c2c888137dc" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab8b167bb39baff9e3ab81c2c888137dc" kindref="member">tripal_pub_add_publication</ref>($pub_details,<sp/>&amp;$action,<sp/>$do_contact<sp/>=<sp/>FALSE,<sp/>$update_if_exists<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/>$pub_id<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="982"><highlight class="normal"></highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($pub_details))<sp/>{</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="986"><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>before<sp/>proceeding<sp/>check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>publication<sp/>already<sp/>exists.<sp/>If<sp/>there<sp/>is<sp/>only<sp/>one<sp/>match</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>the<sp/>$update_if_exists<sp/>is<sp/>NOT<sp/>set<sp/>then<sp/>return<sp/>FALSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/>$pub_ids<sp/>=<sp/><ref refid="d4/d36/group__tripal__pub__api_1gaf334d06b8e40a57e4dd35fe7c1d5051f" kindref="member">chado_publication_exists</ref>($pub_details);</highlight></codeline>
<codeline lineno="990"><highlight class="normal"></highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(count($pub_ids)<sp/>==<sp/>1<sp/>and<sp/>!$update_if_exists)<sp/>{</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1ad9759873be1ae0c3d8ccc37d121aeb3c" kindref="member">TRIPAL_NOTICE</ref>,</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;There<sp/>is<sp/>a<sp/>publication<sp/>that<sp/>is<sp/>a<sp/>duplicate<sp/>of<sp/>this<sp/>publication.<sp/>Cannot<sp/>continue.<sp/>It<sp/>either<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;has<sp/>a<sp/>matching<sp/>Dbxref<sp/>(e.g.<sp/>PubMed<sp/>ID),<sp/>a<sp/>non-unique<sp/>citation<sp/>or<sp/>matches<sp/>on<sp/>the<sp/>unique<sp/><sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;constraint<sp/>set<sp/>by<sp/>the<sp/>Tripal<sp/>publication<sp/>module<sp/>configuration<sp/>page.<sp/>\nCitation:<sp/>%title<sp/>%dbxref.\nMatching<sp/>Pub<sp/>id:<sp/>%ids&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%dbxref&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%ids&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>implode(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>$pub_ids),</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;skipped&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>have<sp/>more<sp/>than<sp/>one<sp/>matching<sp/>pub<sp/>then<sp/>return<sp/>an<sp/>error<sp/>as<sp/>we<sp/>don&apos;t<sp/>know<sp/>which<sp/>to<sp/>update<sp/>even<sp/>if</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>update_if_exists<sp/>is<sp/>set<sp/>to<sp/>TRUE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(count($pub_ids)<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1ad9759873be1ae0c3d8ccc37d121aeb3c" kindref="member">TRIPAL_NOTICE</ref>,</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;There<sp/>are<sp/>%num<sp/>publications<sp/>that<sp/>are<sp/>duplicates<sp/>of<sp/>this<sp/>publication.<sp/>They<sp/>either<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;have<sp/>a<sp/>matching<sp/>Dbxref<sp/>(e.g.<sp/>PubMed<sp/>ID)<sp/>or<sp/>match<sp/>on<sp/>the<sp/>unique<sp/>constraint<sp/>set<sp/>by<sp/>the<sp/>Tripal<sp/>publication<sp/>module<sp/>&quot;</highlight><highlight class="normal">.</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;configuration<sp/>page.<sp/><sp/>\nCitation:<sp/>%title<sp/>%dbxref.\nMatching<sp/>Pub<sp/>ids:<sp/>%ids&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%num&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>count($pub_ids),</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%dbxref&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%ids&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>implode(</highlight><highlight class="stringliteral">&quot;,&quot;</highlight><highlight class="normal">,<sp/>$pub_ids),</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;skipped&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(count($pub_ids)<sp/>==<sp/>1<sp/>and<sp/>$update_if_exists)<sp/>{</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_id<sp/>=<sp/>$pub_ids[0];</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"></highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>publication<sp/>type<sp/>(use<sp/>the<sp/>first<sp/>publication<sp/>type)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">,<sp/>$pub_details))<sp/>{</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(is_array($pub_details[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pub_type<sp/>=<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">][0];</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pub_type<sp/>=<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/>$identifiers<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_type,</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_type<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga43188a45bf914732ee69be620419b34c" kindref="member">chado_get_cvterm</ref>($identifiers);</highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;The<sp/>Publication<sp/>Type<sp/>is<sp/>a<sp/>required<sp/>property<sp/>but<sp/>is<sp/>missing&quot;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$pub_type)<sp/>{</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>find<sp/>publication<sp/>type:<sp/>&apos;%type&apos;&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">][0]));</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"></highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>series<sp/>name<sp/>field<sp/>in<sp/>the<sp/>pub<sp/>table<sp/>is<sp/>only<sp/>255<sp/>characters,<sp/>so<sp/>we<sp/>should<sp/>trim<sp/>just<sp/>in<sp/>case</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/>$series_name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;Series_Name&apos;</highlight><highlight class="normal">,<sp/>$pub_details))<sp/>{</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/>$series_name<sp/>=<sp/>substr($pub_details[</highlight><highlight class="stringliteral">&apos;Series<sp/>Name&apos;</highlight><highlight class="normal">],<sp/>0,<sp/>255);</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;Journal<sp/>Name&apos;</highlight><highlight class="normal">,<sp/>$pub_details))<sp/>{</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/>$series_name<sp/>=<sp/>substr($pub_details[</highlight><highlight class="stringliteral">&apos;Journal<sp/>Name&apos;</highlight><highlight class="normal">],<sp/>0,<sp/>255);</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"></highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>build<sp/>the<sp/>values<sp/>array<sp/>for<sp/>inserting<sp/>or<sp/>updating</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Title&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;volume&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>(isset($pub_details[</highlight><highlight class="stringliteral">&apos;Volume&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Volume&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;series_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$series_name,</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;issue&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>(isset($pub_details[</highlight><highlight class="stringliteral">&apos;Issue&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Issue&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pyear&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>(isset($pub_details[</highlight><highlight class="stringliteral">&apos;Year&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Year&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pages&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>(isset($pub_details[</highlight><highlight class="stringliteral">&apos;Pages&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Pages&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;uniquename&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$pub_type-&gt;cvterm_id,</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"></highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>there<sp/>is<sp/>no<sp/>pub_id<sp/>then<sp/>we<sp/>need<sp/>to<sp/>do<sp/>an<sp/>insert.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$pub_id)<sp/>{</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;statement_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ins_pub_tivoseispypaunty&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$pub)<sp/>{</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>insert<sp/>the<sp/>publication<sp/>with<sp/>title:<sp/>%title&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Title&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_id<sp/>=<sp/>$pub[</highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;inserted&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"></highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>there<sp/>is<sp/>a<sp/>pub_id<sp/>and<sp/>we&apos;ve<sp/>been<sp/>told<sp/>to<sp/>update,<sp/>then<sp/>do<sp/>the<sp/>update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($pub_id<sp/>and<sp/>$update_if_exists)<sp/>{</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id);</highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;statement_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;up_pub_tivoseispypaunty&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga35aa655c2c929858ab05df18bc807541" kindref="member">chado_update_record</ref>(</highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/>$match,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>update<sp/>the<sp/>publication<sp/>with<sp/>title:<sp/>%title&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_details[</highlight><highlight class="stringliteral">&apos;Title&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/>$action<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;updated&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>before<sp/>we<sp/>add<sp/>any<sp/>new<sp/>properties<sp/>we<sp/>need<sp/>to<sp/>remove<sp/>those<sp/>that<sp/>are<sp/>there<sp/>if<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>an<sp/>update.<sp/><sp/>The<sp/>only<sp/>thing<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>remove<sp/>are<sp/>the<sp/>&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($update_if_exists)<sp/>{</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>DELETE<sp/>FROM<sp/>{pubprop}</highlight></codeline>
<codeline lineno="1110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="1111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pub_id<sp/>=<sp/>:pub_id<sp/>AND</highlight></codeline>
<codeline lineno="1112"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NOT<sp/>type_id<sp/>in<sp/>(</highlight></codeline>
<codeline lineno="1113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>cvterm_id</highlight></codeline>
<codeline lineno="1114"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}</highlight></codeline>
<codeline lineno="1115"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>name<sp/>=<sp/>&apos;Publication<sp/>Dbxref&apos;</highlight></codeline>
<codeline lineno="1116"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1117"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id));</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"></highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>the<sp/>properties<sp/>and<sp/>add<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($pub_details<sp/>as<sp/>$key<sp/>=&gt;<sp/>$value)<sp/>{</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>pub_details<sp/>may<sp/>have<sp/>the<sp/>raw<sp/>search<sp/>data<sp/>(e.g.<sp/>in<sp/>XML<sp/>from<sp/>PubMed.<sp/><sp/>We&apos;ll<sp/>irgnore<sp/>this<sp/>for<sp/>now</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;raw&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"></highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>cvterm<sp/>by<sp/>name</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/>$identifiers<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$key,</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga43188a45bf914732ee69be620419b34c" kindref="member">chado_get_cvterm</ref>($identifiers);</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"></highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>could<sp/>not<sp/>find<sp/>the<sp/>cvterm<sp/>by<sp/>name<sp/>then<sp/>try<sp/>by<sp/>synonym</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//$cvterm<sp/>=<sp/>chado_get_cvterm(array(&apos;name&apos;<sp/>=&gt;<sp/>$key,<sp/>&apos;cv_id&apos;<sp/>=&gt;<sp/>array(&apos;name&apos;<sp/>=&gt;<sp/>&apos;tripal_pub&apos;)));</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cvterm)<sp/>{</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$identifiers<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$key,</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga43188a45bf914732ee69be620419b34c" kindref="member">chado_get_cvterm</ref>($identifiers);</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cvterm)<sp/>{</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>find<sp/>term:<sp/>&apos;%prop&apos;.<sp/>Skipping.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%prop&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$key));</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"></highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>details<sp/>that<sp/>won&apos;t<sp/>be<sp/>stored<sp/>as<sp/>properties</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Author<sp/>List&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a985b51587a6dd159c9b7917d501b5d02" kindref="member">tripal_pub_add_authors</ref>($pub_id,<sp/>$value,<sp/>$do_contact);</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Title&apos;</highlight><highlight class="normal"><sp/>or<sp/>$key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Volume&apos;</highlight><highlight class="normal"><sp/>or<sp/>$key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Journal<sp/>Name&apos;</highlight><highlight class="normal"><sp/>or<sp/>$key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Issue&apos;</highlight><highlight class="normal"><sp/>or</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/>$key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Year&apos;</highlight><highlight class="normal"><sp/>or<sp/>$key<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;Pages&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"></highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($value))<sp/>{</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($value<sp/>as<sp/>$subkey<sp/>=&gt;<sp/>$subvalue)<sp/>{</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>key<sp/>is<sp/>an<sp/>integer<sp/>then<sp/>this<sp/>array<sp/>is<sp/>a<sp/>simple<sp/>list<sp/>and</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>will<sp/>insert<sp/>using<sp/>the<sp/>primary<sp/>key.<sp/>Otheriwse,<sp/>use<sp/>the<sp/>new<sp/>key</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(is_int($subkey))<sp/>{</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="d0/d77/group__tripal__chado__prop__api_1gad94d6e8d68c949d1ee56b6edfca6ae70" kindref="member">chado_insert_property</ref>(</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id),</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$key,<sp/></highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$subvalue)</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="d0/d77/group__tripal__chado__prop__api_1gad94d6e8d68c949d1ee56b6edfca6ae70" kindref="member">chado_insert_property</ref>(</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id),</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$subkey,<sp/></highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$subvalue)</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="d0/d77/group__tripal__chado__prop__api_1gad94d6e8d68c949d1ee56b6edfca6ae70" kindref="member">chado_insert_property</ref>(</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id),</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$key,<sp/></highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$value),</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;update_if_present&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE)</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>add<sp/>property<sp/>&apos;%prop&apos;<sp/>to<sp/>publication.<sp/>Skipping.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%prop&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$key));</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"></highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$pub_id;</highlight></codeline>
<codeline lineno="1197"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"></highlight></codeline>
<codeline lineno="1199"><highlight class="normal"></highlight></codeline>
<codeline lineno="1200"><highlight class="normal"></highlight></codeline>
<codeline lineno="1214" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a985b51587a6dd159c9b7917d501b5d02" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a985b51587a6dd159c9b7917d501b5d02" kindref="member">tripal_pub_add_authors</ref>($pub_id,<sp/>$authors,<sp/>$do_contact)<sp/>{</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/>$rank<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"></highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>remove<sp/>any<sp/>of<sp/>the<sp/>existing<sp/>pubauthor<sp/>entires.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{pubauthor}<sp/>WHERE<sp/>pub_id<sp/>=<sp/>:pub_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id));</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"></highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>the<sp/>authors<sp/>and<sp/>add<sp/>them<sp/>to<sp/>the<sp/>pubauthors<sp/>and<sp/>contact</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>tables<sp/>of<sp/>chado,<sp/>then<sp/>link<sp/>them<sp/>through<sp/>the<sp/>custom<sp/>pubauthors_contact</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($authors<sp/>as<sp/>$author)<sp/>{</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Skip<sp/>invalid<sp/>author<sp/>entires.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($author[</highlight><highlight class="stringliteral">&apos;valid&apos;</highlight><highlight class="normal">])<sp/>AND<sp/>$author[</highlight><highlight class="stringliteral">&apos;valid&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;N&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remove<sp/>the<sp/>&apos;valid&apos;<sp/>property<sp/>as<sp/>we<sp/>don&apos;t<sp/>have<sp/>a<sp/>CV<sp/>term<sp/>for<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($author[</highlight><highlight class="stringliteral">&apos;valid&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"></highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id,</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rank&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$rank,</highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"></highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>construct<sp/>the<sp/>contact.name<sp/>field<sp/>using<sp/>the<sp/>author<sp/>information</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/>$name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Person&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($author[</highlight><highlight class="stringliteral">&apos;Given<sp/>Name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>.=<sp/>$author[</highlight><highlight class="stringliteral">&apos;Given<sp/>Name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;givennames&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$author[</highlight><highlight class="stringliteral">&apos;Given<sp/>Name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($author[</highlight><highlight class="stringliteral">&apos;Surname&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>.=<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$author[</highlight><highlight class="stringliteral">&apos;Surname&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;surname&apos;</highlight><highlight class="normal">]<sp/>=<sp/>substr($author[</highlight><highlight class="stringliteral">&apos;Surname&apos;</highlight><highlight class="normal">],<sp/>0,<sp/>100);</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($author[</highlight><highlight class="stringliteral">&apos;Suffix&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>.=<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>$author[</highlight><highlight class="stringliteral">&apos;Suffix&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;suffix&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$author[</highlight><highlight class="stringliteral">&apos;Suffix&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($author[</highlight><highlight class="stringliteral">&apos;Collective&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>$author[</highlight><highlight class="stringliteral">&apos;Collective&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Collective&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($author[</highlight><highlight class="stringliteral">&apos;Surname&apos;</highlight><highlight class="normal">]))</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;surname&apos;</highlight><highlight class="normal">]<sp/>=<sp/>substr($author[</highlight><highlight class="stringliteral">&apos;Collective&apos;</highlight><highlight class="normal">],<sp/>0,<sp/>100);</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>trim($name);</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"></highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>add<sp/>an<sp/>entry<sp/>to<sp/>the<sp/>pubauthors<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;statement_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ins_pubauthor_idrasugisu&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/>$pubauthor<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight><highlight class="stringliteral">&apos;pubauthor&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"></highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>user<sp/>wants<sp/>us<sp/>to<sp/>create<sp/>a<sp/>contact<sp/>for<sp/>each<sp/>author<sp/>then<sp/>do<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($do_contact)<sp/>{</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>contact</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="da/d23/tripal__contact__base_8tpl_8php_1afd33e8d1f281f29797152c06814a07bf" kindref="member">$contact</ref><sp/>=<sp/><ref refid="da/daa/group__tripal__contact__api_1ga98af424a7500b68af030a813132085f8" kindref="member">chado_insert_contact</ref>(array(</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type,</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;properties&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$author</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"></highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>we<sp/>have<sp/>succesfully<sp/>added<sp/>the<sp/>contact<sp/>and<sp/>the<sp/>pubauthor<sp/>entries<sp/>then<sp/>we<sp/>want<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>link<sp/>them<sp/>together</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="da/d23/tripal__contact__base_8tpl_8php_1afd33e8d1f281f29797152c06814a07bf" kindref="member">$contact</ref><sp/>and<sp/>$pubauthor)<sp/>{</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"></highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>link<sp/>the<sp/>pubauthor<sp/>entry<sp/>to<sp/>the<sp/>contact</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pubauthor_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pubauthor[</highlight><highlight class="stringliteral">&apos;pubauthor_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;contact_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="da/d23/tripal__contact__base_8tpl_8php_1afd33e8d1f281f29797152c06814a07bf" kindref="member">$contact</ref>[</highlight><highlight class="stringliteral">&apos;contact_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;statement_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ins_pubauthorcontact_puco&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$pubauthor_contact<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight><highlight class="stringliteral">&apos;pubauthor_contact&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$pubauthor_contact)<sp/>{</highlight></codeline>
<codeline lineno="1286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>link<sp/>pub<sp/>authro<sp/>and<sp/>contact.&quot;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="1287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/>$rank++;</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"></highlight></codeline>
<codeline lineno="1312" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a2f6872d87c67a2df0309a01647818e6b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1a2f6872d87c67a2df0309a01647818e6b" kindref="member">tripal_pub_get_publication_array</ref>($pub_id,<sp/>$skip_existing<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="1313"><highlight class="normal"></highlight></codeline>
<codeline lineno="1314"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;return_array&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1);</highlight></codeline>
<codeline lineno="1315"><highlight class="normal"></highlight></codeline>
<codeline lineno="1316"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>publication</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1319"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id);</highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/>$pub<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1321"><highlight class="normal"></highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>expand<sp/>the<sp/>title</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/>$pub<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>($pub,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pub.title&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/>$pub<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>($pub,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pub.volumetitle&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"><sp/><sp/>$pub<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>($pub,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pub.uniquename&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/>$pub_array<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;title))<sp/>{</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;title;</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;volumetitle))<sp/>{</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Volume<sp/>Title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;volumetitle;</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;volume))<sp/>{</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Volume&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;volume;</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;series_name))<sp/>{</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Series<sp/>Name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;series_name;</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;issue))<sp/>{</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Issue&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;issue;</highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;pyear))<sp/>{</highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Year&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;pyear;</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;pages))<sp/>{</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Pages&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;pages;</highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;miniref))<sp/>{</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Mini<sp/>Ref&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;miniref;</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($pub-&gt;uniquename))<sp/>{</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Uniquename&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$pub-&gt;uniquename;</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$pub-&gt;type_id-&gt;name;</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"></highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>citation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1358"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub-&gt;pub_id,</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1364"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1365"><highlight class="normal"><sp/><sp/>$citation<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;pubprop&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1366"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($citation)<sp/>{</highlight></codeline>
<codeline lineno="1367"><highlight class="normal"><sp/><sp/><sp/><sp/>$citation<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>($citation,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pubprop.value&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($citation)<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Publication<sp/>has<sp/>multiple<sp/>citations<sp/>already:<sp/>%pub_id&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pubid));</highlight></codeline>
<codeline lineno="1371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1372"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1373"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(count($citation)<sp/>==<sp/>1<sp/>and<sp/>$skip_existing<sp/>==<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="1374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>this<sp/>publication,<sp/>it<sp/>already<sp/>has<sp/>a<sp/>citation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1376"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"></highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1380"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>publication<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1381"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub-&gt;pub_id,</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/>$ptypes<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;pubprop&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($ptypes)<sp/>{</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/><sp/><sp/>$ptypes<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>($ptypes,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pubprop.value&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($ptypes<sp/>as<sp/>$ptype)<sp/>{</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Publication<sp/>Type&apos;</highlight><highlight class="normal">][]<sp/>=<sp/>$ptype-&gt;value;</highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"></highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>the<sp/>authors<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>---------------------------------</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub-&gt;pub_id,</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Authors&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1404"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/>$authors<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;pubprop&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1406"><highlight class="normal"><sp/><sp/>$authors<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1gac2d1c767cf1cbff56908b2d6da178e65" kindref="member">chado_expand_var</ref>($authors,<sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;pubprop.value&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($authors)<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Publication<sp/>has<sp/>multiple<sp/>author<sp/>lists.<sp/>It<sp/>should<sp/>have<sp/>only<sp/>one<sp/>list:<sp/>%pub_id&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1409"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pubid));</highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(trim($authors-&gt;value))<sp/>{</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Authors&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$authors-&gt;value;</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1415"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>there<sp/>is<sp/>no<sp/>&apos;Author&apos;s<sp/>property<sp/>then<sp/>try<sp/>to<sp/>retreive<sp/>authors<sp/>from<sp/>the<sp/>pubauthor<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1416"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1418"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>string_agg(surname<sp/>||<sp/>&apos;<sp/>&apos;<sp/>||<sp/>givennames,<sp/>&apos;,<sp/>&apos;)</highlight></codeline>
<codeline lineno="1419"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{pubauthor}</highlight></codeline>
<codeline lineno="1420"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>pub_id<sp/>=<sp/>:pub_id</highlight></codeline>
<codeline lineno="1421"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>GROUP<sp/>BY<sp/>pub_id</highlight></codeline>
<codeline lineno="1422"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/>$au<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub_id))-&gt;fetchField();</highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($au)<sp/>{</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pub_array[</highlight><highlight class="stringliteral">&apos;Authors&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$au;</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"></highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//Get<sp/>other<sp/>props</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1430"><highlight class="normal"><sp/><sp/><ref refid="d7/dd1/tripal__library__properties_8tpl_8php_1ab6b3255872c3392cb5701a4d4b8e771b" kindref="member">$props</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Journal<sp/>Abbreviation&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Elocation&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Media<sp/>Code&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Conference<sp/>Name&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Keywords&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Series<sp/>Name&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pISSN&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Publication<sp/>Date&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Journal<sp/>Code&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Journal<sp/>Alias&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Journal<sp/>Country&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Published<sp/>Location&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Publication<sp/>Model&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Language<sp/>Abbr&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Alias&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Publication<sp/>Dbxref&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Copyright&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Abstract&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Notes&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Citation&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Language&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;URL&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;eISSN&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;DOI&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ISSN&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Publication<sp/>Code&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Comments&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Publisher&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Media<sp/>Alias&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Original<sp/>Title&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d7/dd1/tripal__library__properties_8tpl_8php_1ab6b3255872c3392cb5701a4d4b8e771b" kindref="member">$props</ref><sp/>AS<sp/>$prop)<sp/>{</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>value<sp/>FROM<sp/>{pubprop}</highlight></codeline>
<codeline lineno="1465"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>type_id<sp/>=</highlight></codeline>
<codeline lineno="1466"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(SELECT<sp/>cvterm_id</highlight></codeline>
<codeline lineno="1467"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}</highlight></codeline>
<codeline lineno="1468"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>name<sp/>=<sp/>:cvtname<sp/>AND<sp/>cv_id<sp/>=</highlight></codeline>
<codeline lineno="1469"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(SELECT<sp/>cv_id</highlight></codeline>
<codeline lineno="1470"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cv}</highlight></codeline>
<codeline lineno="1471"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>name<sp/>=<sp/>&apos;tripal_pub&apos;</highlight></codeline>
<codeline lineno="1472"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1473"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1474"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>pub_id<sp/>=<sp/>:pub_id</highlight></codeline>
<codeline lineno="1475"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/>$val<sp/>=<sp/>trim(<ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cvtname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$prop,<sp/></highlight><highlight class="stringliteral">&apos;:pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$pub-&gt;pub_id))-&gt;fetchField());</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($val)<sp/>{</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pub_array[$prop]<sp/>=$val;</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$pub_array;</highlight></codeline>
<codeline lineno="1482"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"></highlight></codeline>
<codeline lineno="1484"><highlight class="normal"></highlight></codeline>
<codeline lineno="1485"><highlight class="normal"></highlight></codeline>
<codeline lineno="1496" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1aee53e48d592f16499640a81586a6f890" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1aee53e48d592f16499640a81586a6f890" kindref="member">tripal_execute_pub_importer</ref>($import_id,<sp/>$job_id<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nNOTE:<sp/>Loading<sp/>of<sp/>publications<sp/>is<sp/>performed<sp/>using<sp/>a<sp/>database<sp/>transaction.<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;If<sp/>the<sp/>load<sp/>fails<sp/>or<sp/>is<sp/>terminated<sp/>prematurely<sp/>then<sp/>the<sp/>entire<sp/>set<sp/>of<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;insertions/updates<sp/>is<sp/>rolled<sp/>back<sp/>and<sp/>will<sp/>not<sp/>be<sp/>found<sp/>in<sp/>the<sp/>database\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"></highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>start<sp/>the<sp/>transaction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"></highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/>$page<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/>$do_contact<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/>$num_to_retrieve<sp/>=<sp/>100;</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"></highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>get<sp/>all<sp/>of<sp/>the<sp/>loaders</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;:import_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$import_id);</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_pub_import}<sp/>WHERE<sp/>pub_import_id<sp/>=<sp/>:import_id<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"><sp/><sp/><sp/><sp/>$import<sp/>=<sp/>db_query($sql,<sp/>$args)-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1513"><highlight class="normal"></highlight></codeline>
<codeline lineno="1514"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Executing<sp/>Importer:<sp/>&apos;&quot;</highlight><highlight class="normal"><sp/>.<sp/>$import-&gt;name<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;&apos;\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1515"><highlight class="normal"></highlight></codeline>
<codeline lineno="1516"><highlight class="normal"><sp/><sp/><sp/><sp/>$criteria<sp/>=<sp/>unserialize($import-&gt;criteria);</highlight></codeline>
<codeline lineno="1517"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/>=<sp/>$criteria[</highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1518"><highlight class="normal"><sp/><sp/><sp/><sp/>$total_pubs<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">do</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>retrieve<sp/>the<sp/>pubs<sp/>for<sp/>this<sp/>page.<sp/>We&apos;ll<sp/>retreive<sp/>100<sp/>at<sp/>a<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/><sp/>=<sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab011e8f4869f0aae80b258deb1d9c821" kindref="member">tripal_get_remote_pubs</ref>($remote_db,<sp/>$criteria,<sp/>$num_to_retrieve,<sp/>$page);</highlight></codeline>
<codeline lineno="1522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$pubs<sp/><sp/><sp/><sp/><sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>[</highlight><highlight class="stringliteral">&apos;pubs&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$num_pubs<sp/>=<sp/>$rseults[</highlight><highlight class="stringliteral">&apos;total_records&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$total_pubs<sp/>+=<sp/>$num_pubs;</highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ac254868fc8671a88a9ae8e294b716d83" kindref="member">tripal_pub_add_publications</ref>($pubs,<sp/>$import-&gt;do_contact);</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$page++;</highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>continue<sp/>looping<sp/>until<sp/>we<sp/>have<sp/>a<sp/>$pubs<sp/>array<sp/>that<sp/>does<sp/>not<sp/>have</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>our<sp/>requested<sp/>numer<sp/>of<sp/>records.<sp/><sp/>This<sp/>means<sp/>we&apos;ve<sp/>hit<sp/>the<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(count($pubs)<sp/>==<sp/>$num_to_retrieve);</highlight></codeline>
<codeline lineno="1531"><highlight class="normal"></highlight></codeline>
<codeline lineno="1532"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>backwards<sp/>compatibility<sp/>check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>legacy<sp/>pub<sp/>module</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1533"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>is<sp/>enabled.<sp/>If<sp/>so,<sp/>then<sp/>sync<sp/>the<sp/>nodes.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(module_exists(</highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="1535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sync<sp/>the<sp/>newly<sp/>added<sp/>publications<sp/>with<sp/>Drupal.<sp/>If<sp/>the<sp/>user</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>requested<sp/>a<sp/>report<sp/>then<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>print<sp/>any<sp/>syncing<sp/>information</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>so<sp/>pass<sp/>&apos;FALSE&apos;<sp/>to<sp/>the<sp/>sync<sp/>call</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Syncing<sp/>publications<sp/>with<sp/>Drupal...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga7145af80db3d89b022703df056227023" kindref="member">chado_node_sync_records</ref>(</highlight><highlight class="stringliteral">&apos;pub&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"></highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>any<sp/>of<sp/>the<sp/>importers<sp/>wanted<sp/>to<sp/>create<sp/>contacts<sp/>from<sp/>the<sp/>authors<sp/>then<sp/>sync<sp/>them</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">($import-&gt;do_contact)<sp/>{</highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Syncing<sp/>contacts<sp/>with<sp/>Drupal...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d43/group__tripal__legacy__chado__node__api_1ga7145af80db3d89b022703df056227023" kindref="member">chado_node_sync_records</ref>(</highlight><highlight class="stringliteral">&apos;contact&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>Tripal<sp/>v3<sp/>we<sp/>want<sp/>to<sp/>publish<sp/>the<sp/>new<sp/>publications</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1548"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$bundle<sp/>=<sp/><ref refid="d5/dce/group__tripal__entities__api_1ga5f53c10c88edbd9405697ffd7bca2094" kindref="member">tripal_load_bundle_entity</ref>([</highlight><highlight class="stringliteral">&apos;label&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Publication&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($bundle)<sp/>{</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/db8/group__tripal__chado__api_1gaf3e6c2a98f3e9ca76d67cbda86a0fe2b" kindref="member">chado_publish_records</ref>([</highlight><highlight class="stringliteral">&apos;bundle_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$bundle-&gt;name],<sp/>$job_id);</highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/></highlight><highlight class="stringliteral">&apos;100&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">;<sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>we<sp/>start<sp/>errors<sp/>on<sp/>new<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog_exception(</highlight><highlight class="stringliteral">&apos;T_pub_import&apos;</highlight><highlight class="normal">,<sp/>$e);</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;FAILED:<sp/>Rolling<sp/>back<sp/>database<sp/>changes...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Done.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1564"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1565"><highlight class="normal"></highlight></codeline>
<codeline lineno="1582" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab1fdb1323b4f4579e3110c9eb3f152e1" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab1fdb1323b4f4579e3110c9eb3f152e1" kindref="member">tripal_get_remote_pub</ref>($dbxref)<sp/>{</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"></highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(preg_match(</highlight><highlight class="stringliteral">&apos;/^(.*?):(.*?)$/&apos;</highlight><highlight class="normal">,<sp/>$dbxref,<sp/>$matches))<sp/>{</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/>$remote_db<sp/>=<sp/>$matches[1];</highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$matches[2];</highlight></codeline>
<codeline lineno="1587"><highlight class="normal"></highlight></codeline>
<codeline lineno="1588"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>that<sp/>the<sp/>database<sp/>is<sp/>supported</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/><sp/><sp/>$supported_dbs<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;tripal_pub_supported_dbs&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;PMID&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1590"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!in_array($remote_db,<sp/>$supported_dbs))<sp/>{</highlight></codeline>
<codeline lineno="1591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1592"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1593"><highlight class="normal"></highlight></codeline>
<codeline lineno="1594"><highlight class="normal"><sp/><sp/><sp/><sp/>$search<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;num_criteria&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="1596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;remote_db&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$remote_db,</highlight></codeline>
<codeline lineno="1597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;criteria&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="charliteral">&apos;1&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;search_terms&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;$remote_db:$accession&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;scope&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;operation&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_phrase&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>0,</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/>$pubs<sp/>=<sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab011e8f4869f0aae80b258deb1d9c821" kindref="member">tripal_get_remote_pubs</ref>($remote_db,<sp/>$search,<sp/>1,<sp/>0);</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"></highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$pubs[</highlight><highlight class="stringliteral">&apos;pubs&apos;</highlight><highlight class="normal">][0];</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1611"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"></highlight></codeline>
<codeline lineno="1653" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab011e8f4869f0aae80b258deb1d9c821" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ab011e8f4869f0aae80b258deb1d9c821" kindref="member">tripal_get_remote_pubs</ref>($remote_db,<sp/>$search_array,<sp/>$num_to_retrieve,<sp/>$page<sp/>=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1654"><highlight class="normal"></highlight></codeline>
<codeline lineno="1655"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>call<sp/>the<sp/>callback<sp/>function<sp/>to<sp/>get<sp/>the<sp/>results</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1656"><highlight class="normal"><sp/><sp/>$callback<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;tripal_pub_remote_search_$remote_db&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1657"><highlight class="normal"><sp/><sp/>$pubs<sp/>=<sp/><sp/>array(</highlight></codeline>
<codeline lineno="1658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;total_records&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>0,</highlight></codeline>
<codeline lineno="1659"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;search_str&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pubs&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="1661"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1662"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(function_exists($callback))<sp/>{</highlight></codeline>
<codeline lineno="1663"><highlight class="normal"><sp/><sp/><sp/><sp/>$pubs<sp/>=<sp/>call_user_func($callback,<sp/>$search_array,<sp/>$num_to_retrieve,<sp/>$page);</highlight></codeline>
<codeline lineno="1664"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1665"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$pubs;</highlight></codeline>
<codeline lineno="1666"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1667"><highlight class="normal"></highlight></codeline>
<codeline lineno="1675" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ae3fda00e5499feec81d5554cfd187b81" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1ae3fda00e5499feec81d5554cfd187b81" kindref="member">tripal_pub_citation_form</ref>(<ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>,<sp/>&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="1676"><highlight class="normal"></highlight></codeline>
<codeline lineno="1677"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;instructions&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#markup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;&lt;p&gt;Use<sp/>this<sp/>form<sp/>to<sp/>unify<sp/>publication<sp/>citations.<sp/>Citations<sp/>are<sp/>created<sp/>automtically<sp/>when</highlight></codeline>
<codeline lineno="1679"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>importing<sp/>publications<sp/>but<sp/>citations<sp/>are<sp/>set<sp/>by<sp/>the<sp/>user<sp/>when<sp/>publications<sp/>are<sp/>added<sp/>manually.</highlight></codeline>
<codeline lineno="1680"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>Or<sp/>publications<sp/>added<sp/>to<sp/>the<sp/>Chado<sp/>database<sp/>by<sp/>tools<sp/>other<sp/>than<sp/>the<sp/>Tripal<sp/>Publication<sp/>Importer<sp/>may</highlight></codeline>
<codeline lineno="1681"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>not<sp/>have<sp/>citations<sp/>set.<sp/>If<sp/>you<sp/>are<sp/>certain<sp/>that<sp/>all<sp/>necessary<sp/>information<sp/>for<sp/>all<sp/>publications<sp/>is<sp/>present<sp/>(e.g.</highlight></codeline>
<codeline lineno="1682"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>authors,<sp/>volume,<sp/>issue,<sp/>page<sp/>numbers,<sp/>etc.)<sp/>but<sp/>citations<sp/>are<sp/>not<sp/>consistent,<sp/>then<sp/>you<sp/>can</highlight></codeline>
<codeline lineno="1683"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>choose<sp/>to<sp/>update<sp/>all<sp/>citations<sp/>for<sp/>all<sp/>publications<sp/>using<sp/>the<sp/>form<sp/>below.<sp/>Alternatively,<sp/>you</highlight></codeline>
<codeline lineno="1684"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>can<sp/>update<sp/>citations<sp/>only<sp/>for<sp/>publication<sp/>that<sp/>do<sp/>not<sp/>already<sp/>have<sp/>one.&lt;/p&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1685"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1686"><highlight class="normal"></highlight></codeline>
<codeline lineno="1687"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;radios&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#options&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;all&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Create<sp/>citation<sp/>for<sp/>all<sp/>publications.<sp/>Replace<sp/>the<sp/>existing<sp/>citation<sp/>if<sp/>it<sp/>exists.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;new&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;Create<sp/>citation<sp/>for<sp/>publication<sp/>only<sp/>if<sp/>it<sp/>does<sp/>not<sp/>already<sp/>have<sp/>one.&apos;</highlight><highlight class="normal">),</highlight></codeline>
<codeline lineno="1692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#default_value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;all&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1693"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1694"><highlight class="normal"></highlight></codeline>
<codeline lineno="1695"><highlight class="normal"><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>[</highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;submit&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>t(</highlight><highlight class="stringliteral">&apos;Submit&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1698"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1699"><highlight class="normal"></highlight></codeline>
<codeline lineno="1700"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1a24227bb4b9c4c11f6f138476251ff34c" kindref="member">$form</ref>;</highlight></codeline>
<codeline lineno="1701"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1702"><highlight class="normal"></highlight></codeline>
<codeline lineno="1710" refid="d8/d4a/tripal__chado_8pub__importers_8inc_1adba635c3908240c6a3e5ff6f0454d290" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d8/d4a/tripal__chado_8pub__importers_8inc_1adba635c3908240c6a3e5ff6f0454d290" kindref="member">tripal_pub_citation_form_submit</ref>(&amp;$form_state)<sp/>{</highlight></codeline>
<codeline lineno="1711"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>[0]<sp/>=<sp/>$form_state[</highlight><highlight class="stringliteral">&apos;options&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;#value&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1712"><highlight class="normal"><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&quot;Create<sp/>citations<sp/>($options[0])&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_pub&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;chado_pub_create_citations&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>,<sp/>$user-&gt;uid);</highlight></codeline>
<codeline lineno="1713"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado/includes/loaders/tripal_chado.pub_importers.inc"/>
  </compounddef>
</doxygen>
