<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d6/d66/tripal__chado__views_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_chado_views.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga79f1499793641ca5ade8a0ff12cf03a6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_add_field_to_views_integration</definition>
        <argsstring>($table_name, $priority, $field)</argsstring>
        <name>tripal_add_field_to_views_integration</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <param>
          <declname>$priority</declname>
        </param>
        <param>
          <declname>$field</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Adds the given field to an existing or cloned integration. In the case of a cloned integration, the lightest integration is used as the template for the clone.</para><para>NOTE: If that field already exists in the specified integration then it will first be deleted and the new one added.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table the integration is for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the integration to use; pass NULL to use the lightest integration </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$field</parametername>
</parameternamelist>
<parameterdescription>
<para>An array describing the field ot add; uses the same format as the $defn_array</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the field was added successfully; FALSE otherwise </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="931" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="931" bodyend="1089"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1gae2ec4020a1bb71f8092b3501af63dc6a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_add_join_to_views_integration</definition>
        <argsstring>($table_name, $priority, $join)</argsstring>
        <name>tripal_add_join_to_views_integration</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <param>
          <declname>$priority</declname>
        </param>
        <param>
          <declname>$join</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Adds the given field to an existing or cloned integration. In the case of a cloned integration, the lightest integration is used as the template for the clone.</para><para>NOTE: If that field already exists in the specified integration then it will first be deleted and the new one added.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table the integration is for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the integration to use; pass NULL to use the lightest integration </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$field</parametername>
</parameternamelist>
<parameterdescription>
<para>An array describing the join to add. it should contain the following keys: base_table, base_field, left_table, left_field, handler, relationship_handler, relationship_only</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the field was added successfully; FALSE otherwise </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="1114" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="1114" bodyend="1142"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_add_views_integration</definition>
        <argsstring>($defn_array, $setup_id=FALSE)</argsstring>
        <name>tripal_add_views_integration</name>
        <param>
          <declname>$defn_array</declname>
        </param>
        <param>
          <declname>$setup_id</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add views integration records into the tripal_views* tables.</para><para>This is the programatic way to add your own integrations to the tripal views integrations list. Keep in mind that the priority set in your $defn_array needs to be lighter than any existing integrations to be used by views and that it should still be below 0 in order to allow site administrators to override it should they need to.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$defn_array</parametername>
</parameternamelist>
<parameterdescription>
<para>An array describing the structure and fields of the table.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>True/False if completed successfully/not.</para></simplesect>
Example usage (in hook_install()): <programlisting><codeline><highlight class="normal">$defn_array<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;table&apos;<sp/>=&gt;<sp/>&apos;feature&apos;,<sp/>//tablename<sp/>or<sp/>materialized<sp/>view<sp/>name</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>&apos;Sequence<sp/>Features&apos;,<sp/>//<sp/>Human<sp/>readable<sp/>name</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>&apos;chado&apos;,<sp/>//either<sp/>chado<sp/>or<sp/>mview<sp/>depending<sp/>on<sp/>tablename</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;Create<sp/>a<sp/>listing<sp/>of<sp/>features.&apos;,<sp/>//description<sp/>seen<sp/>when<sp/>creating<sp/>a<sp/>view<sp/>of<sp/>this<sp/>type</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;priority&apos;<sp/>=&gt;<sp/>10,<sp/>//For<sp/>Base<sp/>tripal<sp/>modules:<sp/>10;<sp/>custom<sp/>modules:<sp/>9<sp/>to<sp/>0;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;base_table&apos;<sp/>=&gt;<sp/>TRUE<sp/>//either<sp/>TRUE<sp/>or<sp/>FALSE<sp/>depending<sp/>on<sp/>whether<sp/>the<sp/>current<sp/>table<sp/>should<sp/>show<sp/>up<sp/>in<sp/>the<sp/>add<sp/>view<sp/>list</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;fields&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>&apos;feature_id&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>&apos;feature_id&apos;,<sp/>//field<sp/>name<sp/>in<sp/>database</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Feature<sp/>ID&apos;,<sp/>//human-readable<sp/>name<sp/>-seen<sp/>in<sp/>Views<sp/>UI</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;description&apos;<sp/>=&gt;<sp/>&apos;This<sp/>is<sp/>the<sp/>unique<sp/>identifier<sp/>for<sp/>features&apos;,<sp/>//help/description<sp/>seen<sp/>in<sp/>Views<sp/>UI</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;type&apos;<sp/>=&gt;<sp/>&apos;int&apos;,<sp/>//<sp/>the<sp/>type<sp/>of<sp/>field</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;handlers&apos;<sp/>=&gt;<sp/>array(<sp/><sp/>//possible<sp/>keys<sp/>are<sp/>field,<sp/>filter,<sp/>sort,<sp/>argument,<sp/>relationship</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;field&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;name&apos;<sp/>=&gt;<sp/>&apos;chado_views_handler_numeric&apos;<sp/>//name<sp/>of<sp/>handler</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;filter&apos;<sp/>=&gt;<sp/>array(<sp/>...<sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>...</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Describe<sp/>any<sp/>joins<sp/>involving<sp/>this<sp/>field.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Note:<sp/>you<sp/>can<sp/>include<sp/>both<sp/>foreign<sp/>keys<sp/>(feature.type_id<sp/>=&gt;<sp/>cvterm.cvterm_id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>and<sp/>referring<sp/>tables<sp/>(ie:<sp/>feature.feature_id<sp/>&lt;=<sp/>feature_relationship.subject_id)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;joins&apos;<sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;feature_relationship&apos;<sp/>=&gt;<sp/>array(<sp/>//table<sp/>to<sp/>join<sp/>to.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;subject_id&apos;<sp/>=&gt;<sp/>array(<sp/>//field<sp/>in<sp/>above<sp/>table<sp/>(feature_relationship)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;table&apos;<sp/>=&gt;<sp/>&apos;featureprop&apos;,<sp/>//table<sp/>to<sp/>join<sp/>to</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;field&apos;<sp/>=&gt;<sp/>&apos;feature_id&apos;,<sp/>//field<sp/>in<sp/>above<sp/>table<sp/>(feature_relationship)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;handler&apos;<sp/>=&gt;<sp/>&apos;views_join&apos;,<sp/>//handler<sp/>to<sp/>use<sp/>for<sp/>joining</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;relationship_handler&apos;<sp/>=&gt;<sp/>&apos;views_handler_relationship&apos;,<sp/>//handler<sp/>to<sp/>use<sp/>when<sp/>a<sp/>relationship<sp/>is<sp/>added.</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;relationship_only&apos;<sp/>=&gt;<sp/>FALSE,<sp/>//whether<sp/>to<sp/>join<sp/>automatically<sp/>(FALSE)<sp/>or<sp/>not<sp/>(TRUE)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>...</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>...</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>),</highlight></codeline>
<codeline><highlight class="normal">);</highlight></codeline>
<codeline><highlight class="normal">tripal_add_views_integration($defn_array);</highlight></codeline>
</programlisting> </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="496" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="496" bodyend="702"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_clone_views_integration</definition>
        <argsstring>($table_name, $new_priority=NULL, $template_priority=NULL)</argsstring>
        <name>tripal_clone_views_integration</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <param>
          <declname>$new_priority</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$template_priority</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Clone an integration. This is often a great way to create your own module-specific integration while still benifiting from an existing (or even the lightest priority) integration.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The table for which you&apos;d like to clone an integration </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$new_priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the clone; this is the integration which will be created. If no priority is supplied then one lighter then the $template_priority will be used. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$template_priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the template to be used for the clone; this is an existing integration. If no priority is supplied then the lightest priority will be used. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="869" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="869" bodyend="907"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga57f341c0e2987ba11338a2d66493cc2c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_disable_view</definition>
        <argsstring>($view_name, $redirect_link=FALSE)</argsstring>
        <name>tripal_disable_view</name>
        <param>
          <declname>$view_name</declname>
        </param>
        <param>
          <declname>$redirect_link</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Programatically disable view.</para><para>This should be used in a hook_menu definition as the callback to provide a link to disable the view (first example). It can also be called directly if needed (second example).</para><para><programlisting><codeline><highlight class="normal"><sp/>//Create<sp/>a<sp/>URL<sp/>that<sp/>when<sp/>the<sp/>user<sp/>navigates<sp/>there,<sp/>a<sp/>given<sp/>view<sp/>will<sp/>be<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>//disabled.</highlight></codeline>
<codeline><highlight class="normal"><sp/>//You<sp/>will<sp/>still<sp/>need<sp/>to<sp/>provide<sp/>a<sp/>link<sp/>to<sp/>this<sp/>menu<sp/>item<sp/>somewhere<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>//appropriate.</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>mymodule_menu()<sp/>{</highlight></codeline>
<codeline><highlight class="normal">$items<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//Create<sp/>one<sp/>of<sp/>these<sp/>for<sp/>each<sp/>of<sp/>your<sp/>default<sp/>views</highlight></codeline>
<codeline><highlight class="normal">$items[&apos;admin/tripal/&lt;PATH-TO-YOUR-ADMIN-SECTION&gt;/views/&lt;VIEW-MACHINE-NAME&gt;/disable&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal">&apos;title&apos;<sp/>=&gt;<sp/>&apos;Disable<sp/>&lt;VIEW-HUMAN-READABLE-NAME&gt;&apos;,</highlight></codeline>
<codeline><highlight class="normal">&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_disable_view&apos;,</highlight></codeline>
<codeline><highlight class="normal">&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;&lt;VIEW-MACHINE-NAME&gt;&apos;,<sp/>&apos;&lt;PATH-TO-REDIRECT-TO-AFTERWARDS&gt;&apos;),</highlight></codeline>
<codeline><highlight class="normal">&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;&lt;YOUR-PERMISSION-KEY&gt;&apos;),</highlight></codeline>
<codeline><highlight class="normal">&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal">);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">return<sp/>$items;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>//Call<sp/>this<sp/>function<sp/>directly<sp/>to<sp/>disable<sp/>a<sp/>view</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>//The<sp/>example<sp/>shows<sp/>disabling<sp/>your<sp/>own<sp/>default<sp/>view<sp/>when<sp/>your<sp/>module<sp/>is<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>//uninstalled</highlight></codeline>
<codeline><highlight class="normal"><sp/>function<sp/>mymodule_uninstall()<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">$view_name<sp/>=<sp/>&apos;&lt;VIEW-MACHINE-NAME&gt;&apos;;</highlight></codeline>
<codeline><highlight class="normal"><sp/>tripal_disable_view($view_name);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting></para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$view_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The machine-name of the view to be enabled </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$redirect_link</parametername>
</parameternamelist>
<parameterdescription>
<para>The path to redirect to. FALSE if no redirect needed </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="127" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="127" bodyend="141"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga275071d80e77c7188c41d456cc0cbdbd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_enable_view</definition>
        <argsstring>($view_name, $redirect_link=FALSE)</argsstring>
        <name>tripal_enable_view</name>
        <param>
          <declname>$view_name</declname>
        </param>
        <param>
          <declname>$redirect_link</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Programatically enable view</para><para>This should be used in a hook_menu definition as the callback to provide a link to enable the view (first example). It can also be called directly if needed (second example). <programlisting><codeline><highlight class="normal"><sp/>Create<sp/>a<sp/>URL<sp/>that<sp/>when<sp/>the<sp/>user<sp/>navigates<sp/>there,<sp/>a<sp/>given<sp/>view<sp/>will<sp/>be<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>enabled.</highlight></codeline>
<codeline><highlight class="normal"><sp/>You<sp/>will<sp/>still<sp/>need<sp/>to<sp/>provide<sp/>a<sp/>link<sp/>to<sp/>this<sp/>menu<sp/>item<sp/>somewhere<sp/></highlight></codeline>
<codeline><highlight class="normal"><sp/>appropriate<sp/>(ie:<sp/>an<sp/>admin<sp/>landing<sp/>page).</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>mymodule_menu<sp/>()<sp/>{</highlight></codeline>
<codeline><highlight class="normal">$items<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/>//Create<sp/>one<sp/>of<sp/>these<sp/>for<sp/>each<sp/>of<sp/>your<sp/>default<sp/>views</highlight></codeline>
<codeline><highlight class="normal"><sp/>$items[&apos;admin/tripal/&lt;PATH-TO-YOUR-ADMIN-SECTION&gt;/views/&lt;VIEW-MACHINE-NAME&gt;/enable&apos;]<sp/>=<sp/>array(</highlight></codeline>
<codeline><highlight class="normal"><sp/>&apos;title&apos;<sp/>=&gt;<sp/>&apos;Enable<sp/>&lt;VIEW-HUMAN-READABLE-NAME&gt;&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/>&apos;page<sp/>callback&apos;<sp/>=&gt;<sp/>&apos;tripal_enable_view&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/>&apos;page<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;&lt;VIEW-MACHINE-NAME&gt;&apos;,<sp/>&apos;&lt;PATH-TO-REDIRECT-TO-AFTERWARDS&gt;&apos;),</highlight></codeline>
<codeline><highlight class="normal"><sp/>&apos;access<sp/>arguments&apos;<sp/>=&gt;<sp/>array(&apos;&lt;YOUR-PERMISSION-KEY&gt;&apos;),</highlight></codeline>
<codeline><highlight class="normal">&apos;type&apos;<sp/>=&gt;<sp/>MENU_CALLBACK,</highlight></codeline>
<codeline><highlight class="normal"><sp/>);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/>return<sp/>$items;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/>Call<sp/>this<sp/>function<sp/>directly<sp/>to<sp/>disable<sp/>a<sp/>view</highlight></codeline>
<codeline><highlight class="normal"><sp/>The<sp/>example<sp/>shows<sp/>enabling<sp/>your<sp/>own<sp/>default<sp/>view<sp/>when<sp/>your<sp/>module<sp/>is<sp/>enabled.</highlight></codeline>
<codeline><highlight class="normal"><sp/>This<sp/>might<sp/>be<sp/>useful<sp/>if<sp/>you<sp/>disable<sp/>your<sp/>view<sp/>when<sp/>your<sp/>module<sp/>is<sp/>disabled.</highlight></codeline>
<codeline><highlight class="normal">function<sp/>mymodule_enable()<sp/>{</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/>$view_name<sp/>=<sp/>&apos;&lt;VIEW-MACHINE-NAME&gt;&apos;;</highlight></codeline>
<codeline><highlight class="normal">tripal_enable_view($view_name);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/>}</highlight></codeline>
</programlisting></para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$view_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The machine-name of the view to be enabled </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$redirect_link</parametername>
</parameternamelist>
<parameterdescription>
<para>The path to redirect to. FALSE if no redirect needed </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="65" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="65" bodyend="79"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga17fc7a59376724fb261bf15bd1b9db1b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_export_views_integration</definition>
        <argsstring>($setup_id)</argsstring>
        <name>tripal_export_views_integration</name>
        <param>
          <declname>$setup_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Export Views integration records.</para><para>This is a great way to create your own integration since it returns an already defined integration in array form that you can modify. After modifications simply set the priority to something lighter (but still below 0) than any existing integrations and use <ref refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" kindref="member">tripal_add_views_integration()</ref> to add it to the list of integrations.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$setup_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The unique setup id of the tripal views integration</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A views integration definition array as used by <ref refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" kindref="member">tripal_add_views_integration()</ref> </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="722" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="722" bodyend="770"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga5ab71a5934907e7e734b00c4ff99d86c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_lightest_views_integration_priority</definition>
        <argsstring>($table_name)</argsstring>
        <name>tripal_get_lightest_views_integration_priority</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieve the priority of the lightest priority for a given table.</para><para>NOTE: Uses lightest priority (drupal-style) where the range is from -10 to 10 and -10 is of highest priority.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to retrieve the setup ID for. This can be either a materialized view or a chado table</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>returns the lowest priority. If the table has not been integrated, a priority of 10 is returned. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="267" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="267" bodyend="280"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga10c681ac5f993cc7ee39f44dc06c97e5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_lightest_views_integration_setup</definition>
        <argsstring>($table_name)</argsstring>
        <name>tripal_get_lightest_views_integration_setup</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieve the views integration setup_id with the lightest priority for a given table</para><para>NOTE: Uses lightest priority (drupal-style) where the range is from -10 to 10 and -10 is of highest priority.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to retrieve the setup ID for. This can be either a materialized view or a chado table</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>On success, the setup_id to use for integration of this table; otherwise FALSE </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="299" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="299" bodyend="311"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga949b536e6f05b032bf37b229c0896c48" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_views_integration_setup_id</definition>
        <argsstring>($table_name, $priority)</argsstring>
        <name>tripal_get_views_integration_setup_id</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <param>
          <declname>$priority</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieve the views integration setup_id with the given priority/table combination.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to retrieve the setup ID for. This can be either a materialized view or a chado table </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority of the integration to retrieve the setup_id for</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>On success, the setup_id to use for integration of this table; otherwise FALSE </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="329" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="329" bodyend="341"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1gac7d08f36291e444ac2b56a650c2b0131" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_is_lightest_priority_setup</definition>
        <argsstring>($setup_id, $table_name)</argsstring>
        <name>tripal_is_lightest_priority_setup</name>
        <param>
          <declname>$setup_id</declname>
        </param>
        <param>
          <declname>$table_name</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Checks if you are dealing with the lightest priority setup for a given table. This is a good way to determine whether your modules integration is being used by views.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$setup_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The ID of the setup to check (is this setup the lightest one?) </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table associated with this setup</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE is this is the lightest priority; FALSE otherwise </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="396" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="396" bodyend="406"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga24a91d667b61d5e0d084971fea344765" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_is_table_integrated</definition>
        <argsstring>($table_name, $priority=NULL)</argsstring>
        <name>tripal_is_table_integrated</name>
        <param>
          <declname>$table_name</declname>
        </param>
        <param>
          <declname>$priority</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check to see if this table already has an integration record with the given priority.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$table_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the table to check for integration </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$priority</parametername>
</parameternamelist>
<parameterdescription>
<para>(optional) The priority of record to check for</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>If the table is already integrated, the setup_id of the existing integration record is returned (If priority is not specified this will be the lightest record); Otherwise the table is not already integrated and FALSE is returned. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="360" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="360" bodyend="380"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1gac1075d1878a59f2518b3bb3fdf13b227" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_make_view_compatible_with_external</definition>
        <argsstring>($view)</argsstring>
        <name>tripal_make_view_compatible_with_external</name>
        <param>
          <declname>$view</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Remove any drupal fields from a chado-based default view definition if chado is external. This ensures compatibility with an external chado database.</para><para>You should be calling this function in your hook_views_default_views(). This function will only remove drupal tables if chado is external; thus you do not need to worry about checking yourself. For example, the following is a good hook_views_default_views():</para><para><programlisting><codeline><highlight class="normal">function<sp/>mymodule_views_default_views()<sp/>{</highlight></codeline>
<codeline><highlight class="normal">$views<sp/>=<sp/>array();</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/>NOTE:<sp/>&lt;VIEW-TYPE&gt;<sp/>describes<sp/>the<sp/>type<sp/>of<sp/>view:</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>&apos;admin&apos;<sp/>for<sp/>views<sp/>used<sp/>for<sp/>administration<sp/>of<sp/>your<sp/>module</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>&apos;search&apos;<sp/>for<sp/>views<sp/>used<sp/>to<sp/>search<sp/>data</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//<sp/><sp/><sp/><sp/><sp/>-<sp/>&apos;list&apos;<sp/>for<sp/>views<sp/>used<sp/>primarily<sp/>as<sp/>data<sp/>listings</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>//&lt;VIEW-HUMAN-READABLE-NAME&gt;</highlight></codeline>
<codeline><highlight class="normal">$view<sp/>=<sp/>mymodule_defaultview_&lt;VIEW-TYPE&gt;_&lt;VIEW-MACHINE-NAME&gt;();</highlight></codeline>
<codeline><highlight class="normal">$view<sp/>=<sp/>tripal_make_view_compatible_with_external($view);</highlight></codeline>
<codeline><highlight class="normal">$views[$view-&gt;name]<sp/>=<sp/>$view;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>//&lt;VIEW-HUMAN-READABLE-NAME&gt;</highlight></codeline>
<codeline><highlight class="normal">$view<sp/>=<sp/>mymodule_defaultview_&lt;VIEW-TYPE&gt;_&lt;VIEW-MACHINE-NAME&gt;();</highlight></codeline>
<codeline><highlight class="normal">$view<sp/>=<sp/>tripal_make_view_compatible_with_external($view);</highlight></codeline>
<codeline><highlight class="normal">$views[$view-&gt;name]<sp/>=<sp/>$view;</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">return<sp/>$views;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>mymodule_defaultview_&lt;VIEW-TYPE&gt;_&lt;VIEW-MACHINE-NAME&gt;()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>//PASTE<sp/>VIEWS<sp/>EXPORT<sp/>CODE<sp/>HERE</highlight></codeline>
<codeline><highlight class="normal">return<sp/>$view;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">function<sp/>mymodule_defaultview_&lt;VIEW-TYPE&gt;_&lt;VIEW-MACHINE-NAME&gt;()<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/>//PASTE<sp/>VIEWS<sp/>EXPORT<sp/>CODE<sp/>HERE</highlight></codeline>
<codeline><highlight class="normal">return<sp/>$view;</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting> Notice that the actual views export code is in a separate function. This makes your hook_views_default_views() more readable.</para><para>NOTE: Currently assumes all tables not in the tripal views integration tables are Drupal tables.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$view</parametername>
</parameternamelist>
<parameterdescription>
<para>The default view definition object </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The default view with all relationships, fields, filters, sorts, arguments for Drupal tables removed. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="199" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="199" bodyend="250"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga849a1e201fc0c834c6119510789dd935" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_rebuild_views_integrations</definition>
        <argsstring>($delete_first=FALSE)</argsstring>
        <name>tripal_rebuild_views_integrations</name>
        <param>
          <declname>$delete_first</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Rebuilds all the default integrations.</para><para>This essentially clears the cache in case you mess up the integrations in your site. This should not be used during module development since it really only rebuilds the integrations described by all enabled modules in the site and if $delete_first is TRUE it can delete custom integrations created by site administrators which will not make your module popular.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$delete_first</parametername>
</parameternamelist>
<parameterdescription>
<para>If TRUE then all integrations are first deleted. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="422" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="422" bodyend="433"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga0e5c638ab20cf9f5b237fda2dcc0e2c9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_remove_join_from_views_integration</definition>
        <argsstring>($setup_id, $base_table, $base_field, $left_table, $left_field)</argsstring>
        <name>tripal_remove_join_from_views_integration</name>
        <param>
          <declname>$setup_id</declname>
        </param>
        <param>
          <declname>$base_table</declname>
        </param>
        <param>
          <declname>$base_field</declname>
        </param>
        <param>
          <declname>$left_table</declname>
        </param>
        <param>
          <declname>$left_field</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Remove a join from an integration. This is usually done after cloning an existing integration using <ref refid="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" kindref="member">tripal_clone_views_integration()</ref>.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$setup_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The setup_id of the integration to delete the join from. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$base_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the base table involved the join. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$base_field</parametername>
</parameternamelist>
<parameterdescription>
<para>The field from the base table involved in the join. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$left_table</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the other table involved in the join </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$left_field</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the field from the other table involved in the join. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="1161" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="1161" bodyend="1172"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga619d2ae668ce597642d7ebf59272cda2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_remove_views_integration</definition>
        <argsstring>($identifiers, $options=array())</argsstring>
        <name>tripal_remove_views_integration</name>
        <param>
          <declname>$identifiers</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Removes a View Integration Entry when you only know the table the integration was created for and the priority.</para><para>This should only be used to remove integrations created by your own module (possibly on uninstall of your module). To override existing integrations simply create your own integration with a lighter priority using <ref refid="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" kindref="member">tripal_clone_views_integration()</ref> or <ref refid="d1/d5e/group__tripal__chado__views__api_1ga17fc7a59376724fb261bf15bd1b9db1b" kindref="member">tripal_export_views_integration()</ref> to create a template.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$identifies</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of identifiers where the keys indicate what the identifier is. One of the following compinations must be present: 1) table_name &amp; priority: the name of the table &amp; the priority to remove a views integration entry for. 2) setup_id: the setup_id of the entry to remove. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of options, currently none are supported.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE on Success; FALSE otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="796" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="796" bodyend="829"/>
      </memberdef>
      <memberdef kind="function" id="d1/d5e/group__tripal__chado__views__api_1ga21424d1f60c2ae70453c514f31ee2cf9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_update_views_integration</definition>
        <argsstring>($setup_id, $defn_array)</argsstring>
        <name>tripal_update_views_integration</name>
        <param>
          <declname>$setup_id</declname>
        </param>
        <param>
          <declname>$defn_array</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Update an existing Views Intregration Entry. This essentially removes and then re-adds the integration.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$setup_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The setup ID of the views integration entry to update </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$defn_array</parametername>
</parameternamelist>
<parameterdescription>
<para>An array describing the structure and fields of the table as is used in <ref refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" kindref="member">tripal_add_views_integration()</ref>. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado_views/api/tripal_chado_views.api.inc" line="843" column="1" bodyfile="tripal_chado_views/api/tripal_chado_views.api.inc" bodystart="843" bodyend="849"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides API functions that support direct integration of Chado tables with Drupal Views. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="65" refid="d1/d5e/group__tripal__chado__views__api_1ga275071d80e77c7188c41d456cc0cbdbd" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga275071d80e77c7188c41d456cc0cbdbd" kindref="member">tripal_enable_view</ref>($view_name,<sp/>$redirect_link<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>$status<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;views_defaults&apos;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($status[$view_name]))<sp/>{</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>$status[$view_name]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/>variable_set(</highlight><highlight class="stringliteral">&apos;views_defaults&apos;</highlight><highlight class="normal">,<sp/>$status);</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Successfully<sp/>Enabled<sp/>$view_name&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Unable<sp/>to<sp/>find<sp/>a<sp/>view<sp/>by<sp/>the<sp/>name<sp/>of<sp/>&apos;$view_name&apos;.<sp/>Unable<sp/>to<sp/>enable<sp/>this<sp/>view.&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;notice&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($redirect_link)<sp/>{</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_goto($redirect_link);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="79"><highlight class="normal">}</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="127" refid="d1/d5e/group__tripal__chado__views__api_1ga57f341c0e2987ba11338a2d66493cc2c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga57f341c0e2987ba11338a2d66493cc2c" kindref="member">tripal_disable_view</ref>($view_name,<sp/>$redirect_link<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="128"><highlight class="normal"></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/>$status<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;views_defaults&apos;</highlight><highlight class="normal">,<sp/>array());</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($status[$view_name]))<sp/>{</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>$status[$view_name]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/>variable_set(</highlight><highlight class="stringliteral">&apos;views_defaults&apos;</highlight><highlight class="normal">,<sp/>$status);</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Disabled<sp/>$view_name&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&quot;Unable<sp/>to<sp/>find<sp/>a<sp/>view<sp/>by<sp/>the<sp/>name<sp/>of<sp/>&apos;$view_name&apos;.<sp/>Unable<sp/>to<sp/>disable<sp/>this<sp/>view.&quot;</highlight><highlight class="normal">,</highlight><highlight class="stringliteral">&apos;notice&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($redirect_link)<sp/>{</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_goto($redirect_link);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal">}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="199" refid="d1/d5e/group__tripal__chado__views__api_1gac1075d1878a59f2518b3bb3fdf13b227" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gac1075d1878a59f2518b3bb3fdf13b227" kindref="member">tripal_make_view_compatible_with_external</ref>($view)<sp/>{</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>$remove_table<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>check<sp/>that<sp/>the<sp/>base<sp/>table<sp/>for<sp/>the<sp/>view<sp/>is<sp/>a<sp/>chado<sp/>table</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it&apos;s<sp/>not<sp/>then<sp/>don&apos;t<sp/>do<sp/>any<sp/>filtering.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga24a91d667b61d5e0d084971fea344765" kindref="member">tripal_is_table_integrated</ref>($view-&gt;base_table);</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$setup_id)<sp/>{</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$view;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>IF<sp/>chado<sp/>is<sp/>external<sp/>then<sp/>remove<sp/>all<sp/>config<sp/>relating<sp/>to<sp/>drupal<sp/>tables.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/>$is_local<sp/>=<sp/>isset($GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_is_local&quot;</highlight><highlight class="normal">])<sp/>&amp;&amp;<sp/>$GLOBALS[</highlight><highlight class="stringliteral">&quot;chado_is_local&quot;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_local)<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>all<sp/>displays.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($view-&gt;display<sp/>as<sp/>$display_name<sp/>=&gt;<sp/>$display)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$display_options<sp/>=<sp/>$display-&gt;handler-&gt;display-&gt;display_options;</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sections<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;filters&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sorts&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;relationships&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($sections<sp/>as<sp/>$section)<sp/>{</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$display_options[$section]<sp/>=<sp/>(isset($display_options[$section]))<sp/>?<sp/>$display_options[$section]<sp/>:<sp/>array();</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($display_options[$section]<sp/>as<sp/>$key<sp/>=&gt;<sp/>$defn)<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>table<sp/>has<sp/>not<sp/>already<sp/>been<sp/>encountered;<sp/>check<sp/>if<sp/>it&apos;s<sp/>in<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>tripal_views.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($remove_table[<sp/>$defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>]))<sp/>{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>table<sp/>is<sp/>view<sp/>then<sp/>this<sp/>is<sp/>a<sp/>general<sp/>handler;<sp/>thus<sp/>keep.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;views&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$remove_table[<sp/>$defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>table<sp/>is<sp/>integrated<sp/>then<sp/>it<sp/>is<sp/>chado;<sp/>thus<sp/>keep.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga24a91d667b61d5e0d084971fea344765" kindref="member">tripal_is_table_integrated</ref>($defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup_id)<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$remove_table[<sp/>$defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>]<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$remove_table[<sp/>$defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Based<sp/>on<sp/>the<sp/>$remove_table<sp/>array,<sp/>unset<sp/>this<sp/>field<sp/>if<sp/>its<sp/>from<sp/>a<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>drupal<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($remove_table[<sp/>$defn[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>])<sp/>{</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unset($view-&gt;display[$display_name]-&gt;handler-&gt;display-&gt;display_options[$section][$key]);</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$view;</highlight></codeline>
<codeline lineno="250"><highlight class="normal">}</highlight></codeline>
<codeline lineno="267" refid="d1/d5e/group__tripal__chado__views__api_1ga5ab71a5934907e7e734b00c4ff99d86c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga5ab71a5934907e7e734b00c4ff99d86c" kindref="member">tripal_get_lightest_views_integration_priority</ref>($table_name)<sp/>{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>priority<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>ORDER<sp/>BY<sp/>priority<sp/>ASC&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/>$setup<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name));</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/>$setup<sp/>=<sp/>$setup-&gt;fetchObject();</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup)<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$setup-&gt;priority;</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Default<sp/>priority<sp/>is<sp/>10.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>10;</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="280"><highlight class="normal">}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight></codeline>
<codeline lineno="299" refid="d1/d5e/group__tripal__chado__views__api_1ga10c681ac5f993cc7ee39f44dc06c97e5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga10c681ac5f993cc7ee39f44dc06c97e5" kindref="member">tripal_get_lightest_views_integration_setup</ref>($table_name)<sp/>{</highlight></codeline>
<codeline lineno="300"><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>ORDER<sp/>BY<sp/>priority<sp/>ASC&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/>$setup<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name));</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/>$setup<sp/>=<sp/>$setup-&gt;fetchObject();</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup)<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$setup-&gt;setup_id;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="311"><highlight class="normal">}</highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight></codeline>
<codeline lineno="329" refid="d1/d5e/group__tripal__chado__views__api_1ga949b536e6f05b032bf37b229c0896c48" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga949b536e6f05b032bf37b229c0896c48" kindref="member">tripal_get_views_integration_setup_id</ref>($table_name,<sp/>$priority)<sp/>{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority<sp/>ORDER<sp/>BY<sp/>priority<sp/>ASC&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/>$setup<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,<sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$priority));</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/>$setup<sp/>=<sp/>$setup-&gt;fetchObject();</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup)<sp/>{</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$setup-&gt;setup_id;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="341"><highlight class="normal">}</highlight></codeline>
<codeline lineno="342"><highlight class="normal"></highlight></codeline>
<codeline lineno="360" refid="d1/d5e/group__tripal__chado__views__api_1ga24a91d667b61d5e0d084971fea344765" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga24a91d667b61d5e0d084971fea344765" kindref="member">tripal_is_table_integrated</ref>($table_name,<sp/>$priority<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($priority)<sp/>{</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>$setup<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,<sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$priority));</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/>$setup<sp/>=<sp/>$setup-&gt;fetchObject();</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>ORDER<sp/>BY<sp/>priority<sp/>ASC&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/>$setup<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name));</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/>$setup<sp/>=<sp/>$setup-&gt;fetchObject();</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup)<sp/>{</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$setup-&gt;setup_id;</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="380"><highlight class="normal">}</highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="396" refid="d1/d5e/group__tripal__chado__views__api_1gac7d08f36291e444ac2b56a650c2b0131" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gac7d08f36291e444ac2b56a650c2b0131" kindref="member">tripal_is_lightest_priority_setup</ref>($setup_id,<sp/>$table_name)<sp/>{</highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/>$lightest_priority_setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga10c681ac5f993cc7ee39f44dc06c97e5" kindref="member">tripal_get_lightest_views_integration_setup</ref>($table_name);</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($lightest_priority_setup_id<sp/>==<sp/>$setup_id)<sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal">}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="422" refid="d1/d5e/group__tripal__chado__views__api_1ga849a1e201fc0c834c6119510789dd935" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga849a1e201fc0c834c6119510789dd935" kindref="member">tripal_rebuild_views_integrations</ref>($delete_first<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($delete_first)<sp/>{</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d3/d88/tripal__chado__views__integration_8inc_1a646283e8101ca7c9aba3f250b384d046" kindref="member">tripal_chado_views_delete_all_integrations</ref>();</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><ref refid="d3/d88/tripal__chado__views__integration_8inc_1ab27ca94ea5edb6d80eb28dcb16a311b2" kindref="member">tripal_chado_views_integrate_all_chado_tables</ref>();</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>the<sp/>function<sp/>above<sp/>should<sp/>have<sp/>a<sp/>return<sp/>value<sp/>from<sp/>which<sp/>we<sp/>can</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>determine<sp/>if<sp/>the<sp/>message<sp/>below<sp/>is<sp/>approprite.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Successfully<sp/>rebuilt<sp/>default<sp/>Chado<sp/>Views<sp/>Integrations&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="433"><highlight class="normal">}</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="496" refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" kindref="member">tripal_add_views_integration</ref>($defn_array,<sp/>$setup_id<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/>$no_errors<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_views&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&apos;Recieved<sp/>integration<sp/>with<sp/>no<sp/>tablename:<sp/>%defn&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%defn&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($defn_array,TRUE)));</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$no_errors;</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>insert<sp/>into<sp/>tripal_views.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/>$view_record<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;table_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;comment&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup_id)<sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/>$view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$setup_id;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($defn_array[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;mview&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/>$mview<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>mview_id<sp/>FROM<sp/>{tripal_mviews}<sp/>WHERE<sp/>mv_table=:table&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/>$mview<sp/>=<sp/>$mview-&gt;fetchObject();</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/>$view_record[</highlight><highlight class="stringliteral">&apos;mview_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$mview-&gt;mview_id;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$mview-&gt;mview_id)<sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($view_record[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])<sp/>{<sp/></highlight><highlight class="comment">//<sp/>&amp;&amp;<sp/>$view_record[&apos;comment&apos;])<sp/>{<sp/><sp/>#<sp/>SPF:<sp/>commented<sp/>out<sp/>9/24/2012<sp/>..<sp/>It&apos;s<sp/>not<sp/>required<sp/>on<sp/>the<sp/>form</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($defn_array[</highlight><highlight class="stringliteral">&apos;additional_content&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$setup<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$view_record[</highlight><highlight class="stringliteral">&apos;table_name&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$view_record[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$setup<sp/>=<sp/>$setup-&gt;fetchObject();</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($setup-&gt;setup_id))<sp/>{</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views&apos;</highlight><highlight class="normal">,<sp/>$view_record);</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$setup-&gt;setup_id;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views&apos;</highlight><highlight class="normal">,<sp/>$view_record,<sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views&apos;</highlight><highlight class="normal">,<sp/>$view_record);</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>&quot;%table&quot;<sp/>table<sp/>due<sp/>to<sp/>a<sp/>missing<sp/>name<sp/>field.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($status)<sp/>{</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Need<sp/>to<sp/>update<sp/>the<sp/>tripal_views<sp/>record<sp/>so<sp/>base_table<sp/>can<sp/>be<sp/>false</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>is<sp/>a<sp/>fix<sp/>because<sp/>drupal_write_record()<sp/>puts<sp/>in<sp/>defaults<sp/>if<sp/>!isset()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>a<sp/>variable<sp/>is<sp/>considered<sp/>not<sp/>set<sp/>if<sp/>it&apos;s<sp/>null!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;UPDATE<sp/>{tripal_views}<sp/>SET<sp/>base_table=:base<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:base&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>Field<sp/>Definitions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($defn_array[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$key<sp/>=&gt;<sp/>$field)<sp/>{</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>some<sp/>defaults.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$key;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;text&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>:<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($field[</highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$field[</highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal">]<sp/>:<sp/>array(</highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;views_handler_field&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>the<sp/>field<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($defn_array[</highlight><highlight class="stringliteral">&apos;additional_content&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$is_present<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>true<sp/>as<sp/>present<sp/>FROM<sp/>{tripal_views_field}<sp/>WHERE<sp/>column_name=:column<sp/>AND<sp/>setup_id=:setup&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:column&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>[</highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$is_present<sp/>=<sp/>$is_present-&gt;fetchField();</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_present)<sp/>{</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_field&apos;</highlight><highlight class="normal">,<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_field&apos;</highlight><highlight class="normal">,<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>,<sp/>array(</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_field&apos;</highlight><highlight class="normal">,<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>);</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>%name<sp/>field<sp/>due<sp/>to<sp/>missing<sp/>required<sp/>fields.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="607"><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($status)<sp/>{</highlight></codeline>
<codeline lineno="609"><highlight class="normal"></highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>Handler<sp/>Definitions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($field[</highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$handler_type<sp/>=&gt;<sp/>$handler)<sp/>{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$handler_record<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;handler_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler_type,</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;handler_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($handler)</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$handler_type<sp/>&amp;&amp;<sp/>$handler[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$handler)<sp/>{</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_handlers&apos;</highlight><highlight class="normal">,<sp/>$handler_record);</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$status)<sp/>{</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>%handler_type<sp/>handler:<sp/>%handler_name&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%handler_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler_type,<sp/></highlight><highlight class="stringliteral">&apos;%handler_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="630"><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>Joins</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note:<sp/>The<sp/>new<sp/>defn_array<sp/>structure<sp/>accounts<sp/>for<sp/>1+<sp/>joins<sp/>to<sp/>the<sp/>same</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>table<sp/>(ie:<sp/>feature_relationship<sp/>=&gt;<sp/>feature<sp/>:<sp/>subject_id<sp/>&amp;<sp/>object_id)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>by<sp/>making<sp/>$field[&apos;joins&apos;]<sp/>an<sp/>array<sp/>of<sp/>left_field<sp/>keys.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($field[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($field[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$joins)<sp/>{</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>keep<sp/>backwards<sp/>compatibility<sp/>with<sp/>the<sp/>old<sp/>defn_array<sp/>which<sp/>just</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>jumped<sp/>right<sp/>into<sp/>the<sp/>table<sp/>definition<sp/>allowing<sp/>only<sp/>a<sp/>single<sp/>join,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>need<sp/>to<sp/>check<sp/>for<sp/>old<sp/>defn_arrays<sp/>and<sp/>transform<sp/>them<sp/>into<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>new<sp/>format.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($joins[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$left_field<sp/>=<sp/>$joins[</highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$joins<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$left_field<sp/>=&gt;<sp/>$joins</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="649"><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Loop<sp/>on<sp/>left<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($joins<sp/>as<sp/>$left_field<sp/>=&gt;<sp/>$join)<sp/>{</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;left_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$join[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;left_field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$left_field,</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(!empty($join[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$join[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;views_join&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record[</highlight><highlight class="stringliteral">&apos;relationship_handler&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(!empty($join[</highlight><highlight class="stringliteral">&apos;relationship_handler&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$join[</highlight><highlight class="stringliteral">&apos;relationship_handler&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;views_handler_relationship&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record[</highlight><highlight class="stringliteral">&apos;relationship_only&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(!empty($join[</highlight><highlight class="stringliteral">&apos;relationship_only&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$join[</highlight><highlight class="stringliteral">&apos;relationship_only&apos;</highlight><highlight class="normal">]<sp/>:<sp/>0;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($view_record[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$join[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$left_field)<sp/>{</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_join&apos;</highlight><highlight class="normal">,<sp/>$join_record);</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="668"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$status)<sp/>{</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t(</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>join<sp/>%left_table.%left_field<sp/>with<sp/>%table.%field&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%left_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$join[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%left_field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$left_field,</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>%field_name<sp/>field&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%field_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>set<sp/>default<sp/>tripal<sp/>views<sp/>integration&apos;</highlight><highlight class="normal">),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$no_errors;</highlight></codeline>
<codeline lineno="702"><highlight class="normal">}</highlight></codeline>
<codeline lineno="703"><highlight class="normal"></highlight></codeline>
<codeline lineno="722" refid="d1/d5e/group__tripal__chado__views__api_1ga17fc7a59376724fb261bf15bd1b9db1b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga17fc7a59376724fb261bf15bd1b9db1b" kindref="member">tripal_export_views_integration</ref>($setup_id)<sp/>{</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Main<sp/>setup<sp/>details</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/>$r<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>setup_id=:setup&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id));</highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/>$r<sp/>=<sp/>$r-&gt;fetchObject();</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/>$defn_array<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;table_name,</highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;name,</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>($r-&gt;mview_id)<sp/>?<sp/></highlight><highlight class="stringliteral">&apos;mview&apos;</highlight><highlight class="normal"><sp/>:<sp/></highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;comment,</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;priority,</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;base_table,</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/>$resource<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_views_field}<sp/>WHERE<sp/>setup_id=:setup&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id));</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($resource<sp/>as<sp/>$r)<sp/>{</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][<sp/>$r-&gt;column_name<sp/>]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;column_name,</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;name,</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;description,</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;type,</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(),</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array()</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="750"><highlight class="normal"></highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>handlers.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/>$resource<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_views_handlers}<sp/>WHERE<sp/>setup_id=:setup&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id));</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($resource<sp/>as<sp/>$r)<sp/>{</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][<sp/>$r-&gt;column_name<sp/>][</highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal">][<sp/>$r-&gt;handler_type<sp/>]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;handler_name</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"></highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>joins.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/>$resource<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_views_join}<sp/>WHERE<sp/>setup_id=:setup&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id));</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($resource<sp/>as<sp/>$r)<sp/>{</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;fields&apos;</highlight><highlight class="normal">][<sp/>$r-&gt;base_field<sp/>][</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">][<sp/>$r-&gt;left_table<sp/>][<sp/>$r-&gt;left_field<sp/>]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;left_table,</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;left_field,</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$r-&gt;handler,</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$defn_array;</highlight></codeline>
<codeline lineno="770"><highlight class="normal">}</highlight></codeline>
<codeline lineno="771"><highlight class="normal"></highlight></codeline>
<codeline lineno="796" refid="d1/d5e/group__tripal__chado__views__api_1ga619d2ae668ce597642d7ebf59272cda2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga619d2ae668ce597642d7ebf59272cda2" kindref="member">tripal_remove_views_integration</ref>($identifiers,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="797"><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>views<sp/>integration<sp/>using<sp/>the<sp/>table_name/priority<sp/>combo.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;table_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/>$table_name<sp/>=<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;table_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/>$priority<sp/>=<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/>$views<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$priority</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>$views<sp/>=<sp/>$views-&gt;fetchObject();</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($views-&gt;setup_id)<sp/>{</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$views-&gt;setup_id;</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="814"><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="816"><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>views<sp/>integration<sp/>using<sp/>the<sp/>setup_id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="819"><highlight class="normal"></highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&apos;DELETE<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>setup_id=:setup&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&apos;DELETE<sp/>FROM<sp/>{tripal_views_field}<sp/>WHERE<sp/>setup_id=:setup&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&apos;DELETE<sp/>FROM<sp/>{tripal_views_handlers}<sp/>WHERE<sp/>setup_id=:setup&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&apos;DELETE<sp/>FROM<sp/>{tripal_views_join}<sp/>WHERE<sp/>setup_id=:setup&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="824"><highlight class="normal"></highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="829"><highlight class="normal">}</highlight></codeline>
<codeline lineno="830"><highlight class="normal"></highlight></codeline>
<codeline lineno="843" refid="d1/d5e/group__tripal__chado__views__api_1ga21424d1f60c2ae70453c514f31ee2cf9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga21424d1f60c2ae70453c514f31ee2cf9" kindref="member">tripal_update_views_integration</ref>($setup_id,<sp/>$defn_array)<sp/>{</highlight></codeline>
<codeline lineno="844"><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"><sp/><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga619d2ae668ce597642d7ebf59272cda2" kindref="member">tripal_remove_views_integration</ref>(array(</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id));</highlight></codeline>
<codeline lineno="846"><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"><sp/><sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;additional_content&apos;</highlight><highlight class="normal">]<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="848"><highlight class="normal"><sp/><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" kindref="member">tripal_add_views_integration</ref>($defn_array,<sp/>$setup_id);</highlight></codeline>
<codeline lineno="849"><highlight class="normal">}</highlight></codeline>
<codeline lineno="850"><highlight class="normal"></highlight></codeline>
<codeline lineno="869" refid="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" kindref="member">tripal_clone_views_integration</ref>($table_name,<sp/>$new_priority<sp/>=<sp/>NULL,<sp/>$template_priority<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="870"><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($template_priority))<sp/>{</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/>$template_setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga10c681ac5f993cc7ee39f44dc06c97e5" kindref="member">tripal_get_lightest_views_integration_setup</ref>($table_name);</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/>$template_setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga949b536e6f05b032bf37b229c0896c48" kindref="member">tripal_get_views_integration_setup_id</ref>($table_name,<sp/>$template_priority);</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="877"><highlight class="normal"></highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/>$defn_array<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga17fc7a59376724fb261bf15bd1b9db1b" kindref="member">tripal_export_views_integration</ref>($template_setup_id);</highlight></codeline>
<codeline lineno="879"><highlight class="normal"></highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($new_priority))<sp/>{</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$new_priority;</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/>$new_priority<sp/>=<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">]<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">]<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="887"><highlight class="normal"></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gad30e8fd9ff4c54293177951877f7effa" kindref="member">tripal_add_views_integration</ref>($defn_array);</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="891"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,</highlight></codeline>
<codeline lineno="893"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$new_priority</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="895"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/>$setup_id-&gt;fetchField();</highlight></codeline>
<codeline lineno="897"><highlight class="normal"></highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($setup_id))<sp/>{</highlight></codeline>
<codeline lineno="899"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_views&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>clone<sp/>the<sp/>setup<sp/>for<sp/>%table<sp/>in<sp/>order<sp/>to<sp/>add<sp/>the<sp/>following<sp/>field<sp/>to<sp/>the<sp/>integration:<sp/>%field.&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,<sp/></highlight><highlight class="stringliteral">&apos;%field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($field_array,TRUE)));</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="902"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$setup_id;</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="906"><highlight class="normal"></highlight></codeline>
<codeline lineno="907"><highlight class="normal">}</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight></codeline>
<codeline lineno="931" refid="d1/d5e/group__tripal__chado__views__api_1ga79f1499793641ca5ade8a0ff12cf03a6" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga79f1499793641ca5ade8a0ff12cf03a6" kindref="member">tripal_add_field_to_views_integration</ref>($table_name,<sp/>$priority,<sp/>$field)<sp/>{</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/>$no_errors<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="933"><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>no<sp/>priority<sp/>is<sp/>supplied<sp/>then<sp/>add<sp/>the<sp/>field<sp/>to<sp/>the<sp/>lightest<sp/>integration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($priority))<sp/>{</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/>$priority<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga5ab71a5934907e7e734b00c4ff99d86c" kindref="member">tripal_get_lightest_views_integration_priority</ref>($table_name);</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="938"><highlight class="normal"></highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>get<sp/>the<sp/>setup_id</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$priority</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/>$setup_id-&gt;fetchObject();</highlight></codeline>
<codeline lineno="949"><highlight class="normal"></highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>isn&apos;t<sp/>an<sp/>integration<sp/>matching<sp/>that<sp/>table/priority<sp/>combination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>clone<sp/>the<sp/>lightest<sp/>priority<sp/>integration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($setup_id))<sp/>{</highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/><sp/><sp/>$setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" kindref="member">tripal_clone_views_integration</ref>($table_name,<sp/>$priority);</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="955"><highlight class="normal"></highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>delete<sp/>any<sp/>existing<sp/>field</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_views_field}<sp/>WHERE<sp/>setup_id=:setup<sp/>AND<sp/>column_name=:column&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,<sp/></highlight><highlight class="stringliteral">&apos;column&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_views_handlers}<sp/>WHERE<sp/>setup_id=:setup<sp/>AND<sp/>column_name=:column&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,<sp/></highlight><highlight class="stringliteral">&apos;column&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/>db_query(</highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_views_join}<sp/>WHERE<sp/>setup_id=:setup<sp/>AND<sp/>base_table=:table<sp/>AND<sp/>base_field=:field&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,<sp/></highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,<sp/></highlight><highlight class="stringliteral">&apos;:field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>we<sp/>need<sp/>to<sp/>add/update<sp/>the<sp/>field.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup_id<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;title&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;description&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;type&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($defn_array[</highlight><highlight class="stringliteral">&apos;additional_content&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>D7<sp/>TODO:<sp/>Check<sp/>DBTNG<sp/>changes<sp/>work.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>true<sp/>as<sp/>present<sp/>FROM<sp/>{tripal_views_field}<sp/>WHERE<sp/>column_name=:column<sp/>AND<sp/>setup_id=:setup&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:column&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>[</highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal">],<sp/></highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is<sp/>=<sp/>$is-&gt;fetchObject();</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is-&gt;present)<sp/>{</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_field&apos;</highlight><highlight class="normal">,<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>);</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_field&apos;</highlight><highlight class="normal">,<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>,<sp/>array(</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_field&apos;</highlight><highlight class="normal">,<sp/><ref refid="d8/d21/tripal__bulk__loader__modify__template__base__form__fields_8tpl_8php_1af5c17c0aab1cbc7599938863dde25a8a" kindref="member">$field_record</ref>);</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>%name<sp/>field<sp/>due<sp/>to<sp/>missing<sp/>required<sp/>fields.&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="998"><highlight class="normal"></highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($status)<sp/>{</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight></codeline>
<codeline lineno="1001"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>Handler<sp/>Definitions.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($field[</highlight><highlight class="stringliteral">&apos;handlers&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$handler_type<sp/>=&gt;<sp/>$handler)<sp/>{</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$handler_record<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;column_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;handler_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler_type,</highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;handler_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>serialize($handler)</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup_id<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$handler_type<sp/>&amp;&amp;<sp/>$handler[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$handler)<sp/>{</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_handlers&apos;</highlight><highlight class="normal">,<sp/>$handler_record);</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$status)<sp/>{</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>%handler_type<sp/>handler:<sp/>%handler_name&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%handler_type&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler_type,<sp/></highlight><highlight class="stringliteral">&apos;%handler_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$handler[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"></highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>Joins</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note:<sp/>The<sp/>new<sp/>defn_array<sp/>structure<sp/>accounts<sp/>for<sp/>1+<sp/>joins<sp/>to<sp/>the<sp/>same</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>table<sp/>(ie:<sp/>feature_relationship<sp/>=&gt;<sp/>feature<sp/>:<sp/>subject_id<sp/>&amp;<sp/>object_id)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>by<sp/>making<sp/>$field[&apos;joins&apos;]<sp/>an<sp/>array<sp/>of<sp/>left_field<sp/>keys.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($field[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$field[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($field[</highlight><highlight class="stringliteral">&apos;joins&apos;</highlight><highlight class="normal">]<sp/>as<sp/>$joins)<sp/>{</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>To<sp/>keep<sp/>backwards<sp/>compatibility<sp/>with<sp/>the<sp/>old<sp/>defn_array<sp/>which<sp/>just</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>jumped<sp/>right<sp/>into<sp/>the<sp/>table<sp/>definition<sp/>allowing<sp/>only<sp/>a<sp/>single<sp/>join,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>need<sp/>to<sp/>check<sp/>for<sp/>old<sp/>defn_arrays<sp/>and<sp/>transform<sp/>them<sp/>into<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>new<sp/>format.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($joins[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$left_field<sp/>=<sp/>$joins[</highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$joins<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$left_field<sp/>=&gt;<sp/>$joins</highlight></codeline>
<codeline lineno="1038"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1039"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1040"><highlight class="normal"></highlight></codeline>
<codeline lineno="1041"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Loop<sp/>on<sp/>left<sp/>fields.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1042"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($joins<sp/>as<sp/>$left_field<sp/>=&gt;<sp/>$join)<sp/>{</highlight></codeline>
<codeline lineno="1043"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1044"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,</highlight></codeline>
<codeline lineno="1045"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;base_field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;left_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$join[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;left_field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$join[</highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"></highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($join[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$join[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$join_record[</highlight><highlight class="stringliteral">&apos;handler&apos;</highlight><highlight class="normal">]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;views_join&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"></highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($setup_id<sp/>&amp;&amp;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$join[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">]<sp/>&amp;&amp;<sp/>$join[</highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_join&apos;</highlight><highlight class="normal">,<sp/>$join_record);</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$status)<sp/>{</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t(</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>join<sp/>%left_table.%left_field<sp/>with<sp/>%table.%field&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%left_table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$join[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%left_field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$join[</highlight><highlight class="stringliteral">&apos;field&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$defn_array[</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>integrate<sp/>%field_name<sp/>field&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%field_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$field[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>$no_errors<sp/>=<sp/>FALSE;</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$no_errors;</highlight></codeline>
<codeline lineno="1089"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"></highlight></codeline>
<codeline lineno="1114" refid="d1/d5e/group__tripal__chado__views__api_1gae2ec4020a1bb71f8092b3501af63dc6a" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gae2ec4020a1bb71f8092b3501af63dc6a" kindref="member">tripal_add_join_to_views_integration</ref>($table_name,<sp/>$priority,<sp/>$join)<sp/>{</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/>$no_errors<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>no<sp/>priority<sp/>is<sp/>supplied<sp/>then<sp/>add<sp/>the<sp/>field<sp/>to<sp/>the<sp/>lightest<sp/>integration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($priority))<sp/>{</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/>$priority<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga5ab71a5934907e7e734b00c4ff99d86c" kindref="member">tripal_get_lightest_views_integration_priority</ref>($table_name);</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"></highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>get<sp/>the<sp/>setup_id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>setup_id<sp/>FROM<sp/>{tripal_views}<sp/>WHERE<sp/>table_name=:table<sp/>AND<sp/>priority=:priority&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$table_name,</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$priority</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/>$setup_id<sp/>=<sp/>$setup_id-&gt;fetchField();</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"></highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>there<sp/>isn&apos;t<sp/>an<sp/>integration<sp/>matching<sp/>that<sp/>table/priority<sp/>combination</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>clone<sp/>the<sp/>lightest<sp/>priority<sp/>integration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($setup_id))<sp/>{</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/>$setup_id<sp/>=<sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1gafc8bd407a6b80aaf35f69f04c26e0334" kindref="member">tripal_clone_views_integration</ref>($table_name,<sp/>$priority);</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>setup_id<sp/>to<sp/>the<sp/>join<sp/>record<sp/>passed<sp/>in</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/>$join[</highlight><highlight class="stringliteral">&apos;setup_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$setup_id;</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"></highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_views_join&apos;</highlight><highlight class="normal">,<sp/>$join);</highlight></codeline>
<codeline lineno="1142"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"></highlight></codeline>
<codeline lineno="1161" refid="d1/d5e/group__tripal__chado__views__api_1ga0e5c638ab20cf9f5b237fda2dcc0e2c9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d1/d5e/group__tripal__chado__views__api_1ga0e5c638ab20cf9f5b237fda2dcc0e2c9" kindref="member">tripal_remove_join_from_views_integration</ref>($setup_id,<sp/>$base_table,<sp/>$base_field,<sp/>$left_table,<sp/>$left_field)<sp/>{</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/>db_query(</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;DELETE<sp/>FROM<sp/>{tripal_views_join}<sp/>WHERE<sp/>setup_id=:setup<sp/>AND<sp/>base_table=:base-table<sp/>AND<sp/>base_field=:base-field<sp/>AND<sp/>left_table=:left-table<sp/>AND<sp/>left_field=:left-field&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:setup&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$setup_id,</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:base-table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$base_table,</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:base-field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$base_field,</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:left-table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$left_table,</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:left-field&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$left_field</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1172"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado_views/api/tripal_chado_views.api.inc"/>
  </compounddef>
</doxygen>
