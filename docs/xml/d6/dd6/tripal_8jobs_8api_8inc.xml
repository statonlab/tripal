<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d6/dd6/tripal_8jobs_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal.jobs.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_add_job</definition>
        <argsstring>($job_name, $modulename, $callback, $arguments, $uid, $priority=10, $includes=array(), $ignore_duplicate=FALSE)</argsstring>
        <name>tripal_add_job</name>
        <param>
          <declname>$job_name</declname>
        </param>
        <param>
          <declname>$modulename</declname>
        </param>
        <param>
          <declname>$callback</declname>
        </param>
        <param>
          <declname>$arguments</declname>
        </param>
        <param>
          <declname>$uid</declname>
        </param>
        <param>
          <declname>$priority</declname>
          <defval>10</defval>
        </param>
        <param>
          <declname>$includes</declname>
          <defval>array()</defval>
        </param>
        <param>
          <declname>$ignore_duplicate</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Adds a job to the Tripal Job queue</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_name</parametername>
</parameternamelist>
<parameterdescription>
<para>The human readable name for the job </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$modulename</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the module adding the job </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$callback</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of a function to be called when the job is executed </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$arguments</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of arguments to be passed on to the callback </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$uid</parametername>
</parameternamelist>
<parameterdescription>
<para>The uid of the user adding the job </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$priority</parametername>
</parameternamelist>
<parameterdescription>
<para>The priority at which to run the job where the highest priority is 10 and the lowest priority is 1. The default priority is 10. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$includes</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of paths to files that should be included in order to execute the job. Use the module_load_include function to get a path for a given file. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$ignore_duplicate.</parametername>
</parameternamelist>
<parameterdescription>
<para>Set to TRUE to not add the job if it has the same name as another job which has not yet run. The default is TRUE.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The job_id of the registered job, or FALSE on failure.</para></simplesect>
Example usage:</para><para><programlisting><codeline><highlight class="normal">$args<sp/>=<sp/>array($dfile,<sp/>$organism_id,<sp/>$type,<sp/>$library_id,<sp/>$re_name,<sp/>$re_uname,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$re_accession,<sp/>$db_id,<sp/>$rel_type,<sp/>$re_subject,<sp/>$parent_type,<sp/>$method,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$user-&gt;uid,<sp/>$analysis_id,<sp/>$match_type);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">$includes<sp/>=<sp/>array()</highlight></codeline>
<codeline><highlight class="normal">$includes[]<sp/>=<sp/>module_load_include(&apos;inc&apos;,<sp/>&apos;tripal_chado&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;includes/loaders/tripal_chado.fasta_loader&apos;);</highlight></codeline>
<codeline></codeline>
<codeline><highlight class="normal">tripal_add_job(&quot;Import<sp/>FASTA<sp/>file:<sp/>$dfile&quot;,<sp/>&apos;tripal_feature&apos;,</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/>&apos;tripal_feature_load_fasta&apos;,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
</programlisting></para><para>The code above is copied from the tripal_feature/fasta_loader.php file. The snipped first builds an array of arguments that will then be passed to the tripal_add_job function. The number of arguments provided in the $arguments variable should match the argument set for the callback function provided as the third argument. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="78" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="78" bodyend="122"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga7d1baa38344008ac242385fbabca10c5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_cancel_job</definition>
        <argsstring>($job_id, $redirect=TRUE)</argsstring>
        <name>tripal_cancel_job</name>
        <param>
          <declname>$job_id</declname>
        </param>
        <param>
          <declname>$redirect</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Cancel a Tripal Job currently waiting in the job queue.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The job_id of the job to be cancelled</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>FALSE if the an error occured or the job could not be canceled, TRUE otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="303" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="303" bodyend="325"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga4228960dcf9f37b7db8c773aca9ac3c2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_execute_job</definition>
        <argsstring>($job_id, $redirect=TRUE)</argsstring>
        <name>tripal_execute_job</name>
        <param>
          <declname>$job_id</declname>
        </param>
        <param>
          <declname>$redirect</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Execute a specific Tripal Job.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The job id to be exeuted. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametertype>bool</parametertype>
<parametername>$redirect</parametername>
</parameternamelist>
<parameterdescription>
<para>[optional] Whether to redirect to the job page or not. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="553" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="553" bodyend="570"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga9dfd4a60577476458f57f3da139f6f05" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_active_jobs</definition>
        <argsstring>($modulename=NULL)</argsstring>
        <name>tripal_get_active_jobs</name>
        <param>
          <declname>$modulename</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Returns a list of jobs that are active.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$modulename</parametername>
</parameternamelist>
<parameterdescription>
<para>Limit the list returned to those that were added by a specific module. If no module name is provided then all active jobs are returned.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An array of objects where each object describes a tripal job. If no jobs were found then an empty array is returned. Each object will have the following members:<itemizedlist>
<listitem><para>job_id: The unique ID number for the job.</para></listitem><listitem><para>uid: The ID of the user that submitted the job.</para></listitem><listitem><para>job_name: The human-readable name of the job.</para></listitem><listitem><para>modulename: The name of the module that submitted the job.</para></listitem><listitem><para>callback: The callback function to be called when the job is run.</para></listitem><listitem><para>arguments: An array of arguments to be passed to the callback function.</para></listitem><listitem><para>progress: The percent progress of completion if the job is running.</para></listitem><listitem><para>status: The status of the job: Waiting, Completed, Running or Cancelled.</para></listitem><listitem><para>submit_date: The UNIX timestamp when the job was submitted.</para></listitem><listitem><para>start_time: The UNIX timestamp for when the job started running.</para></listitem><listitem><para>end_time: The UNIX timestampe when the job completed running.</para></listitem><listitem><para>error_msg: Any error message that occured during execution of the job.</para></listitem><listitem><para>prirotiy: The execution priority of the job (value between 1 and 10) </para></listitem></itemizedlist>
</para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="521" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="521" bodyend="540"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga3d676afee039417282e6655a26323bcd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_job</definition>
        <argsstring>($job_id)</argsstring>
        <name>tripal_get_job</name>
        <param>
          <declname>$job_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieve information regarding a tripal job</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The unique identifier of the job</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An object representing a record from the tripal_job table or FALSE on failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="136" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="136" bodyend="147"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1gabaecb27e1728625549669a3001eca55c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_job_progress</definition>
        <argsstring>($job_id)</argsstring>
        <name>tripal_get_job_progress</name>
        <param>
          <declname>$job_id</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the current proress of a job.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The job_id to get the progress for</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A value between 0 and 100 indicating the percentage complete of the job. FALSE on failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="480" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="480" bodyend="493"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1gab9662b101766216caf761807eb2d5e6c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_is_job_running</definition>
        <argsstring>()</argsstring>
        <name>tripal_is_job_running</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Indicates if any jobs are running.</para><para>This function will check the system to see if a job has a process ID and if that process ID is still running. It will update the job status accordingly before returning.</para><para><simplesect kind="return"><para>Returns TRUE if any job is running or FALSE otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="161" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="161" bodyend="190"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga3232e2191042d96566b8ce3379f9c2a2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_launch_job</definition>
        <argsstring>($do_parallel=0, $job_id=NULL, $max_jobs=-1, $single=0)</argsstring>
        <name>tripal_launch_job</name>
        <param>
          <declname>$do_parallel</declname>
          <defval>0</defval>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <param>
          <declname>$max_jobs</declname>
          <defval>-1</defval>
        </param>
        <param>
          <declname>$single</declname>
          <defval>0</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>A function used to manually launch all queued tripal jobs.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$do_parallel</parametername>
</parameternamelist>
<parameterdescription>
<para>A boolean indicating whether jobs should be attempted to run in parallel</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>To launch a specific job provide the job id. This option should be used sparingly as the jobs queue managment system should launch jobs based on order and priority. However there are times when a specific job needs to be launched and this argument will allow it. Only jobs which have not been run previously will run. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$max_jobs</parametername>
</parameternamelist>
<parameterdescription>
<para>The maximum number of jobs that should be run concurrently. If -1 then unlimited. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$single</parametername>
</parameternamelist>
<parameterdescription>
<para>Ensures only a single job is run rather then the entire queue. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="347" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="347" bodyend="438"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga3de6b96aba36fd173ae6118ce40897c1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_max_jobs_exceeded</definition>
        <argsstring>($max_jobs)</argsstring>
        <name>tripal_max_jobs_exceeded</name>
        <param>
          <declname>$max_jobs</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Check for too many concurrent jobs.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$max_jobs</parametername>
</parameternamelist>
<parameterdescription>
<para>The maximum number of concurrent jobs to allow; -1 = no limit </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="200" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="200" bodyend="232"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga3b535cc716ccea28d82c0bd274a3efa7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_rerun_job</definition>
        <argsstring>($job_id, $goto_jobs_page=TRUE)</argsstring>
        <name>tripal_rerun_job</name>
        <param>
          <declname>$job_id</declname>
        </param>
        <param>
          <declname>$goto_jobs_page</declname>
          <defval>TRUE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Set a job to be re-run (ie: add it back into the job queue).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The job_id of the job to be re-ran </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$goto_jobs_page</parametername>
</parameternamelist>
<parameterdescription>
<para>If set to TRUE then after the re run job is added Drupal will redirect to the jobs page </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="245" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="245" bodyend="289"/>
      </memberdef>
      <memberdef kind="function" id="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_set_job_progress</definition>
        <argsstring>($job_id, $percentage)</argsstring>
        <name>tripal_set_job_progress</name>
        <param>
          <declname>$job_id</declname>
        </param>
        <param>
          <declname>$percentage</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>An internal function for setting the progress for a current job.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The job_id to set the progress for </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$percentage</parametername>
</parameternamelist>
<parameterdescription>
<para>The progress to set the job to</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>True on success and False otherwise </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.jobs.api.inc" line="453" column="1" bodyfile="tripal/api/tripal.jobs.api.inc" bodystart="453" bodyend="466"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Tripal offers a job management subsystem for managing tasks that may require an extended period of time for completion. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="78" refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>($job_name,<sp/>$modulename,<sp/>$callback,<sp/><ref refid="db/dd8/generate__chado__schema__file_8php_1a61eded163d962fc248b3cf209000979b" kindref="member">$arguments</ref>,<sp/>$uid,</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>$priority<sp/>=<sp/>10,<sp/>$includes<sp/>=<sp/>array(),<sp/>$ignore_duplicate<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/>$user<sp/>=<sp/>user_load($uid);</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_created<sp/>=<sp/>$job-&gt;create(array(</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;job_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job_name,</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;modulename&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$modulename,</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$callback,</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="db/dd8/generate__chado__schema__file_8php_1a61eded163d962fc248b3cf209000979b" kindref="member">$arguments</ref>,</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;uid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$uid,</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$priority,</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;includes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$includes,</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;ignore_duplicate&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$ignore_duplicate,</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($is_created)<sp/>{</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>no<sp/>exceptions<sp/>were<sp/>thrown<sp/>then<sp/>we<sp/>know<sp/>the<sp/>creation<sp/>worked.<sp/><sp/>So</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>let<sp/>the<sp/>user<sp/>know!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Job<sp/>&apos;%job_name&apos;<sp/>submitted.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%job_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job_name)));</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>is<sp/>the<sp/>Tripal<sp/>admin<sp/>user<sp/>then<sp/>give<sp/>a<sp/>bit<sp/>more<sp/>information</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>about<sp/>how<sp/>to<sp/>run<sp/>the<sp/>job.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(user_access(</highlight><highlight class="stringliteral">&apos;administer<sp/>tripal&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$jobs_url<sp/>=<sp/>url(</highlight><highlight class="stringliteral">&quot;admin/tripal/tripal_jobs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Check<sp/>the<sp/>&lt;a<sp/>href=&apos;!jobs_url&apos;&gt;jobs<sp/>page&lt;/a&gt;<sp/>for<sp/>status.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;!jobs_url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$jobs_url)));</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;You<sp/>can<sp/>execute<sp/>the<sp/>job<sp/>queue<sp/>manually<sp/>on<sp/>the<sp/>command<sp/>line<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;using<sp/>the<sp/>following<sp/>Drush<sp/>command:<sp/>&lt;br&gt;drush<sp/>trp-run-jobs<sp/>--username=%uname<sp/>--root=%base_path&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%base_path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>DRUPAL_ROOT,<sp/></highlight><highlight class="stringliteral">&apos;%uname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$user-&gt;name)));</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Job<sp/>&apos;%job_name&apos;<sp/>already<sp/>exists<sp/>in<sp/>the<sp/>queue<sp/>and<sp/>was<sp/>not<sp/>re-submitted.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%job_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job_name)),<sp/></highlight><highlight class="stringliteral">&apos;warning&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$job-&gt;getJobID();</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="122"><highlight class="normal">}</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="136" refid="d0/db7/group__tripal__jobs__api_1ga3d676afee039417282e6655a26323bcd" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga3d676afee039417282e6655a26323bcd" kindref="member">tripal_get_job</ref>($job_id)<sp/>{</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$job-&gt;getJob();</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="147"><highlight class="normal">}</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="161" refid="d0/db7/group__tripal__jobs__api_1gab9662b101766216caf761807eb2d5e6c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gab9662b101766216caf761807eb2d5e6c" kindref="member">tripal_is_job_running</ref>()<sp/>{</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>iterate<sp/>through<sp/>each<sp/>job<sp/>that<sp/>has<sp/>not<sp/>ended</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>see<sp/>if<sp/>it<sp/>is<sp/>still<sp/>running.<sp/>If<sp/>it<sp/>is<sp/>not</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>running<sp/>but<sp/>does<sp/>not<sp/>have<sp/>an<sp/>end_time<sp/>then</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>the<sp/>end<sp/>time<sp/>and<sp/>set<sp/>the<sp/>status<sp/>to<sp/>&apos;Error&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_jobs}<sp/>TJ<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;WHERE<sp/>TJ.end_time<sp/>IS<sp/>NULL<sp/>and<sp/>NOT<sp/>TJ.start_time<sp/>IS<sp/>NULL<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/>$jobs<sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($jobs<sp/>as<sp/>$job)<sp/>{</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>shell_exec(</highlight><highlight class="stringliteral">&apos;ps<sp/>-p<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>escapeshellarg($job-&gt;pid)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>-o<sp/>pid=&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job-&gt;pid<sp/>&amp;&amp;<sp/>$status)<sp/>{</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>job<sp/>is<sp/>still<sp/>running<sp/>so<sp/>let<sp/>it<sp/>go</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>return<sp/>1<sp/>to<sp/>indicate<sp/>that<sp/>a<sp/>job<sp/>is<sp/>running</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>job<sp/>is<sp/>not<sp/>running<sp/>so<sp/>terminate<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;job_id<sp/>=<sp/>$job-&gt;job_id;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;end_time<sp/>=<sp/>time();</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;status<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Error&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;error_msg<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Job<sp/>has<sp/>terminated<sp/>unexpectedly.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_jobs&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>,<sp/></highlight><highlight class="stringliteral">&apos;job_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>1<sp/>to<sp/>indicate<sp/>that<sp/>no<sp/>jobs<sp/>are<sp/>currently<sp/>running.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="190"><highlight class="normal">}</highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight></codeline>
<codeline lineno="200" refid="d0/db7/group__tripal__jobs__api_1ga3de6b96aba36fd173ae6118ce40897c1" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga3de6b96aba36fd173ae6118ce40897c1" kindref="member">tripal_max_jobs_exceeded</ref>($max_jobs)<sp/>{</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($max_jobs<sp/>&lt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>No<sp/>limit<sp/>on<sp/>concurrent<sp/>jobs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/>$num_jobs_running<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>each<sp/>job<sp/>that<sp/>has<sp/>not<sp/>ended<sp/>and<sp/>see<sp/>if<sp/>it<sp/>is<sp/>still<sp/>running.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it<sp/>is<sp/>not<sp/>running<sp/>but<sp/>does<sp/>not<sp/>have<sp/>an<sp/>end_time<sp/>then<sp/>set<sp/>the<sp/>end<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>set<sp/>the<sp/>status<sp/>to<sp/>&apos;Error&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_jobs}<sp/>TJ<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;WHERE<sp/>TJ.end_time<sp/>IS<sp/>NULL<sp/>and<sp/>NOT<sp/>TJ.start_time<sp/>IS<sp/>NULL<sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/>$jobs<sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($jobs<sp/>as<sp/>$job)<sp/>{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>$status<sp/>=<sp/>shell_exec(</highlight><highlight class="stringliteral">&apos;ps<sp/>-p<sp/>&apos;</highlight><highlight class="normal"><sp/>.<sp/>escapeshellarg($job-&gt;pid)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;<sp/>-o<sp/>pid=&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job-&gt;pid<sp/>&amp;&amp;<sp/>$status)<sp/>{</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>job<sp/>is<sp/>still<sp/>running</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$num_jobs_running++;</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>job<sp/>is<sp/>not<sp/>running<sp/>so<sp/>terminate<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;job_id<sp/>=<sp/>$job-&gt;job_id;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;end_time<sp/>=<sp/>time();</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;status<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Error&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>-&gt;error_msg<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Job<sp/>has<sp/>terminated<sp/>unexpectedly.&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_write_record(</highlight><highlight class="stringliteral">&apos;tripal_jobs&apos;</highlight><highlight class="normal">,<sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref>,<sp/></highlight><highlight class="stringliteral">&apos;job_id&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>($num_jobs_running<sp/>&gt;=<sp/>$max_jobs);</highlight></codeline>
<codeline lineno="232"><highlight class="normal">}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="245" refid="d0/db7/group__tripal__jobs__api_1ga3b535cc716ccea28d82c0bd274a3efa7" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga3b535cc716ccea28d82c0bd274a3efa7" kindref="member">tripal_rerun_job</ref>($job_id,<sp/>$goto_jobs_page<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/>$user_id<sp/>=<sp/>$user-&gt;uid;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><ref refid="db/dd8/generate__chado__schema__file_8php_1a61eded163d962fc248b3cf209000979b" kindref="member">$arguments</ref><sp/>=<sp/>$job-&gt;getArguments();</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/>$includes<sp/>=<sp/>$job-&gt;getIncludes();</highlight></codeline>
<codeline lineno="255"><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/>$newJob<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Tripaljob();</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;create(array(</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;job_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job-&gt;getJobName(),</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;modulename&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job-&gt;getModuleName(),</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job-&gt;getCallback(),</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;arguments&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="db/dd8/generate__chado__schema__file_8php_1a61eded163d962fc248b3cf209000979b" kindref="member">$arguments</ref>,</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;uid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$user_id,</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job-&gt;getPriority(),</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;includes&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$includes</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>no<sp/>exceptions<sp/>were<sp/>thrown<sp/>then<sp/>we<sp/>know<sp/>the<sp/>creation<sp/>worked.<sp/><sp/>So</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>let<sp/>the<sp/>user<sp/>know!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Job<sp/>&apos;%job_name&apos;<sp/>submitted.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%job_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job-&gt;getJobName())));</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>is<sp/>the<sp/>Tripal<sp/>admin<sp/>user<sp/>then<sp/>give<sp/>a<sp/>bit<sp/>more<sp/>information</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>about<sp/>how<sp/>to<sp/>run<sp/>the<sp/>job.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(user_access(</highlight><highlight class="stringliteral">&apos;administer<sp/>tripal&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$jobs_url<sp/>=<sp/>url(</highlight><highlight class="stringliteral">&quot;admin/tripal/tripal_jobs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Check<sp/>the<sp/>&lt;a<sp/>href=&apos;!jobs_url&apos;&gt;jobs<sp/>page&lt;/a&gt;<sp/>for<sp/>status.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;!jobs_url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$jobs_url)));</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;You<sp/>can<sp/>execute<sp/>the<sp/>job<sp/>queue<sp/>manually<sp/>on<sp/>the<sp/>command<sp/>line<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;using<sp/>the<sp/>following<sp/>Drush<sp/>command:<sp/>&lt;br&gt;drush<sp/>trp-run-jobs<sp/>--username=%uname<sp/>--root=%base_path&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%base_path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>DRUPAL_ROOT,<sp/></highlight><highlight class="stringliteral">&apos;%uname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$user-&gt;name)));</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($goto_jobs_page)<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&quot;admin/tripal/tripal_jobs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e){</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal">}</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="303" refid="d0/db7/group__tripal__jobs__api_1ga7d1baa38344008ac242385fbabca10c5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga7d1baa38344008ac242385fbabca10c5" kindref="member">tripal_cancel_job</ref>($job_id,<sp/>$redirect<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$job_id<sp/>or<sp/>!is_numeric($job_id))<sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>watchdog(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;Must<sp/>provide<sp/>a<sp/>numeric<sp/>\$job_id<sp/>to<sp/>the<sp/>tripal_cancel_job()<sp/>function.&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>Tripaljob();</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;cancel();</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(</highlight><highlight class="stringliteral">&apos;Job<sp/>is<sp/>now<sp/>cancelled.&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&quot;admin/tripal/tripal_jobs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&quot;admin/tripal/tripal_jobs&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="325"><highlight class="normal">}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="347" refid="d0/db7/group__tripal__jobs__api_1ga3232e2191042d96566b8ce3379f9c2a2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga3232e2191042d96566b8ce3379f9c2a2" kindref="member">tripal_launch_job</ref>($do_parallel<sp/>=<sp/>0,<sp/>$job_id<sp/>=<sp/>NULL,<sp/>$max_jobs<sp/>=<sp/>-1,<sp/>$single<sp/>=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="348"><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>check<sp/>if<sp/>any<sp/>jobs<sp/>are<sp/>currently<sp/>running<sp/>if<sp/>they<sp/>are,<sp/>don&apos;t<sp/>continue,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>have<sp/>more<sp/>than<sp/>one<sp/>job<sp/>script<sp/>running<sp/>at<sp/>a<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$do_parallel<sp/>and<sp/><ref refid="d0/db7/group__tripal__jobs__api_1gab9662b101766216caf761807eb2d5e6c" kindref="member">tripal_is_job_running</ref>())<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/>date(</highlight><highlight class="stringliteral">&apos;Y-m-d<sp/>H:i:s&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;:<sp/>Jobs<sp/>are<sp/>still<sp/>running.<sp/>Use<sp/>the<sp/>--parallel=1<sp/>option<sp/>with<sp/>the<sp/>Drush<sp/>command<sp/>to<sp/>run<sp/>jobs<sp/>in<sp/>parallel.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($do_parallel<sp/>&amp;&amp;<sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga3de6b96aba36fd173ae6118ce40897c1" kindref="member">tripal_max_jobs_exceeded</ref>($max_jobs))<sp/>{</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/>date(</highlight><highlight class="stringliteral">&apos;Y-m-d<sp/>H:i:s&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;:<sp/>More<sp/>than<sp/>$max_jobs<sp/>jobs<sp/>are<sp/>still<sp/>running.<sp/>At<sp/>least<sp/>one<sp/>of<sp/>these<sp/>jobs<sp/>much<sp/>complete<sp/>before<sp/>a<sp/>new<sp/>job<sp/>can<sp/>start.&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>all<sp/>jobs<sp/>that<sp/>have<sp/>not<sp/>started<sp/>and<sp/>order<sp/>them<sp/>such<sp/>that<sp/>they<sp/>are</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>processed<sp/>in<sp/>a<sp/>FIFO<sp/>manner.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job_id)<sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="365"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>TJ.job_id</highlight></codeline>
<codeline lineno="366"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{tripal_jobs}<sp/>TJ</highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TJ.start_time<sp/>IS<sp/>NULL<sp/>AND</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TJ.end_time<sp/>IS<sp/>NULL<sp/>AND</highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TJ.job_id<sp/>=<sp/>:job_id</highlight></codeline>
<codeline lineno="371"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>priority<sp/>ASC,<sp/>job_id<sp/>ASC</highlight></codeline>
<codeline lineno="372"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>$jobs<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:job_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job_id));</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/><sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="377"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>TJ.job_id</highlight></codeline>
<codeline lineno="378"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{tripal_jobs}<sp/>TJ</highlight></codeline>
<codeline lineno="379"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TJ.start_time<sp/>IS<sp/>NULL<sp/>AND</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TJ.end_time<sp/>IS<sp/>NULL<sp/>AND</highlight></codeline>
<codeline lineno="382"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>NOT<sp/>TJ.status<sp/>=<sp/>&apos;Cancelled&apos;</highlight></codeline>
<codeline lineno="383"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>BY<sp/>priority<sp/>ASC,job_id<sp/>ASC</highlight></codeline>
<codeline lineno="384"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>$jobs<sp/>=<sp/>db_query($sql);</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($jobs)<sp/>{</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/>date(</highlight><highlight class="stringliteral">&apos;Y-m-d<sp/>H:i:s&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;:<sp/>There<sp/>are<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$jobs-&gt;rowCount()<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>jobs<sp/>queued.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($jobs<sp/>as<sp/>$jid)<sp/>{</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/>$job_id<sp/>=<sp/>$jid-&gt;job_id;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Create<sp/>the<sp/>Tripoaljob<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="398"><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>to<sp/>do<sp/>some<sp/>additional<sp/>processing<sp/>for<sp/>printing<sp/>since<sp/>the<sp/>switch</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>serialized<sp/>arrays<sp/>now<sp/>allows<sp/>nested<sp/>arrays<sp/>which<sp/>cause<sp/>errors<sp/>when</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>printed<sp/>using<sp/>implode<sp/>alone.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>$job-&gt;getArguments();</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>$string_args<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($args<sp/>as<sp/>$k<sp/>=&gt;<sp/>$a)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($a))<sp/>{</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$string_args[$k]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Array&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>(is_object($a))<sp/>{</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$string_args[$k]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Object&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$string_args[$k]<sp/>=<sp/>$a;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="415"><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Run<sp/>the<sp/>job</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/>$callback<sp/>=<sp/>$job-&gt;getCallback();</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/>date(</highlight><highlight class="stringliteral">&apos;Y-m-d<sp/>H:i:s&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;:<sp/>Job<sp/>ID<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$job_id<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;.\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/>date(</highlight><highlight class="stringliteral">&apos;Y-m-d<sp/>H:i:s&apos;</highlight><highlight class="normal">)<sp/>.</highlight><highlight class="stringliteral">&quot;:<sp/>Calling:<sp/>$callback(&quot;</highlight><highlight class="normal"><sp/>.<sp/>implode(</highlight><highlight class="stringliteral">&quot;,<sp/>&quot;</highlight><highlight class="normal">,<sp/>$string_args)<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;)\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$job-&gt;run();</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$job-&gt;logMessage($e-&gt;getMessage(),<sp/>array(),<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>);</highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($single)<sp/>{</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Don&apos;t<sp/>start<sp/>any<sp/>more<sp/>jobs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="d0/db7/group__tripal__jobs__api_1ga3de6b96aba36fd173ae6118ce40897c1" kindref="member">tripal_max_jobs_exceeded</ref>($max_jobs))<sp/>{</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>Send<sp/>an<sp/>email<sp/>to<sp/>the<sp/>user<sp/>advising<sp/>that<sp/>the<sp/>job<sp/>has<sp/>finished</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="438"><highlight class="normal">}</highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="453" refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9d47a24fd67bb0434432d6f10f2d1054" kindref="member">tripal_set_job_progress</ref>($job_id,<sp/>$percentage)<sp/>{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;setProgress($percentage);</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="466"><highlight class="normal">}</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="480" refid="d0/db7/group__tripal__jobs__api_1gabaecb27e1728625549669a3001eca55c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gabaecb27e1728625549669a3001eca55c" kindref="member">tripal_get_job_progress</ref>($job_id)<sp/>{</highlight></codeline>
<codeline lineno="481"><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/>$progress<sp/>=<sp/>$job-&gt;getProgress();</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$progress;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message($e-&gt;getMessage(),<sp/></highlight><highlight class="stringliteral">&apos;error&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="493"><highlight class="normal">}</highlight></codeline>
<codeline lineno="521" refid="d0/db7/group__tripal__jobs__api_1ga9dfd4a60577476458f57f3da139f6f05" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga9dfd4a60577476458f57f3da139f6f05" kindref="member">tripal_get_active_jobs</ref>($modulename<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_jobs&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;TJ&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;TJ&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;job_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;uid&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;job_name&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;modulename&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;callback&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;arguments&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;progress&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;status&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;submit_date&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;start_time&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;end_time&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;error_msg&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;priority&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($modulename)<sp/>{</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;where(</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;TJ.modulename<sp/>=<sp/>:modulename<sp/>and<sp/>NOT<sp/>(TJ.status<sp/>=<sp/>&apos;Completed&apos;<sp/>or<sp/>TJ.status<sp/>=<sp/>&apos;Cancelled&apos;)&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:modulename&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$modulename)</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>$query-&gt;execute();</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/>$jobs<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">($job<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchobject())<sp/>{</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/>$job-&gt;arguments<sp/>=<sp/>unserialize($job-&gt;arguments);</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/>$jobs[]<sp/>=<sp/>$job;</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$jobs;</highlight></codeline>
<codeline lineno="540"><highlight class="normal">}</highlight></codeline>
<codeline lineno="541"><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"></highlight></codeline>
<codeline lineno="553" refid="d0/db7/group__tripal__jobs__api_1ga4228960dcf9f37b7db8c773aca9ac3c2" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga4228960dcf9f37b7db8c773aca9ac3c2" kindref="member">tripal_execute_job</ref>($job_id,<sp/>$redirect<sp/>=<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/>$job<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref>();</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/>$job-&gt;load($job_id);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Run<sp/>the<sp/>job.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job-&gt;getStartTime()<sp/>==<sp/>0<sp/>and<sp/>$job-&gt;getEndTime()<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d0/db7/group__tripal__jobs__api_1ga3232e2191042d96566b8ce3379f9c2a2" kindref="member">tripal_launch_job</ref>(1,<sp/>$job_id);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Job<sp/>%job_id<sp/>has<sp/>finished<sp/>executing.<sp/>See<sp/>below<sp/>for<sp/>more<sp/>information.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%job_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job_id)));</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_set_message(t(</highlight><highlight class="stringliteral">&quot;Job<sp/>%job_id<sp/>cannot<sp/>be<sp/>executed.<sp/>It<sp/>has<sp/>already<sp/>finished.&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;%job_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$job_id)));</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($redirect)<sp/>{</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_goto(</highlight><highlight class="stringliteral">&quot;admin/tripal/tripal_jobs/view/$job_id&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/api/tripal.jobs.api.inc"/>
  </compounddef>
</doxygen>
