<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="d6/d6d/tripal_8quotas_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal.quotas.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d6/d6d/tripal_8quotas_8api_8inc_1a73f50699402cd1f464fa05324b24f54f" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_expire_files</definition>
        <argsstring>(TripalJob $job=NULL)</argsstring>
        <name>tripal_expire_files</name>
        <param>
          <type><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref></type>
          <declname>$job</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Checks if a file needs to be expired. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.quotas.api.inc" line="86" column="1" bodyfile="tripal/api/tripal.quotas.api.inc" bodystart="86" bodyend="108"/>
      </memberdef>
      <memberdef kind="function" id="d6/d6d/tripal_8quotas_8api_8inc_1a76e4b460bfb777bb70e4674d24f3a9fe" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_user_quota</definition>
        <argsstring>($uid)</argsstring>
        <name>tripal_get_user_quota</name>
        <param>
          <declname>$uid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the user&apos;s quote and default days to expire.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$uid</parametername>
</parameternamelist>
<parameterdescription>
<para>The User ID.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An associative array containing the quota and default days to expire. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.quotas.api.inc" line="13" column="1" bodyfile="tripal/api/tripal.quotas.api.inc" bodystart="13" bodyend="27"/>
      </memberdef>
      <memberdef kind="function" id="d6/d6d/tripal_8quotas_8api_8inc_1a3e7ba6026fad571974c3485bd8fc5914" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_user_usage</definition>
        <argsstring>($uid)</argsstring>
        <name>tripal_get_user_usage</name>
        <param>
          <declname>$uid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves the current size of all files uploaded by the user.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$uid</parametername>
</parameternamelist>
<parameterdescription>
<para>The User ID.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The total number of bytes currently used. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.quotas.api.inc" line="70" column="1" bodyfile="tripal/api/tripal.quotas.api.inc" bodystart="70" bodyend="81"/>
      </memberdef>
      <memberdef kind="function" id="d6/d6d/tripal_8quotas_8api_8inc_1a3bb9b9f7ec158c3f1580b898f7acec0d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_remove_user_quota</definition>
        <argsstring>($uid)</argsstring>
        <name>tripal_remove_user_quota</name>
        <param>
          <declname>$uid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Removes a user&apos;s file space and default file expiration.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$uid</parametername>
</parameternamelist>
<parameterdescription>
<para>The User ID for whom the quota will be removed.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para></para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.quotas.api.inc" line="58" column="1" bodyfile="tripal/api/tripal.quotas.api.inc" bodystart="58" bodyend="60"/>
      </memberdef>
      <memberdef kind="function" id="d6/d6d/tripal_8quotas_8api_8inc_1ad7b54983d4fcd9ccb86e81b07832d71b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_reset_file_expiration</definition>
        <argsstring>($fid)</argsstring>
        <name>tripal_reset_file_expiration</name>
        <param>
          <declname>$fid</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Resets the expiration data of a file managed by Tripal.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$fid</parametername>
</parameternamelist>
<parameterdescription>
<para>The file ID of the file to reset.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE on success, FALSE on failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.quotas.api.inc" line="119" column="1" bodyfile="tripal/api/tripal.quotas.api.inc" bodystart="119" bodyend="142"/>
      </memberdef>
      <memberdef kind="function" id="d6/d6d/tripal_8quotas_8api_8inc_1ad9c7dda3ad64328c205c8328ded6ca40" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_set_user_quota</definition>
        <argsstring>($uid, $quota, $expriation)</argsstring>
        <name>tripal_set_user_quota</name>
        <param>
          <declname>$uid</declname>
        </param>
        <param>
          <declname>$quota</declname>
        </param>
        <param>
          <declname>$expriation</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Sets a user&apos;s file space quota and default file expiration.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$uid</parametername>
</parameternamelist>
<parameterdescription>
<para>The User ID for whom the quota will be set. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$quota</parametername>
</parameternamelist>
<parameterdescription>
<para>The quota </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$expriation</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>The inserted record. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.quotas.api.inc" line="41" column="1" bodyfile="tripal/api/tripal.quotas.api.inc" bodystart="41" bodyend="48"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="13" refid="d6/d6d/tripal_8quotas_8api_8inc_1a76e4b460bfb777bb70e4674d24f3a9fe" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1a76e4b460bfb777bb70e4674d24f3a9fe" kindref="member">tripal_get_user_quota</ref>($uid)<sp/>{</highlight></codeline>
<codeline lineno="14"><highlight class="normal"><sp/><sp/>$quota<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_custom_quota&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tgcq&apos;</highlight><highlight class="normal">)-&gt;fields(</highlight><highlight class="stringliteral">&apos;tgcq&apos;</highlight><highlight class="normal">,<sp/>[</highlight></codeline>
<codeline lineno="15"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;custom_quota&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="16"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;custom_expiration&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"><sp/><sp/>])</highlight></codeline>
<codeline lineno="18"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;uid&apos;</highlight><highlight class="normal">,<sp/>$uid)</highlight></codeline>
<codeline lineno="19"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="20"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchObject();</highlight></codeline>
<codeline lineno="21"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<sp/>$quota)<sp/>{</highlight></codeline>
<codeline lineno="22"><highlight class="normal"><sp/><sp/><sp/><sp/>$quota<sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>stdClass();</highlight></codeline>
<codeline lineno="23"><highlight class="normal"><sp/><sp/><sp/><sp/>$quota-&gt;custom_quota<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;tripal_default_file_quota&apos;</highlight><highlight class="normal">,<sp/>pow(20,<sp/>6));</highlight></codeline>
<codeline lineno="24"><highlight class="normal"><sp/><sp/><sp/><sp/>$quota-&gt;custom_expiration<sp/>=<sp/>variable_get(</highlight><highlight class="stringliteral">&apos;tripal_default_file_expiration&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;60&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="25"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="26"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$quota;</highlight></codeline>
<codeline lineno="27"><highlight class="normal">}</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight></codeline>
<codeline lineno="41" refid="d6/d6d/tripal_8quotas_8api_8inc_1ad9c7dda3ad64328c205c8328ded6ca40" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1ad9c7dda3ad64328c205c8328ded6ca40" kindref="member">tripal_set_user_quota</ref>($uid,<sp/>$quota,<sp/>$expriation)<sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>[</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;uid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$uid,</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;custom_quota&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$quota,</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;custom_expiration&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$expriation</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/>];</highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>db_insert(</highlight><highlight class="stringliteral">&apos;tripal_custom_quota&apos;</highlight><highlight class="normal">)-&gt;fields(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)-&gt;execute();</highlight></codeline>
<codeline lineno="48"><highlight class="normal">}</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="d6/d6d/tripal_8quotas_8api_8inc_1a3bb9b9f7ec158c3f1580b898f7acec0d" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1a3bb9b9f7ec158c3f1580b898f7acec0d" kindref="member">tripal_remove_user_quota</ref>($uid)<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/>db_delete(</highlight><highlight class="stringliteral">&apos;tripal_custom_quota&apos;</highlight><highlight class="normal">)-&gt;condition(</highlight><highlight class="stringliteral">&apos;uid&apos;</highlight><highlight class="normal">,<sp/>$uid)-&gt;execute();</highlight></codeline>
<codeline lineno="60"><highlight class="normal">}</highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="70" refid="d6/d6d/tripal_8quotas_8api_8inc_1a3e7ba6026fad571974c3485bd8fc5914" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1a3e7ba6026fad571974c3485bd8fc5914" kindref="member">tripal_get_user_usage</ref>($uid)<sp/>{</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>user&apos;s<sp/>current<sp/>file<sp/>usage</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>SUM(filesize)<sp/>FROM<sp/>(</highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>DISTINCT<sp/>FM.fid,<sp/>FM.filename,<sp/>FM.filesize</highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>file_usage<sp/>FU</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>file_managed<sp/>FM<sp/>ON<sp/>FM.fid<sp/>=<sp/>FU.fid<sp/>and<sp/>FU.module<sp/>=<sp/>&apos;tripal&apos;</highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>FM.uid<sp/>=<sp/>:uid)<sp/>AS<sp/>foo</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/>$total_usage<sp/>=<sp/>db_query($sql,<sp/>[</highlight><highlight class="stringliteral">&apos;:uid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$uid])-&gt;fetchField();</highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>($total_usage);</highlight></codeline>
<codeline lineno="81"><highlight class="normal">}</highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight></codeline>
<codeline lineno="86" refid="d6/d6d/tripal_8quotas_8api_8inc_1a73f50699402cd1f464fa05324b24f54f" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1a73f50699402cd1f464fa05324b24f54f" kindref="member">tripal_expire_files</ref>(<ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref><sp/>$job<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_expiration_files&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tgfe&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tgfe&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($result<sp/>=<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>-&gt;fetchObject())<sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(time()<sp/>&gt;<sp/>$result-&gt;expiration_date)<sp/>{</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$file<sp/>=<sp/>file_load($result-&gt;fid);</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($file)<sp/>{</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job)<sp/>{</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$job-&gt;logMessage(</highlight><highlight class="stringliteral">&apos;File<sp/>&quot;&apos;</highlight><highlight class="normal"><sp/>.<sp/>$file-&gt;filename<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;&quot;<sp/>has<sp/>expired.<sp/>Removing...&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>remove<sp/>the<sp/>file<sp/>from<sp/>the<sp/>file<sp/>system.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>file_delete($file,<sp/>TRUE);</highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>file<sp/>from<sp/>our<sp/>file<sp/>expiration<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_delete(</highlight><highlight class="stringliteral">&apos;tripal_expiration_files&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;fid&apos;</highlight><highlight class="normal">,<sp/>$result-&gt;fid);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$query-&gt;execute();</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="108"><highlight class="normal">}</highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="119" refid="d6/d6d/tripal_8quotas_8api_8inc_1ad7b54983d4fcd9ccb86e81b07832d71b" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1ad7b54983d4fcd9ccb86e81b07832d71b" kindref="member">tripal_reset_file_expiration</ref>($fid)<sp/>{</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/>$file<sp/>=<sp/>file_load($fid);</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>$quota<sp/>=<sp/><ref refid="d6/d6d/tripal_8quotas_8api_8inc_1a76e4b460bfb777bb70e4674d24f3a9fe" kindref="member">tripal_get_user_quota</ref>($file-&gt;uid);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/>$custom_expiration<sp/>=<sp/>$quota-&gt;custom_expiration;</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>$expiration_date<sp/>=<sp/>time()<sp/>+<sp/>$custom_expiration<sp/>*<sp/>24<sp/>*<sp/>60<sp/>*<sp/>60;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/>db_delete(</highlight><highlight class="stringliteral">&apos;tripal_expiration_files&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;fid&apos;</highlight><highlight class="normal">,<sp/>$fid)</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>db_insert(</highlight><highlight class="stringliteral">&apos;tripal_expiration_files&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields([</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;fid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$file-&gt;fid,</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;expiration_date&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$expiration_date,</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>])</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();<sp/><sp/></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;trp_quota&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/>$e-&gt;getMessage());</highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="142"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/api/tripal.quotas.api.inc"/>
  </compounddef>
</doxygen>
