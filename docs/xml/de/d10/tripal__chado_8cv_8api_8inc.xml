<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="de/d10/tripal__chado_8cv_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal_chado.cv.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga1800ff63fb563e08c2e25c834e202abc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>_chado_update_cvtermpath_loop</definition>
        <argsstring>( $origin, $child_id, $cv_id, $type_id, $depth, $increment_of_depth, $tree_path, $possible_loop, $matched_rows, $possible_start_of_loop, $no_loop_skip_test)</argsstring>
        <name>_chado_update_cvtermpath_loop</name>
        <param>
          <declname>$origin</declname>
        </param>
        <param>
          <declname>$child_id</declname>
        </param>
        <param>
          <declname>$cv_id</declname>
        </param>
        <param>
          <declname>$type_id</declname>
        </param>
        <param>
          <declname>$depth</declname>
        </param>
        <param>
          <declname>$increment_of_depth</declname>
        </param>
        <param>
          <declname>$tree_path</declname>
        </param>
        <param>
          <declname>$possible_loop</declname>
        </param>
        <param>
          <declname>$matched_rows</declname>
        </param>
        <param>
          <declname>$possible_start_of_loop</declname>
        </param>
        <param>
          <declname>$no_loop_skip_test</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$origin</parametername>
</parameternamelist>
<parameterdescription>
<para>The root terms cvterm_id. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$child_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The cvterm_id of the current child term. The child term is a descendent of the origin. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$cv_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The controlled vocabulary ID from the cv table of Chado (i.e. cv.cv_id). </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$type_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The relationship type between the origin term and the child. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$depth</parametername>
</parameternamelist>
<parameterdescription>
<para>The depth of the recursion. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$increment_of_depth.</parametername>
</parameternamelist>
<parameterdescription>
<para>An integer tailing the number of children that have been walked down. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$tree_path.</parametername>
</parameternamelist>
<parameterdescription>
<para>The array of every term between the current child and the origin. Each element in the array is an associative array with the keys: -build_id: an string identifier for the child that combines the origin, child cvterm_id,cv_id, and the type_id. -depth: the depth that a child was inserted into the cvtermpath table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$possible_loop</parametername>
</parameternamelist>
<parameterdescription>
<para>A boolean flag. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$matched_row</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of rows that are currently in the cvtermpath table that match the build_id of the current term trying to be written to the table </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$possible_start_of_</parametername>
</parameternamelist>
<parameterdescription>
<para>loop The array of the possible loop item between the current child and the origin. Each element in the array is an associative array with the keys:<itemizedlist>
<listitem><para>cvid : $cv_id</para></listitem><listitem><para>subject_id:</para></listitem><listitem><para>child_id : $child_id,</para></listitem><listitem><para>type_id : $type_id,</para></listitem><listitem><para>depth : $depth, </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$no_loop_skip_test</parametername>
</parameternamelist>
<parameterdescription>
<para>A boolean used when the possible loop has been ruled out as a loop. </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="521" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="521" bodyend="637"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>_chado_update_cvtermpath_loop_increment</definition>
        <argsstring>( $origin, $child_id, $cv_id, $type_id, $depth, $increment_of_depth, $tree_path, $possible_loop, $matched_rows, &amp;$possible_start_of_loop, $no_loop_skip_test)</argsstring>
        <name>_chado_update_cvtermpath_loop_increment</name>
        <param>
          <declname>$origin</declname>
        </param>
        <param>
          <declname>$child_id</declname>
        </param>
        <param>
          <declname>$cv_id</declname>
        </param>
        <param>
          <declname>$type_id</declname>
        </param>
        <param>
          <declname>$depth</declname>
        </param>
        <param>
          <declname>$increment_of_depth</declname>
        </param>
        <param>
          <declname>$tree_path</declname>
        </param>
        <param>
          <declname>$possible_loop</declname>
        </param>
        <param>
          <declname>$matched_rows</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$possible_start_of_loop</declname>
        </param>
        <param>
          <declname>$no_loop_skip_test</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$origin</parametername>
</parameternamelist>
<parameterdescription>
<para>The root terms cvterm_id. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$child_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The cvterm_id of the current child term. The child term is a descendent of the origin. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$cv_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The controlled vocabulary ID from the cv table of Chado (i.e. cv.cv_id). </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$type_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The relationship type between the origin term and the child. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$depth</parametername>
</parameternamelist>
<parameterdescription>
<para>The depth of the recursion. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$increment_of_depth.</parametername>
</parameternamelist>
<parameterdescription>
<para>An integer. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$tree_path.</parametername>
</parameternamelist>
<parameterdescription>
<para>The array of every term between the current child and the origin. Each element in the array is an associative array with the keys: -build_id: an string identifier for the child that combines the origin, child cvterm_id,cv_id, and the type_id. -depth: the depth that a child was inserted into the cvtermpath table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$possible_loop</parametername>
</parameternamelist>
<parameterdescription>
<para>A boolean flag. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$matched_row</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of rows that are currently in the cvtermpath table that match the build_id of the current term trying to be written to the table </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$possible_start_of_</parametername>
</parameternamelist>
<parameterdescription>
<para>loop The array of the possible loop item between the current child and the origin. Each element in the array is an associative array with the keys:<itemizedlist>
<listitem><para>cvid : $cv_id</para></listitem><listitem><para>subject_id:</para></listitem><listitem><para>child_id : $child_id,</para></listitem><listitem><para>type_id : $type_id,</para></listitem><listitem><para>depth : $depth, </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$no_loop_skip_test</parametername>
</parameternamelist>
<parameterdescription>
<para>A boolean used when the possible loop has been ruled out as a loop. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>multitype: Either a number that represents the row count of existing rows that already match these specification or a Boolean false. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="680" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="680" bodyend="835"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1gad719a0176097f3a191626e3d065958a0" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>_chado_update_cvtermpath_root_loop</definition>
        <argsstring>($rootid, $cvid, &amp;$roots)</argsstring>
        <name>_chado_update_cvtermpath_root_loop</name>
        <param>
          <declname>$rootid</declname>
        </param>
        <param>
          <declname>$cvid</declname>
        </param>
        <param>
          <type>&amp;</type>
          <declname>$roots</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Duplicate of _fill_cvtermpath4root() stored procedure in Chado.</para><para>This function process a &quot;branch&quot; of the ontology. Initially, the &quot;root&quot; starts at the top of the tree. But, as the cvtermpath is populated the &quot;root&quot; becomes terms deeper in the tree.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$rootid</parametername>
</parameternamelist>
<parameterdescription>
<para>The term ID from the cvterm table of Chado (i.e. cvterm.cvterm_id). </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$cvid</parametername>
</parameternamelist>
<parameterdescription>
<para>The controlled vocabulary ID from the cv table of Chado (i.e. cv.cv_id). </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="437" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="437" bodyend="479"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga721fc931120ef07298e15f4cfd99a749" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_associate_cvterm</definition>
        <argsstring>($basetable, $record_id, $cvterm, $options=array())</argsstring>
        <name>chado_associate_cvterm</name>
        <param>
          <declname>$basetable</declname>
        </param>
        <param>
          <declname>$record_id</declname>
        </param>
        <param>
          <declname>$cvterm</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add a record to a cvterm linking table (ie: feature_cvterm).</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$basetable</parametername>
</parameternamelist>
<parameterdescription>
<para>The base table to which the cvterm should be linked/associated. Thus to associate a cvterm to a feature the basetable=feature and cvterm_id is added to the feature_cvterm table. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$record_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The primary key of the basetable to associate the cvterm with. This should be in integer. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$cvterm</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array describing the cvterm. Valid keys include:<itemizedlist>
<listitem><para>name: the name for the cvterm,</para></listitem><listitem><para>cv_name: the name of the cv the cvterm belongs to.</para></listitem><listitem><para>cv_id: the primary key of the cv the cvterm belongs to. </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array of options. Valid keys include:<itemizedlist>
<listitem><para>insert_cvterm: Insert the cvterm if it doesn&apos;t already exist. FALSE is the default. </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="1539" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="1539" bodyend="1630"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1gaec265761f247752914cacf25fb748226" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_autocomplete_cv</definition>
        <argsstring>($string=&apos;&apos;)</argsstring>
        <name>chado_autocomplete_cv</name>
        <param>
          <declname>$string</declname>
          <defval>&apos;&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is intended to be used in autocomplete forms.</para><para>This function searches for a matching controlled vobulary name.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$string</parametername>
</parameternamelist>
<parameterdescription>
<para>The string to search for.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A json array of terms that begin with the provided string. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="1439" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="1439" bodyend="1454"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga98c6aeb1ed178c8d453c2c582ad07eb9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_autocomplete_cvterm</definition>
        <argsstring>($cv_id, $string=&apos;&apos;)</argsstring>
        <name>chado_autocomplete_cvterm</name>
        <param>
          <declname>$cv_id</declname>
        </param>
        <param>
          <declname>$string</declname>
          <defval>&apos;&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This function is intended to be used in autocomplete forms for searching for CV terms that begin with the provided string.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$cv_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The CV ID in which to search for the term. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$string</parametername>
</parameternamelist>
<parameterdescription>
<para>The string to search for.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A json array of terms that begin with the provided string. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="1470" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="1470" bodyend="1515"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1gaba12188df5582acf7d92d8be7e1a56bd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_cv</definition>
        <argsstring>($identifiers, $options=array())</argsstring>
        <name>chado_get_cv</name>
        <param>
          <declname>$identifiers</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a chado controlled vocabulary variable</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$identifier</parametername>
</parameternamelist>
<parameterdescription>
<para>An array with the key stating what the identifier is. Supported keys (only on of the following unique keys is required):<itemizedlist>
<listitem><para>cv_id: the chado cv.cv_id primary key.</para></listitem><listitem><para>name: the chado cv.name field (assume unique). </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of options. Supported keys include:<itemizedlist>
<listitem><para>Any keys supported by <ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var()</ref>. See that function definition fot additional details.</para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
NOTE: the $identifier parameter can really be any array similar to $values passed into <ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record()</ref>. It should fully specify the cv record to be returned.</para><para><simplesect kind="return"><para>If unique values were passed in as an identifier then an object describing the cv will be returned (will be a chado variable from <ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var()</ref>). Otherwise, FALSE will be returned. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="47" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="47" bodyend="117"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga1842ab73237ff64b4650da0b9ff924ac" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_cv_select_options</definition>
        <argsstring>()</argsstring>
        <name>chado_get_cv_select_options</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Create an options array to be used in a form element which provides a list of all chado cvs.</para><para><simplesect kind="return"><para>An array(cv_id =&gt; name) for each cv in the chado cv table. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="128" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="128" bodyend="141"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga43188a45bf914732ee69be620419b34c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_cvterm</definition>
        <argsstring>($identifiers, $options=array())</argsstring>
        <name>chado_get_cvterm</name>
        <param>
          <declname>$identifiers</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a chado controlled vocabulary term variable.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$identifier</parametername>
</parameternamelist>
<parameterdescription>
<para>An array apropriate for use with the chado_generate_var for uniquely identifying a cvterm record. Alternativley, there are also some specially handled keys. They are:<itemizedlist>
<listitem><para>id: an ID for the term of the for [dbname]:[accession], where [dbname] is the short name of the vocabulary and accession is the unique ID.</para></listitem><listitem><para>cv_id: an integer indicating the cv_id or an array with &apos;name&apos; =&gt; the name of the cv.</para></listitem><listitem><para>synonym: an array with &apos;name&apos; =&gt; the name of the synonym of the cvterm you want returned; &apos;cv_id&apos; =&gt; the cv_id of the synonym; &apos;cv_name&apos; =&gt; the name of the cv of the synonym.</para></listitem><listitem><para>property: An array/object describing the property to select records for. It should at least have either a type_name (if unique across cvs) or type_id. Other supported keys include: cv_id/cv_name (of the type), value and rank. </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An array of options. Supported keys include:<itemizedlist>
<listitem><para>Any keys supported by <ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var()</ref>. See that function definition for additional details.</para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
NOTE: the $identifier parameter can really be any array similar to $values passed into <ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record()</ref>. It should fully specify the cvterm record to be returned.</para><para><simplesect kind="return"><para>If unique values were passed in as an identifier then an object describing the cvterm will be returned (will be a chado variable from <ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var()</ref>). Otherwise, FALSE will be returned. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="177" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="177" bodyend="292"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1gad4bc1edd01eccc9e3a5b7710a7a8222c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_cvterm_select_options</definition>
        <argsstring>($cv_id, $rel_type=FALSE)</argsstring>
        <name>chado_get_cvterm_select_options</name>
        <param>
          <declname>$cv_id</declname>
        </param>
        <param>
          <declname>$rel_type</declname>
          <defval>FALSE</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Create an options array to be used in a form element which provides a list of all chado cvterms.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$cv_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The chado cv_id; only cvterms with the supplied cv_id will be returnedl. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$rel_type</parametername>
</parameternamelist>
<parameterdescription>
<para>Set to TRUE if the terms returned should only be relationship types in the vocabulary. This is useful for creating drop-downs of terms used for relationship linker tables.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An associative array with the cvterm_id&apos;s as keys. The first element in the array has a key of &apos;0&apos; and a value of &apos;Select a Type&apos;. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="311" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="311" bodyend="329"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga57d5cbe502404ade3fbd9b52179216f7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_get_obo</definition>
        <argsstring>($values)</argsstring>
        <name>chado_get_obo</name>
        <param>
          <declname>$values</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves an OBO record.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$values</parametername>
</parameternamelist>
<parameterdescription>
<para>An associate array with the following allowed keys: obo_id, name.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An instance of an OBO record object. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="1413" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="1413" bodyend="1424"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga69ea5153de0b94fea2be37f336523d48" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_insert_cv</definition>
        <argsstring>($name, $definition)</argsstring>
        <name>chado_insert_cv</name>
        <param>
          <declname>$name</declname>
        </param>
        <param>
          <declname>$definition</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Adds a controlled vocabulary to the CV table of Chado.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$name</parametername>
</parameternamelist>
<parameterdescription>
<para>The name of the controlled vocabulary. These are typically all lower case with no special characters other than an undrescore (for spaces). </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$comment</parametername>
</parameternamelist>
<parameterdescription>
<para>A description or definition of the vocabulary.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>An object populated with fields from the newly added database. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="851" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="851" bodyend="884"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga8f63166e7d8232eac68393510ddd6411" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_insert_cvterm</definition>
        <argsstring>($term, $options=array())</argsstring>
        <name>chado_insert_cvterm</name>
        <param>
          <declname>$term</declname>
        </param>
        <param>
          <declname>$options</declname>
          <defval>array()</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add&apos;s a controlled vocabulary term to Chado.</para><para>This function will add a cvterm record (and a dbxref record if appropriate values are provided). If the parent vocabulary does not exist then that also is added to the cv table. If the cvterm is a relationship term then the &apos;is_relationship&apos; value should be set. All terms must also have a corresponding database. This is specified in the term&apos;s ID just before the colon (e.g. GO:003824). If the database does not exist in the DB table then it will be added automatically. The accession (the value just after the colon in the term&apos;s ID) will be added to the dbxref table. If the CVterm already exists and $update is set (default) then the cvterm is updated. If the CVTerm already exists and $update is not set, then no changes are made and the CVTerm object is returned.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$term</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array with the following keys:<itemizedlist>
<listitem><para>id: the term accession. must be of the form &lt;DB&gt;:&lt;ACCESSION&gt;, where &lt;DB&gt; is the name of the database to which the cvterm belongs and the &lt;ACCESSION&gt; is the term&apos;s accession number in the database.</para></listitem><listitem><para>name: the name of the term. usually meant to be human-readable.</para></listitem><listitem><para>is_obsolete: is present and set to 1 if the term is defunct.</para></listitem><listitem><para>definition: the definition of the term.</para></listitem><listitem><para>cv_name: The CV name to which the term belongs. If this arugment is null or not provided then the function tries to find a record in the CV table with the same name provided in the $term[namespace]. If this field is provided then it overrides what the value in $term[namespace].</para></listitem><listitem><para>is_relationship: If this term is a relationship term then this value should be 1.</para></listitem><listitem><para>db_name: In some cases the database name will not be part of the $term[&apos;id&apos;] and it needs to be explicitly set. Use this argument only if the database name cannot be specififed in the term ID (e.g. &lt;DB&gt;:&lt;ACCESSION&gt;). </para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$options</parametername>
</parameternamelist>
<parameterdescription>
<para>An associative array with the following keys:<itemizedlist>
<listitem><para>update_existing: By default this is TRUE. If the term exists it is automatically updated.</para></listitem></itemizedlist>
</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A cvterm object </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="930" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="930" bodyend="1279"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga9b54aa52cbf3def613366ddc3da17ace" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_insert_obo</definition>
        <argsstring>($name, $path)</argsstring>
        <name>chado_insert_obo</name>
        <param>
          <declname>$name</declname>
        </param>
        <param>
          <declname>$path</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Add the OBO to the tripal_cv_obo table in the Drupal database.</para><para>If the OBO name already exists in the table then the path is updated.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$name</parametername>
</parameternamelist>
<parameterdescription>
<para>The human readable name of this ontology. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$path</parametername>
</parameternamelist>
<parameterdescription>
<para>The file path or URL of the ontology.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>Returns the ontology ID. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="1374" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="1374" bodyend="1400"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1ga69b904332ab4bdcf7997d7a8d49f2468" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_submit_obo_job</definition>
        <argsstring>($obo)</argsstring>
        <name>chado_submit_obo_job</name>
        <param>
          <declname>$obo</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>TODO: deprecate this function</para><para>Avoid using this function as it will be deprecated in future releases.</para><para>This function allows other modules to programatically submit an ontology for loading into Chado.</para><para>This function will add a job to the Jobs subsystem for parsing the ontology. You can either pass a known OBO ID to the function or the URL or full path the the ontology file. If a URL or file name is passed then the $obo_name argument must also be provided. If this is the first time the ontology has been provided to Tripal then it will be added to the database and will be assigned a unique OBO ID.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$obo_id</parametername>
</parameternamelist>
<parameterdescription>
<para>If the ontology is already loaded into the Tripal tables then use this argument to specify the unique ID for the ontology that will be loaded. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$obo_name</parametername>
</parameternamelist>
<parameterdescription>
<para>If the OBO has not been added before then use this argument to specify the human readable name of the ontology. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$obo_url</parametername>
</parameternamelist>
<parameterdescription>
<para>If the OBO to be loaded is located on a remote server then use this argument to provide the URL. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$obo_file</parametername>
</parameternamelist>
<parameterdescription>
<para>If the OBO is housed on the local file system of the server then use this argument to specify the full path.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>returns the job_id of the submitted job or FALSE if the job was not added </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="1317" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="1317" bodyend="1357"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1gad2847118b7b3c1df73663875ce081676" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>chado_update_cvtermpath</definition>
        <argsstring>($cv_id, $job_id=NULL)</argsstring>
        <name>chado_update_cvtermpath</name>
        <param>
          <declname>$cv_id</declname>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Duplicate of fill_cvtermpath() stored procedure in Chado.</para><para>Identifies all of the root terms of the controlled vocabulary. These root terms are then processed by calling the <ref refid="dc/d32/group__tripal__chado__cv__api_1gad719a0176097f3a191626e3d065958a0" kindref="member">_chado_update_cvtermpath_root_loop()</ref> function on each one.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$cvid</parametername>
</parameternamelist>
<parameterdescription>
<para>The controlled vocabulary ID from the cv table of Chado (i.e. cv.cv_id). </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="385" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="385" bodyend="421"/>
      </memberdef>
      <memberdef kind="function" id="dc/d32/group__tripal__chado__cv__api_1gad5792dae8baa4fccbdd0539b0592f802" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_update_cvtermpath_old</definition>
        <argsstring>($cv_id, $job_id=NULL)</argsstring>
        <name>tripal_update_cvtermpath_old</name>
        <param>
          <declname>$cv_id</declname>
        </param>
        <param>
          <declname>$job_id</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Updates the cvtermpath table of Chado for the specified CV.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$cv_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The chado cv_id. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job_id</parametername>
</parameternamelist>
<parameterdescription>
<para>This function is intended to be used with the Tripal Jobs API. When this function is called as a job the $job_id is automatically passed to this function. </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE on success FALSE on failure. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc" line="345" column="1" bodyfile="tripal_chado/api/modules/tripal_chado.cv.api.inc" bodystart="345" bodyend="370"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides API functions specificially for managing controlled vocabulary records in Chado. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="47" refid="dc/d32/group__tripal__chado__cv__api_1gaba12188df5582acf7d92d8be7e1a56bd" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gaba12188df5582acf7d92d8be7e1a56bd" kindref="member">chado_get_cv</ref>($identifiers,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>Defaults.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Tells<sp/>chado_generate_var<sp/>not<sp/>to<sp/>follow<sp/>any<sp/>foreign<sp/>keys.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Error<sp/>Checking<sp/>of<sp/>parameters.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($identifiers))<sp/>{</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cv:<sp/>The<sp/>identifier<sp/>passed<sp/>in<sp/>is<sp/>expected<sp/>to<sp/>be<sp/>an<sp/>array<sp/>with<sp/>the<sp/>key</highlight></codeline>
<codeline lineno="61"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>matching<sp/>a<sp/>column<sp/>name<sp/>in<sp/>the<sp/>cv<sp/>table<sp/>(ie:<sp/>cv_id<sp/>or<sp/>name).<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE)</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/>elseif<sp/>(empty($identifiers))<sp/>{</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cv:<sp/>You<sp/>did<sp/>not<sp/>pass<sp/>in<sp/>anything<sp/>to<sp/>identify<sp/>the<sp/>cv<sp/>you<sp/>want.<sp/>The<sp/>identifier</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>expected<sp/>to<sp/>be<sp/>an<sp/>array<sp/>with<sp/>the<sp/>key<sp/>matching<sp/>a<sp/>column<sp/>name<sp/>in<sp/>the<sp/>cv<sp/>table</highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(ie:<sp/>cv_id<sp/>or<sp/>name).<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE)</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>get<sp/>the<sp/>cv.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/>$cv<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>$identifiers,</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>the<sp/>cv<sp/>is<sp/>singular.<sp/>If<sp/>it&apos;s<sp/>an<sp/>array<sp/>then<sp/>it<sp/>is<sp/>not<sp/>singular.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($cv))<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cv:<sp/>The<sp/>identifiers<sp/>you<sp/>passed<sp/>in<sp/>were<sp/>not<sp/>unique.<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE)</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Report<sp/>an<sp/>error<sp/>if<sp/>$cv<sp/>is<sp/>FALSE<sp/>since<sp/>then<sp/>chado_generate_var<sp/>has<sp/>failed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/>elseif<sp/>($cv<sp/>===<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_chado_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cv:<sp/>chado_generate_var()<sp/>failed<sp/>to<sp/>return<sp/>a<sp/>cv<sp/>based<sp/>on<sp/>the<sp/>identifiers</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>you<sp/>passed<sp/>in.<sp/>You<sp/>should<sp/>check<sp/>that<sp/>your<sp/>identifiers<sp/>are<sp/>correct,<sp/>as<sp/>well<sp/>as,<sp/>look</highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>a<sp/>chado_generate_var<sp/>error<sp/>for<sp/>additional<sp/>clues.<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE)</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Else,<sp/>as<sp/>far<sp/>we<sp/>know,<sp/>everything<sp/>is<sp/>fine<sp/>so<sp/>give<sp/>them<sp/>their<sp/>cv<sp/>:)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$cv;</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal">}</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="128" refid="dc/d32/group__tripal__chado__cv__api_1ga1842ab73237ff64b4650da0b9ff924ac" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga1842ab73237ff64b4650da0b9ff924ac" kindref="member">chado_get_cv_select_options</ref>()<sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">),<sp/>array(),<sp/>array(</highlight><highlight class="stringliteral">&apos;order_by&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ASC&apos;</highlight><highlight class="normal">)));</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>Vocabulary&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/>$r)<sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[$r-&gt;cv_id]<sp/>=<sp/>$r-&gt;name;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>;</highlight></codeline>
<codeline lineno="140"><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal">}</highlight></codeline>
<codeline lineno="142"><highlight class="normal"></highlight></codeline>
<codeline lineno="177" refid="dc/d32/group__tripal__chado__cv__api_1ga43188a45bf914732ee69be620419b34c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga43188a45bf914732ee69be620419b34c" kindref="member">chado_get_cvterm</ref>($identifiers,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>Defaults.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Tells<sp/>chado_generate_var<sp/>to<sp/>only<sp/>get<sp/>the<sp/>cv.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;include_fk&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>TRUE);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Error<sp/>Checking<sp/>of<sp/>parameters.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!is_array($identifiers))<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cvterm:<sp/>The<sp/>identifier<sp/>passed<sp/>in<sp/>is<sp/>expected<sp/>to<sp/>be<sp/>an<sp/>array<sp/>with<sp/>the<sp/>key</highlight></codeline>
<codeline lineno="189"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>matching<sp/>a<sp/>column<sp/>name<sp/>in<sp/>the<sp/>cvterm<sp/>table<sp/>(ie:<sp/>cvterm_id<sp/>or<sp/>name).<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE))</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>elseif<sp/>(empty($identifiers))<sp/>{</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cvterm:<sp/>You<sp/>did<sp/>not<sp/>pass<sp/>in<sp/>anything<sp/>to<sp/>identify<sp/>the<sp/>cvterm<sp/>you<sp/>want.<sp/>The<sp/>identifier</highlight></codeline>
<codeline lineno="196"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>is<sp/>expected<sp/>to<sp/>be<sp/>an<sp/>array<sp/>with<sp/>the<sp/>key<sp/>matching<sp/>a<sp/>column<sp/>name<sp/>in<sp/>the<sp/>cvterm<sp/>table</highlight></codeline>
<codeline lineno="197"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(ie:<sp/>cvterm_id<sp/>or<sp/>name).<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE))</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>synonym<sp/>was<sp/>passed<sp/>in,<sp/>then<sp/>process<sp/>this<sp/>first<sp/>before<sp/>calling<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>chado_generate_var().</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>$synonym<sp/>=<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$synonym);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;synonym&apos;</highlight><highlight class="normal">][</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]));</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;case_insensitive_columns&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cvtermsynonym&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>synonym<sp/>doens&apos;t<sp/>exist<sp/>or<sp/>more<sp/>than<sp/>one<sp/>record<sp/>is<sp/>returned<sp/>then<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>return<sp/>false.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>&gt;<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>$identifiers<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$result[0]-&gt;cvterm_id);</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>one<sp/>of<sp/>the<sp/>identifiers<sp/>is<sp/>property<sp/>then<sp/>use<sp/>chado_get_record_with_property().</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;property&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref><sp/>=<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;property&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/>unset($identifiers[</highlight><highlight class="stringliteral">&apos;property&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="d0/d77/group__tripal__chado__prop__api_1ga03550ae7e873bb2dc52ebf3818676b9d" kindref="member">chado_get_record_with_property</ref>(</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;table&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;base_records&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$identifiers),</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;type_name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/><ref refid="de/d47/tripal__project__base_8tpl_8php_1aca07184a1d9c6d3817265d594c356071" kindref="member">$property</ref>),</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($identifiers[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>list($db_name,<sp/>$accession)<sp/>=<sp/>preg_split(</highlight><highlight class="stringliteral">&apos;/:/&apos;</highlight><highlight class="normal">,<sp/>$identifiers[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,array(</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db_name,</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="252"><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Else<sp/>we<sp/>have<sp/>a<sp/>simple<sp/>case<sp/>and<sp/>we<sp/>can<sp/>just<sp/>use<sp/>chado_generate_var<sp/>to<sp/>get<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>cvterm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>get<sp/>the<sp/>cvterm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/><ref refid="dd/d88/group__tripal__chado__variables__api_1ga6d6af1f6e23e5bbfae0d7867ce09af5a" kindref="member">chado_generate_var</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>$identifiers,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Ensure<sp/>the<sp/>cvterm<sp/>is<sp/>singular.<sp/>If<sp/>it&apos;s<sp/>an<sp/>array<sp/>then<sp/>it<sp/>is<sp/>not<sp/>singular.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(is_array($cvterm))<sp/>{</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_cv_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cvterm:<sp/>The<sp/>identifiers<sp/>you<sp/>passed<sp/>in<sp/>were<sp/>not<sp/>unique.<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE)</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Report<sp/>an<sp/>error<sp/>if<sp/>$cvterm<sp/>is<sp/>FALSE<sp/>since<sp/>then<sp/>chado_generate_var<sp/>has<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>failed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/>elseif<sp/>($cvterm<sp/>===<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;tripal_cv_api&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_get_cvterm:<sp/>chado_generate_var()<sp/>failed<sp/>to<sp/>return<sp/>a<sp/>cvterm<sp/>based<sp/>on<sp/>the<sp/>identifiers</highlight></codeline>
<codeline lineno="279"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>you<sp/>passed<sp/>in.<sp/>You<sp/>should<sp/>check<sp/>that<sp/>your<sp/>identifiers<sp/>are<sp/>correct,<sp/>as<sp/>well<sp/>as,<sp/>look</highlight></codeline>
<codeline lineno="280"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>for<sp/>a<sp/>chado_generate_var<sp/>error<sp/>for<sp/>additional<sp/>clues.<sp/>You<sp/>passed<sp/>in<sp/>%identifier.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;%identifier&apos;</highlight><highlight class="normal">=&gt;<sp/>print_r($identifiers,<sp/>TRUE)</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Else,<sp/>as<sp/>far<sp/>we<sp/>know,<sp/>everything<sp/>is<sp/>fine<sp/>so<sp/>give<sp/>them<sp/>their<sp/>cvterm<sp/>:)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$cvterm;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal">}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="311" refid="dc/d32/group__tripal__chado__cv__api_1gad4bc1edd01eccc9e3a5b7710a7a8222c" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gad4bc1edd01eccc9e3a5b7710a7a8222c" kindref="member">chado_get_cvterm_select_options</ref>($cv_id,<sp/>$rel_type<sp/>=<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a19d2a3d21fe02053311fde465e6ae2e9" kindref="member">$columns</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id);</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($rel_type)<sp/>{</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;is_relationshiptype&apos;</highlight><highlight class="normal">]<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/>$s_options<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;order_by&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&apos;ASC&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/>$cvterms<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a19d2a3d21fe02053311fde465e6ae2e9" kindref="member">$columns</ref>,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/>$s_options);</highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[0]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;Select<sp/>a<sp/>Type&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cvterms<sp/>as<sp/>$cvterm)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[$cvterm-&gt;cvterm_id]<sp/>=<sp/>$cvterm-&gt;name;</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="326"><highlight class="normal"></highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>;</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal">}</highlight></codeline>
<codeline lineno="330"><highlight class="normal"></highlight></codeline>
<codeline lineno="345" refid="dc/d32/group__tripal__chado__cv__api_1gad5792dae8baa4fccbdd0539b0592f802" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gad5792dae8baa4fccbdd0539b0592f802" kindref="member">tripal_update_cvtermpath_old</ref>($cv_id,<sp/>$job_id<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>need<sp/>better<sp/>error<sp/>checking<sp/>in<sp/>this<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>First<sp/>get<sp/>the<sp/>controlled<sp/>vocabulary<sp/>name:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{cv}<sp/>WHERE<sp/>cv_id<sp/>=<sp/>:cv_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/>$cv<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nUpdating<sp/>cvtermpath<sp/>for<sp/>$cv-&gt;name...\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>need<sp/>to<sp/>set<sp/>the<sp/>chado<sp/>schema<sp/>as<sp/>active<sp/>because<sp/>some<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>functions<sp/>call<sp/>other<sp/>functions<sp/>which<sp/>would<sp/>not<sp/>be<sp/>in<sp/>scope.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/>$previous<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>fill_cvtermpath(:name)&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv-&gt;name));</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>($previous);</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>($previous);</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/>$error<sp/>=<sp/>$e-&gt;getMessage();</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>fill<sp/>cvtermpath<sp/>table:<sp/>@error&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;@error&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$error));</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="370"><highlight class="normal">}</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="385" refid="dc/d32/group__tripal__chado__cv__api_1gad2847118b7b3c1df73663875ce081676" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gad2847118b7b3c1df73663875ce081676" kindref="member">chado_update_cvtermpath</ref>($cv_id,<sp/>$job_id<sp/>=<sp/>NULL){</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>TODO:<sp/>there&apos;s<sp/>a<sp/>function<sp/>to<sp/>determine<sp/>the<sp/>current<sp/>Chado<sp/>instance.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>should<sp/>use<sp/>that.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/>$prev_db<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nNOTE:<sp/>Updating<sp/>CV<sp/>Term<sp/>Path<sp/>is<sp/>performed<sp/>using<sp/>a<sp/>database<sp/>transaction.<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;If<sp/>the<sp/>update<sp/>fails<sp/>or<sp/>is<sp/>terminated<sp/>prematurely<sp/>then<sp/>any<sp/>new<sp/>changes<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;made<sp/>will<sp/>be<sp/>rolled<sp/>back.\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_query(</highlight><highlight class="stringliteral">&apos;</highlight></codeline>
<codeline lineno="397"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>DISTINCT<sp/>t.*</highlight></codeline>
<codeline lineno="398"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>cvterm<sp/>t</highlight></codeline>
<codeline lineno="399"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>LEFT<sp/>JOIN<sp/>cvterm_relationship<sp/>r<sp/>ON<sp/>(t.cvterm_id<sp/>=<sp/>r.subject_id)</highlight></codeline>
<codeline lineno="400"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>cvterm_relationship<sp/>r2<sp/>ON<sp/>(t.cvterm_id<sp/>=<sp/>r2.object_id)</highlight></codeline>
<codeline lineno="401"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>t.cv_id<sp/>=<sp/>:cvid<sp/>AND<sp/>r.subject_id<sp/>is<sp/>null&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:cvid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id)</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>each<sp/>root<sp/>level<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>=<sp/>$result-&gt;fetchAll();</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>$roots<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="408"><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="d5/d5b/tripal__library__base_8tpl_8php_1acbcb6dcb11c8755d5ffab0b45aac7a22" kindref="member">$record</ref><sp/>as<sp/>$item){</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gad719a0176097f3a191626e3d065958a0" kindref="member">_chado_update_cvtermpath_root_loop</ref>($item-&gt;cvterm_id,<sp/>$item-&gt;cv_id,<sp/>$roots);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rollback<sp/>any<sp/>database<sp/>changes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>$e;</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>the<sp/>database<sp/>back</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>($prev_db);</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="421"><highlight class="normal">}</highlight></codeline>
<codeline lineno="422"><highlight class="normal"></highlight></codeline>
<codeline lineno="437" refid="dc/d32/group__tripal__chado__cv__api_1gad719a0176097f3a191626e3d065958a0" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gad719a0176097f3a191626e3d065958a0" kindref="member">_chado_update_cvtermpath_root_loop</ref>($rootid,<sp/>$cvid,<sp/>&amp;$roots)<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/>$ttype<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;SELECT<sp/>cv.cvterm_id<sp/></highlight></codeline>
<codeline lineno="440"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>cvterm<sp/>cv</highlight></codeline>
<codeline lineno="441"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>cv.name<sp/>=<sp/>:isa<sp/></highlight></codeline>
<codeline lineno="442"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>OR<sp/>cv.name<sp/>=<sp/>:is_a</highlight></codeline>
<codeline lineno="443"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/>,</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:isa&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;isa&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;:is_a&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/></highlight><highlight class="stringliteral">&quot;is_a&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/>$result<sp/>=<sp/>$ttype-&gt;fetchObject();</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/>$term_id<sp/>=<sp/>$rootid<sp/>.<sp/></highlight><highlight class="charliteral">&apos;|&apos;</highlight><highlight class="normal"><sp/>.<sp/>$rootid<sp/>.<sp/></highlight><highlight class="charliteral">&apos;|&apos;</highlight><highlight class="normal"><sp/>.<sp/>$cvid<sp/>.<sp/></highlight><highlight class="charliteral">&apos;|&apos;</highlight><highlight class="normal"><sp/>.<sp/>$result-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>child_id<sp/>matches<sp/>any<sp/>other<sp/>id<sp/>in<sp/>the<sp/>array<sp/>then<sp/>we&apos;ve<sp/>hit<sp/>a<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($roots<sp/>as<sp/>$element_id)<sp/>{</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($element_id<sp/>==<sp/>$term_id)<sp/>{</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>add<sp/>that<sp/>new<sp/>entry<sp/>to<sp/>the<sp/>$tree_path.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/>$roots[]<sp/>=<sp/>$term_id;</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Descends<sp/>through<sp/>the<sp/>branch<sp/>starting<sp/>at<sp/>this<sp/>&quot;root&quot;<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/>$tree_path<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/>$matched_rows<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/>$possible_start_of_loop<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/>$depth<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga1800ff63fb563e08c2e25c834e202abc" kindref="member">_chado_update_cvtermpath_loop</ref>($rootid,<sp/>$rootid,<sp/>$cvid,<sp/>$result-&gt;cvterm_id,<sp/>$depth,</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/>$tree_path,<sp/>FALSE,<sp/>$matched_rows,<sp/>$possible_start_of_loop,<sp/>FALSE);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get&apos;s<sp/>the<sp/>children<sp/>terms<sp/>of<sp/>this<sp/>&quot;root&quot;<sp/>term<sp/>and<sp/>then<sp/>recursively<sp/>calls</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>function<sp/>making<sp/>each<sp/>child<sp/>root.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/>$cterm<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;SELECT<sp/>*</highlight></codeline>
<codeline lineno="471"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>cvterm_relationship</highlight></codeline>
<codeline lineno="472"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>object_id<sp/>=<sp/>:rootid</highlight></codeline>
<codeline lineno="473"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;:rootid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$rootid]</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>($cterm_result<sp/>=<sp/>$cterm-&gt;fetchAssoc())<sp/>{</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gad719a0176097f3a191626e3d065958a0" kindref="member">_chado_update_cvtermpath_root_loop</ref>($cterm_result[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">],<sp/>$cvid,<sp/>$roots);</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="479"><highlight class="normal">}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="521" refid="dc/d32/group__tripal__chado__cv__api_1ga1800ff63fb563e08c2e25c834e202abc" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga1800ff63fb563e08c2e25c834e202abc" kindref="member">_chado_update_cvtermpath_loop</ref>(</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/>$origin,</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/>$child_id,</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/>$cv_id,</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/>$type_id,</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/>$depth,</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/>$increment_of_depth,</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/>$tree_path,</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/>$possible_loop,</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/>$matched_rows,</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/>$possible_start_of_loop,</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/>$no_loop_skip_test)<sp/>{</highlight></codeline>
<codeline lineno="533"><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>have<sp/>not<sp/>detected<sp/>a<sp/>loop,<sp/>so<sp/>it&apos;s<sp/>safe<sp/>to<sp/>insert<sp/>the<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/>$new_match_rows<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($possible_start_of_loop))<sp/>{</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Go<sp/>through<sp/>each<sp/>matched_row.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($matched_rows)<sp/>===<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>cvtermpath_id<sp/>and<sp/>then<sp/>increment<sp/>down<sp/>one<sp/>row.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvtermpath_id<sp/>=<sp/>(int)<sp/>$matched_rows[0]-&gt;cvtermpath_id;</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvtermpath_id<sp/>=<sp/>$cvtermpath_id<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$next_row<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;SELECT<sp/>*</highlight></codeline>
<codeline lineno="545"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>cvtermpath</highlight></codeline>
<codeline lineno="546"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>cvtermpath_id<sp/>=<sp/>:cvtermpath_id</highlight></codeline>
<codeline lineno="547"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;:cvtermpath_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvtermpath_id]</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$next_row<sp/>=<sp/>$next_row-&gt;fetchObject();</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>next<sp/>row<sp/>matches<sp/>the<sp/>values<sp/>passed<sp/>we<sp/>can&apos;t<sp/>rule<sp/>out<sp/>a<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(($next_row-&gt;type_id<sp/>===<sp/>$type_id)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;subject_id<sp/>===<sp/>$child_id)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;object_id<sp/>===<sp/>$origin)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;cv_id<sp/>===<sp/>$cv_id))<sp/>{</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_match_rows[]<sp/>=<sp/>$next_row;</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>(($next_row-&gt;type_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;subject_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;object_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;cv_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>next_row<sp/>is<sp/>equal<sp/>to<sp/>start<sp/>of<sp/>loop,<sp/>so<sp/>we&apos;ve<sp/>reached<sp/>the<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>confirmed<sp/>that<sp/>this<sp/>is<sp/>a<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$possible_loop<sp/>==<sp/>FALSE;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$matched_rows<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>($origin,<sp/>$child_id,<sp/>$cv_id,</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type_id,<sp/>$depth<sp/>+<sp/>1,<sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_match_rows,<sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($matched_rows<sp/>as<sp/>$matched_row)<sp/>{</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>cvtermpath_id<sp/>and<sp/>then<sp/>increment<sp/>down<sp/>one<sp/>row.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$cvtermpath_id<sp/>=<sp/>(int)<sp/>$match_row-&gt;cvtermpath_id;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>cvtermpath_id<sp/>and<sp/>then<sp/>increment<sp/>down<sp/>one<sp/>row.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$cvtermpath_id<sp/>=<sp/>$cvtermpath_id<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$next_row<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;SELECT<sp/>*</highlight></codeline>
<codeline lineno="582"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>cvtermpath</highlight></codeline>
<codeline lineno="583"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>cvtermpath_id<sp/>=<sp/>:cvtermpath_id</highlight></codeline>
<codeline lineno="584"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;:cvtermpath_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvtermpath_id]</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$next_row<sp/>=<sp/>$next_row-&gt;fetchObject();</highlight></codeline>
<codeline lineno="588"><highlight class="normal"></highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>next<sp/>row<sp/>matches<sp/>the<sp/>values<sp/>passed<sp/>we<sp/>can&apos;t<sp/>rule<sp/>out<sp/>a<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(($next_row-&gt;type_id<sp/>===<sp/>$type_id)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;subject_id<sp/>===<sp/>$child_id)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;object_id<sp/>===<sp/>$origin)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;cv_id<sp/>===<sp/>$cv_id))<sp/>{</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_match_rows[]<sp/>=<sp/>$next_row;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>elseif<sp/>(($next_row-&gt;type_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;subject_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;object_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">])<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>($next_row-&gt;cv_id<sp/>===<sp/>$possible_start_of_loop[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>next_row<sp/>is<sp/>equal<sp/>to<sp/>start<sp/>of<sp/>loop,<sp/>so<sp/>we&apos;ve<sp/>reached<sp/>the<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>confirmed<sp/>that<sp/>this<sp/>is<sp/>a<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$possible_loop<sp/>==<sp/>FALSE;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$matched_rows<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>($origin,<sp/>$child_id,<sp/>$cv_id,</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$type_id,<sp/>$depth<sp/>+<sp/>1,<sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$new_match_rows,<sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="607"><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>$match_rows<sp/>is<sp/>empty<sp/>there<sp/>is<sp/>no<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(empty($new_match_rows))<sp/>{</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$possible_loop<sp/>==<sp/>FALSE;</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$matched_rows<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>unset($new_match_rows);</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$no_loop_skip_test<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>There<sp/>is<sp/>not<sp/>loop<sp/>so<sp/>pass<sp/>it<sp/>back<sp/>the<sp/>possible_start_of_loop<sp/>info</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>and<sp/>a<sp/>flag<sp/>telling<sp/>it<sp/>to<sp/>skip<sp/>the<sp/>loop<sp/>check.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>($possible_start_of_loop-&gt;subject_id,</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$possible_start_of_loop-&gt;child_id,<sp/>$possible_start_of_loop-&gt;cvid,</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$possible_start_of_loop-&gt;type_id,<sp/>$possible_start_of_loop-&gt;depth,</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,<sp/>$matched_rows,</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>$match_rows<sp/>is<sp/>not<sp/>empty<sp/>we<sp/>need<sp/>to<sp/>keep<sp/>trying<sp/>rows.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>($origin,<sp/>$child_id,<sp/>$cv_id,</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$type_id,<sp/>$depth<sp/>+<sp/>1,<sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$match_rows,<sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/>elseif<sp/>($possible_loop<sp/>===<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>($origin,<sp/>$child_id,<sp/>$cv_id,</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/>$type_id,<sp/>$depth<sp/>+<sp/>1,<sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/>$matched_rows,<sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="637"><highlight class="normal">}</highlight></codeline>
<codeline lineno="638"><highlight class="normal"></highlight></codeline>
<codeline lineno="680" refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>(</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/>$origin,</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/>$child_id,</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/>$cv_id,</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/>$type_id,</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/>$depth,</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/>$increment_of_depth,</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/>$tree_path,</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/>$possible_loop,</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/>$matched_rows,</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/>&amp;$possible_start_of_loop,</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/>$no_loop_skip_test)<sp/>{</highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>a<sp/>row<sp/>with<sp/>these<sp/>values<sp/>already<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($possible_loop<sp/>===<sp/>FALSE<sp/>&amp;&amp;<sp/>empty($possible_start_of_loop))<sp/>{</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gab385af166be5f0707544ccbc18c3fe72" kindref="member">chado_set_active</ref>(</highlight><highlight class="stringliteral">&apos;chado&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>$count<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;<sp/>SELECT<sp/>*</highlight></codeline>
<codeline lineno="698"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>cvtermpath</highlight></codeline>
<codeline lineno="699"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>object_id<sp/>=<sp/>:origin</highlight></codeline>
<codeline lineno="700"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>subject_id<sp/>=<sp/>:child_id</highlight></codeline>
<codeline lineno="701"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>pathdistance<sp/>=<sp/>:depth</highlight></codeline>
<codeline lineno="702"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>type_id<sp/>=<sp/>:type_id</highlight></codeline>
<codeline lineno="703"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:origin&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$origin,</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:child_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$child_id,</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:depth&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$depth,</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>$count-&gt;fetchAll();</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>$count_total<sp/>=<sp/>$count-&gt;rowCount();</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($count_total<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$count;</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Build<sp/>the<sp/>ID.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/>$term_id<sp/>=<sp/>$origin<sp/>.<sp/></highlight><highlight class="charliteral">&apos;|&apos;</highlight><highlight class="normal"><sp/>.<sp/>$child_id<sp/>.<sp/></highlight><highlight class="charliteral">&apos;|&apos;</highlight><highlight class="normal"><sp/>.<sp/>$cv_id<sp/>.<sp/></highlight><highlight class="charliteral">&apos;|&apos;</highlight><highlight class="normal"><sp/>.<sp/>$type_id;</highlight></codeline>
<codeline lineno="718"><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($no_loop_skip_test<sp/>===<sp/>FALSE)<sp/>{</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>increment<sp/>of<sp/>depth<sp/>is<sp/>0<sp/>then<sp/>it&apos;s<sp/>the<sp/>first<sp/>time<sp/>and<sp/>we<sp/>need<sp/>to<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>skip<sp/>the<sp/>test<sp/>so<sp/>we<sp/>can<sp/>build<sp/>the<sp/>tree_path<sp/>which<sp/>will<sp/>be<sp/>tested<sp/>against.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($increment_of_depth<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Search<sp/>the<sp/>$tree_path<sp/>for<sp/>the<sp/>new<sp/>$child_id<sp/>in<sp/>the<sp/>build_id<sp/>column.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($tree_path<sp/>as<sp/>$parent)<sp/>{</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>this<sp/>child<sp/>is<sp/>the<sp/>same<sp/>as<sp/>a<sp/>parent<sp/>term<sp/>that<sp/>has<sp/>already<sp/>been</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>processed<sp/>then<sp/>we<sp/>have<sp/>a<sp/>potential<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($parent[</highlight><highlight class="stringliteral">&apos;build_id&apos;</highlight><highlight class="normal">]<sp/>==<sp/>$term_id)<sp/>{</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Tell<sp/>the<sp/>function<sp/>this<sp/>is<sp/>a<sp/>possible<sp/>loop<sp/>and<sp/>to<sp/>stop<sp/>writing<sp/>to<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$possible_loop<sp/>=<sp/>TRUE;</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>all<sp/>the<sp/>results<sp/>in<sp/>the<sp/>table<sp/>that<sp/>might<sp/>be<sp/>the<sp/>start<sp/>of<sp/>the<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>loop.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$matching_rows<sp/>=<sp/>db_query(</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;<sp/>SELECT<sp/>*</highlight></codeline>
<codeline lineno="735"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>cvtermpath</highlight></codeline>
<codeline lineno="736"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>cv_id<sp/>=<sp/>:cvid</highlight></codeline>
<codeline lineno="737"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>object_id<sp/>=<sp/>:origin</highlight></codeline>
<codeline lineno="738"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>subject_id<sp/>=<sp/>:child_id</highlight></codeline>
<codeline lineno="739"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>AND<sp/>type_id<sp/>=<sp/>:type_id</highlight></codeline>
<codeline lineno="740"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:cvid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id,</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:origin&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$origin,</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:child_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$child_id,</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;:type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$matched_rows<sp/>=<sp/>$matching_rows-&gt;fetchAll();</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$possible_start_of_loop<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cvid&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id,</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$origin,</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;child_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$child_id,</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id,</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;depth&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$depth,</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="759"><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$find_query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;chado.cvtermpath&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;CVTP&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$find_query-&gt;fields(</highlight><highlight class="stringliteral">&apos;CVTP&apos;</highlight><highlight class="normal">,<sp/>[</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$find_query-&gt;condition(</highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal">,<sp/>$origin);</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$find_query-&gt;condition(</highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal">,<sp/>$child_id);</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$find_query-&gt;condition(</highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal">,<sp/>$type_id);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$find_query-&gt;condition(</highlight><highlight class="stringliteral">&apos;pathdistance&apos;</highlight><highlight class="normal">,<sp/>$depth);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$exists<sp/>=<sp/>$find_query-&gt;execute()-&gt;fetchObject();</highlight></codeline>
<codeline lineno="767"><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(!$exists){</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_insert(</highlight><highlight class="stringliteral">&apos;cvtermpath&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields([</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;object_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$origin,</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;subject_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$child_id,</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id,</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;type_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$type_id,</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pathdistance&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$depth,</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>]);</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="de/d3f/tripal__bulk__loader__base_8tpl_8php_1ace2ec39e7df3899fa8df9640ec274b03" kindref="member">$rows</ref><sp/>=<sp/>$query-&gt;execute();</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$error<sp/>=<sp/>$e-&gt;getMessage();</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Could<sp/>not<sp/>fill<sp/>cvtermpath<sp/>term:<sp/>@error&quot;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;@error&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$error));</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="785"><highlight class="normal"></highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Then<sp/>add<sp/>that<sp/>new<sp/>entry<sp/>to<sp/>the<sp/>$tree_path.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$tree_path[$increment_of_depth]<sp/>=<sp/>[</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;build_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$term_id,</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;depth&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$depth</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>];</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Reset<sp/>to<sp/>FALSE<sp/><sp/>and<sp/>empty<sp/>variable<sp/>if<sp/>passed<sp/>in<sp/>as<sp/>TRUE.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/>$no_loop_skip_test<sp/>==<sp/>FALSE;</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/>$possible_start_of_loop<sp/>=<sp/>[];</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>all<sp/>of<sp/>the<sp/>relationships<sp/>of<sp/>this<sp/>child<sp/>term,<sp/>and<sp/>recursively</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>call<sp/>the<sp/>_chado_update_cvtermpath_loop_increment()<sp/>function<sp/>to<sp/>continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>descending<sp/>down<sp/>the<sp/>tree.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;cvterm_relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cvtr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;cvtr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;cvtr.object_id&apos;</highlight><highlight class="normal">,<sp/>$child_id,<sp/></highlight><highlight class="charliteral">&apos;=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/>$cterm_relationships<sp/>=<sp/>$query-&gt;fetchAll();</highlight></codeline>
<codeline lineno="804"><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cterm_relationships<sp/>as<sp/>$item)<sp/>{</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$increment_of_depth++;</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga3948642af764cb16aa5e25cf7074624e" kindref="member">_chado_update_cvtermpath_loop_increment</ref>($origin,<sp/>$item-&gt;subject_id,<sp/>$cv_id,</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$item-&gt;type_id,<sp/>$depth<sp/>+<sp/>1,<sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$matched_rows,<sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/>elseif<sp/>($possible_loop<sp/>===<sp/>FALSE<sp/>&amp;&amp;<sp/>!empty($possible_start_of_loop))<sp/>{</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>means<sp/>a<sp/>loop<sp/>has<sp/>been<sp/>identified<sp/>and<sp/>the<sp/>recursive<sp/>call<sp/>can<sp/>move</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>on<sp/>to<sp/>the<sp/>next<sp/>item<sp/>and<sp/>skip<sp/>the<sp/>rest<sp/>of<sp/>this<sp/>run.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$possible_start_of_loop;</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/>elseif<sp/>($possible_loop<sp/>===<sp/>TRUE)<sp/>{</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>all<sp/>of<sp/>the<sp/>relationships<sp/>of<sp/>this<sp/>child<sp/>term,<sp/>and<sp/>recursively</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>call<sp/>the<sp/>_chado_update_cvtermpath_loop()<sp/>function<sp/>to<sp/>continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>descending<sp/>down<sp/>the<sp/>tree.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;cvterm_relationship&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;cvtr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;cvtr&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;cvtr.object_id&apos;</highlight><highlight class="normal">,<sp/>$child_id,<sp/></highlight><highlight class="charliteral">&apos;=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/>$cterm_relationships<sp/>=<sp/>$query-&gt;fetchAll();</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($cterm_relationships<sp/>as<sp/>$item)<sp/>{</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$increment_of_depth++;</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga1800ff63fb563e08c2e25c834e202abc" kindref="member">_chado_update_cvtermpath_loop</ref>($origin,<sp/>$item-&gt;subject_id,<sp/>$cv_id,</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$item-&gt;type_id,<sp/>$depth<sp/>+<sp/>1,<sp/>$increment_of_depth,<sp/>$tree_path,<sp/>$possible_loop,</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$matched_rows,<sp/>$possible_start_of_loop,<sp/>$no_loop_skip_test);</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="833"><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal">}</highlight></codeline>
<codeline lineno="836"><highlight class="normal"></highlight></codeline>
<codeline lineno="851" refid="dc/d32/group__tripal__chado__cv__api_1ga69ea5153de0b94fea2be37f336523d48" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga69ea5153de0b94fea2be37f336523d48" kindref="member">chado_insert_cv</ref>($name,<sp/>$definition)<sp/>{</highlight></codeline>
<codeline lineno="852"><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert/update<sp/>values.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/>$ins_values<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$definition</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="858"><highlight class="normal"></highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>See<sp/>if<sp/>the<sp/>CV<sp/>default<sp/>exists<sp/>already<sp/>in<sp/>the<sp/>database.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/>$sel_values<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name);</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/>$sel_values);</highlight></codeline>
<codeline lineno="862"><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it<sp/>does<sp/>not<sp/>exists<sp/>then<sp/>add<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="865"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>$ins_values);</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>create<sp/>the<sp/>CV<sp/>record&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/>$sel_values);</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>it<sp/>already<sp/>exists<sp/>then<sp/>do<sp/>an<sp/>update.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga35aa655c2c929858ab05df18bc807541" kindref="member">chado_update_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>$sel_values,<sp/>$ins_values);</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>update<sp/>the<sp/>CV<sp/>record&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cv&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/>$sel_values);</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="881"><highlight class="normal"></highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Return<sp/>the<sp/>cv<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref>[0];</highlight></codeline>
<codeline lineno="884"><highlight class="normal">}</highlight></codeline>
<codeline lineno="885"><highlight class="normal"></highlight></codeline>
<codeline lineno="930" refid="dc/d32/group__tripal__chado__cv__api_1ga8f63166e7d8232eac68393510ddd6411" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga8f63166e7d8232eac68393510ddd6411" kindref="member">chado_insert_cvterm</ref>($term,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="931"><highlight class="normal"></highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>term<sp/>properties.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/>$id<sp/>=<sp/>(isset($term[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$term[</highlight><highlight class="stringliteral">&apos;id&apos;</highlight><highlight class="normal">]<sp/>:<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/>$name<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/>$cvname<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/>$definition<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/>$is_obsolete<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/>$accession<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="939"><highlight class="normal"></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>Defaults.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($term[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvname<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvname<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;local&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Namespace<sp/>is<sp/>deprecated<sp/>but<sp/>must<sp/>be<sp/>supported<sp/>for<sp/>backwards</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>compatability.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;namespace&apos;</highlight><highlight class="normal">,<sp/>$term))<sp/>{</highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvname<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;namespace&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="952"><highlight class="normal"></highlight></codeline>
<codeline lineno="953"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($term[</highlight><highlight class="stringliteral">&apos;is_relationship&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_relationship<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;is_relationship&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_relationship<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="959"><highlight class="normal"></highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($term[</highlight><highlight class="stringliteral">&apos;db_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/>$dbname<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;db_name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/>$dbname<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;internal&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight></codeline>
<codeline lineno="967"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;update_existing&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/>$update<sp/>=<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;update_existing&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/>$update<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="973"><highlight class="normal"></highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/>$term))<sp/>{</highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="976"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/>$name<sp/>=<sp/>$id;</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="980"><highlight class="normal"></highlight></codeline>
<codeline lineno="981"><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">,<sp/>$term))<sp/>{</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/>$definition<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/^\&quot;(.*)\&quot;/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;\1&apos;</highlight><highlight class="normal">,<sp/>$term[</highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/>$definition<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;is_obsolete&apos;</highlight><highlight class="normal">,<sp/>$term))<sp/>{</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/>$is_obsolete<sp/>=<sp/>$term[</highlight><highlight class="stringliteral">&apos;is_obsolete&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(strcmp($is_obsolete,<sp/></highlight><highlight class="stringliteral">&apos;true&apos;</highlight><highlight class="normal">)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$is_obsolete<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$name<sp/>and<sp/>!$id)<sp/>{</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>find<sp/>cvterm<sp/>without<sp/>&apos;id&apos;<sp/>or<sp/>&apos;name&apos;&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$id)<sp/>{</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/>$id<sp/>=<sp/>$name;</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>accession<sp/>and<sp/>the<sp/>database<sp/>from<sp/>the<sp/>cvterm<sp/>id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($dbname)<sp/>{</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>$id;</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(preg_match(</highlight><highlight class="stringliteral">&apos;/^.+?:.*$/&apos;</highlight><highlight class="normal">,<sp/>$id))<sp/>{</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/>$accession<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/^.+?:(.*)$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;\1&apos;</highlight><highlight class="normal">,<sp/>$id);</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/>$dbname<sp/>=<sp/>preg_replace(</highlight><highlight class="stringliteral">&apos;/^(.+?):.*$/&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="charliteral">&apos;\1&apos;</highlight><highlight class="normal">,<sp/>$id);</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"></highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>we<sp/>have<sp/>a<sp/>database<sp/>name,<sp/>give<sp/>a<sp/>different<sp/>message<sp/>if<sp/>it&apos;s<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>relationship.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($is_relationship<sp/>and<sp/>!$dbname)<sp/>{</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;A<sp/>database<sp/>name<sp/>is<sp/>not<sp/>provided<sp/>for<sp/>this<sp/>relationship<sp/>term:<sp/>$id&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_relationship<sp/>and<sp/>!$dbname)<sp/>{</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;A<sp/>database<sp/>identifier<sp/>is<sp/>missing<sp/>from<sp/>the<sp/>term:<sp/>$id&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>the<sp/>CV<sp/>name<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/>$cv<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gaba12188df5582acf7d92d8be7e1a56bd" kindref="member">chado_get_cv</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvname));</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cv)<sp/>{</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/>$cv<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga69ea5153de0b94fea2be37f336523d48" kindref="member">chado_insert_cv</ref>($cvname,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cv)<sp/>{</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>find<sp/>namespace<sp/>&apos;$cvname&apos;<sp/>when<sp/>adding/updating<sp/>$id&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1031"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"></highlight></codeline>
<codeline lineno="1033"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>SQL<sp/>statement<sp/>will<sp/>be<sp/>used<sp/>a<sp/>lot<sp/>to<sp/>find<sp/>a<sp/>cvterm<sp/>so<sp/>just<sp/>set<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1034"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>here<sp/>for<sp/>easy<sp/>reference<sp/>below.<sp/><sp/>Because<sp/>CV<sp/>terms<sp/>can<sp/>change<sp/>their<sp/>names</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1035"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>accessions<sp/>don&apos;t<sp/>change,<sp/>the<sp/>following<sp/>SQL<sp/>finds<sp/>cvterms<sp/>based<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1036"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>their<sp/>accession<sp/>rather<sp/>than<sp/>the<sp/>name.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1037"><highlight class="normal"><sp/><sp/>$cvtermsql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1038"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>CVT.name,<sp/>CVT.cvterm_id,<sp/>CV.cv_id,<sp/>CV.name<sp/>as<sp/>cvname,</highlight></codeline>
<codeline lineno="1039"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>DB.name<sp/>as<sp/>dbname,<sp/>DB.db_id,<sp/>DBX.accession</highlight></codeline>
<codeline lineno="1040"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="1041"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{dbxref}<sp/>DBX<sp/>on<sp/>CVT.dbxref_id<sp/>=<sp/>DBX.dbxref_id</highlight></codeline>
<codeline lineno="1042"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{db}<sp/>DB<sp/>on<sp/>DBX.db_id<sp/>=<sp/>DB.db_id</highlight></codeline>
<codeline lineno="1043"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>on<sp/>CV.cv_id<sp/>=<sp/>CVT.cv_id</highlight></codeline>
<codeline lineno="1044"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>DBX.accession<sp/>=<sp/>:accession<sp/>and<sp/>DB.name<sp/>=<sp/>:name</highlight></codeline>
<codeline lineno="1045"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1046"><highlight class="normal"></highlight></codeline>
<codeline lineno="1047"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>database.<sp/>The<sp/>function<sp/>will<sp/>just<sp/>return<sp/>the<sp/>DB<sp/>object<sp/>if<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1048"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>database<sp/>already<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><sp/><sp/>$db<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1gae84b79a2d8af437fde99aa8a3fdc9de3" kindref="member">chado_get_db</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname));</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$db)<sp/>{</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/>$db<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1ga7f331faea3ff3c493fe64ee5ccb972de" kindref="member">chado_insert_db</ref>(array(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname));</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$db)<sp/>{</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Cannot<sp/>find<sp/>database<sp/>&apos;$dbname&apos;<sp/>in<sp/>Chado.&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"></highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>cvterm<sp/>table<sp/>has<sp/>two<sp/>unique<sp/>dependencies.<sp/>We<sp/>need<sp/>to<sp/>check<sp/>both.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>first<sp/>check<sp/>the<sp/>(name,<sp/>cv_id,<sp/>is_obsolete)<sp/>constraint.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_obsolete&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$is_obsolete,</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>array(</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvname,</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/>),</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)<sp/>==<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/>$result[0];</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"></highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>dbxref<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm-&gt;dbxref_id);</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;dbxref&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/>$dbxref<sp/>=<sp/>$result[0];</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$dbxref)<sp/>{</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>,</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;Unable<sp/>to<sp/>access<sp/>the<sp/>dbxref<sp/>record<sp/>for<sp/>the<sp/>:term<sp/>cvterm.<sp/>Term<sp/>Record:<sp/>!record&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;:term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,<sp/></highlight><highlight class="stringliteral">&apos;!record&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($cvterm,<sp/>TRUE))</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1082"><highlight class="normal"></highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>db.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbxref-&gt;db_id);</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;db&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/>$db_check<sp/>=<sp/>$result[0];</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>//<sp/>The<sp/>database<sp/>name<sp/>for<sp/>this<sp/>existing<sp/>term<sp/>does<sp/>not<sp/>match<sp/>that<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>//<sp/>one<sp/>provided<sp/>to<sp/>this<sp/>function.<sp/><sp/>The<sp/>CV<sp/>name<sp/>matches<sp/>otherwise<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>//<sp/>wouldn&apos;t<sp/>have<sp/>made<sp/>it<sp/>this<sp/>far.<sp/>So,<sp/>let&apos;s<sp/>swap<sp/>the<sp/>database<sp/>for</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>//<sp/>this<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>if<sp/>($db_check-&gt;name<sp/>!=<sp/>$db-&gt;name)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1093"><highlight class="normal"></highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Look<sp/>to<sp/>see<sp/>if<sp/>the<sp/>correct<sp/>dbxref<sp/>record<sp/>already<sp/>exists<sp/>for<sp/>this</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>database.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>$values<sp/>=<sp/>array(</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;db_id&apos;<sp/>=&gt;<sp/>$db-&gt;db_id,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&apos;accession&apos;<sp/>=&gt;<sp/>$accession,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>chado_select_record(&apos;dbxref&apos;,<sp/>array(&apos;*&apos;),<sp/>$values);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1101"><highlight class="normal"></highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>we<sp/>already<sp/>have<sp/>a<sp/>good<sp/>dbxref<sp/>then<sp/>we<sp/>want<sp/>to<sp/>update<sp/>our<sp/>cvterm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>to<sp/>use<sp/>this<sp/>dbxref.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(count($result)<sp/>&gt;<sp/>0)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$dbxref<sp/>=<sp/>$result[0];</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(&apos;cvterm_id&apos;<sp/>=&gt;<sp/>$cvterm-&gt;cvterm_id);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$values<sp/>=<sp/>array(&apos;dbxref_id&apos;<sp/>=&gt;<sp/>$dbxref-&gt;dbxref_id);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/>chado_update_record(&apos;cvterm&apos;,<sp/>$match,<sp/>$values);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(!$success)<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tripal_report_error(&apos;tripal_cv&apos;,<sp/>TRIPAL_WARNING,<sp/>&quot;Failed<sp/>to<sp/>correct<sp/>the<sp/>dbxref<sp/>id<sp/>for<sp/>the<sp/>cvterm<sp/>&quot;<sp/>.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&apos;$name&apos;<sp/>(id:<sp/>$accession),<sp/>for<sp/>database<sp/>$dbname&quot;,<sp/>NULL);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>0;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>we<sp/>don&apos;t<sp/>have<sp/>the<sp/>dbxref<sp/>then<sp/>we<sp/>want<sp/>to<sp/>delete<sp/>our<sp/>cvterm<sp/>and<sp/>let</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>the<sp/>code<sp/>below<sp/>recreate<sp/>it<sp/>with<sp/>the<sp/>correct<sp/>info.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>else<sp/>{</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(&apos;cvterm_id&apos;<sp/>=&gt;<sp/>$cvterm-&gt;cvterm_id);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>chado_delete_record(&apos;cvterm&apos;,<sp/>$match);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1120"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/>}</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1122"><highlight class="normal"></highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>that<sp/>the<sp/>accession<sp/>matches.<sp/><sp/>Sometimes<sp/>an<sp/>OBO<sp/>can<sp/>define<sp/>a<sp/>term</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>multiple<sp/>times<sp/>but<sp/>with<sp/>different<sp/>accessions.<sp/><sp/>If<sp/>this<sp/>is<sp/>the<sp/>case<sp/>we</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1125"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>can&apos;t<sp/>do<sp/>an<sp/>insert<sp/>or<sp/>it<sp/>will<sp/>violate<sp/>the<sp/>constraint<sp/>in<sp/>the<sp/>cvterm<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>So<sp/>we&apos;ll<sp/>need<sp/>to<sp/>add<sp/>the<sp/>record<sp/>to<sp/>the<sp/>cvterm_dbxref<sp/>table<sp/>instead.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($dbxref-&gt;accession<sp/>!=<sp/>$accession)<sp/>{</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"></highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get/add<sp/>the<sp/>dbxref<sp/>for<sp/>his<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$dbxref_new<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1gacbea95be42e994968414915482a7ff34" kindref="member">chado_insert_dbxref</ref>(array(</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db-&gt;db_id,</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$dbxref_new)<sp/>{</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>find<sp/>or<sp/>insert<sp/>the<sp/>dbxref<sp/>record<sp/>for<sp/>cvterm,<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;$name<sp/>(id:<sp/>$accession),<sp/>for<sp/>database<sp/>$dbname&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"></highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>cvterm_dbxref<sp/>record<sp/>already<sp/>exists.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm-&gt;cvterm_id,</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbxref_new-&gt;dbxref_id,</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_for_definition&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm_dbxref&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"></highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>the<sp/>cvterm_dbxref<sp/>record<sp/>does<sp/>not<sp/>exists<sp/>then<sp/>add<sp/>it</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($result)==0)<sp/>{</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;return_record&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>FALSE,</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm_dbxref&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>);</highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>find<sp/>or<sp/>insert<sp/>the<sp/>cvterm_dbxref<sp/>record<sp/>for<sp/>a<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;duplicated<sp/>cvterm:<sp/><sp/>$name<sp/>(id:<sp/>$accession),<sp/>for<sp/>database<sp/>$dbname&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>original<sp/>cvterm<sp/>with<sp/>the<sp/>same<sp/>name<sp/>and<sp/>return<sp/>that.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($cvtermsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbxref-&gt;accession,<sp/></highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname));</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/>$result-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$cvterm;</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Continue<sp/>on,<sp/>we&apos;ve<sp/>fixed<sp/>the<sp/>record<sp/>if<sp/>the<sp/>db_id<sp/>did<sp/>not<sp/>match.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>can<sp/>now<sp/>perform<sp/>and<sp/>updated<sp/>if<sp/>we<sp/>need<sp/>to.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"></highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>CVterm<sp/>record.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($cvtermsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,<sp/></highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname));</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/>$cvterm<sp/>=<sp/>$result-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$cvterm)<sp/>{</highlight></codeline>
<codeline lineno="1173"><highlight class="normal"></highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>dbxref<sp/>exists<sp/>if<sp/>not,<sp/>add<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/>$dbxref<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1gacbea95be42e994968414915482a7ff34" kindref="member">chado_insert_dbxref</ref>(array(</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db-&gt;db_id,</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$dbxref)<sp/>{</highlight></codeline>
<codeline lineno="1180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>find<sp/>or<sp/>insert<sp/>the<sp/>dbxref<sp/>record<sp/>for<sp/>cvterm,<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;$name<sp/>(id:<sp/>$accession),<sp/>for<sp/>database<sp/>$dbname&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"></highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>dbxref<sp/>already<sp/>has<sp/>an<sp/>entry<sp/>in<sp/>the<sp/>cvterm<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbxref-&gt;dbxref_id);</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/>$check<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count($check)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>add<sp/>the<sp/>cvterm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$ins_values<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$cv-&gt;cv_id,</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$definition,</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$dbxref-&gt;dbxref_id,</highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_obsolete&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$is_obsolete,</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_relationshiptype&apos;</highlight><highlight class="normal"><sp/><sp/>=&gt;<sp/>$is_relationship,</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>$ins_values);</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$is_relationship)<sp/>{</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>insert<sp/>the<sp/>term:<sp/>$name<sp/>($dbname)&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>insert<sp/>the<sp/>relationship<sp/>term:<sp/>$name<sp/>(cv:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$cvname<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>db:<sp/>$dbname)&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>dbxref<sp/>already<sp/>exists<sp/>in<sp/>the<sp/>cvterm<sp/>table.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;The<sp/>dbxref<sp/>already<sp/>exists<sp/>for<sp/>another<sp/>cvterm<sp/>record:<sp/>$name<sp/>(cv:<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$cvname<sp/>.<sp/></highlight><highlight class="stringliteral">&quot;<sp/>db:<sp/>$dbname)&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($cvtermsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,<sp/></highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname));</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/>$result-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>the<sp/>cvterm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/>elseif<sp/>($update)<sp/>{</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"></highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>First,<sp/>basic<sp/>update<sp/>of<sp/>the<sp/>term.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm-&gt;cvterm_id);</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/>$upd_values<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;definition&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$definition,</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_obsolete&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>=&gt;<sp/>$is_obsolete,</highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;is_relationshiptype&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$is_relationship,</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga35aa655c2c929858ab05df18bc807541" kindref="member">chado_update_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>$match,<sp/>$upd_values);</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_cv&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>update<sp/>the<sp/>term:<sp/>$name&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Second,<sp/>check<sp/>that<sp/>the<sp/>dbxref<sp/>has<sp/>not<sp/>changed<sp/>and<sp/>if<sp/>it<sp/>has<sp/>then<sp/>update<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/>$checksql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1238"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>cvterm_id</highlight></codeline>
<codeline lineno="1239"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="1240"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{dbxref}<sp/>DBX<sp/>on<sp/>CVT.dbxref_id<sp/>=<sp/>DBX.dbxref_id</highlight></codeline>
<codeline lineno="1241"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{db}<sp/>DB<sp/>on<sp/>DBX.db_id<sp/>=<sp/>DB.db_id</highlight></codeline>
<codeline lineno="1242"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>on<sp/>CV.cv_id<sp/>=<sp/>CVT.cv_id</highlight></codeline>
<codeline lineno="1243"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>DBX.accession<sp/>=<sp/>:accession<sp/>and<sp/>DB.name<sp/>=<sp/>:dbname<sp/>and<sp/>CVT.name<sp/>=<sp/>:term<sp/>and<sp/>CV.name<sp/>=<sp/>:cvname</highlight></codeline>
<codeline lineno="1244"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1245"><highlight class="normal"><sp/><sp/><sp/><sp/>$check<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($checksql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,<sp/></highlight><highlight class="stringliteral">&apos;:dbname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname,<sp/></highlight><highlight class="stringliteral">&apos;:term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,<sp/></highlight><highlight class="stringliteral">&apos;:cvname&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvname))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$check)<sp/>{</highlight></codeline>
<codeline lineno="1247"><highlight class="normal"></highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>to<sp/>see<sp/>if<sp/>the<sp/>dbxref<sp/>exists<sp/>if<sp/>not,<sp/>add<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$dbxref<sp/>=<sp/><ref refid="da/d96/group__tripal__chado__database__api_1gacbea95be42e994968414915482a7ff34" kindref="member">chado_insert_dbxref</ref>(array(</highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;db_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$db-&gt;db_id,</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession</highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>));</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$dbxref)<sp/>{</highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>find<sp/>or<sp/>insert<sp/>the<sp/>dbxref<sp/>record<sp/>for<sp/>cvterm,<sp/>&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;$name<sp/>(id:<sp/>$accession),<sp/>for<sp/>database<sp/>$dbname&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1258"><highlight class="normal"></highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$match<sp/>=<sp/>array(</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm-&gt;cvterm_id);</highlight></codeline>
<codeline lineno="1260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$upd_values<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;dbxref_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbxref-&gt;dbxref_id,</highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga35aa655c2c929858ab05df18bc807541" kindref="member">chado_update_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>$match,<sp/>$upd_values);</highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,<sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>update<sp/>the<sp/>term<sp/>$name<sp/>with<sp/>new<sp/>accession<sp/>$db:$accession&quot;</highlight><highlight class="normal">,<sp/>NULL);</highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Finally<sp/>grab<sp/>the<sp/>updated<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($cvtermsql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:accession&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$accession,<sp/></highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$dbname));</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/><sp/><sp/>$cvterm<sp/>=<sp/>$result-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Do<sp/>nothing,<sp/>we<sp/>have<sp/>the<sp/>cvterm<sp/>but<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>update.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1276"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Return<sp/>the<sp/>cvterm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1278"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$cvterm;</highlight></codeline>
<codeline lineno="1279"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1280"><highlight class="normal"></highlight></codeline>
<codeline lineno="1281"><highlight class="normal"></highlight></codeline>
<codeline lineno="1317" refid="dc/d32/group__tripal__chado__cv__api_1ga69b904332ab4bdcf7997d7a8d49f2468" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga69b904332ab4bdcf7997d7a8d49f2468" kindref="member">chado_submit_obo_job</ref>($obo)<sp/>{</highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/>global<sp/>$user;</highlight></codeline>
<codeline lineno="1319"><highlight class="normal"></highlight></codeline>
<codeline lineno="1320"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Set<sp/>Defaults</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1321"><highlight class="normal"><sp/><sp/>$obo[</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset($obo[</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">]))<sp/>?<sp/>$obo[</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">]<sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="1322"><highlight class="normal"><sp/><sp/>$obo[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>=<sp/>(isset($obo[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]))<sp/><sp/><sp/>?<sp/>$obo[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="1323"><highlight class="normal"><sp/><sp/>$obo[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/>=<sp/>(isset($obo[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">]))<sp/><sp/><sp/><sp/>?<sp/>$obo[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/><sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="1324"><highlight class="normal"><sp/><sp/>$obo[</highlight><highlight class="stringliteral">&apos;file&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>=<sp/>(isset($obo[</highlight><highlight class="stringliteral">&apos;file&apos;</highlight><highlight class="normal">]))<sp/><sp/><sp/>?<sp/>$obo[</highlight><highlight class="stringliteral">&apos;file&apos;</highlight><highlight class="normal">]<sp/><sp/><sp/>:<sp/>NULL;</highlight></codeline>
<codeline lineno="1325"><highlight class="normal"></highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/>$includes<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/includes/tripal_chado.cv.inc&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/>);</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"></highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($obo[</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_cv_obo}<sp/>WHERE<sp/>obo_id<sp/>=<sp/>:obo_id&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:obo_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$obo[</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">]))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"></highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array($result-&gt;obo_id);</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&quot;Load<sp/>OBO<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$result-&gt;name,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;tripal_cv_load_obo&quot;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($obo[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_cv_obo}<sp/>WHERE<sp/>path<sp/>=<sp/>:url&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$obo[</highlight><highlight class="stringliteral">&apos;url&apos;</highlight><highlight class="normal">]))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"></highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array($result-&gt;obo_id);</highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&quot;Load<sp/>OBO<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$result-&gt;name,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;tripal_cv_load_obo&quot;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>($obo[</highlight><highlight class="stringliteral">&apos;file&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;SELECT<sp/>*<sp/>FROM<sp/>{tripal_cv_obo}<sp/>WHERE<sp/>path<sp/>=<sp/>:file&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/>db_query($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:url&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$obo[</highlight><highlight class="stringliteral">&apos;file&apos;</highlight><highlight class="normal">]))-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"></highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$args<sp/>=<sp/>array($result-&gt;obo_id);</highlight></codeline>
<codeline lineno="1352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="d0/db7/group__tripal__jobs__api_1gae7fa345a83829ddc37f727c8d04c02d6" kindref="member">tripal_add_job</ref>(</highlight><highlight class="stringliteral">&quot;Load<sp/>OBO<sp/>&quot;</highlight><highlight class="normal"><sp/>.<sp/>$result-&gt;name,<sp/></highlight><highlight class="stringliteral">&apos;tripal_chado&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;tripal_cv_load_obo&quot;</highlight><highlight class="normal">,<sp/>$args,<sp/>$user-&gt;uid,<sp/>10,<sp/>$includes);</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1357"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"></highlight></codeline>
<codeline lineno="1374" refid="dc/d32/group__tripal__chado__cv__api_1ga9b54aa52cbf3def613366ddc3da17ace" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga9b54aa52cbf3def613366ddc3da17ace" kindref="member">chado_insert_obo</ref>($name,<sp/>$path)<sp/>{</highlight></codeline>
<codeline lineno="1375"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Make<sp/>sure<sp/>an<sp/>OBO<sp/>with<sp/>the<sp/>same<sp/>name<sp/>doesn&apos;t<sp/>already<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1376"><highlight class="normal"><sp/><sp/>$obo_id<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_cv_obo&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tco&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1377"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tco&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="1378"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/>$name)</highlight></codeline>
<codeline lineno="1379"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;execute()</highlight></codeline>
<codeline lineno="1380"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fetchField();</highlight></codeline>
<codeline lineno="1381"><highlight class="normal"></highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($obo_id)<sp/>{</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/><sp/><sp/>db_update(</highlight><highlight class="stringliteral">&apos;tripal_cv_obo&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(array(</highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$path,</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>))</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;condition(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/>$name)</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$obo_id;</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1392"><highlight class="normal"><sp/><sp/><sp/><sp/>$obo_id<sp/>=<sp/>db_insert(</highlight><highlight class="stringliteral">&apos;tripal_cv_obo&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;fields(array(</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$name,</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;path&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$path,</highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>))</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>-&gt;execute();</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$obo_id;</highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1400"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"></highlight></codeline>
<codeline lineno="1413" refid="dc/d32/group__tripal__chado__cv__api_1ga57d5cbe502404ade3fbd9b52179216f7" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga57d5cbe502404ade3fbd9b52179216f7" kindref="member">chado_get_obo</ref>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>)<sp/>{</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"><sp/><sp/>$query<sp/>=<sp/>db_select(</highlight><highlight class="stringliteral">&apos;tripal_cv_obo&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;tco&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1415"><highlight class="normal"><sp/><sp/><sp/><sp/>-&gt;fields(</highlight><highlight class="stringliteral">&apos;tco&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"></highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tco.name&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(array_key_exists(</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>))<sp/>{</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/>$query-&gt;condition(</highlight><highlight class="stringliteral">&apos;tco.obo_id&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;obo_id&apos;</highlight><highlight class="normal">]);</highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$query-&gt;execute()-&gt;fetchObject();</highlight></codeline>
<codeline lineno="1424"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"></highlight></codeline>
<codeline lineno="1439" refid="dc/d32/group__tripal__chado__cv__api_1gaec265761f247752914cacf25fb748226" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1gaec265761f247752914cacf25fb748226" kindref="member">chado_autocomplete_cv</ref>($string<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1441"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>SELECT<sp/>CV.cv_id,<sp/>CV.name</highlight></codeline>
<codeline lineno="1442"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>FROM<sp/>{cv}<sp/>CV</highlight></codeline>
<codeline lineno="1443"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WHERE<sp/>lower(CV.name)<sp/>like<sp/>lower(:name)</highlight></codeline>
<codeline lineno="1444"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ORDER<sp/>by<sp/>CV.name</highlight></codeline>
<codeline lineno="1445"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>LIMIT<sp/>25<sp/>OFFSET<sp/>0</highlight></codeline>
<codeline lineno="1446"><highlight class="stringliteral"><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$string<sp/>.<sp/></highlight><highlight class="charliteral">&apos;%&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/>$items<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/>$cv)<sp/>{</highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/><sp/><sp/>$items[$cv-&gt;name]<sp/>=<sp/>$cv-&gt;name;</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"></highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/>drupal_json_output($items);</highlight></codeline>
<codeline lineno="1454"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"></highlight></codeline>
<codeline lineno="1470" refid="dc/d32/group__tripal__chado__cv__api_1ga98c6aeb1ed178c8d453c2c582ad07eb9" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga98c6aeb1ed178c8d453c2c582ad07eb9" kindref="member">chado_autocomplete_cvterm</ref>($cv_id,<sp/>$string<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($cv_id)<sp/>{</highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1473"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>CVT.cvterm_id,<sp/>CVT.name</highlight></codeline>
<codeline lineno="1474"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="1475"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>CVT.cv_id<sp/>=<sp/>:cv_id<sp/>and<sp/>lower(CVT.name)<sp/>like<sp/>lower(:name)</highlight></codeline>
<codeline lineno="1476"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>UNION</highlight></codeline>
<codeline lineno="1477"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>CVT2.cvterm_id,<sp/>CVTS.synonym<sp/>as<sp/>name</highlight></codeline>
<codeline lineno="1478"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT2</highlight></codeline>
<codeline lineno="1479"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvtermsynonym}<sp/>CVTS<sp/>ON<sp/>CVTS.cvterm_id<sp/>=<sp/>CVT2.cvterm_id</highlight></codeline>
<codeline lineno="1480"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>CVT2.cv_id<sp/>=<sp/>:cv_id<sp/>and<sp/>lower(CVTS.synonym)<sp/>like<sp/>lower(:name)</highlight></codeline>
<codeline lineno="1481"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>by<sp/>name</highlight></codeline>
<codeline lineno="1482"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>LIMIT<sp/>25<sp/>OFFSET<sp/>0</highlight></codeline>
<codeline lineno="1483"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1484"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:cv_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cv_id,<sp/></highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$string<sp/>.<sp/></highlight><highlight class="charliteral">&apos;%&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1485"><highlight class="normal"><sp/><sp/><sp/><sp/>$items<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/>$term)<sp/>{</highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$items[$term-&gt;name]<sp/>=<sp/>$term-&gt;name;</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>a<sp/>CV<sp/>wasn&apos;t<sp/>provided<sp/>then<sp/>search<sp/>all<sp/>of<sp/>them,<sp/>and<sp/>include<sp/>the<sp/>cv</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>the<sp/>results.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/>$sql<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;</highlight></codeline>
<codeline lineno="1494"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>CVT.cvterm_id,<sp/>CVT.name,<sp/>CV.name<sp/>as<sp/>cvname,<sp/>CVT.cv_id</highlight></codeline>
<codeline lineno="1495"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT</highlight></codeline>
<codeline lineno="1496"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV<sp/>on<sp/>CVT.cv_id<sp/>=<sp/>CV.cv_id</highlight></codeline>
<codeline lineno="1497"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>lower(CVT.name)<sp/>like<sp/>lower(:name)</highlight></codeline>
<codeline lineno="1498"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>UNION</highlight></codeline>
<codeline lineno="1499"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>SELECT<sp/>CVT2.cvterm_id,<sp/>CVTS.synonym<sp/>as<sp/>name,<sp/>CV2.name<sp/>as<sp/>cvname,<sp/>CVT2.cv_id</highlight></codeline>
<codeline lineno="1500"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>FROM<sp/>{cvterm}<sp/>CVT2</highlight></codeline>
<codeline lineno="1501"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cv}<sp/>CV2<sp/>on<sp/>CVT2.cv_id<sp/>=<sp/>CV2.cv_id</highlight></codeline>
<codeline lineno="1502"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>INNER<sp/>JOIN<sp/>{cvtermsynonym}<sp/>CVTS<sp/>ON<sp/>CVTS.cvterm_id<sp/>=<sp/>CVT2.cvterm_id</highlight></codeline>
<codeline lineno="1503"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>WHERE<sp/>lower(CVTS.synonym)<sp/>like<sp/>lower(:name)</highlight></codeline>
<codeline lineno="1504"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>ORDER<sp/>by<sp/>name</highlight></codeline>
<codeline lineno="1505"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>LIMIT<sp/>25<sp/>OFFSET<sp/>0</highlight></codeline>
<codeline lineno="1506"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga73e802bb6e6daa31f712682939c270fb" kindref="member">chado_query</ref>($sql,<sp/>array(</highlight><highlight class="stringliteral">&apos;:name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$string<sp/>.<sp/></highlight><highlight class="charliteral">&apos;%&apos;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/>$items<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1a233d12bd8b6d3453e9a7a3f0b8c31db2" kindref="member">$results</ref><sp/>as<sp/>$term)<sp/>{</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$items[$term-&gt;name]<sp/>=<sp/>$term-&gt;name;</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1513"><highlight class="normal"></highlight></codeline>
<codeline lineno="1514"><highlight class="normal"><sp/><sp/>drupal_json_output($items);</highlight></codeline>
<codeline lineno="1515"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1516"><highlight class="normal"></highlight></codeline>
<codeline lineno="1539" refid="dc/d32/group__tripal__chado__cv__api_1ga721fc931120ef07298e15f4cfd99a749" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga721fc931120ef07298e15f4cfd99a749" kindref="member">chado_associate_cvterm</ref>($basetable,<sp/>$record_id,<sp/>$cvterm,<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref><sp/>=<sp/>array())<sp/>{</highlight></codeline>
<codeline lineno="1540"><highlight class="normal"><sp/><sp/>$linking_table<sp/>=<sp/>$basetable<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_cvterm&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1541"><highlight class="normal"><sp/><sp/>$foreignkey_name<sp/>=<sp/>$basetable<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;_id&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1542"><highlight class="normal"></highlight></codeline>
<codeline lineno="1543"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Default<sp/>Values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1544"><highlight class="normal"><sp/><sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;insert_cvterm&apos;</highlight><highlight class="normal">]<sp/>=<sp/>(isset(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;insert_cvterm&apos;</highlight><highlight class="normal">]))<sp/>?<sp/><ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;insert_cvterm&apos;</highlight><highlight class="normal">]<sp/>:<sp/>FALSE;</highlight></codeline>
<codeline lineno="1545"><highlight class="normal"></highlight></codeline>
<codeline lineno="1546"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>the<sp/>cvterm_id<sp/>is<sp/>not<sp/>set<sp/>then<sp/>find<sp/>the<sp/>cvterm<sp/>record<sp/>using<sp/>the<sp/>name<sp/>and<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1547"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>cv_id.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1548"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!isset($cvterm[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1549"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1551"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($cvterm[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">];</highlight></codeline>
<codeline lineno="1554"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1555"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(isset($cvterm[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="1556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>[</highlight><highlight class="stringliteral">&apos;cv_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;cv_name&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="1558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1559"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_associate_cvterm:<sp/>The<sp/>cvterm<sp/>needs<sp/>to<sp/>have<sp/>either<sp/>the<sp/>cv_name<sp/>or<sp/>cv_id</highlight></codeline>
<codeline lineno="1563"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>supplied.<sp/>You<sp/>were<sp/>trying<sp/>to<sp/>associate<sp/>a<sp/>cvterm<sp/>with<sp/>the<sp/>%base<sp/>%record_id</highlight></codeline>
<codeline lineno="1564"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>and<sp/>supplied<sp/>the<sp/>cvterm<sp/>values:<sp/>%cvterm.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%base&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$basetable,<sp/></highlight><highlight class="stringliteral">&apos;%record_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$record_id,<sp/></highlight><highlight class="stringliteral">&apos;%cvterm&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($cvterm,TRUE))</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1568"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1569"><highlight class="normal"></highlight></codeline>
<codeline lineno="1570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Get<sp/>the<sp/>cvterm.<sp/>If<sp/>it<sp/>doesn&apos;t<sp/>exist<sp/>then<sp/>add<sp/>it<sp/>if<sp/>the<sp/>option</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1571"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;insert_cvterm&apos;<sp/>is<sp/>set.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1572"><highlight class="normal"><sp/><sp/><sp/><sp/>$select<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>(</highlight><highlight class="stringliteral">&apos;cvterm&apos;</highlight><highlight class="normal">,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($select)<sp/>{</highlight></codeline>
<codeline lineno="1574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$select[0]-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="1575"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1576"><highlight class="normal"><sp/><sp/><sp/><sp/>elseif<sp/>(<ref refid="d5/d66/tripal__organism__properties_8tpl_8php_1a011800c63ece4cbbfa77136a20607023" kindref="member">$options</ref>[</highlight><highlight class="stringliteral">&apos;insert_cvterm&apos;</highlight><highlight class="normal">])<sp/>{</highlight></codeline>
<codeline lineno="1577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Insert<sp/>the<sp/>cvterm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$insert<sp/>=<sp/><ref refid="dc/d32/group__tripal__chado__cv__api_1ga8f63166e7d8232eac68393510ddd6411" kindref="member">chado_insert_cvterm</ref>(<ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($insert-&gt;cvterm_id))<sp/>{</highlight></codeline>
<codeline lineno="1580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>=<sp/>$insert-&gt;cvterm_id;</highlight></codeline>
<codeline lineno="1581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_chado_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="1584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_associate_cvterm:<sp/>Unable<sp/>to<sp/>insert<sp/>the<sp/>cvterm<sp/>using<sp/>the<sp/>cvterm<sp/>values:<sp/>%cvterm.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%cvterm&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($cvterm,TRUE))</highlight></codeline>
<codeline lineno="1586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1589"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1590"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="1592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;chado_associate_cvterm:<sp/>The<sp/>cvterm<sp/>doesn&apos;t<sp/>already<sp/>exist.<sp/>You<sp/>supplied<sp/>the<sp/>cvterm<sp/>values:<sp/>%cvterm.&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%cvterm&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>print_r($cvterm,TRUE))</highlight></codeline>
<codeline lineno="1594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1596"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1597"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1598"><highlight class="normal"></highlight></codeline>
<codeline lineno="1599"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Now<sp/>add<sp/>the<sp/>link<sp/>between<sp/>the<sp/>record<sp/>&amp;<sp/>cvterm.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($cvterm[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">]<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref><sp/>=<sp/>array(</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;cvterm_id&apos;</highlight><highlight class="normal">],</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$foreignkey_name<sp/>=&gt;<sp/>$record_id,</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;pub_id&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>1,</highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"></highlight></codeline>
<codeline lineno="1607"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>if<sp/>the<sp/>cvterm<sp/>is<sp/>already<sp/>associated.<sp/>If<sp/>so,<sp/>don&apos;t<sp/>re-add<sp/>it.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>($linking_table,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$result)<sp/>{</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$success<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1ga5c5f09d0a7dc5a6ecf00cc226692bd19" kindref="member">chado_insert_record</ref>($linking_table,<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!$success)<sp/>{</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="d9/dae/group__tripal__notify__api_1ga2240e326e18c3074843ac815e4629ee2" kindref="member">tripal_report_error</ref>(</highlight><highlight class="stringliteral">&apos;tripal_api&apos;</highlight><highlight class="normal">,<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a179264461824ee52a7a08ebef9150e4b" kindref="member">TRIPAL_WARNING</ref>,</highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>insert<sp/>the<sp/>%base<sp/>record<sp/>%term&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>array(</highlight><highlight class="stringliteral">&apos;%base&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$linking_table,<sp/></highlight><highlight class="stringliteral">&apos;%term&apos;</highlight><highlight class="normal"><sp/>=&gt;<sp/>$cvterm[</highlight><highlight class="stringliteral">&apos;name&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>);</highlight></codeline>
<codeline lineno="1616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$result<sp/>=<sp/><ref refid="de/dc4/group__tripal__chado__query__api_1gad84b24dc3ed2e18b053977221f997a35" kindref="member">chado_select_record</ref>($linking_table,<sp/>array(</highlight><highlight class="charliteral">&apos;*&apos;</highlight><highlight class="normal">),<sp/><ref refid="dd/d72/tripal__library__features_8tpl_8php_1affc45c6ace2eeb3f300b054dbf9592b6" kindref="member">$values</ref>);</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1620"><highlight class="normal"></highlight></codeline>
<codeline lineno="1621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(isset($result[0]))<sp/>{</highlight></codeline>
<codeline lineno="1622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$result[0];</highlight></codeline>
<codeline lineno="1623"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1626"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1627"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1628"><highlight class="normal"></highlight></codeline>
<codeline lineno="1629"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="1630"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal_chado/api/modules/tripal_chado.cv.api.inc"/>
  </compounddef>
</doxygen>
