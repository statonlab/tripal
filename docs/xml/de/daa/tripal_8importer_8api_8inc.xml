<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.15">
  <compounddef id="de/daa/tripal_8importer_8api_8inc" kind="file" language="PHP">
    <compoundname>tripal.importer.api.inc</compoundname>
      <sectiondef kind="func">
      <memberdef kind="function" id="d7/dba/group__tripal__importer__api_1ga0b9b25e660436fd04f40af6098ba7385" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>hook_handle_uploaded_file</definition>
        <argsstring>($file, $type)</argsstring>
        <name>hook_handle_uploaded_file</name>
        <param>
          <declname>$file</declname>
        </param>
        <param>
          <declname>$type</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Implements hook_handle_uplaoded_file().</para><para>This is a Tripal hook that allows the module to set the proper parameters for a file uploaded via the Tripal HTML5 uploader.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$file</parametername>
</parameternamelist>
<parameterdescription>
<para>The Drupal file object of the newly uploaded file. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$type</parametername>
</parameternamelist>
<parameterdescription>
<para>The category or type of file.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>A Drupal managed file ID. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.importer.api.inc" line="36" column="1" bodyfile="tripal/api/tripal.importer.api.inc" bodystart="36" bodyend="38"/>
      </memberdef>
      <memberdef kind="function" id="d7/dba/group__tripal__importer__api_1ga1719c27c79b0345e2f2547ec3aca97b4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_get_importers</definition>
        <argsstring>()</argsstring>
        <name>tripal_get_importers</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Retrieves a list of <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> Importers.</para><para>The <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> classes can be added by a site developer that wishes to create a new data loader. The class file should be placed in the [module]/includes/TripalImporter directory. Tripal will support any loader as long as it is in this directory and extends the <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> class.</para><para><simplesect kind="return"><para>A list of <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> names. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.importer.api.inc" line="54" column="1" bodyfile="tripal/api/tripal.importer.api.inc" bodystart="54" bodyend="72"/>
      </memberdef>
      <memberdef kind="function" id="d7/dba/group__tripal__importer__api_1gaaa61a3d63c25553bc9b2884d41f32ca5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_load_include_importer_class</definition>
        <argsstring>($class)</argsstring>
        <name>tripal_load_include_importer_class</name>
        <param>
          <declname>$class</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Loads the <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> class file into scope.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$class</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> class to include.</para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>TRUE if the field type class file was found, FALSE otherwise. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.importer.api.inc" line="85" column="1" bodyfile="tripal/api/tripal.importer.api.inc" bodystart="85" bodyend="98"/>
      </memberdef>
      <memberdef kind="function" id="d7/dba/group__tripal__importer__api_1ga0b16353d8f1230a4a8808bc554d52bf5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_run_importer</definition>
        <argsstring>($import_id, TripalJob $job=NULL)</argsstring>
        <name>tripal_run_importer</name>
        <param>
          <declname>$import_id</declname>
        </param>
        <param>
          <type><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref></type>
          <declname>$job</declname>
          <defval>NULL</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Imports data into the database.</para><para>Tripal provides the <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> class to allow site developers to create their own data loaders. Site users can then use any data loader implemented for the site by submitting the form that comes with the <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> impelmentation. This function runs the importer using the arguments provided by the user.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$import_id</parametername>
</parameternamelist>
<parameterdescription>
<para>The ID of the import record. </para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.importer.api.inc" line="115" column="1" bodyfile="tripal/api/tripal.importer.api.inc" bodystart="115" bodyend="153"/>
      </memberdef>
      <memberdef kind="function" id="d7/dba/group__tripal__importer__api_1ga44555f6f35cfe764ad2f9cf2775e19ce" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_run_importer_post_run</definition>
        <argsstring>($loader, $job)</argsstring>
        <name>tripal_run_importer_post_run</name>
        <param>
          <declname>$loader</declname>
        </param>
        <param>
          <declname>$job</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Second step of the tripal_run_importer.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$loader</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> object. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref> object. </para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.importer.api.inc" line="201" column="1" bodyfile="tripal/api/tripal.importer.api.inc" bodystart="201" bodyend="212"/>
      </memberdef>
      <memberdef kind="function" id="d7/dba/group__tripal__importer__api_1ga7887ddebca49ade985ee6b27c93d4348" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>tripal_run_importer_run</definition>
        <argsstring>($loader, $job)</argsstring>
        <name>tripal_run_importer_run</name>
        <param>
          <declname>$loader</declname>
        </param>
        <param>
          <declname>$job</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>First step of the tripal_run_importer.</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>$loader</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> object. </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>$job</parametername>
</parameternamelist>
<parameterdescription>
<para>The <ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref> object.$this </para></parameterdescription>
</parameteritem>
</parameterlist>
<parameterlist kind="exception"><parameteritem>
<parameternamelist>
<parametername>Exception</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="tripal/api/tripal.importer.api.inc" line="166" column="1" bodyfile="tripal/api/tripal.importer.api.inc" bodystart="166" bodyend="189"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
<para>Provides an application programming interface (API) for working with data file importers using the <ref refid="d8/d2a/classTripalImporter" kindref="compound">TripalImporter</ref> class. </para>    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal">&lt;?php</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="36" refid="d7/dba/group__tripal__importer__api_1ga0b9b25e660436fd04f40af6098ba7385" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga0b9b25e660436fd04f40af6098ba7385" kindref="member">hook_handle_uploaded_file</ref>($file,<sp/>$type)<sp/>{</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal">}</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="54" refid="d7/dba/group__tripal__importer__api_1ga1719c27c79b0345e2f2547ec3aca97b4" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga1719c27c79b0345e2f2547ec3aca97b4" kindref="member">tripal_get_importers</ref>()<sp/>{</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/>$importers<sp/>=<sp/>array();</highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/>$modules<sp/>=<sp/>module_list(TRUE);</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Find<sp/>all<sp/>of<sp/>the<sp/>files<sp/>in<sp/>the<sp/>tripal_chado/includes/fields<sp/>directory.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader_path<sp/>=<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/>$module)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/includes/TripalImporter&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader_files<sp/>=<sp/>file_scan_directory($loader_path,<sp/></highlight><highlight class="stringliteral">&apos;/.inc$/&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Iterate<sp/>through<sp/>the<sp/>fields,<sp/>include<sp/>the<sp/>file<sp/>and<sp/>run<sp/>the<sp/>info<sp/>function.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($loader_files<sp/>as<sp/>$file)<sp/>{</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$class<sp/>=<sp/>$file-&gt;name;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/>$module,<sp/></highlight><highlight class="stringliteral">&apos;includes/TripalImporter/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$class);</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(class_exists($class)<sp/>and<sp/>is_subclass_of($class,<sp/></highlight><highlight class="stringliteral">&apos;TripalImporter&apos;</highlight><highlight class="normal">))<sp/>{</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>$importers[]<sp/>=<sp/>$class;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>$importers;</highlight></codeline>
<codeline lineno="72"><highlight class="normal">}</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="85" refid="d7/dba/group__tripal__importer__api_1gaaa61a3d63c25553bc9b2884d41f32ca5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d7/dba/group__tripal__importer__api_1gaaa61a3d63c25553bc9b2884d41f32ca5" kindref="member">tripal_load_include_importer_class</ref>($class)<sp/>{</highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/>$modules<sp/>=<sp/>module_list(TRUE);</highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">foreach</highlight><highlight class="normal"><sp/>($modules<sp/>as<sp/>$module)<sp/>{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>$file_path<sp/>=<sp/>realpath(</highlight><highlight class="stringliteral">&quot;.&quot;</highlight><highlight class="normal">)<sp/>.<sp/></highlight><highlight class="charliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>.<sp/>drupal_get_path(</highlight><highlight class="stringliteral">&apos;module&apos;</highlight><highlight class="normal">,<sp/>$module)<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;/includes/TripalImporter/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$class<sp/>.<sp/></highlight><highlight class="stringliteral">&apos;.inc&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(file_exists($file_path))<sp/>{</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>module_load_include(</highlight><highlight class="stringliteral">&apos;inc&apos;</highlight><highlight class="normal">,<sp/>$module,<sp/></highlight><highlight class="stringliteral">&apos;includes/TripalImporter/&apos;</highlight><highlight class="normal"><sp/>.<sp/>$class);</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(class_exists($class))<sp/>{</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>TRUE;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>FALSE;</highlight></codeline>
<codeline lineno="98"><highlight class="normal">}</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="115" refid="d7/dba/group__tripal__importer__api_1ga0b16353d8f1230a4a8808bc554d52bf5" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga0b16353d8f1230a4a8808bc554d52bf5" kindref="member">tripal_run_importer</ref>($import_id,<sp/><ref refid="d5/d64/classTripalJob" kindref="compound">TripalJob</ref><sp/>$job<sp/>=<sp/>NULL)<sp/>{</highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/>$loader<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/>$loader<sp/>=<sp/><ref refid="d8/d2a/classTripalImporter_1a484416cee58b2706c581936b36af3142" kindref="member">TripalImporter::byID</ref>($import_id);</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>$loader-&gt;setJob($job);</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>$loader-&gt;prepareFiles();</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nRunning<sp/>&apos;&quot;</highlight><highlight class="normal">.$loader::$name.</highlight><highlight class="stringliteral">&quot;&apos;<sp/>importer&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;\nNOTE:<sp/>Loading<sp/>of<sp/>file<sp/>is<sp/>performed<sp/>using<sp/>a<sp/>database<sp/>transaction.<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;If<sp/>it<sp/>fails<sp/>or<sp/>is<sp/>terminated<sp/>prematurely<sp/>then<sp/>all<sp/>insertions<sp/>and<sp/>\n&quot;</highlight><highlight class="normal"><sp/>.</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;updates<sp/>are<sp/>rolled<sp/>back<sp/>and<sp/>will<sp/>not<sp/>be<sp/>found<sp/>in<sp/>the<sp/>database\n\n&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Run<sp/>the<sp/>loader</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga7887ddebca49ade985ee6b27c93d4348" kindref="member">tripal_run_importer_run</ref>($loader,<sp/>$job);</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Handle<sp/>the<sp/>post<sp/>run.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga44555f6f35cfe764ad2f9cf2775e19ce" kindref="member">tripal_run_importer_post_run</ref>($loader,<sp/>$job);</highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>for<sp/>tables<sp/>with<sp/>new<sp/>cvterms</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/>print<sp/></highlight><highlight class="stringliteral">&quot;Remapping<sp/>Chado<sp/>Controlled<sp/>vocabularies<sp/>to<sp/>Tripal<sp/>Terms...&quot;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d6/ddf/tripal__chado_8mapping_8inc_1afc4316a90530625e0bfe663e15cb2cdf" kindref="member">tripal_chado_map_cvterms</ref>();</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>for<sp/>new<sp/>fields<sp/>and<sp/>notify<sp/>the<sp/>user.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="d5/dce/group__tripal__entities__api_1ga118e7306cc739fe083689877cd863984" kindref="member">tripal_tripal_cron_notification</ref>();</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Clear<sp/>the<sp/>Drupal<sp/>cache</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>cache_clear_all();</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job)<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$job-&gt;logMessage($e-&gt;getMessage(),<sp/>array(),<sp/><ref refid="dd/d45/tripal_8notice_8api_8inc_1a4b04c4b1ce52da710d57abf5c4b09dd3" kindref="member">TRIPAL_ERROR</ref>);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($loader)<sp/>{</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$loader-&gt;cleanFile();</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="153"><highlight class="normal">}</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="166" refid="d7/dba/group__tripal__importer__api_1ga7887ddebca49ade985ee6b27c93d4348" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga7887ddebca49ade985ee6b27c93d4348" kindref="member">tripal_run_importer_run</ref>($loader,<sp/>$job)<sp/>{</highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>begin<sp/>the<sp/>transaction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader-&gt;run();</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>($job)<sp/>{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$job-&gt;logMessage(</highlight><highlight class="stringliteral">&quot;\nDone.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="177"><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>temp<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!empty($details-&gt;arguments[</highlight><highlight class="stringliteral">&apos;file_url&apos;</highlight><highlight class="normal">]))<sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>$loader-&gt;logMessage(</highlight><highlight class="stringliteral">&apos;Removing<sp/>downloaded<sp/>file...&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>unlink($temp);</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rollback<sp/>and<sp/>re-throw<sp/>the<sp/>error.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>$e;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="189"><highlight class="normal">}</highlight></codeline>
<codeline lineno="201" refid="d7/dba/group__tripal__importer__api_1ga44555f6f35cfe764ad2f9cf2775e19ce" refkind="member"><highlight class="keyword">function</highlight><highlight class="normal"><sp/><ref refid="d7/dba/group__tripal__importer__api_1ga44555f6f35cfe764ad2f9cf2775e19ce" kindref="member">tripal_run_importer_post_run</ref>($loader,<sp/>$job)<sp/>{</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>transaction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction<sp/>=<sp/>db_transaction();</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/>$loader-&gt;postRun();</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">catch</highlight><highlight class="normal"><sp/>(Exception<sp/>$e)<sp/>{</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Rollback<sp/>and<sp/>re-throw<sp/>the<sp/>error.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/>$transaction-&gt;rollback();</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">throw</highlight><highlight class="normal"><sp/>$e;</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="212"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="tripal/api/tripal.importer.api.inc"/>
  </compounddef>
</doxygen>
